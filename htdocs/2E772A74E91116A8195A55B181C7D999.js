!function(e,n,t,i,r,o,l,c,a,s,d,u,f,m,h,p,g,w,k,b,y,v,x,M){!function(e){let n=e.require("AppModule"),i=t.define=n.define;y.assign(i,{panel:e.panel,view:e.view,module:e.define,data:e.data,route:e.route,proxy:e.proxy}),i.data(["/ModuleTree/API/Data","/ModuleTree/Tree/Data","/ModuleTree/Tree","/ModuleTree/Main/ModuleInfo/Base"],{none:"(app)"}),i.data({"Settings.Header":"hide","Settings.Language":"chinese","Settings.Theme":"light"}),e.config({API:{url:`${r.origin}/api/`},Proxy:{base:"api/"},App:{name:`webpart-server-${r.port}`},Masker:{fadeIn:200,fadeOut:200}})}(t.definejs),f("data.Sidebar",function(e,n,t){return[{language$name:{chinese:"首页",english:"Home"},icon:"fas fa-home",view:"Home",args:[]},{language$name:{chinese:"文件资源",english:"Files"},icon:"fa fa-folder-open",view:"FileList",args:[]},{language$name:{chinese:"模块系统",english:"Module Tree"},icon:"fab fa-connectdevelop",view:"ModuleTree",args:[]},{language$name:{chinese:"html 系统",english:"HTML Tree"},icon:"fa fa-sitemap",view:"HtmlTree",args:[]},{language$name:{chinese:"日志",english:"Logs"},icon:"fas fa-comment-dots",view:"Log",args:[]},{language$name:{chinese:"写文档",english:"Markdoc"},icon:"fa fa-edit",view:"DocAdd"},{language$name:{chinese:"终端",english:"Terminal"},icon:"fas fa-terminal",view:"Terminal",args:[]},{language$name:{chinese:"常用工具",english:"Tools"},icon:"fas fa-tools",view:"Tool",args:[]},{language$name:{chinese:"代理",english:"Proxy"},icon:"fas fa-network-wired",view:"Proxy",args:[]},{language$name:{chinese:"偏好设置",english:"Settings"},icon:"fas fa-cogs",view:"Setting",args:[]},{language$name:{chinese:"帮助手册",english:"Help"},icon:"fa fa-question-circle",view:"Help",args:[]}]}),f("CheckBox.defaults",{checked:!1,fireNow:!0,checkedClass:"far fa-check-square checked",uncheckedClass:"far fa-square"}),f("CheckBox",function(e,n,t){const i=e("$"),r=e("@definejs/object"),o=e("@definejs/template"),l=e("@definejs/emitter");let c=e("CheckBox.defaults"),a=new Map,s=new o("#tpl-CheckBox");return class{constructor(e){e=y.assign({},c,e);let n=new l(this),t={checked:e.checked,text:e.text,fireNow:e.fireNow,checkedClass:e.checkedClass,uncheckedClass:e.uncheckedClass,$:i(e.container),emitter:n,bind:!1};a.set(this,t)}render(e={}){let n=a.get(this),t=r.filter(e,["checked","text"]);y.assign(n,t);let i=s.fill({class:n.checked?n.checkedClass:n.uncheckedClass,text:n.text});n.$.html(i),n.$.addClass("CheckBox"),n.fireNow&&n.emitter.fire("checked",[n.checked]),n.bind||(n.$.on("click",function(e){let t=n.checked=!n.checked,i=n.$.find("i");t?(i.removeClass(n.uncheckedClass),i.addClass(n.checkedClass)):(i.removeClass(n.checkedClass),i.addClass(n.uncheckedClass)),n.emitter.fire("checked",[t])}),n.bind=!0)}on(...e){a.get(this).emitter.on(...e)}destroy(){let e=a.get(this);e.emitter.destroy(),e.$=null,a.delete(this)}}}),f("Dialog/Drager",function(e,n,r){const o=e("$"),l=e("@definejs/masker");let c=0,a=0,s=0,d=0,u="",f=i.body,m=null,h={},p=null;function g(e){f.style.cursor=u,p&&p.$.removeClass("draging"),m&&m.hide(),e&&e.preventDefault(),p=null}return o(f).on({mousedown:function(e){(p=h[e.target.id])&&(c=e.pageX,a=e.pageY,u=f.style.cursor,f.style.cursor="move",s=p.$.css("margin-left"),d=p.$.css("margin-top"),s=parseInt(s),d=parseInt(d),p.$.addClass("draging"),(m=m||new l({opacity:0,background:"red","z-index":1025})).show(),t.getSelection().removeAllRanges())},mousemove:function(e){if(!p)return;if(1!=e.which)return void g();let n=e.pageX-c,t=e.pageY-a,i=s+n,r=d+t;p.$.css({"margin-left":i,"margin-top":r})},mouseup:function(e){g(e)}}),{set:function(e,n){h[e]=n},remove:function(e){delete h[e]}}}),f("Dialog/Events",function(e,n,t){const r=e("$");return{bind:function(e){let n={keyup:function(n){13==n.keyCode&&e.visible&&(n.stopPropagation(),e.emitter.fire("enter",[n]))}};r(i.body).on(n),r("#"+e.id).on(n),r("#"+e.headerId).on("click","i",function(){e.this.close()}),r("#"+e.footerId).on("click","button[data-index]",function(){let n=+this.getAttribute("data-index"),t=e.footer.buttons[n],i=t.name||x(n);e.emitter.fire("button",i,[t,n]),e.emitter.fire("button",[t,n]),("autoClose"in t?t.autoClose:e.autoClose)&&e.this.close(!0)})}}}),f("Dialog/Meta",function(e,n,t){const i=e("@definejs/string");return{create:function(e,n){let t="Dialog-"+i.random(4),r=e.footer;r=m.isArray(r)?{content:"",buttons:r}:"string"==typeof r?{content:r,buttons:[]}:r||{};let o={dragable:e.dragable,resizable:e.resizable,cssClass:e.cssClass,autoClose:e.autoClose,mask:e.mask,"z-index":e["z-index"],width:e.width,height:e.height,container:e.container,title:e.title,content:e.content,footer:r,maxWidth:e.maxWidth,minWidth:e.minWidth,maxHeight:e.maxHeight,minHeight:e.minHeight,attributes:e.attributes,masker:null,id:t,headerId:t+"-header",contentId:t+"-content",footerId:t+"-footer",sizerId:t+"-sizer",rendered:!1,visible:!1,$:null,this:this};return y.assign(o,n),o}}}),f("Dialog/Resizer",function(e,n,t){const r=e("$");let o=0,l=0,c=0,a=0,s="",d=i.body,u={},f=null,m=null,h=null;function p(e){d.style.cursor=s,e&&e.preventDefault(),m&&m.removeClass("resizing"),f=null,m=null,h=null}function g(e,n){let t=e+" x "+n;h.html(t)}return r(d).on({mousedown:function(e){let n=e.target,t=n.getAttribute("data-id");if(f=u[t])return o=e.pageX,l=e.pageY,s=d.style.cursor,d.style.cursor=r(n).css("cursor"),c=f.$.css("width"),a=f.$.css("height"),c=parseInt(c),a=parseInt(a),(m=r("#"+f.headerId)).addClass("resizing"),h=r("#"+f.sizerId),g(c,a),!1},mousemove:function(e){if(!f)return;if(1!=e.which)return void p();let n=e.pageX-o,t=e.pageY-l,i=c+n,r=a+t,s=f.maxWidth;s&&i>s&&(i=s);let d=f.minWidth;d&&i<d&&(i=d);let u=f.maxHeight;u&&r>u&&(r=u);let m=f.minHeight;m&&r<m&&(r=m),f.$.css({width:i,height:r}),g(i,r)},mouseup:function(e){p(e)}}),{set:function(e,n){u[e]=n},remove:function(e){delete u[e]}}}),f("Dialog/Style",function(e,n,t){const i=e("@definejs/object");function r(e){return(e=0-(e=parseInt(e))/2)+"px"}return{get:function(e){var n=i.filter(e,["height","width","z-index"]),t=n.width;t?(n.width=parseInt(t)+"px",n["margin-left"]=r(t)):delete n.width;var o=n.height;o?(n.height=parseInt(o)+"px",n["margin-top"]=r(o)):delete n.height;var l=[];for(var c in n){var a=c+": "+n[c];l.push(a)}return n=l.join("; ")+";"}}}),f("Dialog/Template",function(e,n){let t=new(e("@definejs/template"))("#tpl-Dialog");return t.process({"":function(e){let n=this.fill("header",e),t=this.fill("content",e),i=this.fill("footer",e),r=y.entries(e.attributes).map(function(e){return e[0]+'="'+e[1]+'"'});return this.fix("attributes"),{id:e.id,headerId:e.headerId,contentId:e.contentId,footerId:e.footerId,attributes:r.join(" "),cssClass:e.cssClass,style:e.style,header:n,content:t,footer:i}},header:function(e){return{title:e.title,sizerId:e.sizerId}},content:function(e){return e.content},footer:{"":function(e){let n=e.footer;return{content:this.fill("content",n),buttons:this.fill("buttons",n),resizer:this.fill("resizer",e)}},content:function(e){return e.content},buttons:{"":function(e){let n=e.buttons;return n&&0!=n.length?{buttons:n=this.fill("button",n)}:""},button:function(e,n){return{index:n,text:e.text,cssClass:e.cssClass||""}}},resizer:function(e){return e.resizable?{id:e.id}:""}}}),t}),f("Dialog.defaults",{cssClass:"",mask:!0,title:"",content:"",width:0,height:0,"z-index":1024,maxWidth:0,maxHeight:0,minWidth:200,minHeight:160,dragable:!0,resizable:!0,autoClose:!0,attributes:{},footer:{content:"",buttons:[]}}),f("Dialog",function(e,n,t){const r=e("$"),o=e("@definejs/emitter"),l=e("@definejs/masker"),c=e("@definejs/panel"),a=n.require("Meta"),s=n.require("Template"),d=n.require("Drager"),u=n.require("Resizer"),f=n.require("Style"),h=n.require("Events");let p=e("Dialog.defaults"),g=new Map;function w(e){e=y.assign({},p,e);let n=new o(this),t=a.create(e,{this:this,emitter:n});g.set(this,t),this.id=t.id,this.$=t.$}return w.prototype={constructor:w,id:"",$:null,render:function(e){e=e||{};let n=g.get(this),t=n.emitter;if(n.rendered)return this.set(e),this.show(),void t.fire("render",[e]);let o=n.title=e.title||n.title,c=n.content=e.content||n.content,a=n.footer=e.footer||n.footer,m=f.get(n),p=n.headerId,w=s.fill({id:n.id,headerId:p,contentId:n.contentId,footerId:n.footerId,sizerId:n.sizerId,cssClass:n.cssClass,resizable:n.resizable,attributes:n.attributes,style:m,title:o,content:c,footer:a});r(i.body).prepend(w),n.rendered=!0,this.$=n.$=r("#"+n.id),n.$.toggleClass("auto-size",!n.width||!n.height),n.mask&&(n.masker=new l({"z-index":n["z-index"]-1})),n.dragable&&d.set(p,n),n.resizable&&u.set(n.id,n),h.bind(n),this.show(),t.fire("first-render",[e]),t.fire("render",[e])},show:function(){let e=g.get(this);if(!e.rendered||e.visible)return;let n=e.masker;if(n){let t=l.normalize(e.mask);n.show(t)}e.$.show(),e.visible=!0,e.emitter.fire("show")},close:function(e){let n=g.get(this);if(!n.rendered||!n.visible)return;let t=n.emitter;if(!e){if(!1===(e=t.fire("before-close").slice(-1)[0]))return}let i=n.masker;i&&i.hide(),n.$.hide(),n.visible=!1,t.fire("close")},set:function(e,n){let t="object"==typeof e?e:{[e]:n},i=g.get(this),o={title:"header",content:"content",footer:"footer"};for(e in t){let l=o[e];if(l){let e=s.fill(l,t),n=i[l+"Id"];r("#"+n).html(e)}else switch(n=t[e],e){case"width":case"height":i.$.css(e,n)}}},on:function(e,n){let t=g.get(this).emitter,i=m.from(arguments);t.on(i)},destroy:function(){let e=g.get(this);if(!e)return;e.emitter.destroy(),e.masker.destroy(),e.$.off();let n=e.$.get(0);n.parentNode.removeChild(n),d.remove(e.headerId),u.remove(e.id)}},y.assign(w,{panel:function(e){let n=e.content,t=e.container,i=e.footer,r=n.$.get(0),o=t.$.get(0),l=i&&!m.isArray(i)?i.$.get(0):null,a={};m.from(o.attributes).map(function(e){let n=e.name;"class"!=n&&(a[n]=e.value)});let s=y.assign({},e,{content:r.outerHTML,cssClass:o.className,attributes:a});s.footer=l?l.outerHTML:i;let d=new w(s);return d.on({"first-render":function(){o.parentNode.removeChild(o),r.parentNode.removeChild(r),l&&l.parentNode.removeChild(l),t.set("$");let e=`[data-panel^="${o.getAttribute("data-panel")}"]`,n=t.$.find(e).toArray();n=n.map(function(e){return e.getAttribute("data-panel")}),c.update(n),o=null,r=null,l=null}}),d}}),w}),f("DropCheckList/Events",function(e,n,t){e("$");return{bind:function(e){e.binded||(e.binded=!0,e.$.on("click","button",function(n){e.visible?e.masker.hide():e.masker.show()}),e.$.on("click",'[data-id="chk-all"]',function(n){let{list:t,all:i,tpl:r,emitter:o,$list:l}=e,c=!i.checked;i.fill(c);let a=r.fill("item",t);l.html(a),o.fire("check","all",[c,t]),o.fire("check",[t])}),e.$.on("click","li[data-index]",function(n){let{list:t,all:i,tpl:r,emitter:o}=e,l=+this.dataset.index,c=t[l];c.checked=!c.checked,i.fill();let a=r.fill("item",c,l);this.outerHTML=a,o.fire("check","item",[c,l,t]),o.fire("check",[t])}))}}}),f("DropCheckList/Masker",function(e,n,t){const i=e("@definejs/masker");return{create:function(e){let n=new i({volatile:!0,opacity:0});return n.on({show:function(){e.$.addClass("show"),e.visible=!0,e.$main.slideDown(80)},hide:function(){e.$.removeClass("show"),e.visible=!1,e.$main.slideUp(50)}}),n}}}),f("DropCheckList/Meta",function(e,n,t){let i=new(e("@definejs/id-maker"))(n.parent.id);return{create:function(e,n){let{container:t,list:r,text:o}=e,l={id:i.next(),$:null,this:null,emitter:null,masker:null,tpl:null,$main:null,$list:null,$container:$(t),text:o,width:e.width||"auto",maxTextWidth:0,container:t,list:r||[],binded:!1,visible:!1,all:{$:null,text:"全选",checked:!1,fill(e){let{all:n,list:t,tpl:i}=l,r=t.length,o=0;"boolean"==typeof e?(o=e?r:0,n.checked=e,t.forEach(n=>{n.checked=e})):(t.forEach(e=>{e.checked&&o++}),e=n.checked=o>0&&o==r);let c=i.fill("all",{text:n.text,checked:e,count:o,total:r});l.$.toggleClass("not-all-checked",!e),n.$.html(c)}}};return y.assign(l,n),l}}}),f("DropCheckList/Template",function(e,n){const t=e("@definejs/string"),i=e("@definejs/template");return{create:function(e){let n=new i("#tpl-DropCheckList");return n.process({"":function(){return{id:e.id,text:e.text}},all:function(e){return{checked:e.checked?"checked":"",icon:e.checked?"check-":"",text:e.text,count:e.count,total:e.total}},item:function(n,i){let{text:r,checked:o}=n,l=8*t.getByteLength(r);return e.maxTextWidth=k.max(l,e.maxTextWidth),{index:i,text:r,checked:o?"checked":"",icon:o?"check-":""}}}),n}}}),f("DropCheckList.defaults",{}),f("DropCheckList",function(e,n,t){const i=e("@definejs/emitter"),r=n.require("Meta"),o=n.require("Template"),l=n.require("Events"),c=n.require("Masker"),a=e("DropCheckList.defaults"),s=new Map;return class{constructor(e){e=y.assign({},a,e);let n=new i(this),t=r.create(e,{emitter:n,this:this});s.set(this,t),y.assign(this,{id:t.id,$:t.$})}render(e){let n=s.get(this);if(e&&(n.list=e),n.$)return void this.fill();let t=(n.tpl=o.create(n)).fill({});$(n.container).html(t),n.$=this.$=$(`#${n.id}`),n.$main=n.$.find('[data-id="main"]'),n.all.$=n.$.find('[data-id="all"]'),n.$list=n.$.find('[data-id="list"]'),n.masker=c.create(n),l.bind(n),this.fill()}fill(e){let n=s.get(this);e=n.list=e||n.list;let t=n.width,i=n.tpl.fill("item",e);n.all.fill(),n.$list.html(i),"auto"==t&&(t=n.maxTextWidth+50),t>0&&(t=k.max(t,110),n.$main.width(t),n.all.$.width(t)),n.emitter.fire("fill",[e])}on(...e){s.get(this).emitter.on(...e)}}}),f("DropList/Current",function(e,n,t){let i={item:null,row:null,event:null,hover:null,keyword:"",html:""};return{create:function(){return y.assign({},i)},reset:function(e,n){n=n||{},y.assign(e.current,i,n),e.this.hover(0)}}}),f("DropList/Field",function(e,n,t){function i(e,n){return"function"==typeof n?n(e):e[n]}return{map:function(e,n){return n=n||[],e?n=n.map(function(n){return{id:e.id?i(n,e.id):"",title:e.title?i(n,e.title):"",item:n,disabled:!1}}):n}}}),f("DropList/Filter",function(e,n,t){return{bind:function(e){let n=e.filters;e.this.on("change",function(t){this.fill(e.list,t,function(e,i){return!n||function(e,n,t){let i=n.length;for(let r=0;r<i;r++){let i=n[r],o=!1;if("object"==typeof i){let e=i;i=e.name,o=e.ignoreCase}let l=e[i];if("number"==typeof l&&(l=x(l)),"string"==typeof l&&(o&&(l=l.toLowerCase(),t=t.toLowerCase()),l.includes(t)))return!0}return!1}(e,n,t)})})}}}),f("DropList/Input",function(e,n,t){const r=e("$");return{create:function(e){let n=i.getElementById(e.txtId),t=!1;return r(n).on({focus:function(){e.disabled||(e.masker.show(),function(e){let n=e.field,t=e.current.item;if(!n||!n.focus||!t)return;let i=e.getValue(t.item,n.focus);e.this.set("text",i),e.this.select()}(e))},blur:function(){e.hovering||(e.masker.hide(),function(e){let n=e.field,t=e.current.item;if(!n||!n.text||!t)return;let i=e.getValue(t.item,n.text);e.this.set("text",i)}(e))},click:function(e){},input:function(){t||e.change()},compositionstart:function(e){t=!0},compositionend:function(n){t=!1,e.change()},keydown:function(t){let i=t.keyCode,r=e.current,o=r.hover;if(13==i)return r.event=t,o&&e.this.select(o.index),void n.blur();let l=o?o.index:-1,c=38==i,a=40==i,s=e.length-1;(c||a)&&((l=c?l-1:l+1)<0?l=s:l>s&&(l=0),e.this.hover(l),t.preventDefault())}}),n}}}),f("DropList/Masker",function(e,n,t){const i=e("@definejs/masker");return{create:function(e){let n=new i({volatile:!0,opacity:e.mask,container:e.dialog,position:"absolute"});return n.on({show:function(){e.$.addClass("on"),e.visible=!0,e.adjust(),e.$table.get(0).scrollIntoViewIfNeeded();let n=e.current.row;n&&n.element.scrollIntoViewIfNeeded(),e.emitter.fire("focus")},hide:function(){let n=e.old.item;if(""===e.txt.value&&!e.empty&&n&&(e.this.fill(e.list),e.this.select(n)),!e.custom&&!e.current.item&&!!e.text)return e.$txt.addClass("error"),u.alert("输入的数据不存在，请重新输入。",function(){e.txt.focus()}),!1;e.$.removeClass("on"),e.visible=!1,e.emitter.fire("blur")}}),n}}}),f("DropList/Meta",function(e,n,t){const i=e("@definejs/string"),r=e("$");return{create:function(e,n){let t=e.filters,o=e.columns;!0===t&&(t=o||null);let l={id:i.random(),txtId:i.random(),tableId:i.random(),$:null,$table:null,$txt:null,txt:null,this:null,emitter:null,table:null,masker:null,tpl:null,container:e.container,cssClass:e.cssClass,tableClass:e.tableClass,text:e.text,readonly:e.readonly,disabled:e.disabled,custom:e.custom,order:e.order,empty:e.empty,mask:e.mask,dialog:e.dialog,field:e.field,tabIndex:e.tabIndex,maxLength:e.maxLength,columns:o,filters:t,direction:"",visible:!1,hovering:!1,list:[],length:0,current:{},old:{},getValue:function(e,n){return"function"==typeof n?n(e):e[n]},change:function(e){let n=arguments.length>0,t=l.txt,i=r(t);if((e=n?x(e):t.value)===l.text)return;let o=""===e;i.removeClass("error"),l.text=t.title=e,n&&(t.value=e),n||l.emitter.fire("change",[e]),o&&l.emitter.fire("empty",[]),t.placeholder=l.current.item&&o?"(无内容)":""},adjust:function(){if(!l.visible)return;l.$.removeClass("right");let e=l.$table.outerWidth(),n=r(l.dialog).width(),t=l.$table.offset().left-r(l.dialog).offset().left,i=l.direction=t+e>n?"right":"left";l.$.toggleClass("right","right"==i)}};return y.assign(l,n),l}}}),f("DropList/Table",function(e,n,t){const i=e("@definejs/escape"),r=e("Table");return{create:function(e){let n=e.columns.map(function(e){return{name:e}}),t=new r({container:"#"+e.tableId,fields:n,order:e.order,class:e.tableClass,columnName:"name"});return t.on("process",{row:function(n){let t=e.field.title;t&&(n.title=e.getValue(n.data.item,t))},cell:function(n){let t=e.emitter.fire("process",[n]).slice(-1)[0];t===M&&(t=null==(t=n.row.data.item[n.name])?"":t,t=i.html(t));let r=e.current,o=r.keyword;return t.includes(o)&&r.index<0&&(r.index=n.row.index),o&&(t=x(t).split(o).join(r.html)),t}}),t.on("fill",function(n){let t=e.length=n.length,i=k.max(e.current.index,0);e.$table.removeClass("loading").toggleClass("nodata",!t),e.$txt.removeClass("error"),e.this.hover(i),e.adjust()}),t.on("render",function(){this.$.on("mouseover",function(){e.hovering=!0}),this.$.on("mouseout",function(){e.hovering=!1})}),t.on("click",{row:function(n,t){e.current.event=t,e.this.select(n.index)}}),t},getRow:function(e,n){let t=e.get("rows"),i=typeof n;if("number"==i)return t[n];if("function"==i)return t.find(function(e,t){return n(e.data,t)});if(!n)return null;let r=n;return"object"==i&&(r=x(n.id)),t.find(function(e,n){return e.data.id==r})}}}),f("DropList/Template",function(e,n){const t=e("@definejs/template");return{create:function(e){let n=new t("#tpl-DropList");return n.process({"":function(){this.fix(["maxlength","readonly","disabled","tabIndex"]);let n=e.tabIndex,t=e.maxLength;return n=n?'tabindex="'+n+'"':"",t=t?'maxlength="'+e.maxLength+'"':"",{txtId:e.txtId,tableId:e.tableId,text:e.text,readonly:e.readonly?"readonly":"",disabled:e.disabled?"disabled":"",tabindex:n,maxlength:t}}}),n}}}),f("DropList.defaults",function(e,n,t){return{cssClass:"DropList",tableClass:"",text:"",readonly:!1,disabled:!1,custom:!1,order:!1,empty:!1,mask:0,dialog:i.body,columns:[],field:null,filters:!0,container:null,tabIndex:"",maxLength:0}}),f("DropList",function(e,n){const t=e("$"),i=e("@definejs/emitter"),r=e("@definejs/array"),o=e("@definejs/object"),l=n.require("Current"),a=n.require("Field"),d=n.require("Filter"),u=n.require("Input"),f=n.require("Masker"),m=n.require("Meta"),h=n.require("Table"),p=n.require("Template"),g=e("DropList.defaults");let w=new Map;function $(e){e=y.assign({},g,e);let n=new i(this),t=l.create(),r=m.create(e,{emitter:n,current:t,this:this});w.set(this,r),y.assign(this,{id:r.id,$:r.$,meta:r}),d.bind(r)}return $.prototype={constructor:$,id:"",$:null,render:function(e){let n=w.get(this),i=(n.tpl=p.create(n)).fill(n);n.$=this.$=t(n.container),n.$.html(i),n.$.addClass(n.cssClass),(n.table=h.create(n)).render(),n.txt=u.create(n),n.masker=f.create(n),n.$table=t("#"+n.tableId),n.$txt=t(n.txt),e&&this.fill(e)},fill:function(e,n,t){"function"==typeof n&&(t=n,n="");let i=w.get(this);e=r.map(e,function(e,n){if(!t)return e;let r=t.call(i.this,e,n);return!1===r?null:"object"==typeof r?r:e}),n||(i.list=e);let o=a.map(i.field,e),c=n?i.tpl.fill("keyword",{keyword:n}):"",s=i.current;s.item&&y.assign(i.old,s),l.reset(i,{keyword:n,html:c,index:-1}),i.table.fill(o),i.emitter.fire("fill",[e])},select:function(e){let n=w.get(this),i=n.txt;if(0==arguments.length)return i.select(),i.value;let r=h.getRow(n.table,e);if(!r)return void c.warn("要选择的项无法找到:",e);let o=r.data;if(o.disabled)return void c.warn("要选择的项已给禁用:",o);let l=n.current;if(l.item===o)return n.masker&&n.masker.hide(),void c.warn("要选择的项已给选中:",o);let a=l.row,d=l.item,u=l.event;l.row=r,l.item=o,l.event=null,a&&t(a.element).removeClass("on"),t(r.element).addClass("on"),n.$txt.removeClass("error"),r.element.scrollIntoViewIfNeeded(),this.hover(r.index),u&&s(function(){n.visible&&n.masker&&n.masker.hide()},50);let f=n.field;if(f&&f.text){let e=n.getValue(o.item,f.text);this.set("text",e)}n.emitter.fire("select",[o,{index:r.index,row:r,item:o,event:u,keyword:l.keyword,oldRow:a,oldItem:d}])},hover:function(e){let n=w.get(this),i=n.table.get(e),r=n.current.hover;if(!i)return r&&t(r.element).removeClass("hover"),void(n.current.hover=null);i!==r&&(n.current.hover=i,r&&t(r.element).removeClass("hover"),t(i.element).addClass("hover"),i.element.scrollIntoViewIfNeeded())},set:function(e,n){let t=o.isPlain(e)?e:{[e]:n},i=w.get(this);o.each(t,function(e,n){switch(e){case"text":i.change(n);break;case"disabled":n=!!n,i.txt.disabled=i.disabled=n;break;case"list":i.list=n||[]}})},get:function(e){let n=w.get(this),t=n.current;if(!e)return t.item;switch(e){case"text":case"disabled":case"length":return n[e]}},reset:function(){let e=w.get(this),n=e.current.row;n&&t(n.element).removeClass("on hover"),e.old={},l.reset(e),this.set({text:"",disabled:!1}),e.emitter.fire("reset")},on:function(){w.get(this).emitter.on(...arguments)},destroy:function(){let e=w.get(this);e&&(e.emitter.destroy(),e.table.destroy(),e.masker.destroy(),e.tpl.destroy(),e.current=null,e.$=null,e.txt=null,e.this=null,e.$txt=null,e.$table=null,e.masker=null,w.delete(this))}},$}),f("File/API",function(e,n,t){const i=e("@definejs/emitter"),r=e("@definejs/loading"),o=e("API");return{create(){let e=new i,n=new r({mask:0});return{on:e.on.bind(e),read:function(t,i){let r=new o("FileList.read",{});r.on({request:function(){n.show("加载中...")},response:function(){n.hide()},success:function(n,t,i){e.fire("success","read",[n])},fail:function(e,n,t,i){u.alert("获取文件内容失败: {0}",n)},error:function(e,n,t,i){u.alert("获取文件内容错误: 网络繁忙，请稍候再试")}}),t.startsWith("/")||(t=t.split("/").slice(1).join("/")),r.get({id:t})}}}}}),f("File/Ext",function(e,n,t){return{get(e){if(!e.includes("."))return"";let n=e.split(".").slice(-1)[0];return n=(n=n?`.${n}`:"").toLowerCase()}}}),f("File/Icon",function(e,n,t){let i={dir:"fa fa-folder",file:"fas fa-file-alt",".css":"fab fa-css3-alt",".doc":"fas fa-file-word",".docx":"fas fa-file-word",".html":"fab fa-html5",".js":"fab fa-node-js",".json":"fab fa-npm",".less":"fab fa-less",".md":"fab fa-markdown",".map":"fas fa-globe",".bmp":"fas fa-file-image",".jpg":"fas fa-file-image",".png":"fas fa-file-image"};return{get({type:e,ext:n}){if("dir"==e){let n=i.dir,t=`FileIcon dir ${n}`;return{type:e,icon:n,className:t,html:`<i class="${t}"></i>`}}e="file";let t=n.slice(1),r=i[n]||i.file,o=`FileIcon file ${t} ${r}`;return{type:e,ext:n,extName:t,className:o,icon:r,html:`<i class="${o}"></i>`}}}}),f("File/Size",function(e,n,t){return{getDesc:function(e){return e?e<1024?{value:e,desc:"B"}:(e/=1024)<1024?{value:e=k.ceil(e),desc:"KB"}:(e/=1024)<1024?((e=e.toFixed(2)).endsWith("0")&&(e=e.slice(0,-1)),e.endsWith("0")&&(e=e.slice(0,-2)),{value:e,desc:"MB"}):((e=(e/=1024).toFixed(2)).endsWith("0")&&(e=e.slice(0,-1)),e.endsWith("0")&&(e=e.slice(0,-2)),{value:e,desc:"GB"}):{value:0,desc:""}}}}),f("File",function(e,n,t){const i=n.require("API"),r=n.require("Ext"),o=n.require("Icon"),l=n.require("Size");return{API:i.create,getSizeDesc:(...e)=>l.getDesc(...e),getIcon(e){"string"==typeof e&&(e={name:e});let{ext:n,type:t,name:i}=e;return n=n||r.get(i),o.get({ext:n,type:t})},getExt:e=>r.get(e)}}),f("GridView/Check",function(e,n,t){const i=e("$");return{item:function(e,n,t){let r=n[e.primaryKey],o=e.current,l=o.id$item,c=new Set(o.list);return t===M&&(t=!l[r]),t?(l[r]=n,c.add(r)):(delete l[r],c.delete(r)),o.list=[...c],i("#"+e.countId).html(c.size),c=e.this.get(),e.emitter.fire("check",[{item:n,checked:t,list:c,id$item:l}]),t},all:function(e){let n=e.list,t=e.current.id$item,r=e.primaryKey,o=n.length,l=o>0;for(let e=0;e<o;e++){if(!t[n[e][r]]){l=!1;break}}i("#"+e.checkAllId).toggleClass("on",l)}}}),f("GridView/Fields",function(e,n,t){const i=e("GridView.defaults");return{get:function(e){let n=e.fields,t=e.check,r=e.order,o=[];return t=!0===t?i.check:t,r=!0===r?i.order:r,t&&o.push({name:t.name,width:t.width,caption:"",class:t.class,dragable:t.dragable}),r&&o.push({name:r.name,width:r.width,caption:r.caption,class:r.class,dragable:r.dragable}),n.forEach(function(e){o.push({name:e.name,width:e.width,caption:e.caption,class:e.class,dragable:e.dragable,delegate:e.delegate})}),o},sumWidth:function(e){let n=0;return e.map(function(e){n+=e.width}),n}}}),f("GridView/Meta",function(e,n,t){const i=e("@definejs/string");return{create:function(e,n){let t=e.all,r=t?t.length:e.total,o={id:i.random(),pagerId:i.random(),tableId:i.random(),headerId:i.random(),counterId:i.random(),countId:i.random(),checkAllId:i.random(),nodataId:i.random(),$:null,$container:null,$nodata:null,table:null,pager:null,tpl:null,resizer:null,checkItem:null,checkAll:null,all:t,total:r,container:e.container,class:e.class,no:e.no,size:e.size,sizes:e.sizes,sumWidth:0,check:e.check,order:e.order,primaryKey:e.primaryKey,footer:!!e.footer,list:[],oldList:null,selectedMode:!1,index$checkedJSON:"",current:{list:[],id$item:{}}};return y.assign(o,n),o}}}),f("GridView/Pager",function(e,n,t){const i=e("Pager");return{create:function(e){let n=new i({container:"#"+e.pagerId,total:e.total,size:e.size,sizes:e.sizes});return n.on({change:function(n,t){e.no=n,e.size=t,e.selectedMode=!1,e.emitter.fire("page","change",[n,t])},error:function(n){e.emitter.fire("page","error",[n])}}),n},list:function(e,n,t){let i=(n-1)*t,r=i+t;return e.slice(i,r)}}}),f("GridView/Resizer",function(e,n,t){const i=e("$"),r=e("TableResizer");return{create:function(e){let n=null,t=new r({table:"#"+e.headerId,fields:e.fields});return t.on("render",function(){let n="#"+e.checkAllId;this.$.on("click",n,function(){let n=i(this),t=!n.hasClass("on");n.toggleClass("on",t),e.table.column("check",function(n){n.ctrl.toggleClass("on",t),e.checkItem(n.row.data,t)})})}),t.on({render:function(t,i){(n=new r({table:e.table.get("element"),dragable:!1,fields:i})).render()},change:function(t){n.set(t),e.$.width(t.width+10)}}),t}}}),f("GridView/Table",function(e,n,t){const i=e("$"),r=e("Table");return{create:function(e){let n=new r({container:"#"+e.tableId,fields:e.fields,order:!1,columnName:"name"});return n.on("process",{row:function(n){n.value=n.data[e.primaryKey],e.emitter.fire("process","row",[n])},cell:{"":function(n){let t=e.emitter.fire("process","cell",n.name,[n]),i=t.slice(-1)[0];return i===M&&(i=(t=e.emitter.fire("process","cell",[n])).slice(-1)[0]),i===M&&(i=n.row.data[n.name]),n.value=i,i},check:function(n){let t=n.row,i=e.current.id$item[t.value];return e.tpl.fill("check-item",{index:t.index,checked:i?"on":""})},order:function(n){let t=n.row.index+1;return!e.order.global||e.selectedMode?t:(e.no-1)*e.size+t}}}),n.on("render",function(){n.$.on("click",'[data-cmd="check-item"]',function(){let t=this.parentNode.id,r=n.get(t),o=e.checkItem(r.row.data);i(this).toggleClass("on",o),e.checkAll()})}),n.on("fill",function(t){e.list=t,e.check&&(e.checkAll(),n.column("check",function(e){e.ctrl=i(e.element).find('[data-cmd="check-item"]')}))}),n.on("click",{"":function(t){e.emitter.fire("click","table",[n,t])},row:function(n,t){e.emitter.fire("click","row",[n,t])},cell:function(n,t){e.emitter.fire("click","cell",n.name,[n,t]),e.emitter.fire("click","cell",[n,t])}}),e.fields.forEach(function(t){let i=t.delegate;i&&n.on("click","cell",t.name,i,function(n,t,r){e.emitter.fire("click","cell",n.name,i,[n,t,r])})}),n}}}),f("GridView/Template",function(e,n,t){const i=e("@definejs/template");return{create:function(e){let n=new i("#tpl-GridView"),t=e.fields;return e.check&&(t[0].caption=n.fill("check-all",{})),n.process({"":function(){return{header:this.fill("header",{fields:t}),id:e.id,class:e.class,sumWidth:e.sumWidth+10,"no-footer":e.footer?"":"no-footer",headerId:e.headerId,tableId:e.tableId,pagerId:e.pagerId,counterId:e.counterId,countId:e.countId,checkAllId:e.checkAllId,nodataId:e.nodataId}},header:{"":function(e){let n=e.fields;return{cells:this.fill("cell",n)}},cell:function(e,n){return{index:n,caption:e.caption}}}}),n}}}),f("GridView.defaults",{size:20,all:null,class:"",primaryKey:"id",footer:!0,sizes:[10,20,30,40,50],check:{name:"check",width:43,class:"check",dragable:!1},order:{name:"order",width:50,caption:"序号",global:!0,dragable:!0,class:"order"}}),f("GridView",function(e,n,t){const i=e("$"),r=e("@definejs/emitter"),o=e("@definejs/array"),l=e("@definejs/object"),c=n.require("Template"),a=n.require("Table"),s=n.require("Pager"),d=n.require("Resizer"),u=n.require("Fields"),f=n.require("Check"),m=n.require("Meta"),h=e("GridView.defaults");let p=new Map,g=0;function w(e){e=y.assign({},h,e);let n=new r(this),t=u.get(e),i=e.width,o=u.sumWidth(t);"auto"==i&&(i=o+264),n.id=`GridView-Emitter-${g++}`;let l=m.create(e,{emitter:n,fields:t,width:i,sumWidth:o,this:this,checkItem:function(e,n){return f.item(l,e,n)},checkAll:function(){return f.all(l)}});p.set(this,l),y.assign(this,{id:l.id}),l.all&&this.on("pager","change",function(e,n){if(!l.all)return;let t=s.list(l.all,e,n);this.fill(t)})}return w.prototype={constructor:w,id:"",$:null,render:function(e={}){let n=p.get(this),t=n.container=e.container||n.container;n.tpl=c.create(n),n.$container=i(t);let r=n.tpl.fill(n);n.$container.html(r),n.$=this.$=n.$container.find(`#${n.id}`),n.$nodata=n.$.find(`#${n.nodataId}`),n.table=a.create(n),n.resizer=d.create(n),n.pager=s.create(n),n.table.render(),n.resizer.render(),n.pager.render(),n.$.on("click","#"+n.counterId,function(){let e=n.selectedMode=!n.selectedMode,t=e?n.this.get():n.oldList;i(this).toggleClass("selected-mode",e),n.table.fill(t)})},fill:function(e,n){let t=p.get(this);n&&(e=o.map(e,n)),t.oldList=e,t.table.fill(e),t.$nodata.toggle(0==e.length),t.emitter.fire("fill",[e])},check:function(e){let n=p.get(this);e&&e.forEach(function(e){n.checkItem(e,!0)}),n.list&&this.fill(n.list)},clear:function(){let e=p.get(this),n=e.current;n.list.length&&(n.id$item={},n.list=[],e.table.column("check",function(e){e.ctrl.removeClass("on")}),i("#"+e.checkAllId).removeClass("on"),i("#"+e.countId).html(0),e.emitter.fire("clear"))},set:function(e){let n=p.get(this),t=e.all,i=l.filter(e,["total","size","no"]);l.isEmpty(i)||(y.assign(n,i),n.pager.render(i)),t&&(n.all=t)},get:function(){let e=p.get(this),n=e.current.list||[],t=e.current.id$item;return n=n.map(function(e){return t[e]})},to:function(e){p.get(this).pager.to(e)},destroy:function(){let e=p.get(this);e&&(e.emitter.destroy(),e.resizer.destroy(),e.table.destroy(),e.pager.destroy(),e.tpl.destroy(),p.delete(this))},on:function(){p.get(this).emitter.on(...arguments)},toggleFields(e){if(!e)return;let n=p.get(this),t=JSON.stringify(e);if(t==n.index$checkedJSON)return;n.index$checkedJSON=t;let r=i(`#${n.headerId}`),o=i(`#${n.tableId}>table`),l=0;function c(t){let{index:r}=t.dataset,o=e[r],l=n.fields[r];return"boolean"==typeof o?(i(t).toggle(o),o?0:l.width):0}r.find("col").each(function(){let e=c(this);l+=e}),r.find("th").each(function(){c(this)}),o.find("col").each(function(){c(this)}),o.find(">tbody>tr>td").each(function(){c(this)});let a=n.sumWidth-l;r.width(a),o.width(a),n.$.width(a+10)}},y.assign(w,{}),w}),f("MarkDoc/Href/Url",function(e,n,t){const i=e("@definejs/query"),r=e("@definejs/hash"),o=e("resolveUrl");function l(e,n){if(0!=n.indexOf("."))return n;let t=e.split("/").slice(0,-1).join("/")+"/",i=o(t,n),r=o("./");return i=i.slice(r.length)}return{getHref:function(e,n){let t=i.get(e)||{},r=t.file,o=t.dir;if(!r)return e;o&&(o=l(n,o));let c=r.split(",");return c=c.map(function(e){return e=l(n,e)}),r=c.join(","),o&&(e=i.add(e,"dir",o)),e=i.add(e,"file",r)},getHash:function(e){let n=i.get(e);return r.set("",n)}}}),f("MarkDoc/Code",function(e,n,i){const r=e("$"),o=e("@definejs/string"),l=e("@definejs/json");return{each:function(e,n){r(e).find("code[data-language]").each(function(e){let t=this.innerText,i=this.getAttribute("data-language");n({element:this,content:t,language:i},e)})},format:function(e){if("json"==e.getAttribute("data-language")){let n=e.innerText,i=l.parse(n);return i&&(i=t.JSON.stringify(i,null,4),e.innerHTML=i),i}},language:function(e,n){return o.format(e.samples.language,{language:n,foldable:e.code.foldable?"foldable":""})},wrap:function(e,n){let t=r(n.element.parentNode),i=n.language+n.numbers;t.wrap(e.samples.source),t.before(i),t.height(n.height);let o=t.parent().find(">ul"),l=10*o.find(">li").length.toString().length+15;o.css("width",l),t.css("margin-left",l)}}}),f("MarkDoc/Content",function(e,n,i){const r=e("@definejs/string"),o=t.marked;return{get:function(e,n){let{language:t,content:i,sample:l="pre",process:c}=n;if("html"!=t&&"htm"!=t||(t="",i=["``` html",i,"```"].join("\r\n")),t){let n=/[&'"<>\/\\\-\x00-\x09\x0b-\x0c\x1f\x80-\xff]/g;i=i.replace(n,function(e){return"&#"+e.charCodeAt(0)+";"}),i=r.format(e.samples[l],{language:t,content:i})}else i=o(i),c&&(i=c(i));return i}}}),f("MarkDoc/Events",function(e,n,t){const i=e("$");return{bind:function(e,n){e.bind=!0,e.code.foldable&&e.$.on("click",'[data-cmd="language"]',function(e){i(this.parentNode).toggleClass("on"),e.stopPropagation()}),e.code.foldable&&e.$.on("click",'[data-cmd="source-code"]',function(){let e=i(this);e.hasClass("on")&&e.removeClass("on")}),e.$.on("click",'a[href^="#"]',function(n){let t=this.getAttribute("href");n.preventDefault(),e.emitter.fire("hash",[t])}),e.titles.foldable&&e.$.on("click",e.titles.selector,function(n){"span"==n.target.tagName.toLowerCase()&&i(this).nextUntil(e.titles.selector).animate({height:"toggle",opacity:"toggle"})})}}}),f("MarkDoc/Highlight",function(e,n,i){const r=e("@definejs/string"),o=t.hljs;return{highlight:function(e,n){if(!n)return"";n=r.replaceAll(n,"&lt;","<"),n=r.replaceAll(n,"&gt;",">");try{return o.highlight(e,n).value}catch(e){return n}}}}),f("MarkDoc/Href",function(e,n,t){const i=n.require("Url");return{format:function(e,n){n&&e.$.find("a").each(function(){let e=this,t=e.getAttribute("href");(t.startsWith("#")||t.startsWith("?"))&&e.setAttribute("target","_self"),t.startsWith("?")&&(t=i.getHref(t,n),t=i.getHash(t),e.setAttribute("href",t))})}}}),f("MarkDoc/Image",function(e,n,t){const i=e("$");return{format:function(e,n){n&&i(e).find("img").each(function(){let e=this.getAttribute("src");!e||e.startsWith("http://")||e.startsWith("https://")||(this.src=n+e)})}}}),f("MarkDoc/Lines",function(e,n,t){const i=e("@definejs/string");return t={getNumbers:function(e,n){let r=e.samples.numbers,o=e.samples["numbers.item"],l=n.split(/\r\n|\n|\r/),c=t.getHeight(l);l[l.length-1]||(l=l.slice(0,-1));let a=l.map(function(e,n){return i.format(o,{no:n+1})});return i.format(r,{height:c,items:a.join(""),total:a.length})},getHeight:function(e){return m.isArray(e)||(e=e.split(/\r\n|\n|\r/)),20*e.length}}}),f("MarkDoc/Meta",function(e,n,t){const i=e("$"),r=e("@definejs/string"),o=e("@definejs/template");let l={format:!0,language:!0,numbers:!0,foldable:!0},c={selector:"h1,h2,h3,h4,h5,h6",foldable:!0};return{create:function(e,n){let t=new o("#tpl-MarkDoc"),a=y.assign({},l,e.code),s=y.assign({},c,e.titles),d=e.container,u={id:r.random(),container:d,code:{format:a.format,language:a.language,numbers:a.numbers,foldable:a.foldable},this:null,emitter:null,$:i(d),tpl:t,bind:!1,outline:{visible:!0},current:{},titles:{selector:s.selector,foldable:s.foldable},samples:{source:t.sample("source"),language:t.sample("language"),pre:t.sample("pre"),code:t.sample("code"),numbers:t.sample("numbers"),"numbers.item":t.sample("numbers","item"),title:t.sample("title")}};return y.assign(u,n),u}}}),f("MarkDoc/Titles",function(e,n,t){const i=e("$");return{render:function(e){let n=e.samples.title,t=e.titles.selector,r="";return e.$.find(t).each(function(){let e=i(this),o=e.nextUntil(t);r=r||e.text(),e.wrapInner(n),e.toggleClass("title",o.length>0)}),r}}}),f("MarkDoc",function(e,n,t){const i=e("$"),r=e("@definejs/array"),o=e("@definejs/emitter"),l=n.require("Meta"),c=n.require("Content"),a=n.require("Events"),d=n.require("Titles"),u=n.require("Href"),f=n.require("Code"),m=n.require("Highlight"),h=n.require("Lines"),p=n.require("Image");let g=new Map;function w(e){let n=new o(this),t=l.create(e,{this:this,emitter:n});g.set(this,t),y.assign(this,{id:t.id,$:t.$,data:{}}),this.on("process",function(e){return e=(e=(e=e.split("<li>[ ] ").join('<li class="todo-list-item"> <i class="far fa-square"></i>')).split("<li>[#] ").join('<li class="todo-list-item"> <i class="fas fa-check-square"></i>')).split("<li>[x] ").join('<li class="todo-list-item"> <i class="fas fa-check-square"></i>')})}return w.prototype={constructor:w,$:null,data:{},render:function(e){let n=g.get(this),t=n.current,r=!!e.language,o=c.get(n,{language:e.language,content:e.content,sample:e.sample,process:function(e){let t=n.emitter.fire("process",[e]);return t.length>0?t[0]:e}});e.code&&y.assign(n.code,e.code),e.titles&&y.assign(n.titles,e.titles),n.$.html(o),n.$.addClass("MarkDoc"),n.$.toggleClass("SourceMode",r),n.outline.visible=!0,n.bind||a.bind(n),p.format(n.$,e.imgUrl),f.each(n.$,function(e,t){let r=e.element,o=e.language,l=n.code;l.format&&f.format(r);let c=r.innerText,a=h.getHeight(c);f.wrap(n,{element:r,height:a,language:l.language?f.language(n,o):"",numbers:l.numbers?h.getNumbers(n,c):""}),c=m.highlight(o,c),i(r).addClass("hljs").html(c)});let l=d.render(n);r||u.format(n,e.baseUrl),t.code=n.$.find("pre>code"),t.html=t.code.html(),t.ul=n.$.find("ul"),n.emitter.fire("render",[{title:l}])},show:function(){let e=g.get(this);e.$.show(...arguments),e.emitter.fire("show")},hide:function(){let e=g.get(this);e.$.hide(...arguments),e.emitter.fire("hide")},outline:function(){let e=g.get(this),n=e.$.find(">*:not("+e.titles.selector+")"),t=e.outline.visible?"hide":"show";n.animate({height:t,opacity:t},"fast"),e.outline.visible=!e.outline.visible},empty:function(e){let n=g.get(this).current,t=n.code,i=n.ul,o=n.html;if(e){let e=h.getHeight(o);return t.parent().height(e),i.find("li").show(),void t.html(o)}let l=(o=t.html()).split(/\r\n|\n|\r/);o=(l=r.map(l,function(e){return e.length>0?e:null})).join("\r\n"),t.html(o);let c=h.getHeight(o);t.parent().height(c);let a=l.length-1;i.find("li").show(),i.find("li:gt("+a+")").hide()},on:function(){g.get(this).emitter.on(...arguments)},toOutline:function(e){let n=g.get(this),t=n.$.find(n.titles.selector).get(e);if(!t)return;let r=i(t);t.scrollIntoViewIfNeeded?t.scrollIntoViewIfNeeded():t.scrollIntoView();r.addClass("on"),s(function(){r.removeClass("on"),s(function(){r.addClass("on"),s(function(){r.removeClass("on")},200)},200)},200)},getOutlines:function(){let e=g.get(this),n=e.$.find(e.titles.selector).toArray();return n=n.map(function(e){return{level:+e.nodeName.slice(1),text:e.innerText}})}},w}),f.panel("MenuNav/Panel/Icon",function(e,n,t){const i=e("@definejs/panel"),r=e("File");return{create(e){let n=new i(`[data-panel="${e.id}/Icon"]`);return n.on("init",function(){}),n.on("render",function(e){let t=e;e&&"object"==typeof e&&(t=(e=r.getIcon(e)).html),n.$.html(t)}),n.wrap({})}}}),f.panel("MenuNav/Panel/List",function(e,n,t){const i=e("@definejs/panel");return{create(e){let n=new i(`[data-panel="${e.id}/List"]`);return n.on("init",function(){n.$on("click",{"[data-index]":function(e){let t=+this.dataset.index;n.fire("item",[t]),e.stopPropagation()}}),n.$.on("click",function(e){n.fire("text",[])})}),n.on("render",function(t){let i=e.tpl.fill("item",t);n.$.html(i)}),n.wrap({})}}}),f.panel("MenuNav/Panel/Text",function(e,n,t){const i=e("@definejs/panel");return{create(e){let n=new i(`[data-panel="${e.id}/Text"]`),t=null,r={path:""};return n.set("show",!1),n.on("init",function(){t=n.$.find("input").get(0),n.$bind("input",{blur:function(e){n.fire("blur")},click:function(e){let n=t.value.length;t.selectionEnd-t.selectionStart==n&&(t.selectionStart=n,t.selectionEnd=n)},change:function(e){let i=t.value;i!=r.path&&(t.value=r.path,r.path=i,n.fire("change",[i]))},keyup:function(e){13==e.keyCode&&t.blur()}})}),n.on("render",function(e){r.path=t.value=e}),n.on("show",function(){t.focus(),t.select()}),n.wrap({})}}}),f("MenuNav/Meta",function(e,n,t){let i=new(e("@definejs/id-maker"))(n.parent.id);return{create:function(e,n){let t={id:i.next(),container:e.container,this:null,emitter:null,tpl:null,panel:null};return y.assign(t,n),t}}}),f("MenuNav/Panel",function(e,n,t){const i=e("@definejs/panel"),r=n.require("Icon"),o=n.require("List"),l=n.require("Text");return{create(e){const n=r.create(e),t=o.create(e),c=l.create(e);let a=new i(`[data-panel="${e.id}"]`),s={names:[],path:""};return a.on("init",function(){t.on({item:function(e){let n=s.names.slice(0,e+1);a.fire("item",[n,e])},text:function(){"string"==typeof s.path&&(t.hide(),c.show())}}),c.on({blur:function(){t.show(),c.hide()},change:function(e){a.fire("text",[e]).includes(!1)&&c.render(s.path)}})}),a.on("render",function(e){let{names:i,path:r,icon:o}=e;s.names=i,s.path=r,n.render(o),t.render(i),"string"==typeof r&&c.render(r),a.$.toggleClass("no-icon",!o),a.fire("render",[e])}),a.wrap({})}}}),f("MenuNav/Template",function(e,n,t){const i=e("@definejs/template");return{create:function(e){let n=new i("#tpl-MenuNav");return n.process({"":function(){return{id:e.id}},item:function(e,n){return{index:n,name:e}}}),n}}}),f("MenuNav.defaults",{}),f("MenuNav",function(e,n,t){const i=e("@definejs/emitter"),r=e("$"),o=n.require("Panel"),l=n.require("Meta"),c=n.require("Template"),a=e("MenuNav.defaults"),s=new Map;return class{constructor(e){e=y.assign({},a,e);let n=new i(this),t=l.create(e,{this:this,emitter:n});s.set(this,t),y.assign(this,{id:t.id,$:t.$})}init(){let e=s.get(this);if(!e.panel){if(e.tpl=c.create(e),e.container){let n=this.fill();r(e.container).html(n)}e.panel=o.create(e),this.$=e.panel.$,e.panel.on({item:function(n,t){e.emitter.fire("item",[n,t])},text:function(n){return e.emitter.fire("text",[n]).slice(-1)[0]},render:function(n){e.emitter.fire("render",[n])}})}}fill(){return s.get(this).tpl.fill({})}render(e){let n=s.get(this);this.init(),n.panel.render(e)}on(...e){s.get(this).emitter.on(...e)}}}),f("MenuTree/Data",function(e,n,t){let i=new(e("@definejs/id-maker"))(n.parent.id);return t={make(e,n){let r={},o={},l=[],c={list:e=function e(n,r,o,l){return n?n=n.map(n=>{let c=n.id;"string"!=typeof c&&"string"!=typeof(c=JSON.stringify(c))&&(c=i.next("item")),o.cid++;let a={id:c,cid:o.cid,level:0,name:n.name,open:n.open,dirIcon:n.dirIcon,fileIcon:n.fileIcon,data:n.data,list:[],parent:r||null,parents:[],children:[]};return a.list=e(n.list,a,o,l),t.trace(a,function(e){e.children.push(a),a.parents.push(e)}),a.level=a.parents.length,a.children.sort((e,n)=>e.cid-n.cid),l(a),a}):[]}(e,null,{cid:0},function(e){r[e.id]=e,o[e.cid]=e,l.push(e)}),items:l,id$item:r,cid$item:o};return n&&y.assign(n,c),c},trace(e,n){let i=e.parent;i&&(n(i),t.trace(i,n))}}}),f("MenuTree/Events",function(e,n,t){const i=e("$");function r(e,n,t){let i=t.find('> div > i[data-cmd="icon-dir"]'),r=t.children("ul"),o=n.open=!n.open,l=o?"open":"close",c=n.dirIcon||e.dirIcon;o?(i.removeClass(c.close),i.addClass(c.open),r.slideDown("fast")):(i.removeClass(c.open),i.addClass(c.close),r.slideUp("fast")),t.toggleClass("open",o),e.emitter.fire(l,[n])}return{bind:function(e){e.$.on("click",'[data-cmd="item"]',function(n){let t=this.parentNode,{id:o}=t.dataset,l=e.id$item[o],c=i(t),{current:a}=e;c.children("ul");a&&e.$.find(`[data-id="${a.id}"]`).removeClass("on"),c.addClass("on"),e.current=l,l.list.length>0?l===a?r(e,l,c):(l.open||r(e,l,c),e.emitter.fire("item",[l])):e.emitter.fire("item",[l]),this.scrollIntoViewIfNeeded()}),e.$.on("click",'[data-cmd="icon-dir"]',function(n){n.stopPropagation();let t=this.parentNode.parentNode,{id:o}=t.dataset,l=e.id$item[o],c=i(t);r(e,l,c)})}}}),f("MenuTree/Meta",function(e,n,t){let i=new(e("@definejs/id-maker"))(n.parent.id);return{create:function(e,n){let t={id:i.next(),container:e.container,dirIcon:e.dirIcon,fileIcon:e.fileIcon,$:null,this:null,emitter:null,tpl:null,list:[],items:[],id$item:{},cid$item:{},current:null};return y.assign(t,n),t}}}),f("MenuTree/Template",function(e,n,t){const i=e("@definejs/template");return{create:function(e){let n=new i("#tpl-MenuTree");function t(e,t){let i=e.list.length>0?"dir":"file";return n.fill("root",i,e)}function r(n){let t=e.emitter.fire("fill","name",[n]).slice(-1)[0];return t===M&&(t=n.name),t}return n.process({"":function(){let n=this.fill("root",e.list);return{id:e.id,roots:n}},root:{"":function(e,n){return{root:t(e)}},dir:function(n){let{open:i,id:o}=n,l=n.list.map(t),c=e.current,a=n.dirIcon||e.dirIcon;return"string"==typeof a&&(a={close:a,open:a}),{id:o,name:r(n)||"",open:i?"open":"",on:c&&o==c.id?"on":"",display:i?"display: block;":"display: none;",icon:i?a.open:a.close,items:l}},file:function(n,t){let{id:i,fileIcon:o}=n,{current:l}=e;return{id:i,name:r(n),icon:o||e.fileIcon,on:l&&i==l.id?"on":""}}}}),n}}}),f("MenuTree.defaults",{container:null,dirIcon:{close:"fa fa-folder",open:"fa fa-folder-open"},fileIcon:"fas fa-file-alt"}),f("MenuTree",function(e,n,t){const i=e("@definejs/emitter"),r=e("$"),o=n.require("Data"),l=n.require("Events"),c=n.require("Meta"),a=n.require("Template"),s=e("MenuTree.defaults"),d=new Map;return class{constructor(e){e=y.assign({},s,e);let n=new i(this),t=c.create(e,{this:this,emitter:n});d.set(this,t),y.assign(this,{id:t.id,$:t.$})}render(e=[]){let n=d.get(this);if(n.$)e.length>0&&this.update(e);else{if(n.tpl=a.create(n),n.container&&e.length>0){let t=this.fill(e);r(n.container).html(t)}n.$=this.$=r(`#${n.id}`),l.bind(n)}}fill(e){let n=d.get(this);return o.make(e,n),n.tpl.fill({})}update(e){let n=d.get(this);o.make(e,n);let t=n.tpl.fill("root",n.list);n.$.html(t)}open(e){let n=d.get(this),t=null;if("string"==typeof e){if(!(t=n.id$item[e]))throw new g(`不存在 id 为 '${e}' 的节点`)}else{if("number"!=typeof e)throw new g("无法识别的参数 id。");if(!(t=n.cid$item[e]))throw new g(`不存在 cid 为 '${e}' 的节点`)}t.open=!0,o.trace(t,function(e){e.open=!0}),this.render(n.list),t.list.length>0&&(t.open=!1),(t.$=t.$||n.$.find(`li[data-id="${t.id}"]`)).find('>[data-cmd="item"]').trigger("click")}on(...e){d.get(this).emitter.on(...e)}}}),f("Outline/Events",function(e,n,t){const i=e("$");return{bind:function(e){e.$.on("click","li[data-index]",function(n){let t=+this.getAttribute("data-index"),i=e.list[t];e.emitter.fire("item",[i,t])}),e.$.on("click","i[data-index]",function(n){let t=e.list,r=+this.getAttribute("data-index"),o=t[r];if(0==(o.children||[]).length)return;let l=i(this),a=l.hasClass("closed"),s=r+1,d=t.slice(s).findIndex(function(e,n){return e.level<=o.level});d=d<0?t.length:d+s,c.log(s,d),l.toggleClass("opened",a),l.toggleClass("closed",!a),l.attr({title:a?"点击收起子级":"点击展开子级"}),n.stopPropagation(),t.slice(s,d).forEach(function(n,t){t+=s;let i=e.$.find(`li[data-index="${t}"]`),r="closed-count",o=i.data(r)||0;a?--o<=0&&(o=0,i.slideDown("fast")):(o++,i.slideUp("fast")),i.data(r,o)})})}}}),f("Outline/Meta",function(e,n,t){const i=e("@definejs/string");return{create:function(e,n){let t={id:i.random(),container:e.container,this:null,emitter:null,$:null,tpl:null,list:null};return y.assign(t,n),t}}}),f("Outline/Template",function(e,n,t){const i=e("@definejs/template"),r=e("@definejs/string");return{create:function(){let e=new i("#tpl-Outline");return e.process({"":function(e){let n=e.list;return{items:this.fill("item",n)}},item:{"":function(e,n){let t=e.level,i=t-1,o=e.children||[];return i=(i=r.random(i).split("")).map(function(){return{}}),{index:n,level:t,tabs:i=this.fill("tab",i),text:e.text,opened:o.length>0?"opened":"","folder-title":o.length>0?"点击收起子级":""}},tab:function(e,n){return{}}}}),e}}}),f("Outline",function(e,n,t){const i=e("$"),r=e("@definejs/emitter"),o=n.require("Meta"),l=n.require("Events"),c=n.require("Template");let a=new Map;function s(e){let n=new r(this),t=c.create(),i=o.create(e,{this:this,emitter:n,tpl:t});a.set(this,i),y.assign(this,{id:i.id,$:i.$,data:{}})}return s.prototype={constructor:s,$:null,data:{},render:function(e){let n=a.get(this);n.$=i(n.container),(e=e||n.list)&&this.fill(e),n.$.show(),l.bind(n)},fill:function(e){e.forEach(function(n,t){n.parent=null;let i=n.level;if(1!=i)for(let r=t-1;r>=0;r--){let t=e[r];if(i>t.level)return n.parent=t,t.children=t.children||[],void t.children.push(n)}});let n=a.get(this),t=n.tpl.fill({list:e});return n.list=e,n.$&&n.$.html(t),t},show:function(){let e=a.get(this);e.$.show(...arguments),e.emitter.fire("show")},hide:function(){let e=a.get(this);e.$.hide(...arguments),e.emitter.fire("hide")},on:function(){a.get(this).emitter.on(...arguments)}},s}),f("Pager/Events",function(e,n){return{bind:function(e){let n=e.txtId,t=e.sizerId,r=e.this;function o(){let e=+i.getElementById(n).value;r.to(e)}e.$.on("click","[data-no]",function(){if($(this).hasClass("active"))return;let e=+this.getAttribute("data-no");r.to(e)}),e.$.on("click",'[data-button="to"]',function(){o()}),e.$.on("click",'[data-button="previous"]',function(){r.previous()}),e.$.on("click",'[data-button="next"]',function(){r.next()}),e.$.on("change","#"+t,function(){let n=this.selectedIndex,t=e.sizes[n];r.render({size:t,no:1}),r.to(1)}),e.$.on("keydown","#"+n,function(e){let n=e.keyCode;c.log(n),13!=n?48<=n&&n<=57||96<=n&&n<=105||(8==n||37==n||39==n||46==n)||112<=n&&n<=123||e.preventDefault():o()})}}}),f("Pager/JumpNo",function(e,n){return{get:function(e,n,t){return e<=1?e:n==e?e-1:(n>t?i=n+1:(i=n-1)<1&&(i=2),i);var i}}}),f("Pager/Regions",function(e,n){return{get:function(e,n){return e<=10?[{from:1,to:e,more:!1}]:n<=3?[{from:1,to:5,more:!0}]:n<=5?[{from:1,to:n+2,more:!0}]:n>=e-1?[{from:1,to:2,more:!0},{from:e-5,to:e,more:!1}]:[{from:1,to:2,more:!0},{from:n-2,to:n+2,more:n+2!=e}]}}}),f("Pager/Sizes",function(e,n){return{get:function(e,n){return e=[n=n||e[0],...e],(e=[...new Set(e)]).sort(function(e,n){return e>n?1:-1}),e}}}),f("Pager/Template",function(e,n){const t=e("@definejs/template"),i=e("@definejs/array");let r=new t("#tpl-Pager");return r.process({"":function(e){let n=e.no,t=e.count;return{regions:this.fill("region",e.regions,n),sizes:this.fill("size",e.sizes,e.size),count:e.count,total:e.total,ulId:e.ulId,txtId:e.txtId,sizerId:e.sizerId,toNo:e.toNo,"first-disabled-class":n==k.min(1,t)?"disabled":"","final-disabled-class":n==t?"disabled":"","jump-disabled-class":0==t?"disabled":""}},region:{"":function(e,n,t){let r=e.from,o=e.to,l=i.pad(r,o+1);l=this.fill("item",l,t);let c=e.more||"";return c&&(c=this.fill("more",{})),l+c},item:function(e,n,t){return{no:e,active:e==t?"active":""}},more:function(e){return e}},size:function(e,n,t){return this.fix("selected"),{value:e,selected:e==t?'selected="selected"':""}}}),r}),f("Pager.defaults",{container:"",total:0,current:1,size:20,min:0,sizes:[10,20,30,40,50]}),f("Pager",function(e,n){const t=e("$"),i=e("@definejs/emitter"),r=e("@definejs/string"),o=n.require("Events"),l=n.require("JumpNo"),c=n.require("Regions"),a=n.require("Sizes"),s=e("Pager.defaults");let d=new Map;function u(e){e=y.assign({},s,e);let n=r.random(),t=new i(this),o=e.size,l=a.get(e.sizes,o),c={id:n,txtId:r.random(),ulId:r.random(),sizerId:r.random(),$:null,ctn:e.container,no:e.no||1,size:o,total:e.total||0,min:e.min||0,count:0,last:0,sizes:l,emitter:t,this:this};d.set(this,c),y.assign(this,{id:n,meta:c,$:c.$})}return u.prototype={constructor:u,id:"",$:null,render:function(e){e=e||{};let i=d.get(this),r="number"==typeof e.total?e.total:i.total,a="number"==typeof e.size?e.size:i.size,s="number"==typeof e.min?e.min:i.min,u="number"==typeof e.no?e.no:i.no,f=k.ceil(r/a),m=!!i.$;if(0==f)return void(i.$&&i.$.hide());if(u<1||u>f)return i.emitter.fire("error",["输入的页码值只能从 1 到 "+f]),!1;if(i.$=this.$=t(i.ctn),i.count=f,i.no=u,i.total=r,i.size=a,i.min=s,m||o.bind(i),f<s)return void i.$.hide();let h=n.require("Template"),p=c.get(f,u),g=l.get(f,u,i.last),w=h.fill({regions:p,no:u,count:f,total:r,toNo:g,txtId:i.txtId,sizerId:i.sizerId,sizes:i.sizes,size:i.size});i.$.html(w).show()},to:function(e){let n=d.get(this),t=n.emitter,i=/^\d+$/.test(e);i?(e=parseInt(e),!1!==(i=this.render({no:e}))&&(n.last=n.no,n.no=e,t.fire("change",[e,n.size]))):t.fire("error",["输入的页码必须是数字"])},previous:function(){let e=d.get(this).no-1;e<1||this.to(e)},next:function(){let e=d.get(this),n=e.no+1;n>e.count||this.to(n)},first:function(){this.to(1)},final:function(){let e=d.get(this).count;this.to(e)},refresh:function(){let e=d.get(this).no;this.to(e)},on:function(){let e=d.get(this).emitter,n=m.from(arguments);e.on(n)},destroy:function(){let e=d.get(this);e.emitter.off(),e.$&&e.$.html("").undelegate(),d.delete(this)}},u}),f("Settings.Header",function(e,n,t){const i=e("@definejs/local-storage"),r=e("@definejs/emitter");let o=new i(n.id),l=new r,a={value:o.get("value")||n.data||"hide"};return{on:l.on.bind(l),get:()=>a.value,set(e){let t=a.value;e!=t&&(e?(o.set("value",e),a.value=e):e=t,l.fire("change",[e,t]),c.log(n.id,"set",e))}}}),f("Settings.Language",function(e,n,t){const i=e("@definejs/local-storage"),r=e("@definejs/emitter");let o=new i(n.id),l=new r,a={value:o.get("value")||n.data||"chinese"};return{on:l.on.bind(l),get:()=>a.value,set(e){let t=a.value;e!=t&&(e?(o.set("value",e),a.value=e):e=t,l.fire("change",[e,t]),c.log(n.id,"set",e))}}}),f("Settings.Theme",function(e,n,t){const r=e("@definejs/local-storage"),o=e("@definejs/emitter");let l=new r(n.id),c=new o,a={value:l.get("value")||n.data||"light"};return{on:c.on.bind(c),get:()=>a.value,set(e){let n=a.value;if(e==n)return;e?(l.set("value",e),a.value=e):e=n;let t=i.body;[...t.classList].forEach(e=>{e.startsWith("theme-")&&t.classList.remove(e)}),t.classList.add(`theme-${e}`),c.fire("change",[e,n])}}}),f("SidebarTree/Panel/Resizer/Masker",function(e,n,t){const i=e("@definejs/masker");let r=null;return{show(){(r=r||new i({opacity:0})).show()},hide(){r&&r.hide()}}}),f("SidebarTree/Panel/Header",function(e,n,t){const i=e("@definejs/panel"),r=e("CheckBox");return{create(e){let n=new i(`[data-panel="${e.id}/Header"]`),t=null,o={dirOnly:!1};return n.set("show",!1),n.on("init",function(){(t=new r({fireNow:!0,container:n.$.find('[data-cmd="dirOnly"]'),text:"仅目录"})).on("checked",function(e){o.dirOnly=e,n.fire("dir-only",[e])}),n.$on("click",{"[data-cmd]":function(e){let{cmd:t}=this.dataset;n.fire(t)}})}),n.on("render",function(e){e=e||{},n.$.toggleClass("back",!!e.back),n.$.toggleClass("forward",!!e.forward),n.$.toggleClass("up",!!e.up),n.$.toggleClass("root",!!e.root),n.$.toggleClass("dir-only",!!e.dirOnly),t.render({checked:o.dirOnly})}),n.wrap({})}}}),f("SidebarTree/Panel/Main",function(e,n,t){const i=e("@definejs/panel"),r=e("MenuTree");return{create(e){let n=new i(`[data-panel="${e.id}/Main"]`),t=null,o={item:null,index:-1,list:[]};return n.on("init",function(){let i={container:n.$},{fileIcon:l,dirIcon:c}=e;l&&(i.fileIcon=l),c&&(i.dirIcon=c),(t=new r(i)).on({item:function(e){let i=e.id;"/"!=i&&i.endsWith("/")?t.open(e.parent.id):function(e){e!==o.item&&(o.index++,o.list[o.index]=e,o.item=e,n.fire("item",[e,{back:o.index>0,forward:o.index<o.list.length-1,up:!(!e||!e.parent),root:!!e.parent,dirOnly:e.list.length>0}]),n.fire(e.data.type,[e]))}(e)},fill:{name:function(e){return n.fire("fill","name",[e]).slice(-1)[0]}}})}),n.on("render",function(e){o.item=null,o.list=[],o.index=-1,t.render(e)}),n.wrap({open:function(e){t.open(e)},back:function(){let e=o.index-1,n=o.list[e];n&&(o.index=e-1,this.open(n.id))},forward:function(){let e=o.index+1,n=o.list[e];n&&this.open(n.id)},up:function(){let e=o.item,n=e?e.parent:null;n&&this.open(n.id)},root:function(){this.open(1)},dirOnly:function(e){n.$.toggleClass("dir-only",!!e)}})}}}),f("SidebarTree/Panel/Resizer",function(e,n,t){const r=e("@definejs/panel"),o=n.require("Masker");return{create(e){let n=new r(`[data-panel="${e.id}/Resizer"]`);return n.set("show",!1),n.on("init",function(){let e=!1,t=0,r="",l=i.body,c=n.$.get(0);$(l).on({mousedown:function(i){i.target===c&&(e=!0,t=i.pageX,r=l.style.cursor,l.style.cursor="ew-resize",o.show(),n.fire("start"))},mousemove:function(i){if(!e)return;let r=i.pageX-t;n.fire("change",[r])},mouseup:function(t){e&&(e=!1,l.style.cursor=r,o.hide(),n.fire("stop"))}})}),n.on("render",function(e){}),n.wrap()}}}),f("SidebarTree/Meta",function(e,n,t){let i=new(e("@definejs/id-maker"))(n.parent.id);return{create:function(e,n){let t={id:i.next(),container:e.container,width:e.width,minWidth:e.minWidth,fileIcon:e.fileIcon,dirIcon:e.dirIcon,header:e.header,resizer:e.resizer,this:null,emitter:null,tpl:null,panel:null};return y.assign(t,n),t}}}),f("SidebarTree/Panel",function(e,n,t){const i=e("@definejs/panel"),r=n.require("Header"),o=n.require("Main"),l=n.require("Resizer");return{create(e){const n=r.create(e),t=o.create(e),c=l.create(e);let a=new i(`[data-panel="${e.id}"]`);return a.on("init",function(){t.on({item:function(e,t){a.fire("item",[e]),n.render(t)},dir:function(e){a.fire("dir",[e])},file:function(e){a.fire("dir",[e])},fill:{name:function(e){return a.fire("fill","name",[e]).slice(-1)[0]}}}),n.on({back:function(){t.back()},forward:function(){t.forward()},up:function(){t.up()},root:function(){t.root()},"dir-only":function(e){t.dirOnly(e)}})}),a.on("init",function(){function n(){return a.$.outerWidth()}function t(e){a.$.outerWidth(e)}let i=n();c.on({change:function(n){let r=i+n;r<e.minWidth?t(e.minWidth):(t(r),a.fire("resize"))},stop:function(){i=n()}})}),a.on("render",function(i){n.render(),t.render(i),c.render(),e.header&&n.show(),e.resizer&&c.show()}),a.wrap({open:function(e){t.open(e)}})}}}),f("SidebarTree/Template",function(e,n,t){const i=e("@definejs/template");return{create:function(e){let n=new i("#tpl-SidebarTree");return n.process({"":function(){return{id:e.id,width:e.width,"header-display":e.header?"":"display: none;","resizer-display":e.resizer?"":"display: none;"}}}),n}}}),f("SidebarTree.defaults",{container:null,width:300,minWidth:220,fileIcon:"",dirIcon:null,header:!0,resizer:!0}),f("SidebarTree",function(e,n,t){const i=e("@definejs/emitter"),r=e("$"),o=n.require("Panel"),l=n.require("Meta"),c=n.require("Template"),a=e("SidebarTree.defaults"),s=new Map;return class{constructor(e){e=y.assign({},a,e);let n=new i(this),t=l.create(e,{this:this,emitter:n});s.set(this,t),y.assign(this,{id:t.id,$:t.$})}init(){let e=s.get(this);if(!e.panel){if(e.tpl=c.create(e),e.container){let n=this.fill();r(e.container).html(n)}e.panel=o.create(e),this.$=e.panel.$,e.panel.on({item:function(n){e.emitter.fire("item",[n])},dir:function(n){e.emitter.fire("dir",[n])},resize:function(){e.emitter.fire("resize")},fill:{name:function(n){return e.emitter.fire("fill","name",[n]).slice(-1)[0]}}})}}fill(){return s.get(this).tpl.fill({})}render(e){let n=s.get(this);this.init(),n.panel.render(e)}on(...e){s.get(this).emitter.on(...e)}open(e){s.get(this).panel.open(e)}}}),f("Table/Meta/Column",function(e,n,t){const i=e("@definejs/string");return{create:function(e){let n=i.random(),t={name:e.name,caption:e.caption,index:e.index,field:e.field,table:e.table,id:n,cells:[],data:{},deps:[],infers:[],type:"Table.Column",change:null,sum:function(n){let i=0;return t.cells.map(function(t,r){let o=n?n.call(e.table,t,r):t.value;null!==o&&(i+=o=o||0)}),i}};return t}}}),f("Table/Meta",function(e,n,t){const i=e("@definejs/string"),r=n.require("Column");return{create:function(e,n){let t=e.count||e.details.length,o={},l={},c=e.fields.map(function(t,i){let c=t[e.columnName],a=t[e.captionName],s=r.create({name:c,caption:a,index:i,field:t,table:n.this});return o[c]=s,l[s.id]=s,s}),a={id:i.random(),fields:e.fields,columnName:e.columnName,captionName:e.captionName,details:e.details,container:e.container,width:e.width,class:e.class,order:e.order,attributes:e.attributes,count:t,columns:c,id$column:l,name$column:o,rows:[],id$row:{},id$cell:{},emitter:null,tpl:null,element:null,$:null,$tbody:null,$container:null,this:null};return y.assign(a,n),a}}}),f("Table/Order",function(e,n,t){let i={sample:"{order}",add:!0,index:0};return{normalize:function(e){let n=e.order;if(!n)return e;!0===n&&(n={}),n=y.assign({},i,n);let t=e.fields.slice(0),r={[e.columnName]:"order",caption:"序号"},o=n.index;return n.add?t.splice(o,0,r):t[o]=r,e=y.assign({},e,{order:n,fields:t})}}}),f("Table/Reaction",function(e,n,t){const i=e("@definejs/object");function r(e,n,t,i){let r=e[n];r?(i&&(r.change=i),t&&(r.deps.splice(0),r.deps.push(...t),t.map(function(t){let i=e[t];if(!i)return void c.warn("不存在名为 "+n+" 的列。");let r=i.infers;(r=new Set(r)).add(n),i.infers.splice(0),i.infers.push(...r)}))):c.warn("不存在名为 "+n+" 的列。")}return{set:function(e,n,t){let o=this;if(i.isPlain(e))i.each(e,function(e,n){m.isArray(n)?r(o,e,n,null):"function"!=typeof n?r(o,e,n.deps,n.change):r(o,e,null,n)});else if(i.isPlain(n)){let t=n;r(o,e,t.deps,t.change)}else"function"==typeof n&&(t=n,n=null),r(o,e,n,t)}}}),f("Table/Row",function(e,n,t){const r=e("@definejs/string");return t={create:function(e,n){let t=e.rows,i=r.random(),o=t.length,l=y.assign({},n),a={},s=e.id$row[i]={id:i,index:o,type:"Table.Row",cells:null,table:e.this,element:null,data:l,name$cell:a,value:null,title:"",class:"",attributes:{index:o}};return s.valueOf=function(e){return a[e].value},s.cells=e.fields.map(function(n,t){let i=r.random(),o=e.columns[t],l=e.order.index==t,d=n[e.columnName],u=n[e.captionName],f=e.id$cell[i]={id:i,name:d,caption:u,type:"Table.Cell",row:s,field:n,index:t,isOrder:l,column:o,table:e.this,ctrl:null,element:null,value:null,data:{},deps:o.deps,infers:o.infers,title:"",html:"",class:n.class||"",attributes:{index:t,name:d}};return f.change=function(n,t){(t=t||[]).push(f),f.value=n,c.log(t),f.infers.map(function(n){let i=e.name$column[n],r=a[n],o=i.change;if(t.includes(r)||!o)return;let l=o.apply(r,[f,t]);l!==M&&(r.value=l)}),e.emitter.fire("change",f.name,[f]),e.emitter.fire("change",[f])},o.cells.push(f),a[d]=f,f}),t.push(s),s},add:function(e,n){let r=e.rows.length,o=t.create(e,n),l=e.tpl.fill("tr",o,r);return e.$tbody.append(l),o.element=i.getElementById(o.id),o.cells.map(function(e){e.element=i.getElementById(e.id)}),o},remove:function(e,n){let t=e.rows,i=t[n];t.splice(n,1),delete e.id$row[i.id],i.cells.map(function(n){let t=n.ctrl;t&&t.destroy(),delete e.id$cell[n.id],n.ctrl=null,n.element=null}),e.columns.map(function(e,t){e.cells.splice(n,1)});let r=i.element;return r&&r.parentNode.removeChild(r),i.element=null,t.slice(n).map(function(t,i){if(i=t.index=i+n,"index"in t.attributes&&(t.element.setAttribute("data-index",i),t.attributes.index=i),e.order){let n=e.tpl;t.cells.map(function(e){if(!e.isOrder)return;let t=n.fill("tr","td",e,0,i);e.element.innerHTML=t})}}),i},move:function(e,n,t){let i=e.rows,r=n+t;if(0==t||r<0||r>i.length-1)return;let o=i[n],l=i[r],c=o.element.parentNode;i.splice(n,1),i.splice(r,0,o),t>0?c.insertBefore(l.element,o.element):c.insertBefore(o.element,l.element),i.map(function(n,t){n.index!=t&&(n.index=t,"index"in n.attributes&&(n.element.setAttribute("data-index",t),n.attributes.index=t),e.order&&n.cells.map(function(n){if(!n.isOrder)return;let i=e.tpl.fill("tr","td",n,0,t);n.element.innerHTML=i}))}),e.emitter.fire("move",[o,t])}}}),f("Table/Static",function(e,n,t){const i=e("@definejs/object");return t={eachCell:function(e,n){m.isArray(e)||(e=[e]);let t=[];e.map(function(e){switch(e.type){case"Table.Cell":t.push(e);break;case"Table.Column":case"Table.Row":t=t.concat(e.cells);break;default:throw new g("无法识别的 type 值: "+type)}}),t.map(n)},column:function(e,n,i){let r=[];if(m.isArray(e)){e.map(function(e){if(!t.isRow(e))return;let i=e.name$cell[n];i&&r.push(i)})}else if(t.isRow(e)){let t=e.name$cell[n];t&&r.push(t)}else{let t=e.get("name$column")[n];t&&(r=t.cells||[])}r.map(function(e,n){i(e,n)})},isCell:function(e){return i.isPlain(e)&&"Table.Cell"==e.type},isRow:function(e){return i.isPlain(e)&&"Table.Row"==e.type},isColumn:function(e){return i.isPlain(e)&&"Table.Column"==e.type}}}),f("Table/Template",function(e,n){const t=e("@definejs/template"),i=e("@definejs/string");function r(e){return e?(e=y.entries(e).map(function(e){return"data-"+e[0]+'="'+e[1]+'"'})).join(" "):""}function o(e){let n=e.title;return n===M||""===n?"":'title="'+n+'"'}function l(e){let n=e.class;return m.isArray(n)&&(n=n.join(" ")),n?'class="'+n+'"':""}return{create:function(e){let n=new t("#tpl-Table"),c=e.emitter;return n.process({"":function(){this.fix("attributes");let n=e.width||"";n&&(n="width: "+n+"px;");let t=this.fill("tr",e.rows),i=r(e.attributes),o=e.class||"";return{id:e.id,class:o+" Table",width:n,rows:t,attributes:i}},tr:{"":function(e,n){this.fix(["class","attributes","title"]),c.fire("process","row",[e,n]);let t=r(e.attributes),i=this.fill("td",e.cells,n),a=o(e),s=l(e);return{id:e.id,class:s,attributes:t,title:a,cells:i}},td:{"":function(n,t,a){this.fix(["class","attributes","title"]);let s="";if(n.isOrder)s=i.format(e.order.sample,{index:t,no:a,order:a+1});else{let e=c.fire("process","cell",n.name,[n,t]);(s=e.slice(-1)[0])===M&&(s=(e=c.fire("process","cell",[n,t])).slice(-1)[0]);let i=typeof s;"number"!=i&&"boolean"!=i||(s=x(s))}let d=!1===n.field.visible?"display: none;":"",u=r(n.attributes),f=o(n),m=l(n);return{id:n.id,cid:n.column.id,html:s||"",class:m,attributes:u,display:d,title:f}}}}}),n}}}),f("Table.defaults",{$:null,fields:[],width:0,widths:[],class:"",process:{},order:!1,details:[],columnName:"fieldName",captionName:"caption"}),f("Table",function(e,n,t){const r=e("$"),o=e("@definejs/emitter"),l=e("@definejs/object"),a=n.require("Reaction"),s=n.require("Static"),d=n.require("Template"),u=n.require("Row"),f=n.require("Order"),h=n.require("Meta"),p=e("Table.defaults");let w=new Map;function $(e){e=y.assign({},p,e),e=f.normalize(e);let n=new o(this),t=h.create(e,{emitter:n,this:this});t.tpl=d.create(t),w.set(this,t),y.assign(this,{id:t.id,meta:t});for(let e=0;e<t.count;e++)this.new(t.details[e]);let i=e.reaction;i&&this.reaction(i),this.on("process","cell",function(e){return(e.row.data||{})[e.name]})}return $.prototype={constructor:$,id:"",$:null,render:function(){let e=w.get(this),n=e.rows,t=e.tpl.fill({});if(e.$container=r(e.container),!e.$container.length)throw new g("不存在容器节点: "+e.container);return e.$container.html(t),e.rows.map(function(e){e.element=i.getElementById(e.id),e.cells.map(function(e){e.element=i.getElementById(e.id)})}),e.element=i.getElementById(e.id),e.$=this.$=r(e.element),e.$tbody=e.$.find(">tbody"),e.fields.forEach(function(n,t){let i=n.delegate;i&&(m.isArray(i)?i:[i]).forEach(function(t){let i='>tr>td[data-name="'+n[e.columnName]+'"] '+t;e.$tbody.on("click",i,function(n){let i=r(this).parents().toArray(),o=i.length;for(let r=0;r<o;r++){let o=i[r].id,l=e.id$cell[o];if(l){e.emitter.fire("click","cell",l.name,t,[l,n,this]);break}}})})}),e.$tbody.on("click",">tr>td",function(n){let t=e.id$cell[this.id];e.emitter.fire("click","cell",t.name,[t,n]),e.emitter.fire("click","cell",[t,n])}),e.$tbody.on("click",">tr",function(n){let t=e.id$row[this.id];e.emitter.fire("click","row",[t,n])}),e.$tbody.on("click",function(n){e.emitter.fire("click",[n])}),e.emitter.fire("render",[n]),t},new:function(e){let n=w.get(this),t=u.create(n,e);return n.emitter.fire("new",[t,e]),t},add:function(e){let n=w.get(this);if(m.isArray(e)){let t=e.map(function(e){return u.add(n,e)});return n.emitter.fire("add",[t]),t}let t=u.add(n,e);return n.emitter.fire("add",[t]),t},remove:function(e){let n=w.get(this);"number"!=typeof e&&(e=n.rows.length-1);let t=u.remove(n,e);n.emitter.fire("remove",[t,e])},move:function(e,n){let t=w.get(this),i=typeof e,r="number"==i?t.rows[e]:"string"==i?t.id$row[e]:"object"==i?t.id$row[e.id]:null;if(!r)throw new g("传入的参数 item 不属性当前 table 的表格行。");u.move(t,r.index,n)},fill:function(e){this.clear();let n=w.get(this),t=e.map(function(e){return this.new(e)},this),r=n.tpl.fill("tr",t);n.$tbody.html(r),t.map(function(e){e.element=i.getElementById(e.id),e.cells.map(function(e){e.element=i.getElementById(e.id)})}),n.emitter.fire("fill",[e])},clear:function(){let e=w.get(this);e.rows.map(function(e){e.cells.map(function(e){let n=e.ctrl;n&&n.destroy&&n.destroy()})}),e.columns.map(function(e){e.cells.splice(0)}),e.id$row={},e.id$cell={},e.rows.splice(0),e.$tbody.html(""),e.emitter.fire("clear")},get:function(e){let n=w.get(this),t=n.rows;if(0==arguments.length)return t;if("number"==typeof e)return t[e];switch(e){case"id$row":case"id$cell":case"id$column":case"name$column":case"rows":case"columns":case"element":case"details":return n[e];case"length":return t.length}return"string"==typeof e?n.id$cell[e]||n.id$row[e]||n.id$column[e]:void 0},set:function(e,n){let t=w.get(this);switch(e){case"width":t[e]=n}},column:function(e,n){let t=w.get(this).name$column[e];if(t)return t.cells.map(function(e,t){n&&n(e,t)}),t;c.warn("不存在名为 "+e+" 的列。")},reaction:function(e,n,t){let i=w.get(this);a.set.call(i.name$column,...arguments)},destroy:function(){let e=w.get(this);if(!e)return;let n=e.element;e.tpl.destroy(),e.emitter.destroy(),n.parentNode.removeChild(n),e.$tbody.off(),e.$.off(),l.each(e.id$cell,function(e,n){let t=n.ctrl;t&&t.destroy&&t.destroy()}),w.delete(this)},on:function(){w.get(this).emitter.on(...arguments)}},y.assign($,s),$}),f("TableResizer/Mouse/Masker",function(e){const n=e("@definejs/masker");let t=null;return{show(){(t=t||new n({opacity:0})).show()},hide(){t&&t.hide()}}}),f("TableResizer/Cols",function(e,n){let t=new(e("@definejs/template"))("#tpl-TableResizer");return t.process({colgroup:{"":function(e){return{cols:this.fill("col",e.fields)}},col:function(e,n){return{index:n,width:e.width,display:e.visible?"":"display: none;"}}}}),{fill:function(e,n){let i=t.fill("colgroup",{fields:n});return e.prepend(i),e.find("colgroup>col").toArray()}}}),f("TableResizer/Fields",function(e,n){return{normalize:function(e){return e=e.map(function(e,n){let t=!("visible"in(e=y.assign({},e)))||e.visible;t&&e.width;return e.visible=!!t,e.dragable=!1!==e.dragable,e.width=e.width||0,e})},sum:function(e){let n=0;return e=e.map(function(e,t){e.visible&&(n+=e.width)}),n}}}),f("TableResizer/Meta",function(e,n,t){const i=e("@definejs/string");return{create:function(e,n){let t={id:i.random(),emitter:null,table:null,$:null,this:null,selector:e.table,dragable:e.dragable,rowspan:e.rowspan,minWidth:e.minWidth,indexKey:e.indexKey,cssClass:e.cssClass,fields:null,width:0,cols:[],id$index:{},cell$ids:new Map};return y.assign(t,n),t}}}),f("TableResizer/Mouse",function(e,n,t){const r=e("$"),o=n.require("Masker");let l={},c=!1,a=0,s=0,d=0,u="",f="",m=null,h=i.body;return r(h).on({mousedown:function(e){f=e.target.id;let n=l[f];if(!n)return;let t=n.id$index[f],i=n.fields[t],s=t==n.fields.length-1;c=!0,d=e.pageX,u=h.style.cursor,h.style.cursor="ew-resize",a=i.width,(m=r("#"+f+">b")).addClass("on"),m.toggleClass("last",s),m.html(a+"px"),o.show()},mousemove:function(e){if(!c)return;let n=l[f],t=e.pageX-d,i=a+t;if(i<n.minWidth)return;let r=n.fields,o=n.id$index[f],u=n.cols[o],h=s=n.width+t;u.width=r[o].width=i,n.$.width(h),m.html(i+"px"),n.emitter.fire("change",[{index:o,dx:t,tdWidth:i,width:h,fields:r}])},mouseup:function(){let e=l[f];e&&(e.width=s,f="",c=!1,h.style.cursor=u,o.hide(),m&&m.removeClass("on"))}}),{set:function(e,n){l[e]=n},remove:function(e){delete l[e]}}}),f("TableResizer/Rows",function(e,n){const t=e("@definejs/array");return{get:function(e,n){let i=m.from(e.rows).slice(0,n),r=t.pad(0,n).map(function(){return[]});return i.map(function(e,n){let i=0,o=r[n],l=o.length;l>0&&(i=o.findIndex(function(e){return!e}))<0&&(i=l),m.from(e.cells).map(function(e,l){let c=e.getAttribute("rowspan"),a=e.getAttribute("colspan");c=b(c)||1,a=b(a)||1,t.pad(0,c).map(function(o){let l=r[o+n];t.pad(0,a).map(function(n){l[i+n]=e})}),o[i+=a]&&(i=o.findIndex(function(e){return!e}))<0&&(i=o.length)})}),r}}}),f("TableResizer.defaults",{dragable:!0,rowspan:1,minWidth:20,indexKey:"data-target-index",cssClass:"TableResizer",fields:[]}),f("TableResizer",function(e,n){const t=e("$"),r=e("@definejs/string"),o=e("@definejs/emitter"),l=e("@definejs/template"),c=n.require("Cols"),a=n.require("Mouse"),s=n.require("Rows"),d=n.require("Fields"),u=n.require("Meta"),f=e("TableResizer.defaults");let m=new Map,h=new l("#tpl-TableResizer");function p(e){e=y.assign({},f,e);let n=new o(this),t=d.normalize(e.fields),i=e.width||d.sum(t),r=u.create(e,{emitter:n,this:this,fields:t,width:i});m.set(this,r),y.assign(this,{id:r.id,meta:r})}return p.prototype={constructor:p,id:"",$:null,render:function(){this.destroy(!0);let e=m.get(this);e.$=this.$=t(e.selector),e.$.addClass(e.cssClass);let n=e.table=e.$.get(0),i=s.get(n,e.rowspan);e.dragable&&i.map(function(n){n.map(function(n,i){let o=r.random(),l=n.getAttribute(e.indexKey);if(null!==l){let t=e.cell$ids.get(n)||[],i=t.length;if(t.push(o),e.cell$ids.set(n,t),i!=l)return}let c=e.fields[i],s=h.fill("resizer",{id:o,display:!1===c.dragable?"display: none;":""});t(n).append(s),e.id$index[o]=i,a.set(o,e)})}),e.cols=c.fill(e.$,e.fields),e.$.width(e.width),e.emitter.fire("render",[e.width,e.fields])},set:function(e){let n=e.index,t=e.width,i=e.tdWidth,r=m.get(this);r.fields[n].width=i,r.cols[n].width=i,r.width=t,r.$.width(t)},on:function(){m.get(this).emitter.on(...arguments)},destroy:function(e){let n=m.get(this);if(y.keys(n.id$index).map(function(e){a.remove(e);let n=i.getElementById(e);n&&n.parentNode.removeChild(n)}),!e){let e=n.$.find(">colgroup").get(0);e&&e.parentNode.removeChild(e),n.emitter.destroy(),n.$.removeClass(n.cssClass),m.delete(this)}}},p}),f("TextTree/Events",function(e,n,t){const r=e("$");let o={};return{bind:function(e){let n=`#${e.id} [data-cmd]`;r(i.body).on("click",n,function(n){let{cmd:t,index:i}=n.currentTarget.dataset;if("icon-dir"==t)return;i=b(i);let r=e.items[i];r=e.id$item[r.id],e.emitter.fire("cmd",t,[r]),e.emitter.fire("cmd",[t,r])}),r(i.body).on("click",n,function(n){let{cmd:t,index:i}=n.currentTarget.dataset;if("icon-dir"!=t)return;let l=r(this),a=e.items[i],{id:s}=a,d=l.hasClass("closed"),u=`#${e.id} li[data-id^="${s}${e.seperator}"]`;l.toggleClass("closed",!d),o[s]=!d,c.log(o),r(u).each(function(){let n=r(this);if(!d)return void n.slideUp("fast");let{id:t}=this.dataset;(function(e,n){let t,i;do{t=n[e],i=o[t],e=t}while("string"==typeof t&&!i);return i})(t,e.id$parent)?n.slideUp("fast"):n.slideDown("fast")})})}}}),f("TextTree/Meta",function(e,n,t){const i=e("@definejs/string"),r=e("@definejs/tree");let o=0;return{create:function(e,n){let t={id:`TextTree-${o++}-${i.random(4)}`,seperator:e.seperator,secondaryKey:e.secondaryKey,container:e.container,emptyText:e.emptyText,showSecondary:e.showSecondary,showIcon:e.showIcon,showTab:e.showTab,showColor:e.showColor,showHover:e.showHover,highlightIndex:-1,items:[],id$item:{},id$index:{},id$children:{},id$childs:{},id$parent:{},id$parents:{},id$siblings:{},tree:null,$:null,this:null,emitter:null,tpl:null,makeData:function(e,n){let i=function(e,n){let t={},i={},r={},o={},l={},a={},s={},d=e.map((e,l)=>{let{id:c}=e,a=c.split(n),s=(a.slice(-1)[0],null),d=[];if(t[c]=e,a.length>1){let e=s=a.slice(0,-1).join(n),t=o[e]||[];t.push(c),o[e]=t,d=(d=(d=a.map((e,n)=>a.slice(0,n+1).join("/"))).reverse()).slice(1)}return i[c]=s,r[c]=d,c});d.forEach((e,t)=>{let r=d.filter(t=>t.startsWith(`${e}${n}`));l[e]=r,s[e]=t;let c=i[e];if("string"==typeof c){let n=(o[c]||[]).filter(n=>n!=e);a[e]=[...new Set(n)]}});let u={ids:d,id$item:t,id$children:l,id$childs:o,id$parent:i,id$parents:r,id$siblings:a,id$index:s};return c.log(u),u}(e=e||[],n=n||t.seperator);return y.assign(t,{id$item:i.id$item,id$index:i.id$index,id$children:i.id$children,id$childs:i.id$childs,id$parent:i.id$parent,id$parents:i.id$parents,id$siblings:i.id$siblings}),i},toggleHideClass:function(e,n){t.$&&("boolean"==typeof n?t.$.toggleClass(e,!n):t.$.toggleClass(e))}},{ids:l}=t.makeData(e.list);return t.tree=new r(l,t.seperator),y.assign(t,n),t}}}),f("TextTree/Template",function(e,n,t){const i=e("@definejs/template");return{create:function(e){let n=new i("#tpl-TextTree");function t(e,t){let i=n.fill(e,t);return i=(i=i.trim()).split("\n").join("")}return n.process({"":function(n){let t=this.fill("item",n.list);return{id:n.id,items:t,"hide-tab":e.showTab?"":"hide-tab","hide-icon":e.showIcon?"":"hide-icon","hide-secondary":e.showSecondary?"":"hide-secondary","hide-color":e.showColor?"":"hide-color","hide-hover":e.showHover?"":"hide-hover"}},item:function(n,i){let{tabs:r,key:o,linker:l,id:c}=n,a=(e.id$children[c]||[]).length>0;return o=o||e.emptyText,r=t("tabs",n),o=t("key",{key:o,index:i,id:c,isDir:a}),{id:c,tabs:r,linker:l=t("linker",n),key:o,index:i,type:a?"dir":"file","not-found":e.id$item[c]?"":"not-found"}},tabs:function(e){let{tabs:n}=e,i=0;return{tabs:n=n.split("").map(function(e,n){e=e.trim(),i++,e.length>0&&(i=0);let r="";return(!e&&0==n||4==i)&&(r="grouper",i=0),t("b",{class:r,text:e})})}},key:{"":function(e){let n=this.fill("secondary",e),t=this.fill("icon",e);return{...e,icon:t,secondary:n}},icon:function({isDir:e}){return{type:e?"dir":"file",icon:e?"fas fa-angle-down":"far fa-circle"}},secondary:function(n){let{secondaryKey:t}=e;if(!t)return"";let i=n.index,r=e.id$item[n.id];return r?{secondary:r[t],secondaryKey:t,index:i}:{}}}}),n}}}),f("TextTree.defaults",{seperator:"/",emptyText:"(app)",secondaryKey:"",showSecondary:!1,showIcon:!1,showTab:!1,showColor:!1,showHover:!1}),f("TextTree",function(e,n,t){const i=e("@definejs/emitter"),r=e("@definejs/object"),o=e("$"),l=n.require("Events"),a=n.require("Meta"),s=n.require("Template"),d=e("TextTree.defaults");let u=new Map;return class{constructor(e){e=y.assign({},d,e);let n=new i(this),t=a.create(e,{this:this,emitter:n});t.tpl=s.create(t),u.set(this,t),y.assign(this,{id:t.id,$:t.$}),l.bind(t)}render(e){let n=u.get(this);if(e){let{ids:t}=n.makeData(e);n.tree.clear(),t.forEach(e=>{let t=e.split(n.seperator);n.tree.set(t)})}let t=n.tree.render(function(e,t){let{key:i,nodes:r,keys:o,value:l}=e,{tabs:c,linker:a,content:s}=t;return{id:o.join(n.seperator),tabs:c,key:i,linker:a}});n.items=t;let i=n.tpl.fill({id:n.id,list:t});return n.container&&(o(n.container).html(i),n.$=n.this.$=o(`#${n.id}`)),i}toString(e){let n=u.get(this);return e===M&&n.$&&(e=!n.$.hasClass("hide-secondary")),n.tree.render(function(t,i){let{key:r,nodes:o,keys:l,value:c}=t,{tabs:a,linker:s,content:d}=i,u="";if(e){let e=l.join(n.seperator);u=n.id$item[e][n.secondaryKey]}let f=`${a}${s} ${r||n.emptyText}`;return u&&(f=f+" "+u),f}).join("\n")}on(...e){u.get(this).emitter.on(...e)}toggle(e){let n=u.get(this);r.isPlain(e)?r.each(e,function(e,t){n.toggleHideClass(`hide-${e}`,t)}):n.$.toggle(e)}highlight(e){let n=u.get(this),t=n.id$index[e];t<0?c.warn(`不存在 id 为 ${e} 的项。`):(n.highlightIndex&&n.$.find(`[data-cmd="id"][data-index="${n.highlightIndex}"]`).removeClass("on"),n.$.find(`[data-cmd="id"][data-index="${t}"]`).addClass("on"),n.highlightIndex=t)}}}),f("$",function(e,n,i){return t.definejs.require("jquery")}),f("API",function(e,n,t){const i=e("@definejs/api");return function(e,n){var t=new i(e,n),r=(t.get.bind(t),t.post.bind(t));return t.post=function(e,n){return r({data:e},n)},t}}),f("Clipboard",function(e,n,t){let r=new(e("@definejs/toast"))({duration:1200});return{copy(e){let n=i.createElement("textarea");n.setAttribute("readonly","readonly"),n.style.height=0,i.body.appendChild(n),n.value=e,n.select(),i.execCommand("copy")&&r.show("已复制"),i.body.removeChild(n)}}}),f("List",function(e,n,t){const i=e("@definejs/emitter");let r=new Map;function o(e){let n={emitter:new i(this),list:(e=e||[]).slice(0),reserves:e.slice(0)};r.set(this,n)}return o.prototype={constructor:o,add:function(e){let n=this.index(e);if(n>=0)return n;let t=r.get(this),i=t.list,o=t.emitter;return i.push(e),n=i.length-1,o.fire("change",[i.slice(0)]),o.fire("add",[e,n]),n},insert:function(e,n){let t=r.get(this),i=t.list,o=t.emitter;return e+=1,i.splice(e,0,n),o.fire("change",[i.slice(0)]),o.fire("insert",[n,e]),e},remove:function(e){"object"==typeof e&&(e=this.index(e));let n=r.get(this),t=n.emitter,i=n.list,o=i[e];if(o)return i.splice(e,1),t.fire("change",[i.slice(0)]),t.fire("remove",[o,e]),o},clear:function(e){let n=r.get(this),t=(n.list,n.emitter),i=n.reserves;n.list=e?[]:i.slice(0),t.fire("change",[n.list.slice(0)]),t.fire("clear")},get:function(e){let n=r.get(this).list;return 0==arguments.length?n.slice(0):n[e]},index:function(e){let n=r.get(this).list,t=e.id;return n.findIndex(function(e,n){return e.id==t})},on:function(e,n){r.get(this).emitter.on(...arguments)}},o}),f("Panel",function(e,n,t){const i=e("$"),r={key:"panel",prefix:"./"};function o(e,n){let t=[e];return function e(n,t,i){let{key:r,prefix:o}=i;let l=n.parentNode;if(!l)return;let c=l.dataset||{};let a=c[r];if(a&&(t.push(l),!a.startsWith(o)))return;e(l,t,i)}(e,t,n),t.reverse(),t}return{pad(e,n){n=n||r;let{key:t,prefix:l}=n;e=e||i(`[data-${t}^="${l}"]`).toArray(),c.log(e),e.forEach(function(e){let{dataset:i}=e;if(!i)return;let r=i[t];if(!r||!r.startsWith(l))return;let c=o(e,n);if(c[0].dataset[t].startsWith(l))throw new g(`无法找到值为完整 data-${t} 的父节点。`);c.forEach((e,n)=>{let i=e.dataset[t];if(!i.startsWith(l))return;let r=c[n-1],o=i.slice(l.length),a=`${r.dataset[t]}/${o}`;e.dataset[t]=a,e.dataset[`${t}_old`]=i})})}}}),f("resolveUrl",function(e,n,i){return t.resolveUrl}),f.panel("/Loading",function(e,n,t){}),f.panel("/Markdoc/Content",function(e,n,t){const i=e("MarkDoc");let r=null;return t.on("init",function(){(r=new i({container:t.$.find('[data-id="content"]')})).on("render",function(e){let n=r.getOutlines();t.fire("render",[{title:e.title,outlines:n}])}),r.on("hash",function(e){t.fire("hash",[e])})}),t.on("render",function(e,n){r.render({content:e,baseUrl:n.url,language:n.isCode?n.ext:""})}),{toOutline:function(e){r.toOutline(e)},font:function(e){r.$.css({"font-size":e+"px"})}}}),f.panel("/Markdoc/Header",function(e,n,t){const i=e("@definejs/string");let r=[{cmd:"numbers",text:"行号",checked:!0},{cmd:"comment",text:"注释",checked:!0}];return t.set("show",!1),t.on("init",function(){t.$.on("click","[data-index]",function(){let e=+this.getAttribute("data-index"),n=r[e].cmd,i=this.checked;i?s(function(){t.fire("check",[n,i])},200):t.fire("check",[n,i])}),t.template({"":function(e){return this.fill("html",e)},html:{"":function(e){let n=this.fill("item",e.list);return{url:e.url,name:e.name,items:n}},item:function(e,n){return{id:i.random(),index:n,text:e.text,checked:e.checked?"checked":""}}}})}),t.on("render",function(e){e.isCode?(t.fill({url:e.url,name:e.name,list:r}),t.show()):t.hide()}),{leave:function(e){t.$.toggleClass("fixed",e)}}}),f.panel("/Markdoc/Outline",function(e,n,t){const i=e("Outline");let r=null;t.set("show",!1),t.on("init",function(){t.$.on("scroll","ul",function(e){e.stopPropagation(),c.log(e)}),(r=new i({container:t.$.find('[data-id="container"]')})).on({item:function(e,n){t.fire("item",[e,n])}}),r.render()}),t.on("render",function(e){r.fill(e)})}),f.panel("/Markdoc/Tools",function(e,n,t){let i=[{cmd:"top",text:"顶部",icon:"fas fa-chevron-up"},{cmd:"home",text:"首页",icon:"fas fa-home"},{cmd:"outline",text:"提纲",icon:"fas fa-list"},{cmd:"font",text:"字体",icon:"fas fa-font"},{cmd:"print",text:"打印",icon:"fas fa-print"},{cmd:"bottom",text:"底部",icon:"fas fa-chevron-down"}],o={list:[14,16,18,20],index:1};return t.set("show",!1),t.on("init",function(){t.$on("click",'[data-cmd="{value}"]',{top:function(){t.fire("top")},home:function(){r.hash=""},font:function(){let e=o.list,n=o.index+1;n>=e.length&&(n=0),o.index=n,t.fire("font",[e[n]])},outline:function(){t.fire("outline")},print:function(){t.fire("print")},bottom:function(){t.fire("bottom")}}),t.template(function(e,n){return{index:n,cmd:e.cmd||"",text:e.text||"",icon:e.icon||""}})}),t.on("render",function(){t.fill(i),t.show()}),{set:function(e){t.$.find('[data-cmd="outline"]').toggle(!e)}}}),f("/Markdoc/API",function(e,n,t){const i=e("@definejs/emitter"),r=e("API");let o=new i;return{on:o.on.bind(o),read:function(e){let n=new r("FileList.read",{});n.on({request:function(){o.fire("loading",[!0])},response:function(){o.fire("loading",[!1])},success:function(e,n,t){let{content:i,isImage:r,url:l}=e;r&&(i=`![ ](${l})`),o.fire("success",[i])},fail:function(e,n,t,i){u.alert("获取文件内容失败: {0}",n)},error:function(e,n,t,i){u.alert("获取文件内容错误: 网络繁忙，请稍候再试")}}),n.get({id:e})}}}),f("/Markdoc/Url",function(e,n,t){let i=["md","txt","markdown"],r=["bmp","gif","jpg","jpeg","png"];return{parse(e){let n=e.startsWith("@"),t=n?e.slice(1):e,o=t.split(".").slice(-1)[0],l=t.split("/").slice(-1)[0],c=function(e){return(e=(e=e.split("#")[0]).split("?")[0]).split("/").slice(0,-1).join("/")+"/"}(t),a=i.includes(o)||r.includes(o);return{url:t,name:l,dir:c,ext:o,isCode:n||!a}}}}),f.panel("/Markdoc",function(e,n,t){const r=n.require("API"),o=n.require("Header"),l=n.require("Content"),a=n.require("Url"),s=n.require("Outline"),d=n.require("Tools");let u={info:null};return t.on("init",function(){o.on({check:function(e,n){t.$.toggleClass(`no-${e}`,!n)}}),r.on({loading:function(e){t.fire("loading",[e])},success:function(e){l.render(e,u.info)}}),l.on({render:function({title:e,outlines:n}){i.title=e,s.render(n),d.render()}}),s.on({item:function(e,n){l.toOutline(n)}}),d.on({top:function(){},bottom:function(){let e=t.$.get(0).scrollHeight;c.log(n.id,e),scrollTo(0,e)},outline:function(){s.toggle()},print:function(){function e(){t.$.toggleClass("print")}e(),i.execCommand("print")&&e()},font:function(e){l.font(e)}})}),t.on("render",function(e){let n=u.info=a.parse(e);t.$.toggleClass("source",n.isCode),o.render(n),r.read(n.url)}),{}}),f("/Master/PageList/List",function(e,n,t){return new(e("List"))([])}),f("/Master/PageList/Mask",function(e,n,t){const i=e("@definejs/panel"),r=e("@definejs/masker");let o=null,l=!1,c=new i;return c.on("init",function(){(o=new r({volatile:!0,opacity:0})).on({hide:function(){l=!1,c.fire("hide")},show:function(){l=!0,c.fire("show")}})}),c.on("render",function(){}),c.wrap({toggle:function(){l?o.hide():o.show()}})}),f.panel("/Master/PageList/Tabs",function(e,n,t){const i=e("$"),r=e("@definejs/tabs"),o=e("Settings.Language");let l=null,c={index:0,list:[]};t.on("init",function(){(l=new r({container:t.$.get(0),selector:">li",eventName:"click",indexKey:"data-index",activedClass:"on"})).on("change",function(e,n){c.index=n,t.fire("active",[e,n])}),l.template(function(e,n){return{index:n,name:e.name,icon:e.icon,"close-display":"Home"==e.view?"display: none;":""}}),o.on("change",function(e,n){t.render(c.list),l.reset(),l.active(c.index)}),t.$on("click",{'[data-cmd="close"]':function(e){e.stopPropagation();let n=+this.parentNode.getAttribute("data-index"),i=c.list[n];if(t.fire("before-close",[i,n]).includes(!1))return!1;a.close(n,!0)}})}),t.on("render",function(e){let n=o.get(),t=c.list=e.map(e=>(e.name=e.language$name[n],e));l.render(t)});let a=null;return a={active(e,n){c.index=e,l.active(e,n);let i=t.$.find(">li").get(e);if(i){(i.scrollIntoViewIfNeeded||i.scrollIntoView).call(i)}},index:()=>l.getActivedIndex(),close(e,n){let r=c.list[e];l.remove(e),t.$.find(`>li[data-index="${e}"]`).animate({height:0},function(){i(this).hide(),n&&t.fire("after-close",[r,e])})}}}),f.panel("/Master/PageList",function(e,n,t){const i=n.require("List"),r=n.require("Tabs"),o=n.require("Mask");return t.on("init",function(){let e=t.$.find(">div");t.$on("click",{">i":function(e){o.toggle()},'[data-cmd="refresh"]':function(e){t.fire("refresh")}}),o.on({hide:function(){e.slideUp("fast"),t.$.removeClass("show")},show:function(){e.slideDown("fast"),t.$.addClass("show")}}),i.on({change:function(e){r.render(e)},remove:function(e,n){r.active(n-1,!0)}}),r.on({active:function(e,n){t.fire("active",[e,n])},"before-close":function(e,n){if(t.fire("before-close",[e,n]).includes(!1))return!1},"after-close":function(e,n){i.remove(n),t.fire("after-close",[e,n])}})}),t.on("render",function(){r.render([]),o.render()}),{open:function(e){let n=i.index(e);n<0&&(n=r.index(),n=i.insert(n,e)),r.active(n,!1)},close:function(e){let n=i.index({id:e});r.close(n,!1),i.remove(n)}}}),f("/Master/PageTabs/List",function(e,n,t){return new(e("List"))([])}),f.panel("/Master/PageTabs/Tabs",function(e,n,t){const i=e("$"),r=e("@definejs/tabs"),o=e("Settings.Language");let l=null,c={index:0,list:[]};t.on("init",function(){(l=new r({container:t.$.get(0),selector:">li",eventName:"click",indexKey:"data-index",activedClass:"on"})).on("change",function(e,n){c.index=n,t.fire("active",[e,n])}),l.template(function(e,n){return{index:n,name:e.name,icon:e.icon,"close-display":"Home"==e.view?"display: none;":""}}),o.on("change",function(e,n){t.render(c.list),l.reset(),l.active(c.index)}),t.$on("click",{'[data-cmd="close"]':function(e){e.stopPropagation();let n=+this.parentNode.getAttribute("data-index"),i=c.list[n];if(t.fire("before-close",[i,n]).includes(!1))return!1;a.close(n,!0)}})}),t.on("render",function(e){let n=o.get(),t=c.list=e.map(e=>(e.name=e.language$name[n],e));l.render(t)});let a=null;return a={active(e,n){c.index=e,l.active(e,n);let i=t.$.find(">li").get(e);if(i){(i.scrollIntoViewIfNeeded||i.scrollIntoView).call(i)}},index:()=>l.getActivedIndex(),close(e,n){let r=c.list[e];l.remove(e),t.$.find(`>li[data-index="${e}"]`).animate({width:0,padding:0},function(){i(this).hide(),n&&t.fire("after-close",[r,e])})}}}),f.panel("/Master/PageTabs",function(e,n,t){const i=n.require("List"),r=n.require("Tabs");return t.on("init",function(){i.on({change:function(e){r.render(e)},remove:function(e,n){r.active(n-1,!0)}}),r.on({active:function(e,n){t.fire("active",[e,n])},"before-close":function(e,n){if(t.fire("before-close",[e,n]).includes(!1))return!1},"after-close":function(e,n){i.remove(n),t.fire("after-close",[e,n])}})}),t.on("render",function(){r.render([])}),{open(e){let n=i.index(e);n<0&&(n=r.index(),n=i.insert(n,e)),r.active(n,!1)},close(e){let n=i.index({id:e});r.close(n,!1),i.remove(n)}}}),f("/Master/Sidebar/List/Data",function(e,n,t){const i=e("Settings.Language");return{make(e){let n=i.get();return e.map((e,t)=>((e={...e}).id=e.view,e.index=t,e.name=e.language$name[n],e))},set(e,n){e.forEach(e=>{e.name=e.language$name[n]})}}}),f.panel("/Master/Sidebar/Header",function(e,n,t){const i=e("@definejs/local-storage");let r=null,o=!0;t.on("init",function(){r=new i(n.id),(o=r.get("visible"))===M&&(o=!0),t.fire("toggle",[o]),t.$.on("click",function(){o=!o,r.set("visible",o),t.fire("toggle",[o])})}),t.on("render",function(){})}),f.panel("/Master/Sidebar/List",function(e,n,t){const i=e("@definejs/tabs"),r=e("Settings.Language"),o=n.require("Data");let l=null,c={index:-1,list:[]};return t.on("init",function(){(l=new i({container:t.$,selector:">li",activedClass:"on",repeated:!0})).on("change",function(e,n){n!=c.index?(e=c.list[n],c.index=n,t.fire("item",[e])):t.fire("refresh",[e])}),t.template(function(e,n){return{index:n,name:e.name,icon:e.icon,class:e.border?"group":""}}),r.on("change",function(e,n){o.set(c.list,e),t.fill(c.list),l.reset(),l.active(c.index)})}),t.on("render",function(e){let n=c.list=o.make(e);l.render(n),t.fire("render",[n])}),{active:function(e){let n=e.index;"number"!=typeof n&&(n=-1),c.index=n,l.active(n,!1)},get:function(e){return c.list.find(function(n,t){return n.view===e})}}}),f.panel("/Master/Sidebar",function(e,n,t){const i=e("@definejs/package"),r=n.require("Header"),o=n.require("List");return t.on("init",function(){r.on({toggle:function(e){t.fire("toggle",[e])}}),o.on({render:function(e){t.fire("render",[e])},item:function(e){t.fire("item",[e])},refresh:function(e){t.fire("refresh",[e])}})}),t.on("render",function(){i.load("data.Sidebar",function(){let n=e("data.Sidebar");r.render(),o.render(n)})}),{active(e){if("string"==typeof e&&(e=o.get(e)),e)return o.active(e),e}}}),f.panel("/Master/Views",function(e,n,t){const i=e("@definejs/package");let r={current:null,view$bind:new Map,view$rendered:new Map};function o(e){let n=t.fire("require",[e])[0];if(n)return r.view$bind.get(n)||(r.view$bind.set(n,!0),n.on("close",function(...n){t.fire("close",[e])}),n.on("fullscreen",function(...e){t.fire("fullscreen",e)}),n.on("title",function(...e){t.fire("title",e)})),n}function l(e,n={}){let{args:i=[],render:o=null,title:l=""}=n;r.current&&r.current.hide(),r.current=e,null===o&&(o=!r.view$rendered.get(e)),t.fire("title",[l]),o?(r.view$rendered.set(e,!0),e.render(...i)):e.show()}return t.on("init",function(){}),t.on("render",function(e,n){if("object"==typeof e){let t=e;e=t.view,n={title:t.name,...n}}let r=o(e);r?l(r,n):i.load(e,function(i){if(!i)return c.warn(`不存在视图 ${e} 对应的 package 文件。`),void t.fire("404",[e,n]);let r=i.html;r&&t.$.append(r.content);let a=o(e);if(!a)return c.warn(`无法获取到视图 ${e}`),void t.fire("404",[e,n]);l(a,n)})}),{close(e,n){let t=o(e);if(t)return!t.close(...n).includes(!1)&&(t.$.fadeOut("slow",function(){t.hide()}),r.current===t&&(r.current=null),void r.view$rendered.delete(t))},refresh(e){"string"==typeof(e=e||r.current)&&(e=o(e)),e&&(e.refresh(),r.view$rendered.set(e,!0))}}}),f.panel("/Master/Container",function(e,n,t){const i=e("Settings.Header");t.on("init",function(){i.on("change",function(e,n){t.$.toggleClass("no-header","hide"==e)})}),t.on("render",function(){let e=i.get();t.$.toggleClass("no-header","hide"==e)})}),f.panel("/Master",function(e,n,t){const o=n.require("Sidebar"),l=n.require("Container"),c=n.require("PageTabs"),a=n.require("PageList"),s=n.require("Views");let d={rendered:!1,view:""};function u(e){if(!e)return;let n=o.active(e);c.open(n),a.open(n),s.render(n)}return t.on("init",function(){o.on({render:function(e){let n=e[0].view;c.render(),a.render(),u(n),d.view!=n.view&&(u(d.view),d.view=""),t.fire("ready")},item:function(e){r.hash="#"+e.view},refresh:function(e){s.refresh()},toggle:function(e){t.$.toggleClass("hide",!e)}}),c.on({active:function(e,n){r.hash="#"+e.view},"before-close":function(e,n){return s.close(e.view,[n])},"after-close":function(e,n){a.close(e.id)}}),a.on({active:function(e,n){r.hash="#"+e.view},"before-close":function(e,n){return s.close(e.view,[n])},"after-close":function(e,n){c.close(e.id)},refresh:function(){s.refresh()}}),s.on({require:function(e){return t.fire("require",[e])[0]},404:function(e,n){s.render("404",{args:[e],render:!0,title:`404 - ${n.title}`})},close:function(e){c.close(e),a.close(e)},title:function(e){i.title=`webpart - ${e}`},fullscreen:function(...e){t.$.toggleClass("fullscreen",...e)}})}),t.on("render",function(e){e?d.rendered?u(e):(d.view=e,d.rendered=!0,o.render(),l.render()):r.hash="#Home"}),t.on("after-render",function(){t.fire("render")}),{open:function(e,n){s.render(e,{args:n,render:!0}),r.hash="#"+e}}}),f.panel("/Router",function(e,n,i){const r=e("@definejs/hash");i.on("init",function(){r.onchange(t,!0,function(e,n){if((e=e||"").startsWith("!")){let n=e.slice(1);i.fire("markdoc",[n])}else i.fire("master",[e])})}),i.on("render",function(){})}),f.view("/404",function(e,n,t){t.on("init",function(){}),t.on("render",function(e){c.log(n.id,e)})}),f.view("/Error",function(e,n,t){t.on("init",function(){}),t.on("render",function(e,n){t.fill({name:e.name,ex:n.stack}),c.log(n)})}),f("/FileList/Body/Main/Icon/List/Data",function(e,n,t){const i=e("File");function r(e,n){return(e=e.name)==(n=n.name)?0:e>n?1:-1}return{get(e){let n=[],t=[];return e.forEach(e=>{let{data:r}=e,{name:o,type:l}=r,c=i.getExt(o),a=o.split("/").slice(-1)[0],s={...r,ext:c,sname:a};("dir"==l?n:t).push(s)}),n=n.sort(r),t=t.sort(r),e=[...n,...t]}}}),f.panel("/FileList/Body/Main/Icon/List",function(e,n,t){const i=e("File"),r=n.require("Data");let o=[];return t.on("init",function(){t.template(function(e,n){return{index:n,icon:i.getIcon(e).html,name:e.sname}}),t.$on("click",{"[data-index]":function(e){let n=+this.dataset.index,i=o[n];t.fire("item",[i])}})}),t.on("render",function(e){o=r.get(e),t.fill(o)}),{}}),f.panel("/FileList/Body/Main/Icon",function(e,n,t){const i=n.require("List");return t.on("init",function(){i.on({item:function(e){t.fire("item",[e])}})}),t.on("render",function(e){i.render(e.item.list)}),{}}),f.panel("/FileList/Body/Main/List/Dir/Filter/CWD",function(e,n,t){const i=e("CheckBox");let r=null;t.on("init",function(){(r=new i({fireNow:!0,container:t.$,text:"仅当前目录"})).on("checked",function(e){t.fire("change",[e])})}),t.on("render",function(e){r.render({checked:e})})}),f.panel("/FileList/Body/Main/List/Dir/Filter/ChildDirs",function(e,n,t){const i=e("@definejs/array"),r=e("DropCheckList");let o=null;return t.on("init",function(){function e(e){e=i.map(e,function(e){return e.checked?e.value:null}),t.fire("check",[e])}(o=new r({container:t.$,text:"直接子目录",fireNow:!0})).on({check:function(n){e(n)},fill:function(n){e(n)}})}),t.on("render",function(e){e=i.map(e,e=>{let{type:n,name:t}=e.data;return"dir"==n?{text:e.name,checked:!0,value:t}:null}),o.render(e)}),{}}),f.panel("/FileList/Body/Main/List/Dir/Filter/Dirs",function(e,n,t){const i=e("DropCheckList");let r=null,o=[{text:"N = 0",checked:!0,value:"N=0"},{text:"N > 0",checked:!0,value:"N>0"}];return t.on("init",function(){(r=new i({container:t.$,text:"目录数"})).on({check:function(e){t.fire("check",[e])}})}),t.on("render",function(){r.render(o)}),{}}),f.panel("/FileList/Body/Main/List/Dir/Filter/Files",function(e,n,t){const i=e("DropCheckList");let r=null,o=[{text:"N = 0",checked:!0,value:"N=0"},{text:"N > 0",checked:!0,value:"N>0"}];return t.on("init",function(){(r=new i({container:t.$,text:"文件数"})).on({check:function(e){t.fire("check",[e])}})}),t.on("render",function(){r.render(o)}),{}}),f.panel("/FileList/Body/Main/List/Dir/Filter/Name",function(e,n,t){t.on("init",function(){t.$.on("input","input",function(){t.fire("change",[this.value])})}),t.on("render",function(){})}),f.panel("/FileList/Body/Main/List/Dir/Filter",function(e,n,t){const i=n.require("Name"),r=n.require("CWD"),o=n.require("Files"),l=n.require("Dirs"),a=n.require("ChildDirs");let d={name:"",cwd:!1,files$checked:null,dirs$checked:null,childDirs:null};t.on("init",function(){let e=null;function n(n){y.assign(d,n),clearTimeout(e),e=s(function(){t.fire("change",[d])},100)}function u(e){let n={};return e.forEach(e=>{n[e.value]=e.checked}),n}i.on({change:function(e){n({name:e})}}),r.on({change:function(e){n({cwd:e})}}),o.on({check:function(e){n({files$checked:u(e)})}}),l.on({check:function(e){n({dirs$checked:u(e)})}}),a.on({check:function(e){c.log(e),n({childDirs:e})}})}),t.on("render",function(e){i.render(),r.render(d.cwd),o.render(),l.render(),a.render(e.list)})}),f.panel("/FileList/Body/Main/List/Dir/GridView",function(e,n,t){e("@definejs/date");const i=e("GridView"),r=e("File");let o=null,l=null,c={keyword:"",keywordHtml:""};t.on("init",function(){l=t.template(),(o=new i({container:t.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"路径",name:"name",width:600,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"大小",name:"size",width:95,class:"size number",dragable:!0},{caption:"文件数",name:"files",width:74,class:"files number",dragable:!0},{caption:"目录数",name:"dirs",width:74,class:"dirs number",dragable:!0}]})).on("process","row",function(e){}),o.on("process","cell",{name:function(e){let n=e.row.data,t=n.name,i=r.getIcon(n.item);return c.keyword&&(t=t.split(c.keyword).join(c.keywordHtml)),l.fill("name",{icon:i.html,name:t})},files:function(e){let n=e.row.data;e.class+=` files-${n.files}`}}),o.on("click","cell",{name:{"":function(e,n){},"[data-cmd]":function(e,n){n.stopPropagation();let i=e.row.data.item;t.fire("item",[i])}}}),o.on("click","table",function(e,n){e.column("name",function(e){$(e.element).removeClass("text")})}),o.render()}),t.on("render",function(e,n={}){let t=c.keyword=n.keyword||"",i=n.root||"";t&&(c.keywordHtml='<span class="keyword">'+t+"</span>"),e=e.map(function(e,n){let t="file"==e.type,o=r.getSizeDesc(e.size),{name:l}=e;return t||(l+="/"),{name:i+l,size:o.value+" "+o.desc,dirs:e.dirs.length,files:e.files.length,item:e}}),o.fill(e)})}),f("/FileList/Body/Main/List/Dir/Data",function(e,n,t){let i={list:[],dirs:[]};function r(e,n,t){return n&&(e=e.filter(t)),e}return{init(e){i.list=e,i.dirs=e.filter(e=>"dir"==e.type),i.dirs.forEach(n=>{let t=n.stat.size,i=n.name,r=[],o=[];e.forEach(e=>{let{name:n,stat:l,type:c}=e;n.startsWith(`${i}/`)&&("file"==c?(t+=l.size,r.push(e)):o.push(e))}),n.files=r,n.dirs=o,n.size=t})},filter:function(e){let{cwd:n="",name:t="",files$checked:o=null,dirs$checked:l=null,childDirs:c=null}=e,a=i.dirs;return a=r(a=r(a=r(a=r(a,t,function(e){return e.name.includes(t)}),n,function(e){let{name:t}=e;return"/"==n?!t.slice(1).includes("/"):!t.slice(n.length+1).includes("/")}),o,function(e){let n=e.files.length;return!(!o["N=0"]&&0==n)&&!(!o["N>0"]&&n>0)}),l,function(e){let n=e.dirs.length;return!(!l["N=0"]&&0==n)&&!(!l["N>0"]&&n>0)}),n||(a=r(a,c,function(e){let{name:n}=e;return c.some(e=>n==e||n.startsWith(`${e}/`))})),a}}}),f.panel("/FileList/Body/Main/List/Dir",function(e,n,t){const i=n.require("Filter"),r=n.require("GridView"),o=n.require("Data");let l={root:"",item:null};return t.on("init",function(){i.on({change:function(e){e=y.assign({},e,{cwd:e.cwd?l.item.id:""});let n=o.filter(e);r.render(n,{keyword:e.name,root:l.root})}}),r.on({item:function(e){t.fire("item",[e])}})}),t.on("render",function(e){e.item!==l.item?(l.item=e.item,l.root=e.root,o.init(e.list),i.render(e.item)):t.show()}),{}}),f.panel("/FileList/Body/Main/List/File/Filter/CWD",function(e,n,t){const i=e("CheckBox");let r=null;t.on("init",function(){(r=new i({fireNow:!0,container:t.$,text:"仅当前目录"})).on("checked",function(e){t.fire("change",[e])})}),t.on("render",function(e){r.render({checked:e})})}),f.panel("/FileList/Body/Main/List/File/Filter/ChildDirs",function(e,n,t){const i=e("@definejs/array"),r=e("DropCheckList");let o=null;return t.on("init",function(){function e(e){e=i.map(e,function(e){return e.checked?e.value:null}),t.fire("check",[e])}(o=new r({container:t.$,text:"直接子目录"})).on({check:function(n){e(n)},fill:function(n){e(n)}})}),t.on("render",function(e){e=i.map(e,e=>{let{type:n,name:t}=e.data;return"dir"==n?{text:e.name,checked:!0,value:t}:null}),o.render(e)}),{}}),f.panel("/FileList/Body/Main/List/File/Filter/Encoding",function(e,n,t){const i=e("DropCheckList");let r=null,o=[{text:"UTF8",checked:!0,value:"utf8"},{text:"其它",checked:!0,value:"other"}];return t.on("init",function(){(r=new i({container:t.$,text:"编码"})).on({check:function(e){t.fire("check",[e])}})}),t.on("render",function(){r.render(o)}),{}}),f.panel("/FileList/Body/Main/List/File/Filter/MD5",function(e,n,t){const i=e("DropCheckList");let r=[{text:"N = 1",checked:!0,value:"N=1"},{text:"N > 1",checked:!0,value:"N>1"}];return t.on("init",function(){chk=new i({container:t.$,text:"重复文件"}),chk.on({check:function(e){t.fire("check",[e])}})}),t.on("render",function(){chk.render(r)}),{}}),f.panel("/FileList/Body/Main/List/File/Filter/Name",function(e,n,t){t.on("init",function(){t.$.on("input","input",function(){t.fire("change",[this.value])})}),t.on("render",function(){})}),f.panel("/FileList/Body/Main/List/File/Filter/Type",function(e,n,t){const i=e("DropCheckList");let r=null,o=[];return t.on("init",function(){(r=new i({container:t.$,text:"类型"})).on({check:function(e){t.fire("check",[e])}})}),t.on("render",function(e){o=e.map(e=>({text:`${e.slice(1)} 文件`,checked:!0,value:e})),r.render(o),t.fire("check",[o])}),{}}),f.panel("/FileList/Body/Main/List/File/Filter",function(e,n,t){const i=n.require("Type"),r=n.require("Encoding"),o=n.require("Name"),l=n.require("CWD"),a=n.require("MD5"),d=n.require("ChildDirs");let u={name:"",cwd:!1,ext$checked:null,encoding$checked:null,md5$checked:null,childDirs:null};t.on("init",function(){let e=null;function n(n){y.assign(u,n),clearTimeout(e),e=s(function(){t.fire("change",[u])},100)}function f(e){let n={};return e.forEach(e=>{n[e.value]=e.checked}),n}o.on({change:function(e){n({name:e})}}),l.on({change:function(e){n({cwd:e})}}),i.on({check:function(e){n({ext$checked:f(e)})}}),r.on({check:function(e){n({encoding$checked:f(e)})}}),a.on({check:function(e){n({md5$checked:f(e)})}}),d.on({check:function(e){c.log(e),n({childDirs:e})}})}),t.on("render",function({exts:e,item:n}){i.render(e),r.render(),l.render(u.cwd),o.render(),a.render(),d.render(n.list)})}),f.panel("/FileList/Body/Main/List/File/GridView",function(e,n,t){const i=e("@definejs/date"),r=e("GridView"),o=e("File");let l=null,c=null,a={keyword:"",keywordHtml:""};t.on("init",function(){c=t.template(),(l=new r({container:t.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"路径",name:"name",width:600,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"大小",name:"size",width:70,class:"size number",dragable:!0},{caption:"编码",name:"isUTF8",width:80,class:"utf8",dragable:!0},{caption:"MD5",name:"md5",width:285,class:"md5",dragable:!0}]})).on("process","row",function(e){e.class=e.data.item.type}),l.on("process","cell",{name:function(e){let n=e.row.data,t=n.name,i=o.getIcon(n.item);return a.keyword&&(t=t.split(a.keyword).join(a.keywordHtml)),c.fill("name",{icon:i.html,name:t})},md5:function(e){let n=e.row.data.item,{md5:t,files:i}=n,r=i.slice(-1)[0];i.length>1&&(e.class+=" repeat",n===r&&(e.row.class+=" md5-group-bottom"))}}),l.on("click","cell",{name:{"":function(e,n){},"[data-cmd]":function(e,n){n.stopPropagation();let i=e.row.data.item;t.fire("item",[i])}}}),l.on("click","table",function(e,n){e.column("name",function(e){$(e.element).removeClass("text")})}),l.render()}),t.on("render",function(e,n={}){let t=a.keyword=n.keyword||"",r=n.root||"";t&&(a.keywordHtml='<span class="keyword">'+t+"</span>"),l.$.toggleClass("md5-repeat-mode",n.isMd5Mode),e=e.map(function(e,n){let t=e.stat,l=i.format(t.birthtime,"yyyy-MM-dd HH:mm:ss"),c=i.format(t.mtime,"yyyy-MM-dd HH:mm:ss"),a="file"==e.type,s=o.getSizeDesc(t.size),{isUTF8:d,name:u}=e;return a||(u+="/"),{name:r+u,typeDesc:a?e.ext.slice(1)+" 文件":"目录",size:s.value+" "+s.desc,birthtime:l,mtime:c,isUTF8:a?d?"UTF8":"其它":"",md5:e.md5,item:e}}),l.fill(e)})}),f("/FileList/Body/Main/List/File/Data",function(e,n,t){const i=e("@definejs/array");let r={list:[],files:[],exts:[],md5$files:{}};function o(e,n,t){return n&&(e=e.filter(t)),e}return{init(e){let n=new Set;return r.md5$files={},r.list=e,r.files=e.filter(e=>{if("dir"==e.type)return!1;let{ext:t,md5:o}=e,{md5$files:l}=r;return n.add(t.toLowerCase()),i.add(l,o,e),e.files=l[o],!0}),r.exts=[...n],r},filter:function(e){let{cwd:n="",name:t="",ext$checked:i=null,encoding$checked:l=null,md5$checked:c=null,childDirs:a=null}=e,s=r.files;s=o(s=o(s=o(s=o(s=o(s,t,function(e){return e.name.includes(t)}),n,function(e){let{name:t}=e;return"/"==n?!t.slice(1).includes("/"):!t.slice(n.length+1).includes("/")}),i,function(e){let n=e.ext.toLowerCase();return i[n]}),l,function(e){let n=e.isUTF8?"utf8":"other";return l[n]}),c,function(e){let{md5:n}=e,t=r.md5$files[n].length;return!(!c["N=1"]&&1==t)&&!(!c["N>1"]&&t>1)}),n||(s=o(s,a,function(e){let{name:n}=e;return a.some(e=>n==e||n.startsWith(`${e}/`))}));let d=!1;if(c&&c["N>1"]&&!c["N=1"]){let e={};s.forEach(n=>{let{md5:t,files:i}=n;e[t]=i}),d=!0,s=[],y.keys(e).forEach(n=>{let t=e[n];s=[...s,...t]})}return{list:s,isMd5Mode:d}}}}),f.panel("/FileList/Body/Main/List/File",function(e,n,t){const i=n.require("Filter"),r=n.require("GridView"),o=n.require("Data");let l={root:"",item:null};return t.on("init",function(){i.on({change:function(e){e=y.assign({},e,{cwd:e.cwd?l.item.id:""});let{list:n,isMd5Mode:t}=o.filter(e);r.render(n,{keyword:e.name,root:l.root,isMd5Mode:t})}}),r.on({item:function(e){t.fire("item",[e])}})}),t.on("render",function(e){if(e.item===l.item)return void t.show();let{exts:n}=o.init(e.list);l.item=e.item,l.root=e.root,i.render({exts:n,item:l.item})}),{}}),f.panel("/FileList/Body/Main/List/Tabs",function(e,n,t){const i=e("@definejs/tabs"),r=e("@definejs/local-storage");let o=null,l=null,c={index:0,list:[{name:"文件",cmd:"file"},{name:"目录",cmd:"dir"}]};return t.on("init",function(){l=new r(n.id),c.index=l.get("index")||0,(o=new i({container:t.$,activedClass:"on",eventName:"click",selector:">li"})).on("change",function(e,n){c.index=n,e=c.list[n],l.set("index",n),t.fire(e.cmd)})}),t.on("render",function(e){o.render(c.list,function(e,n){return{index:n,name:e.name}}),"number"==typeof e?c.index=e:e=c.index,o.active(e)}),{}}),f.panel("/FileList/Body/Main/List",function(e,n,t){const i=n.require("Tabs"),r=n.require("File"),o=n.require("Dir");let l={opt:null};return t.on("init",function(){i.on({file:function(){r.render(l.opt),o.hide()},dir:function(){r.hide(),o.render(l.opt)}}),r.on({item:function(e){t.fire("item",[e])}}),o.on({item:function(e){t.fire("item",[e])}})}),t.on("render",function(e){l.opt=e,i.render()}),{}}),f.panel("/FileList/Body/Main/Tree/Header",function(e,n,t){const i=e("CheckBox");let r=[{id:"icon",text:"图标",chk:null},{id:"tab",text:"缩进",chk:null},{id:"color",text:"彩色",chk:null},{id:"hover",text:"悬停",chk:null}];t.on("init",function(){r.forEach(e=>{let n=new i({fireNow:!0,container:t.$.find(`[data-id="chk-${e.id}"]`),text:e.text});n.on("checked",function(n){t.fire("check",[{[e.id]:n}])}),e.chk=n}),t.$on("click","[data-cmd]",function(e){let{cmd:n}=e.target.dataset;t.fire("cmd",n,[])})}),t.on("render",function(e){r.forEach(n=>{let t=e[n.id];n.chk.render({checked:t})})})}),f.panel("/FileList/Body/Main/Tree/Main",function(e,n,t){const i=e("TextTree"),r=e("Clipboard");let o=null;return t.on("init",function(){(o=new i({container:t.$})).on("cmd",function(e,n){t.fire("cmd",[e,n])})}),t.on("render",function(e){let{id:n,list:i}=e;o.render(i),"string"==typeof n&&o.highlight(n),t.fire("render")}),{check(e){o.toggle(e)},copy(){let e=o.toString();r.copy(e)}}}),f.panel("/FileList/Body/Main/Tree",function(e,n,t){const i=n.require("Header"),r=n.require("Main");t.on("init",function(){i.on("check",function(e){r.check(e)}),i.on("cmd",{copy:function(){r.copy()}}),r.on({cmd:function(e,n){t.fire("cmd",e,[n])},render:function(){i.render({icon:!1,tab:!0,color:!0,hover:!1})}})}),t.on("render",function(e){let{item:n,list:t,root:i}=e;t=t.map(e=>{return{id:i+e.name}});let o="/"==n.id?i:i+n.id,l=o.split("/");t=[...l.map((e,n)=>{return{id:l.slice(0,n+1).join("/")}}),...t],r.render({id:o,list:t})})}),f.panel("/FileList/Body/Main/Tabs",function(e,n,t){const i=e("@definejs/tabs"),r=e("@definejs/local-storage");let o=null,l=null,c={index:0,list:[{name:"平铺",cmd:"icon",root:!0},{name:"列表",cmd:"list",root:!0},{name:"架构",cmd:"tree",root:!0}],cmd$module:null};return t.on("init",function(){l=new r(n.id),c.index=l.get("index")||0,(o=new i({container:t.$.get(0),activedClass:"on",eventName:"click",selector:">li",repeated:!0})).on("change",function(e,n){c.index=n,e=c.list[n],l.set("index",n);let{cmd:i}=e,{cmd$module:r}=c;r&&y.keys(r).forEach(e=>{let n=r[e];e==i?t.fire("change",[n]):n.hide()}),t.fire("cmd",i,[])})}),t.on("render",function(){o.render(c.list,function(e,n){return{index:n,name:e.name}}),o.active(c.index)}),{map(e){c.cmd$module=e}}}),f.panel("/FileList/Body/Main",function(e,n,t){const i=n.require("Tabs"),r=n.require("Tree"),o=n.require("List"),l=n.require("Icon");let c={root:"",list:[],item:null};return t.on("init",function(){i.map({tree:r,list:o,icon:l}),i.on({change:function(e){e.render(c)}}),o.on({item:function(e){t.fire("item",[e])}}),l.on({item:function(e){t.fire("item",[e])}}),r.on("cmd",{id:function(e){let n=e.id.slice(c.root.length);t.fire("item",[{name:n||"/"}])}})}),t.on("render",function(e){let n=e.root;n.endsWith("/")&&(n=n.slice(0,-1)),c.root=n,c.list=e.list,c.item=e.item,i.render()}),{}}),f("/FileList/Body/Nav/Data",function(e,n,t){return{make(e){let{type:n,root:t}=e,i="file"==n?e.name:e.item.id,r="file"==n?e:e.item.data,o=`${t}${i}`.split("/").filter(e=>!!e);return{names:o,path:o.join("/"),icon:r}}}}),f.panel("/FileList/Body/Nav",function(e,n,t){const i=e("MenuNav"),r=n.require("Data");let o=null,l={root:""};t.on("init",function(){(o=new i({container:t.$})).on({item:function(e,n){c.log(n,e);let i={name:`/${e.slice(1).join("/")}`};t.fire("item",[i])},text:function(e){if(!e.startsWith(l.root))return!1;e.endsWith("/")&&(e=e.slice(0,-1));let n={name:`/${e.slice(l.root.length)}`};t.fire("item",[n])},render:function(e){t.fire("render",[e])}})}),t.on("render",function(e){l.root=e.root,e=r.make(e),o.render(e)})}),f.panel("/FileList/Body/Preview/MarkDoc",function(e,n,t){const i=e("@definejs/escape"),r=e("MarkDoc");let o=null,l=[".json",".js",".css",".html",".htm",".less"];return t.on("init",function(){(o=new r({container:t.$})).on("render",function(e){let n=o.getOutlines();t.fire("render",[n])})}),t.on("render",function(e){let n=e.content,r=e.ext.toLowerCase(),c="",a=!0;"source"==e.type?(n=i.html(n),c=r.slice(1),a=!1):l.includes(r)&&(c=r.slice(1)),o.render({content:n,language:c,baseUrl:"",code:{format:a}}),t.$.toggleClass("image",e.isImage)}),{outline:function(e){o.toOutline(e)}}}),f.panel("/FileList/Body/Preview/Tabs",function(e,n,t){const i=e("@definejs/tabs");var r=[{name:"预览",type:"preview"},{name:"源码",type:"source"}],o=0,l=null;t.on("init",function(){(l=new i({container:t.$,activedClass:"on",eventName:"click",selector:">li",repeated:!0})).on("change",function(e,n){o=n,e=r[n],t.fire("change",[e.type])})}),t.on("render",function(e){l.render(r,function(e,n){return{index:n,name:e.name}}),"number"==typeof e?o=e:e=o,l.active(e)})}),f.panel("/FileList/Body/Preview",function(e,n,t){const i=n.require("Tabs"),r=n.require("MarkDoc");let o={};return t.on("init",function(){i.on({change:function(e){o.type=e,r.render(o)}}),r.on({render:function(e){t.fire("render",[e])}})}),t.on("render",function(e){let n=e.isImage,t=n?".md":e.ext;o={content:e.content,ext:t,isImage:n,type:""},i.render()}),{get:function(){return o},outline:function(e){r.outline(e)}}}),f.panel("/FileList/Body",function(e,n,t){const i=n.require("Nav"),r=n.require("Main"),o=n.require("Preview");return t.on("init",function(){i.on({render:function(e){t.fire("path",[e])},item:function(e){t.fire("item",[e])}}),r.on({item:function(e){t.fire("item",[e])}}),o.on({render:function(e){t.fire("outline",[e])}})}),t.on("render",function(e,n){i.render(n),"file"==e?(r.hide(),o.render(n)):"dir"==e&&(o.hide(),r.render(n))}),{outline:o.outline,resize(...e){let n="calc(100% - "+e.reduce(function(e,n){return e+n},0)+"px)";t.$.css({width:n})}}}),f("/FileList/Sidebar/Operation/Data",function(e,n,t){let i=[".css",".less",".sass",".html",".htm",".txt",".json",".js",".md"],r=[{name:"详情",cmd:"detail",icon:"fas fa-angle-double-{icon}"},{name:"刷新",cmd:"refresh",icon:"fa fa-sync-alt"},{name:"打开",cmd:"open",icon:"fa fa-external-link-alt"},{name:"编辑",cmd:"edit",icon:"fa fa-edit"},{name:"效果",cmd:"demo",icon:"fas fa-desktop"},{name:"复制",cmd:"copy",icon:"far fa-copy"},{name:"编译",cmd:"compile-less",icon:"fab fa-less"},{name:"压缩",cmd:"minify-js",icon:"fab fa-node-js"},{name:"删除",cmd:"delete",icon:"fa fa-times"}],o={detail:function(){return!0},open:function({detail:e}){return"file"==e.type},edit:function({detail:e}){return"file"==e.type},demo:function({detail:e}){return"file"==e.type},copy:function({detail:e}){return"file"==e.type&&i.includes(e.ext)},"compile-less":function({detail:e}){return"file"==e.type&&".less"==e.ext},"minify-js":function({detail:e}){return"file"==e.type&&".js"==e.ext},delete:function({item:e}){return!!e.parent}};return{make:e=>r.filter(n=>{let{cmd:t}=n,i=o[t];return!i||i(e)})}}),f.panel("/FileList/Sidebar/Operation",function(e,n,t){const i=e("@definejs/local-storage"),r=e("@definejs/string"),o=n.require("Data");let l={visible:!0,list:[]},c=null;t.on("init",function(){c=new i(n.id),l.visible=c.get("visible"),l.visible===M&&(l.visible=!0),t.$on("click",{"li[data-index]":function(e){let{index:n}=this.dataset,i=l.list[n],{cmd:r}=i;if("detail"==r)return l.visible=!l.visible,void t.refresh();t.fire("cmd",[r])}}),t.template(function(e,n){let{cmd:t,icon:i}=e;return"detail"==t&&(i=r.format(i,{icon:l.visible?"right":"left"})),{index:n,cmd:t,icon:i,name:e.name}})}),t.on("render",function(e){let n=l.visible,i=l.list=o.make(e);t.fill(i),t.fire("detail",[n]),c.set("visible",n)})}),f.panel("/FileList/Sidebar/Outline",function(e,n,t){var i=e("Outline"),r=null;t.set("show",!1),t.on("init",function(){(r=new i({container:t.$})).on({item:function(e,n){t.fire("item",[e,n])}}),r.render()}),t.on("render",function(e){r.fill(e)})}),f("/FileList/Sidebar/Stat/Types",function(e,n,t){const i=e("@definejs/object"),r=e("File");let o=[".png",".jpg",".jpeg",".gif",".bmp"];return{get:function(e){if(!e)return[];let n={dir:0,file:0,image:0,size:0,isUTF8:0,notUTF8:0},t={};e.forEach(function(e,i){let r=e.type;if(n[r]++,"dir"==r)return;let l=e.ext.toLowerCase(),c=e.isUTF8?"isUTF8":"notUTF8";t[l]=(t[l]||0)+1,o.includes(l)&&n.image++,n.size+=e.stat.size,n[c]++});let l=[{name:"全部",value:e.length,desc:"个",class:"spliter"}],c=n.size;return c&&(c=r.getSizeDesc(c),l.push({name:"大小",value:c.value,desc:c.desc,class:"dir-size"})),n.dir&&l.push({name:"目录",value:n.dir,desc:"个"}),n.file&&l.push({name:"文件",value:n.file,desc:"个"}),l.push({name:"UTF8 编码",value:n.isUTF8,desc:"个"}),l.push({name:"其它编码",value:n.notUTF8,desc:"个"}),n.image&&l.push({name:"图片",value:n.image,desc:"个"}),y.keys(i.sort(t)).forEach(function(e,n){let i=t[e],r=e.slice(1)+" 文件",o=0==n?"spliter":"";l.push({name:r,value:i,desc:"个",class:o})}),l}}}),f.panel("/FileList/Sidebar/Stat",function(e,n,t){const i=e("File"),r=e("@definejs/date"),o=n.require("Types");t.on("init",function(){t.template({"":function(e){return this.fill("table",e)},table:{"":function(e){let{stat:n,type:t,name:l}=e,c="dir"==t?"目录":e.ext.slice(1)+" 文件",a=r.format(n.birthtime,"yyyy-MM-dd HH:mm:ss"),s=r.format(n.mtime,"yyyy-MM-dd HH:mm:ss"),d=i.getSizeDesc(n.size),u=o.get(e.list),f=l.split("/").slice(-1)[0],m=e.root.slice(0,-1);return u=this.fill("type",u),{sname:f,name:m+l,ext:e.ext,md5:e.md5,size:d.value,sizeDesc:d.desc,birthtime:a,mtime:s,type:c,types:u}},type:function(e,n){return{name:e.name,value:e.value,desc:e.desc||"",class:e.class||""}}}})}),t.on("render",function(e){c.log(e),t.fill(e),t.$.toggleClass("dir","dir"==e.type)})}),f.panel("/FileList/Sidebar/Tabs",function(e,n,t){const i=e("@definejs/tabs");var r=[{name:"常规",type:"general"},{name:"提纲",type:"outline"}],o=0,l=null;t.on("init",function(){(l=new i({container:t.$.get(0),activedClass:"on",eventName:"click",selector:">li",repeated:!0})).on("change",function(e,n){o=n,e=r[n],t.fire(e.type)})}),t.on("render",function(e){var n=e.index,t=e.outline,i=t?r:r.slice(0,-1);l.render(i,function(e,n){return{index:n,name:e.name}}),"number"==typeof n?o=n:n=o,t||(n=0),l.active(n)})}),f.panel("/FileList/Sidebar",function(e,n,t){const i=n.require("Stat"),r=n.require("Operation"),o=n.require("Outline"),l=n.require("Tabs");let c={width:0};return t.on("init",function(){l.on({general:function(){i.show(),r.show(),o.hide()},outline:function(){i.hide(),r.hide(),o.show()}}),r.on({cmd:function(e){t.fire("operation",e)},detail:function(e){c.width=c.width||t.$.width();let n=e?c.width:0;t.$.width(n),t.fire("hide",[n])}}),o.on({item:function(e,n){t.fire("outline",[e,n])}})}),t.on("render",function({detail:e,item:n}){let t="file"==n.data.type&&!e.isImage;i.render(e),r.render({detail:e,item:n}),l.render({outline:t})}),{outline:function(e){o.render(e)}}}),f("/FileList/Tree/Data",function(e,n,t){const i=e("File");function r(e){let{className:n}=i.getIcon({name:e});return n}return{make:function(e){let n=function e(n,t){let{dir$dirs:i,dir$files:o}=n;return i[t].map(function(i){let l=t+"/"+i;l=l.replace(/\/+/g,"/");let c=e(n,l),a=o[l];return a=a.map(function(e){let n=l+"/"+e;return{name:e,id:n,fileIcon:r(e),data:{type:"file",name:n,parent:l}}}),(c=[...c,...a]).length||c.push({name:"(空目录)",id:l+"/",data:{type:"file",name:"",parent:l}}),{name:i,id:l,data:{type:"dir",name:l,parent:t},list:c}})}(e,"/"),t=e.dir$files["/"];return t=t.map(function(e){let n="/"+e;return{name:e,id:n,fileIcon:r(e),data:{type:"file",name:n,parent:"/"}}}),n=[...n,...t],[{name:e.root.split("/").slice(-1)[0],id:"/",open:!0,data:{type:"dir",name:"/"},list:n}]}}}),f.panel("/FileList/Tree",function(e,n,t){const i=e("SidebarTree"),r=n.require("Data");let o=null;return t.on("init",function(){(o=new i({container:t.$,width:t.$.width()})).on({item:function(...e){t.fire("item",e)},dir:function(...e){t.fire("dir",e)},resize:function(...e){let n=o.$.outerWidth();t.$.width(n),t.fire("resize",e)}})}),t.on("render",function(e){let n=r.make(e);o.render(n)}),{open:function(e){o.open(e)}}}),f("/FileList/API",function(e,n,t){const i=e("@definejs/emitter"),r=e("@definejs/string"),o=e("@definejs/loading"),l=e("@definejs/toast"),c=e("API");let a=new i,s=new o({mask:0}),d=new l({duration:1500,mask:0});return{on:a.on.bind(a),get:function(){let e=new c("FileList.get",{});e.on({request:function(){s.show("加载中...")},response:function(){s.hide()},success:function(e,n,t){a.fire("success","get",[e])},fail:function(e,n,t,i){u.alert("获取文件列表失败: {0}",n)},error:function(e,n,t,i){u.alert("获取文件列表错误: 网络繁忙，请稍候再试")}}),e.get()},read:function(e){let n=new c("FileList.read",{});n.on({request:function(){s.show("加载中...")},response:function(){s.hide()},success:function(n,t,i){n.content;if(n.isImage){let e="![ ]({url})";n.content=r.format(e,{url:n.url})}let o=e.data.type,l={detail:n,item:e};a.fire("success","read",o,[l])},fail:function(e,n,t,i){u.alert("获取文件内容失败: {0}",n)},error:function(e,n,t,i){u.alert("获取文件内容错误: 网络繁忙，请稍候再试")}}),n.get({id:e.id})},delete:function(e){let n=e.data.type,t=`你确认要删除该${{file:"文件",dir:"目录"}[n]}（${e.id}）吗？ `;"dir"==n&&(t+='<p style="color: red;">这将会连同它的所有子目录和文件一起删除。</p>'),t+='<p style="color: #FF5722; font-weight: bold;">该操作会直接从服务器上删除目标项，且不可恢复！</p>',u.confirm(t,function(){let t=new c("FileList.delete");t.on({request:function(){s.show("删除中...")},response:function(){s.hide()},success:function(n,t,i){d.show("删除成功",function(n){a.fire("success","delete",[{id:e.id,parent:e.parent.id}])})},fail:function(e,n,t,i){u.alert("删除失败: {0}",n)},error:function(e,n,t,i){u.alert("删除错误: 网络繁忙，请稍候再试")}}),t.post({id:e.id,type:n})})}}}),f.view("/FileList",function(e,n,t){const i=e("@definejs/session-storage"),r=e("Clipboard"),o=n.require("API"),l=n.require("Tree"),c=n.require("Sidebar"),a=n.require("Body");let s=new i(n.id),d={item:{id:"/"},detail:null};t.on("init",function(){o.on("success",{get:function(e){let n=function(e,n){return n==e?"/":(n.startsWith(`${e}/`)&&(n=n.slice(e.length)),n)}(e.root,d.item.id);d.item.id=n,l.render(e),l.open(n)},read:{dir:function({detail:e,item:n}){a.render("dir",{list:e.list,item:n,root:e.root}),c.render({detail:e,item:n})},file:function({detail:e,item:n}){d.detail=e,a.render("file",e),c.render({detail:e,item:n})}},delete:function(e){d.item.id=e.parent,o.get()}}),l.on({item:function(e){s.set("id",e.id),d.item=e,o.read(e)},resize:function(){let e=l.$.outerWidth(),n=c.$.outerWidth();a.resize(e,n,6)}}),a.on({outline:function(e){c.outline(e)},item:function(e){l.open(e.name)},path:function(e){}}),c.on({outline:function(e,n){a.outline(n)},hide:function(e){let n=l.$.outerWidth();a.resize(n,e,6)}}),c.on("operation",{refresh:function(){o.get()},delete:function(){o.delete(d.item)},open:function(){t.fire("open",[d.detail.url])},edit:function(){t.fire("edit",[d.item.id])},demo:function(){t.fire("demo",[d.item.id])},copy:function(){r.copy(d.detail.content)},"compile-less":function(){t.fire("compile-less",[d.detail.content])},"minify-js":function(){t.fire("minify-js",[d.detail.content])}})}),t.on("render",function(e){let n=e||s.get("id")||"/";d.path=n,d.item={id:n},o.get()})}),f("/Home/FileList/Main/Data",function(e,n,t){const i=new Set([".png",".jpg",".jpeg",".gif",".bmp"]);return{parse(e){let n=[],t=[],r=[],o={},l=0,c={is:0,not:0};e.forEach(e=>{let{type:a,ext:s,stat:d,isUTF8:u}=e;"dir"!=a?(t.push(e),function(e,n,t){let i=e[n];i||(i=e[n]=[]),i.push(t)}(o,s,e),i.has(s)&&r.push(e),l+=d.size,c[u?"is":"not"]++):n.push(e)});let a=y.keys(o).map(e=>{return{ext:e,files:o[e]}});return{list:e,dirs:n,files:t,images:r,ext$files:o,exts:a,size:l,utf8:c}}}}),f("/Home/FileList/API",function(e,n,t){const i=e("@definejs/emitter"),r=e("API");let o=new i;return{on:o.on.bind(o),get:function(){let e=new r("FileList.read",{});e.on({request:function(){},response:function(){},success:function(e,n,t){o.fire("success","get",[e])},fail:function(e,n,t,i){u.alert("获取文件列表失败: {0}",n)},error:function(e,n,t,i){u.alert("获取文件列表错误: 网络繁忙，请稍候再试")}}),e.get({id:"/"})}}}),f.panel("/Home/FileList/Loading",function(e,n,t){t.on("init",function(){}),t.on("render",function(){})}),f.panel("/Home/FileList/Main",function(e,n,t){const i=e("File"),r=n.require("Data");t.on("init",function(){t.template({"":function(e){return this.fill("html",e)},html:{"":function(e){let{list:n,dirs:t,files:r,images:o,ext$files:l,exts:c,size:a,utf8:s}=e,d=this.fill("type",c),u=i.getSizeDesc(a);return{all:n.length,sizeValue:u.value,sizeDesc:u.desc,dir:t.length,file:r.length,image:o.length,types:d,isUTF8:s.is,notUTF8:s.not}},type:function(e,n){let{ext:t,files:i}=e;return{ext:t=t.slice(1)||"(none)",count:i.length}}}})}),t.on("render",function(e){e=r.parse(e.list),t.fill(e)})}),f.panel("/Home/FileList",function(e,n,t){const i=n.require("API"),r=n.require("Loading"),o=n.require("Main");t.on("init",function(){i.on("success",{get:function(e){r.hide(),o.render(e)}})}),t.on("render",function(){o.hide(),r.render(),i.get()})}),f("/Home/JsModule/Main/Data",function(e,n,t){return{parse(e){let{ids:n,id$module:t,id$children:i,singles:r,level$ids:o}=e.moduleStat,l=[],c=[],a=[],s=[],d=[],u=[],f=[];n.forEach(e=>{if(!e)return void l.push(e);let{level:n}=t[e];(i[e]||[]).length>0&&s.push(e),1==n?c.push(e):a.push(e);let r=t[e],{method:o}=r;o.endsWith(".view")?d.push(e):o.endsWith(".panel")?u.push(e):f.push(e)});let m=y.keys(o).map(e=>{return{level:e,ids:o[e]}});return{ids:n,nones:l,publics:c,privates:a,singles:r,parents:s,views:d,panels:u,defines:f,levels:m}}}}),f("/Home/JsModule/API",function(e,n,t){const i=e("@definejs/emitter"),r=e("API");let o=new i;return{on:o.on.bind(o),get:function(){let e=new r("Stat.get",{});e.on({request:function(){},response:function(){},success:function(e,n,t){c.log(e),o.fire("success","get",[e])},fail:function(e,n,t,i){u.alert("获取统计数据失败: {0}",n)},error:function(e,n,t,i){u.alert("获取统计数据错误: 网络繁忙，请稍候再试")}}),e.get()}}}),f.panel("/Home/JsModule/Loading",function(e,n,t){t.on("init",function(){}),t.on("render",function(){})}),f.panel("/Home/JsModule/Main",function(e,n,t){const i=n.require("Data");t.on("init",function(){t.template({"":function(e){return this.fill("html",e)},html:{"":function(e){let{ids:n,nones:t,publics:i,privates:r,singles:o,parents:l,views:c,panels:a,defines:s,levels:d}=e,u=this.fill("level",d);return{all:n.length,none:t.length,public:i.length,private:r.length,view:c.length,panel:a.length,define:s.length,single:o.length,parent:l.length,child:r.length,levels:u}},level:function(e){return{level:e.level,count:e.ids.length}}}})}),t.on("render",function(e){let n=i.parse(e);t.fill(n)})}),f.panel("/Home/JsModule",function(e,n,t){const i=n.require("API"),r=n.require("Loading"),o=n.require("Main");t.on("init",function(){i.on("success",{get:function(e){r.hide(),o.render(e)}})}),t.on("render",function(){o.hide(),r.render(),i.get()})}),f("/Home/Server/API",function(e,n,t){const i=e("@definejs/emitter"),r=e("API");let o=new i;return{on:o.on.bind(o),get:function(){let e=new r("Server.get",{});e.on({request:function(){},response:function(){},success:function(e,n,t){c.log(e),e.host=e.host||"localhost",o.fire("success","get",[e])},fail:function(e,n,t,i){u.alert(`获取服务器信息失败: $${n}`)},error:function(e,n,t,i){u.alert("获取服务器信息错误: 网络繁忙，请稍候再试")}}),e.get()}}}),f.panel("/Home/Server/Loading",function(e,n,t){t.on("init",function(){}),t.on("render",function(){})}),f.panel("/Home/Server/Main",function(e,n,t){const i=e("@definejs/date");return t.on("init",function(){t.template({"":function(e){return this.fill("table",e)},table:{"":function(e){let n=e.statics.filter(e=>"/"!=e),t=this.fill("status",{running:!0}),r=this.fill("local",n,e),o=this.fill("network",n,e),{session:l}=e,{allowCrossOrigin:c}=e.api;return{status:t,time:i.format(l.time,"yyyy-MM-dd HH:mm:ss"),port:e.port,host:e.host,sessionId:l.id,crossOriginClass:c?"cross-origin-true":"cross-origin-false",crossOriginIcon:c?"check":"times",crossOriginText:c?"允许":"禁止",localUrls:r,networkUrls:o}},status:function({running:e}){return{status:e?"play":"stop",text:e?"运行中":"已停止"}},local:function(e,n,t){return{port:t.port,dir:e}},network:function(e,n,t){let{host:i,port:r}=t,o=`http://${i}:${r}${e}`;return{host:i,port:r,dir:e,url:o=encodeURIComponent(o),"qrcode.path":t.qrcode.path}}}})}),t.on("render",function(e){t.fill(e)}),{setStatus(e){let n=t.template().fill("table","status",{running:e});t.$.find('[data-id="td-status"]').html(n)}}}),f("/Home/Server/Status",function(e,n,t){const i=e("@definejs/query"),r=e("@definejs/emitter"),o=e("@definejs/toast");let l=new r,c=new o({icon:"ban",mask:.25,width:200,text:"服务器已停止运行"}),a=u.config("API"),s=null;return{on:l.on.bind(l),test:function(){let e=i.add(`${a.url}sse/Terminal.exec`,{cmd:"pwd",args:"[]"}),n=!0;function t(e){e!==n&&(!1===n&&!0===e?(c.hide(),l.fire("restart")):(c.show("服务器已停止运行"),l.fire("close")),n=e)}!function(){if(s)s.close(),s=null}(),(s=new EventSource(e)).addEventListener("stdout",function(e){t(!0)}),s.addEventListener("error",function(e){let{data:n}=e;n!==M||t(!1)}),s.addEventListener("stderr",function(e){t(!0)})}}}),f.panel("/Home/Server",function(e,n,t){const i=n.require("API"),r=n.require("Status"),o=n.require("Loading"),l=n.require("Main");t.on("init",function(){i.on("success",{get:function(e){o.hide(),l.render(e),r.test("pwd")}}),r.on({restart:function(){t.refresh()},close:function(){l.setStatus(!1)}})}),t.on("render",function(){l.hide(),o.render(),i.get()})}),f.view("/Home",function(e,n,t){const i=n.require("JsModule"),r=n.require("FileList"),o=n.require("Server");t.on("init",function(){}),t.on("render",function(){i.render(),r.render(),o.render()})}),f.panel("/HtmlTree/Main/HtmlBlock/BaseInfo/Children/GridView",function(e,n,t){const i=e("GridView");let r=null,o=null;t.on("init",function(){o=t.template(),(r=new i({container:t.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"节点名称",name:"name",width:300,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"所在文件",name:"file",width:500,class:"file",dragable:!0,delegate:"[data-cmd]"}]})).on("process","row",function(e){}),r.on("process","cell",{name:function(e){let n=e.row.data;return o.fill("href",{cmd:"id",text:n.name})},file:function(e){let n=e.row.data;return o.fill("href",{cmd:"file",text:n.file})}}),r.on("click","cell",function(e,n){let i=n.target.dataset.cmd;i&&(n.stopPropagation(),t.fire("cmd",[i,e.row.data]))}),r.render()}),t.on("render",function(e){r.fill(e)})}),f.panel("/HtmlTree/Main/HtmlBlock/BaseInfo/Childs/GridView",function(e,n,t){const i=e("GridView");let r=null,o=null;t.on("init",function(){o=t.template(),(r=new i({container:t.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"节点名称",name:"name",width:300,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"所在文件",name:"file",width:500,class:"file",dragable:!0,delegate:"[data-cmd]"}]})).on("process","row",function(e){}),r.on("process","cell",{name:function(e){let n=e.row.data;return o.fill("href",{cmd:"id",text:n.name})},file:function(e){let n=e.row.data;return o.fill("href",{cmd:"file",text:n.file})}}),r.on("click","cell",function(e,n){let i=n.target.dataset.cmd;i&&(n.stopPropagation(),t.fire("cmd",[i,e.row.data]))}),r.render()}),t.on("render",function(e){r.fill(e)})}),f.panel("/HtmlTree/Main/HtmlBlock/BaseInfo/Base",function(e,n,t){const i=e("@definejs/escape");let r={node:null};t.on("init",function(){t.template(function(e){let{data:n,parent:t}=e,r=i.html(n.tags.begin),o=i.html(n.tags.end),l=JSON.stringify(n.patterns,null,4);return{tabs:n.tabs,beginNo:n.begin+1,endNo:n.end+1,beginTag:r,endTag:o,patterns:l,parent:`${t.cid} - ${t.name}`}}),t.$on("click",{'[data-cmd="parent"]':function(e){let n=r.node.parent.id;t.fire("id",[n])},'[data-cmd="file"]':function(e){let n=r.node.data.file;t.fire("file",[n])},'[data-cmd="dir"]':function(e){let n=r.node.data.link.dir;n.endsWith("/")&&(n=n.slice(0,-1)),t.fire("file",[n])},'[data-cmd="rel"]':function(e){t.fire("rel")}})}),t.on("render",function(e){r.node=e,t.fill(e)})}),f.panel("/HtmlTree/Main/HtmlBlock/BaseInfo/Children",function(e,n,t){const i=n.require("GridView");t.set("show",!1),t.on("init",function(){i.on({cmd:function(e,n){let i=n[e];t.fire(e,[i])}})}),t.on("render",function(e){let n=e.children.map(e=>{let{data:n}=e;return{id:e.id,name:`${e.cid} - ${e.name}`,file:n.file,list:e.list.length}});i.render(n),t.show()})}),f.panel("/HtmlTree/Main/HtmlBlock/BaseInfo/Childs",function(e,n,t){const i=n.require("GridView");t.set("show",!1),t.on("init",function(){i.on({cmd:function(e,n){let i=n[e];t.fire(e,[i])}})}),t.on("render",function(e){let n=e.list.map(e=>{let{data:n}=e;return{id:e.id,name:`${e.cid} - ${e.name}`,file:n.file,list:e.list.length}});i.render(n),t.show()})}),f.panel("/HtmlTree/Main/HtmlBlock/BaseInfo",function(e,n,t){const i=n.require("Base"),r=n.require("Childs"),o=n.require("Children");t.on("init",function(){[i,r,o].forEach(e=>{e.on({file:function(e){t.fire("file",[e])},id:function(e){t.fire("id",[e])}})}),i.on({rel:function(){t.fire("rel")}})}),t.on("render",function(e){i.render(e),r.render(e),e.children.length>e.list.length?o.render(e):o.hide()})}),f("/HtmlTree/Main/HtmlBlock/Rel/Data",function(e,n,t){return{get(e){let{parent:n}=e;return{file:n.data.file,content:n.data.content,beginNo:e.data.begin,endNo:e.data.end}}}}),f.panel("/HtmlTree/Main/HtmlBlock/Rel/Header",function(e,n,t){const i=e("File");let r={file:""};return t.on("init",function(){t.$on("click",{'[data-cmd="file"]':function(e){t.fire("file",[r.file])}})}),t.on("render",function(e){let n=i.getIcon(e);r.file=e,t.fill({icon:n.html,file:e})}),{}}),f.panel("/HtmlTree/Main/HtmlBlock/Rel/MarkDoc",function(e,n,t){const i=e("MarkDoc"),r=e("$");let o=null;return t.on("init",function(){o=new i({container:t.$})}),t.on("render",function(e){o.render({content:e,language:"html",baseUrl:"",code:{format:!0}})}),{highlight(e,n){let t=o.$.find("ul.line-numbers>li").toArray();(t=t.slice(e,n+1)).forEach(e=>{r(e).addClass("on")}),s(()=>{t[0].scrollIntoViewIfNeeded()},200)}}}),f.panel("/HtmlTree/Main/HtmlBlock/Rel",function(e,n,t){const i=n.require("Data"),r=n.require("Header"),o=n.require("MarkDoc");return t.on("init",function(){r.on({file:function(e){t.fire("file",[e])}})}),t.on("render",function(e){let{file:n,content:t,beginNo:l,endNo:c}=i.get(e);r.render(n),o.render(t),o.highlight(l,c)}),{}}),f.panel("/HtmlTree/Main/HtmlBlock/Render",function(e,n,t){const i=e("MarkDoc");let r=null;return t.on("init",function(){r=new i({container:t.$})}),t.on("render",function(e){let n=e.data.block.render,t=e.data.tabs;if(t>0){n=n.split("\n").map(e=>e.slice(t)).join("\n")}r.render({content:n,language:"html",baseUrl:"",code:{format:!0}})}),{}}),f.panel("/HtmlTree/Main/HtmlBlock/Tabs",function(e,n,t){const i=e("@definejs/tabs"),r=e("@definejs/local-storage");let o=[{name:"基本信息",cmd:"base"},{name:"引用原文",cmd:"rel"},{name:"渲染内容",cmd:"render"}],l=null,c=null,a={index:0,list:[],cmd$module:null};return t.on("init",function(){c=new r(n.id),a.index=c.get("index")||0,(l=new i({container:t.$.get(0),activedClass:"on",eventName:"click",selector:">li",repeated:!0})).on("change",function(e,n){a.index=n,e=a.list[n],c.set("index",n);let{cmd:i}=e,{cmd$module:r}=a;r&&y.keys(r).forEach(e=>{let n=r[e];e==i?t.fire("change",[n]):n.hide()}),t.fire("cmd",i,[])})}),t.on("render",function(e){a.list=o,e&&(a.list=a.list.filter(e=>e.root)),l.render(a.list,function(e,n){return{index:n,name:e.name}}),a.index>a.list.length-1&&(a.index=0),l.active(a.index)}),{active(e){let n=a.list.findIndex(n=>n.cmd==e);l.active(n)},map(e){a.cmd$module=e}}}),f.panel("/HtmlTree/Main/HtmlBlock",function(e,n,t){const i=n.require("Tabs"),r=n.require("BaseInfo"),o=n.require("Rel"),l=n.require("Render");let c={item:null};return t.on("init",function(){i.map({base:r,rel:o,render:l}),i.on({change:function(e){e.render(c.item)}}),[r,o].forEach(e=>{e.on({file:function(e){t.fire("file",[e])},id:function(e){t.fire("id",[e])}})}),r.on({rel:function(){i.active("rel")}})}),t.on("render",function(e){c.item=e,i.render()}),{}}),f.panel("/HtmlTree/Main/HtmlLink/BaseInfo/Children/GridView",function(e,n,t){const i=e("GridView");let r=null,o=null;t.on("init",function(){o=t.template(),(r=new i({container:t.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"节点名称",name:"name",width:300,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"所在文件",name:"file",width:500,class:"file",dragable:!0,delegate:"[data-cmd]"}]})).on("process","row",function(e){}),r.on("process","cell",{name:function(e){let n=e.row.data;return o.fill("href",{cmd:"id",text:n.name})},file:function(e){let n=e.row.data;return o.fill("href",{cmd:"file",text:n.file})}}),r.on("click","cell",function(e,n){let i=n.target.dataset.cmd;i&&(n.stopPropagation(),t.fire("cmd",[i,e.row.data]))}),r.render()}),t.on("render",function(e){r.fill(e)})}),f.panel("/HtmlTree/Main/HtmlLink/BaseInfo/Childs/GridView",function(e,n,t){const i=e("GridView");let r=null,o=null;t.on("init",function(){o=t.template(),(r=new i({container:t.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"节点名称",name:"name",width:300,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"所在文件",name:"file",width:500,class:"file",dragable:!0,delegate:"[data-cmd]"}]})).on("process","row",function(e){}),r.on("process","cell",{name:function(e){let n=e.row.data;return o.fill("href",{cmd:"id",text:n.name})},file:function(e){let n=e.row.data;return o.fill("href",{cmd:"file",text:n.file})}}),r.on("click","cell",function(e,n){let i=n.target.dataset.cmd;i&&(n.stopPropagation(),t.fire("cmd",[i,e.row.data]))}),r.render()}),t.on("render",function(e){r.fill(e)})}),f.panel("/HtmlTree/Main/HtmlLink/BaseInfo/Base",function(e,n,t){const r=e("MarkDoc");let o=null,l={node:null};t.on("init",function(){t.template({"":function(e){let n=e.data.href?"static":"block";return this.fill(n,e)},static:function(e){let{data:n,parent:t}=e,l=function(e){return(o=o||new r({container:i.createElement("div")})).render({content:e,language:"html",code:{numbers:!1,language:!1}}),e=o.$.html()}(n.item);return{href:n.href,file:n.file,tabs:n.tabs,no:n.no+1,dir:n.link.dir,rel:l,parent:`${t.cid} - ${t.name}`}},block:function(e){let{data:n,parent:t}=e;return{file:n.file,dir:n.link.dir,parent:`${t.cid} - ${t.name}`}}}),t.$on("click",{'[data-cmd="parent"]':function(e){let n=l.node.parent.id;t.fire("id",[n])},'[data-cmd="file"]':function(e){let n=l.node.data.file;t.fire("file",[n])},'[data-cmd="dir"]':function(e){let n=l.node.data.link.dir;n.endsWith("/")&&(n=n.slice(0,-1)),t.fire("file",[n])},'[data-cmd="rel"]':function(e){t.fire("rel")}})}),t.on("render",function(e){l.node=e,t.fill(e)})}),f.panel("/HtmlTree/Main/HtmlLink/BaseInfo/Children",function(e,n,t){const i=n.require("GridView");t.set("show",!1),t.on("init",function(){i.on({cmd:function(e,n){let i=n[e];t.fire(e,[i])}})}),t.on("render",function(e){let n=e.children.map(e=>{let{data:n}=e,t=n.link.content.split("\n");return{id:e.id,name:`${e.cid} - ${e.name}`,file:n.file,lines:t.length,list:e.list.length}});i.render(n),t.show()})}),f.panel("/HtmlTree/Main/HtmlLink/BaseInfo/Childs",function(e,n,t){const i=n.require("GridView");t.set("show",!1),t.on("init",function(){i.on({cmd:function(e,n){let i=n[e];t.fire(e,[i])}})}),t.on("render",function(e){let n=e.list.map(e=>{let{data:n}=e,t=n.link.content.split("\n");return{id:e.id,name:`${e.cid} - ${e.name}`,file:n.file,lines:t.length,list:e.list.length}});i.render(n),t.show()})}),f.panel("/HtmlTree/Main/HtmlLink/BaseInfo",function(e,n,t){const i=n.require("Base"),r=n.require("Childs"),o=n.require("Children");t.on("init",function(){[i,r,o].forEach(e=>{e.on({file:function(e){t.fire("file",[e])},id:function(e){t.fire("id",[e])}})}),i.on({rel:function(){t.fire("rel")}})}),t.on("render",function(e){i.render(e),r.render(e),e.children.length>e.list.length?o.render(e):o.hide()})}),f("/HtmlTree/Main/HtmlLink/Content/Data",function(e,n,t){return{get(e){let{data:n}=e,{content:t,file:i}=n.link;return{file:i,content:t}}}}),f.panel("/HtmlTree/Main/HtmlLink/Content/Header",function(e,n,t){const i=e("File");let r={file:""};return t.on("init",function(){t.$on("click",{'[data-cmd="file"]':function(e){t.fire("file",[r.file])}})}),t.on("render",function(e){let n=i.getIcon(e);r.file=e,t.fill({icon:n.html,file:e})}),{}}),f.panel("/HtmlTree/Main/HtmlLink/Content/MarkDoc",function(e,n,t){const i=e("MarkDoc"),r=e("$");let o=null;return t.on("init",function(){o=new i({container:t.$})}),t.on("render",function(e){o.render({content:e,language:"html",baseUrl:"",code:{format:!0}})}),{highlight(e,n){let t=[];o.$.find("ul.line-numbers>li").each(function(i){let o=this;e<=i&&i<=n&&(r(o).addClass("on"),t.push(o))}),t.length>0&&s(()=>{t[0].scrollIntoViewIfNeeded()},200)}}}),f.panel("/HtmlTree/Main/HtmlLink/Content",function(e,n,t){const i=n.require("Data"),r=n.require("Header"),o=n.require("MarkDoc");return t.on("init",function(){r.on({file:function(e){t.fire("file",[e])}})}),t.on("render",function(e){let{file:n,content:t}=i.get(e);r.render(n),o.render(t)}),{}}),f.panel("/HtmlTree/Main/HtmlLink/FileInfo",function(e,n,t){const i=e("File"),r=e("@definejs/date"),o=i.API();let l={file:"",dir:""};t.on("init",function(){t.$on("click",{'[data-cmd="file"]':function(e){t.fire("file",[l.file])},'[data-cmd="dir"]':function(e){t.fire("file",[l.dir])}}),o.on("success",{read:function(e){let n=l.file.split("/").slice(-1)[0],o=e.content.split("\n"),{stat:c}=e,a=i.getSizeDesc(c.size),s=e.ext.slice(1)+" 文件",d=r.format(c.birthtime,"yyyy-MM-dd HH:mm:ss"),u=r.format(c.mtime,"yyyy-MM-dd HH:mm:ss");t.fill({name:n,file:l.file,dir:l.dir,ext:e.ext,md5:e.md5,type:s,lines:o.length,size:a.value,sizeDesc:a.desc,birthtime:d,mtime:u,isUTF8:e.isUTF8?"是":"否"})}})}),t.on("render",function(e){let{file:n}=e.data;n!=l.file&&(l.file=n,l.dir=n.split("/").slice(0,-1).join("/"),o.read(n))})}),f("/HtmlTree/Main/HtmlLink/Rel/Data",function(e,n,t){return{get(e){let{parent:n}=e,{data:t}=n;if(t.link){let t=n.data.link,i=e.data.no;return{file:t.file,content:t.content,beginNo:i,endNo:i}}if(t.block){let e=n.parent.data;return{file:e.file,content:e.content,beginNo:t.begin,endNo:t.end}}if("MasterPage"==t.type){let t=n.data,i=e.data.no;return{file:t.file,content:t.content,beginNo:i,endNo:i}}throw new g("无法识别的 node 节点。")}}}),f.panel("/HtmlTree/Main/HtmlLink/Rel/Header",function(e,n,t){const i=e("File");let r={file:""};return t.on("init",function(){t.$on("click",{'[data-cmd="file"]':function(e){t.fire("file",[r.file])}})}),t.on("render",function(e){let n=i.getIcon(e);r.file=e,t.fill({icon:n.html,file:e})}),{}}),f.panel("/HtmlTree/Main/HtmlLink/Rel/MarkDoc",function(e,n,t){const i=e("MarkDoc"),r=e("$");let o=null;return t.on("init",function(){o=new i({container:t.$})}),t.on("render",function(e){o.render({content:e,language:"html",baseUrl:"",code:{format:!0}})}),{highlight(e,n){let t=o.$.find("ul.line-numbers>li").toArray();(t=t.slice(e,n+1)).forEach(e=>{r(e).addClass("on")}),s(()=>{t[0].scrollIntoViewIfNeeded()},200)}}}),f.panel("/HtmlTree/Main/HtmlLink/Rel",function(e,n,t){const i=n.require("Data"),r=n.require("Header"),o=n.require("MarkDoc");return t.on("init",function(){r.on({file:function(e){t.fire("file",[e])}})}),t.on("render",function(e){let{file:n,content:t,beginNo:l,endNo:c}=i.get(e);r.render(n),o.render(t),o.highlight(l,c)}),{}}),f.panel("/HtmlTree/Main/HtmlLink/Render",function(e,n,t){const i=e("MarkDoc");let r=null;return t.on("init",function(){r=new i({container:t.$})}),t.on("render",function(e){let n=e.data.link.render,t=e.data.tabs;if(t>0){n=n.split("\n").map(e=>e.slice(t)).join("\n")}r.render({content:n,language:"html",baseUrl:"",code:{format:!0}})}),{}}),f.panel("/HtmlTree/Main/HtmlLink/Tabs",function(e,n,t){const i=e("@definejs/tabs"),r=e("@definejs/local-storage");let o=[{name:"基本信息",cmd:"base"},{name:"引用原文",cmd:"rel"},{name:"渲染内容",cmd:"render"},{name:"文件内容",cmd:"content"},{name:"文件信息",cmd:"file"}],l=null,c=null,a={index:0,list:[],cmd$module:null};return t.on("init",function(){c=new r(n.id),a.index=c.get("index")||0,(l=new i({container:t.$.get(0),activedClass:"on",eventName:"click",selector:">li",repeated:!0})).on("change",function(e,n){a.index=n,e=a.list[n],c.set("index",n);let{cmd:i}=e,{cmd$module:r}=a;r&&y.keys(r).forEach(e=>{let n=r[e];e==i?t.fire("change",[n]):n.hide()}),t.fire("cmd",i,[])})}),t.on("render",function(e){a.list=o,e&&(a.list=a.list.filter(e=>e.root)),l.render(a.list,function(e,n){return{index:n,name:e.name}}),a.index>a.list.length-1&&(a.index=0),l.active(a.index)}),{active(e){let n=a.list.findIndex(n=>n.cmd==e);l.active(n)},map(e){a.cmd$module=e}}}),f.panel("/HtmlTree/Main/HtmlLink",function(e,n,t){const i=n.require("Tabs"),r=n.require("Content"),o=n.require("FileInfo"),l=n.require("BaseInfo"),c=n.require("Rel"),a=n.require("Render");let s={item:null};return t.on("init",function(){i.map({base:l,file:o,content:r,rel:c,render:a}),i.on({change:function(e){e.render(s.item)}}),[o,l,c,r].forEach(e=>{e.on({file:function(e){t.fire("file",[e])},id:function(e){t.fire("id",[e])}})}),l.on({rel:function(){i.active("rel")}})}),t.on("render",function(e){s.item=e,i.render()}),{}}),f.panel("/HtmlTree/Main/JsLink/BaseInfo/Base",function(e,n,t){const r=e("MarkDoc");let o=null,l={node:null,dir:""};t.on("init",function(){t.template({"":function(e){let n=e.data.html?"static":"block";return this.fill(n,e)},static:function(e){let{data:n,parent:t}=e,c=function(e){return(o=o||new r({container:i.createElement("div")})).render({content:e,language:"html",code:{numbers:!1,language:!1}}),e=o.$.html()}(n.html),a=n.file.split("/").slice(0,-1).join("/");return l.dir=a,{type:n.link.type,href:n.href,file:n.file,tabs:n.tabs,no:n.no+1,dir:a,rel:c,parent:`${t.cid} - ${t.name}`}},block:function(e){let{data:n,parent:t}=e,i=n.file.split("/").slice(0,-1).join("/");return l.dir=i,{type:n.link.type,file:n.file,dir:i,parent:`${t.cid} - ${t.name}`}}}),t.$on("click",{'[data-cmd="parent"]':function(e){let n=l.node.parent.id;t.fire("id",[n])},'[data-cmd="file"]':function(e){let n=l.node.data.file;t.fire("file",[n])},'[data-cmd="dir"]':function(e){t.fire("file",[l.dir])},'[data-cmd="rel"]':function(e){t.fire("rel")}})}),t.on("render",function(e){l.node=e,t.fill(e)})}),f.panel("/HtmlTree/Main/JsLink/BaseInfo",function(e,n,t){const i=n.require("Base");t.on("init",function(){[i].forEach(e=>{e.on({file:function(e){t.fire("file",[e])},id:function(e){t.fire("id",[e])}})}),i.on({rel:function(){t.fire("rel")}})}),t.on("render",function(e){i.render(e)})}),f("/HtmlTree/Main/JsLink/Compile/API",function(e,n,t){const i=e("@definejs/emitter"),r=e("@definejs/loading"),o=e("API");let l=new i,c=new r({mask:0});return{on:l.on.bind(l),compile:function(e){let n=new o("Less.compile",{});n.on({request:function(){c.show("编译中...")},response:function(){c.hide()},success:function(e,n,t){l.fire("success","compile",[e])},fail:function(e,n,t,i){u.alert("编译 less 失败: {0}",n)},error:function(e,n,t,i){u.alert("编译 less 错误: 网络繁忙，请稍候再试")}}),n.post({file:e.file,dest:e.dest,minify:!1})}}}),f.panel("/HtmlTree/Main/JsLink/Compile/Header",function(e,n,t){const i=e("File");let r={file:""};return t.on("init",function(){t.$on("click",{'[data-cmd="file"]':function(e){t.fire("file",[r.file])}})}),t.on("render",function(e){let n=i.getIcon(e);r.file=e,t.fill({icon:n.html,file:e})}),{}}),f.panel("/HtmlTree/Main/JsLink/Compile/MarkDoc",function(e,n,t){const i=e("MarkDoc");let r=null;return t.on("init",function(){r=new i({container:t.$})}),t.on("render",function(e){r.render({content:e,language:"css"})}),{}}),f.panel("/HtmlTree/Main/JsLink/Compile",function(e,n,t){const i=n.require("API"),r=n.require("Header"),o=n.require("MarkDoc");return t.on("init",function(){r.on({file:function(e){t.fire("file",[e])}}),i.on("success",{compile:function(e){o.render(e.css)}})}),t.on("render",function(e){let{file:n,dest:t}=e.data;r.render(t.file),i.compile({file:n,dest:t.file})}),{}}),f.panel("/HtmlTree/Main/JsLink/Content/Header",function(e,n,t){const i=e("File");let r={file:""};return t.on("init",function(){t.$on("click",{'[data-cmd="file"]':function(e){t.fire("file",[r.file])}})}),t.on("render",function(e){let n=i.getIcon(e);r.file=e,t.fill({icon:n.html,file:e})}),{}}),f.panel("/HtmlTree/Main/JsLink/Content/MarkDoc",function(e,n,t){const i=e("MarkDoc"),r=e("$");let o=null;return t.on("init",function(){o=new i({container:t.$})}),t.on("render",function({content:e,ext:n}){let t=n.startsWith(".")?n.slice(1):n;o.render({content:e,language:t,baseUrl:"",code:{format:!0}})}),{highlight(e,n){let t=[];o.$.find("ul.line-numbers>li").each(function(i){let o=this;e<=i&&i<=n&&(r(o).addClass("on"),t.push(o))}),t.length>0&&s(()=>{t[0].scrollIntoViewIfNeeded()},200)}}}),f.panel("/HtmlTree/Main/JsLink/Content",function(e,n,t){const i=e("File").API(),r=n.require("Header"),o=n.require("MarkDoc");let l={file:""};return t.on("init",function(){r.on({file:function(e){t.fire("file",[e])}}),i.on("success",{read:function(e){o.render(e)}})}),t.on("render",function(e){let{file:n}=e.data;n!=l.file&&(l.file=n,r.render(n),i.read(n))}),{}}),f.panel("/HtmlTree/Main/JsLink/FileInfo",function(e,n,t){const i=e("File"),r=e("@definejs/date"),o=i.API();let l={file:"",dir:""};t.on("init",function(){t.$on("click",{'[data-cmd="file"]':function(e){t.fire("file",[l.file])},'[data-cmd="dir"]':function(e){t.fire("file",[l.dir])}}),o.on("success",{read:function(e){let n=l.file,o=n.split("/").slice(-1)[0],c=e.content.split("\n"),{stat:a}=e,s=i.getSizeDesc(a.size),d=e.ext.slice(1)+" 文件",u=r.format(a.birthtime,"yyyy-MM-dd HH:mm:ss"),f=r.format(a.mtime,"yyyy-MM-dd HH:mm:ss");t.fill({name:o,file:n,ext:e.ext,md5:e.md5,dir:l.dir,type:d,lines:c.length,size:s.value,sizeDesc:s.desc,birthtime:u,mtime:f,isUTF8:e.isUTF8?"是":"否",utf8Class:e.isUTF8})}})}),t.on("render",function(e){let{file:n}=e.data;n!=l.file&&(l.file=n,l.dir=n.split("/").slice(0,-1).join("/"),o.read(n))})}),f("/HtmlTree/Main/JsLink/Rel/Data",function(e,n,t){return{get(e){let{parent:n}=e,{data:t}=n;if(t.link){let t=n.data.link,i=e.data.no;return{file:t.file,content:t.content,beginNo:i,endNo:i}}if(t.block){let e=n.parent.data;return{file:e.file,content:e.content,beginNo:t.begin,endNo:t.end}}if("MasterPage"==t.type){let t=n.data,i=e.data.no;return{file:t.file,content:t.content,beginNo:i,endNo:i}}throw new g("无法识别的 node 节点。")}}}),f.panel("/HtmlTree/Main/JsLink/Rel/Header",function(e,n,t){const i=e("File");let r={file:""};return t.on("init",function(){t.$on("click",{'[data-cmd="file"]':function(e){t.fire("file",[r.file])}})}),t.on("render",function(e){let n=i.getIcon(e);r.file=e,t.fill({icon:n.html,file:e})}),{}}),f.panel("/HtmlTree/Main/JsLink/Rel/MarkDoc",function(e,n,t){const i=e("MarkDoc"),r=e("$");let o=null;return t.on("init",function(){o=new i({container:t.$})}),t.on("render",function(e){o.render({content:e,language:"html",baseUrl:"",code:{format:!0}})}),{highlight(e,n){let t=o.$.find("ul.line-numbers>li").toArray();(t=t.slice(e,n+1)).forEach(e=>{r(e).addClass("on")}),s(()=>{t[0].scrollIntoViewIfNeeded()},200)}}}),f.panel("/HtmlTree/Main/JsLink/Rel",function(e,n,t){const i=n.require("Data"),r=n.require("Header"),o=n.require("MarkDoc");return t.on("init",function(){r.on({file:function(e){t.fire("file",[e])}})}),t.on("render",function(e){let{file:n,content:t,beginNo:l,endNo:c}=i.get(e);r.render(n),o.render(t),o.highlight(l,c)}),{}}),f.panel("/HtmlTree/Main/JsLink/Render",function(e,n,t){const i=e("MarkDoc");let r=null;return t.on("init",function(){r=new i({container:t.$})}),t.on("render",function(e){let n=e.data.link.render,t=e.data.tabs;if(t===M&&(t=e.parent.data.tabs),t>0){n=n.split("\n").map(e=>e.slice(t)).join("\n")}r.render({content:n,language:"html",baseUrl:"",code:{format:!0}})}),{}}),f.panel("/HtmlTree/Main/JsLink/Tabs",function(e,n,t){const i=e("@definejs/tabs"),r=e("@definejs/local-storage");let o=[{name:"基本信息",cmd:"base"},{name:"引用原文",cmd:"rel"},{name:"渲染内容",cmd:"render"},{name:"文件信息",cmd:"file"},{name:"文件内容",cmd:"content"},{name:"编译内容",cmd:"compile"}],l=null,c=null,a={index:0,list:[],cmd$module:null};return t.on("init",function(){c=new r(n.id),a.index=c.get("index")||0,(l=new i({container:t.$.get(0),activedClass:"on",eventName:"click",selector:">li",repeated:!0})).on("change",function(e,n){a.index=n,e=a.list[n],c.set("index",n);let{cmd:i}=e,{cmd$module:r}=a;r&&y.keys(r).forEach(e=>{let n=r[e];e==i?t.fire("change",[n]):n.hide()}),t.fire("cmd",i,[])})}),t.on("render",function(e){a.list=o,e||(a.list=a.list.filter(e=>"compile"!=e.cmd)),l.render(a.list,function(e,n){return{index:n,name:e.name}}),a.index>a.list.length-1&&(a.index=0),l.active(a.index)}),{active(e){let n=a.list.findIndex(n=>n.cmd==e);l.active(n)},map(e){a.cmd$module=e}}}),f.panel("/HtmlTree/Main/JsLink",function(e,n,t){const i=n.require("Tabs"),r=n.require("Content"),o=n.require("FileInfo"),l=n.require("BaseInfo"),c=n.require("Rel"),a=n.require("Compile"),s=n.require("Render");let d={item:null};return t.on("init",function(){i.map({base:l,file:o,content:r,rel:c,compile:a,render:s}),i.on({change:function(e){e.render(d.item)}}),[o,l,c,r,a].forEach(e=>{e.on({file:function(e){t.fire("file",[e])},id:function(e){t.fire("id",[e])}})}),l.on({rel:function(){i.active("rel")}})}),t.on("render",function(e){let n="LessLink"==e.data.link.type;d.item=e,i.render(n)}),{}}),f("/HtmlTree/Main/Nav/Data",function(e,n,t){return{make(e){let n=[e,...e.parents].reverse(),t=n.map(e=>e.name),i={type:e.list.length>0?"dir":"file",name:e.data.file||".html"};t.join(">");return{list:n,names:t,icon:i}}}}),f.panel("/HtmlTree/Main/Nav",function(e,n,t){const i=e("MenuNav"),r=n.require("Data");let o=null,l={list:[],item:null,stat:null};t.on("init",function(){(o=new i({container:t.$})).on({item:function(e,n){let i=l.list[n];t.fire("item",[i])}})}),t.on("render",function(e){let{list:n,names:t,path:i,icon:c}=r.make(e);l.list=n,o.render({names:t,path:i,icon:c})})}),f.panel("/HtmlTree/Main",function(e,n,t){const i=n.require("Nav"),r=n.require("JsLink"),o=n.require("HtmlLink"),l=n.require("HtmlBlock");n.require("MasterPage");return t.on("init",function(){i.on({item:function(e){t.fire("id",[e.id])}}),[r,o,l].forEach(e=>{e.on({file:function(e){t.fire("file",[e])},id:function(e){t.fire("id",[e])}})})}),t.on("render",function(e){i.render(e);let{link:n,block:t}=e.data;n?("HtmlLink"==n.type?(r.hide(),o.render(e)):(r.render(e),o.hide()),l.hide()):t?(r.hide(),o.hide(),l.render(e)):(r.hide(),o.hide(),l.hide())}),{resize(...e){let n="calc(100% - "+e.reduce(function(e,n){return e+n},0)+"px)";t.$.css({width:n})}}}),f("/HtmlTree/Tree/Data",function(e,n,t){const i=e("File");function r(e,n){let{link:t}=e,o=t.list,l=e.href,c=i.getIcon(e.file);return l||(l=e.file,n&&l.startsWith(n)&&(l=l.slice(n.length))),o&&(o=o.map(e=>r(e))),{name:l,id:t.id,open:!1,fileIcon:c.className,data:e,list:o}}function o(e){return e=e.map(e=>{return r(e)})}function l(e,n){return e=e.map(e=>{let{block:t}=e,i=t.list.map(e=>r(e,t.dir));return{name:t.id,id:t.id,open:!1,dirIcon:n,data:e,list:i}})}return{make:e=>e.masterBlock.list.map(({master:e})=>{let n=o(e.cssLinks),t=o(e.lessLinks),i=o(e.htmlLinks),r=o(e.jsLinks),c=l(e.lessBlocks,{open:"less-block far fa-list-alt",close:"less-block fas fa-list-alt"}),a=l(e.htmlBlocks,{open:"html-block far fa-list-alt",close:"html-block fas fa-list-alt"}),s=l(e.jsBlocks,{open:"js-block far fa-list-alt",close:"js-block fas fa-list-alt"});return{name:e.file,id:e.id,open:!0,data:e,list:[...n,...t,...c,...i,...a,...r,...s]}})}}),f.panel("/HtmlTree/Tree",function(e,n,t){const i=e("SidebarTree"),r=n.require("Data");let o=null;return t.on("init",function(){(o=new i({container:t.$,width:t.$.width(),dirIcon:{close:"fas fa-file-alt",open:"far fa-file-alt"}})).on({item:function(...e){t.fire("item",e)},dir:function(...e){t.fire("dir",e)},resize:function(){let e=o.$.outerWidth();t.$.width(e),t.fire("resize")},fill:{name:function(e){let{name:n,cid:t,list:i}=e,r=`${t} - ${n}`;return i.length>0&&(r=`${r} <b class="child-count">(${i.length})</b>`),r}}})}),t.on("render",function(e){let n=r.make(e);o.render(n)}),{open:function(e){o.open(e)}}}),f("/HtmlTree/API",function(e,n,t){const i=e("@definejs/emitter"),r=e("@definejs/loading"),o=e("API");let l=new i,a=new r({mask:0});return{on:l.on.bind(l),get:function(){let e=new o("HtmlTree.parse",{});e.on({request:function(){a.show("加载中...")},response:function(){a.hide()},success:function(e,n,t){c.log(e),l.fire("success","get",[e])},fail:function(e,n,t,i){},error:function(e,n,t,i){u.alert("获取解析错误: 网络繁忙，请稍候再试")}}),e.get({usePack:!1})}}}),f.view("/HtmlTree",function(e,n,t){const i=e("@definejs/session-storage"),r=n.require("API"),o=n.require("Tree"),l=n.require("Main");let a=new i(n.id),s={cid:0};t.on("init",function(){r.on("success",{get:function(e){o.render(e),o.open(s.cid)}}),o.on({item:function(e){c.log(e),s.cid=e.cid,a.set("cid",e.cid),l.render(e)},resize:function(){let e=o.$.outerWidth();l.resize(e,6)}}),l.on({file:function(e){t.fire("file",[e])},id:function(e){o.open(e)}})}),t.on("render",function(){s.cid=a.get("cid")||1,r.get()})}),f.panel("/Log/Filter/Dates",function(e,n,t){const i=e("DropCheckList");let r=null;return t.on("init",function(){(r=new i({container:t.$,text:"日期"})).on({check:function(e){t.fire("check",[e])}})}),t.on("render",function(e){e=e.map(e=>({text:e,checked:!0,value:e})),r.render(e)}),{}}),f.panel("/Log/Filter/Types",function(e,n,t){const i=e("DropCheckList");let r=null;return t.on("init",function(){(r=new i({container:t.$,text:"类型"})).on({check:function(e){t.fire("check",[e])}})}),t.on("render",function(e){e=e.map(e=>({text:e,checked:!0,value:e})),r.render(e)}),{}}),f.panel("/Log/Filter",function(e,n,t){const i=n.require("Types"),r=n.require("Dates");let o={type$checked:null,date$checked:null};return t.on("init",function(){function e(e){let n={};return e.forEach(e=>{n[e.value]=e.checked}),n}i.on({check:function(n){o.type$checked=e(n),t.fire("change",[o])}}),r.on({check:function(n){o.date$checked=e(n),t.fire("change",[o])}})}),t.on("render",function(e){i.render(e.names),r.render(e.dates),t.fire("change",[o])}),{}}),f.panel("/Log/Header",function(e,n,t){const i=e("CheckBox");let r=[{id:"time",cmd:"time",checked:!0,fireNow:!0,text:"时间"},{id:"color",cmd:"color",checked:!0,fireNow:!0,text:"彩色"},{id:"highlight",cmd:"highlight",checked:!1,fireNow:!0,text:"高亮当前行"},{id:"border",cmd:"border",checked:!1,fireNow:!0,text:"边线"}];return t.on("init",function(){t.$on("click",{"[data-cmd]":function(e){let{cmd:n}=e.currentTarget.dataset;t.fire("cmd",n,[])}}),r=r.map(e=>{let n=new i({checked:e.checked,fireNow:e.fireNow,text:e.text,container:t.$.find(`[data-id="chk-${e.id}"]`)});return n.on("checked",function(n){t.fire("check",[e.cmd,n])}),n})}),t.on("render",function(){r.forEach(e=>{e.render()})}),{close(e){}}}),f("/Log/List/Template/Colors",function(e,n,t){let i={reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29],black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],gray:[90,39],brightRed:[91,39],brightGreen:[92,39],brightYellow:[93,39],brightBlue:[94,39],brightMagenta:[95,39],brightCyan:[96,39],brightWhite:[97,39],bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgGray:[100,49],bgBrightRed:[101,49],bgBrightGreen:[102,49],bgBrightYellow:[103,49],bgBrightBlue:[104,49],bgBrightMagenta:[105,49],bgBrightCyan:[106,49],bgBrightWhite:[107,49]};return{render(e){let n=e;return y.keys(i).forEach(function(e){let t=i[e],r=`[${t[0]}m`,o=`[${t[1]}m`;n=(n=n.split(r).join(`<span class="colors ${e}">`)).split(o).join("</span>")}),n}}}),f("/Log/List/Template/File",function(e,n,t){const i=e("@definejs/string");let r={fs:null,files:[]};return{render(e,n){if(!n)return e;let{files:t}=function(e){if(e===r.fs)return r;let{list:n,root:t}=e;t.endsWith("/")&&(t=t.slice(0,-1));let i=n.map(e=>`${t}${e.name}`);return i=i.sort(function(e,n){return e.length>n.length?-1:1}),r.fs=e,r.files=i,r}(n);return t.forEach((n,t)=>{let r=`<a data-cmd="file" data-value="{${t}}">{${t}}</a>`;e=i.replaceAll(e,n,r)}),e=i.format(e,t)}}}),f("/Log/List/Template/HTML",function(e,n,t){return{render(e){if("string"!=typeof e)return"";return e=(e=(e=(e=(e=e.replace(/[<>]/g,function(e){return"&#"+e.charCodeAt(0)+";"})).split(" ").join('<b class="empty"></b>')).split("│").join('<b class="linkY">│</b>')).split("\r\n").join("<br />")).split("\n").join("<br />")}}}),f("/Log/List/Template",function(e,n,t){const i=n.require("Colors"),r=n.require("File"),o=n.require("HTML");let l={input:'<i class="fas fa-terminal"></i>',info:'<i class="fas fa-info-circle"></i>',stdout:""},c={panel:null,meta:null};return{init(e,n){c.panel=e,c.meta=n;let t=e.template();t.template("group","item").fix("datetime"),t.process({"":function(e){return{groups:this.fill("group",e.groups)}},group:{"":function(e,n){let{list:t}=e;return{no:n,date:e.date,total:t.length,items:"<li> loading... </li>"}},item:{"":function(e,t,c){let{date:a,time:s,name:d,msg:u}=e,{list:f,no:m,baseIndex:h}=c;"number"==typeof h&&(t+=h),u=o.render(u),u=i.render(u),u=r.render(u,n.fs);let p=d||"stdout",g=l[p]||"",w=f[t-1],$=`${a} ${s}`;return{no:m,index:t,time:s=w&&s==w.time?"":this.fill("time",e),datetime:s?"":`data-dt="${$}"`,sameTime:s?"":"same-time",type:p,icon:g,msg:u}},time:function(e){return{time:e.time}}}}})},fillGroup(e){let{panel:n,meta:t}=c,i=t.groups[e],{date:r,list:o}=i,l=n.$.find(`ul[data-group="${r}"]`),a={list:o,no:e},s=n.template().fill("group","item",o,a);l.html(s)},getGroup(e){let{panel:n,meta:t}=c,i=t.groups[e],{date:r,list:o}=i,l=n.$.find(`ul[data-group="${r}"]`);return{date:r,list:o,$ul:l,filled:l.find(">li[data-index]").length>0,no:e}}}}),f.panel("/Log/List",function(e,n,t){const i=n.require("Template");let r={list:[],groups:[],date$list:[],date$time$list:[]};function o(){let e=r.groups.length-1;if(e<0)return;let n=r.groups[e].list.length-1,i=t.$.find(`li[data-id="${e}-${n}"]`).get(0);i&&i.scrollIntoViewIfNeeded()}return t.on("init",function(){i.init(t,r),t.$on("click",{"[data-date]":function(e){let{no:n}=this.dataset,t=$(this.parentNode),{$ul:r,filled:o}=i.getGroup(n);t.toggleClass("hide"),o?r.slideToggle("fast"):(r.slideDown("fast"),s(()=>{i.fillGroup(n)},200))},'[data-cmd="datetime"]':function(e){let n=this.parentNode,{no:t,index:i}=n.dataset,o=r.groups[t],{date:l,time:c}=o.list[i],a=$(n.parentNode);$(n).toggleClass("fold-same-time"),a.find(`li[data-dt="${l} ${c}"]`).slideToggle("fast")}})}),t.on("render",function(e){c.log(n.id,e),r.list=e.list,r.groups=e.groups,r.date$list=e.date$list,r.date$time$list=e.date$time$list,t.fill(r),o()}),{add(e){let{list:n,groups:l}=e,c=1==l.length?l[0]:null,a=r.groups.slice(-1)[0]||null;if(!c||!a||c.date!=a.date)return!1;n=c.list;let s=r.groups.length-1,{$ul:d,filled:u}=i.getGroup(s);u||i.fillGroup(s);let f=t.template().fill("group","item",n,{list:n,no:s,baseIndex:a.list.length});return d.append(f),a.list=[...a.list,...n],o(),!0},clear(){r.groups=[],t.$.html("")},check(e,n){"time"==e?t.$.toggleClass(`hide-${e}`,!n):t.$.toggleClass(`show-${e}`,n)}}}),f("/Log/API",function(e,n,t){const i=e("@definejs/emitter"),r=e("@definejs/loading"),o=e("API");let l=new i,c=new r({mask:0});return{on:l.on.bind(l),get:function(){let e=new o("Log.get",{});e.on({request:function(){c.show("加载中...")},response:function(){c.hide()},success:function(e,n,t){l.fire("success","get",[e])},fail:function(e,n,t,i){u.alert("获取日志列表失败: {0}",n)},error:function(e,n,t,i){u.alert("获取日志列表错误: 网络繁忙，请稍候再试")}}),e.get()},clear(){let e=new o("Log.clear",{});e.on({request:function(){c.show("处理中...")},response:function(){c.hide()},success:function(e,n,t){l.fire("success","clear",[])},fail:function(e,n,t,i){u.alert(`清空日志失败: ${n}`)},error:function(e,n,t,i){u.alert("清空日志错误: 网络繁忙，请稍候再试")}}),e.get()}}}),f("/Log/Data",function(e,n,t){const i=e("@definejs/array"),r=e("@definejs/date");return{parse(e,n={}){let{date$checked:t=null,type$checked:o=null}=n,l=new Set,c=new Set,a={},s={};e.forEach(e=>{if(!e)return;let n=r.format(e.time,"yyyy-MM-dd HH:mm:ss").split(" "),d=n[0],u=n[1],{name:f}=e;if(t&&!t[d])return;if(o&&!o[f])return;l.add(f),c.add(d);let m={date:d,time:u,timestamp:e.time,name:f,msg:e.msg};i.add(a,d,m),i.add(s,d,u,m)});let d=[...c].map(e=>({date:e,list:a[e]||[]}));return{names:[...l],dates:[...c],list:e,groups:d,date$list:a,date$time$list:s}}}}),f("/Log/SSE",function(e,n,t){let i=new(e("@definejs/emitter")),r=u.config("API"),o=null;return t={on:i.on.bind(i),open:function(){let e=`${r.url}sse/Log.watch`;t.close(),(o=new EventSource(e)).addEventListener("open",function(e){}),o.addEventListener("reset",function(e){let n=JSON.parse(e.data);i.fire("reset",[n])}),o.addEventListener("add",function(e){let n=JSON.parse(e.data);i.fire("add",[n])}),o.addEventListener("error",function(e){let{data:n}=e;if(n===M)return u.alert("服务器可能已经关闭了。"),void t.close();(n=JSON.parse(n)).msg=JSON.stringify(JSON.parse(n.msg),null,4),i.fire("error",[n])}),o.onmessage=function(e){c.log("onmessage",e)}},close(){if(o)return o.close(),o=null,!0}}}),f.view("/Log",function(e,n,t){const i=n.require("API"),r=n.require("SSE"),o=n.require("Data"),l=n.require("Filter"),c=n.require("Header"),a=n.require("List");let s={list:[]};t.on("init",function(){c.on({check:function(e,n){a.check(e,n)},cmd:{reload:function(){i.get()},clear:function(){u.confirm("确认要清空服务器端的日志列表？",function(){i.clear()})},close:function(){panel.fire("close")}}}),l.on({change:function(e){let n=o.parse(s.list,e);a.render(n)}}),a.on({cmd:function(e,n){panel.fire("cmd",[e,n])}}),i.on("success",{get:function(e){let n=o.parse(e);s.list=e,c.render(),l.render(n),r.open()},clear:function(){a.clear()}}),r.on({reset:function(e){a.render(e)},add:function(e){let n=o.parse(e);a.add(n)||(s.list=[...s.list,...e],n=o.parse(s.list),l.render(n),a.render(n))}})}),t.on("render",function(){i.get()})}),f("/DocAdd/Data/API",function(e,n,t){const i=e("@definejs/emitter"),r=e("@definejs/loading"),o=e("@definejs/toast"),l=e("API");let c=new i,a=new r({mask:0}),d=new o({text:"保存成功",duration:1500,mask:0});return{on:c.on.bind(c),read(e,n){let t=new l("FileList.read");t.on({request:function(){a.show("读取中...")},response:function(){a.hide()},success:function(e,n,t){c.fire("success","read",[e])},fail:function(e,n,t){u.alert("读取失败: {0}",n)},error:function(){u.alert("读取错误: 网络繁忙，请稍候再试")}}),t.get({id:e})},save(e){let n=new l("FileList.write");n.on({request:function(){a.show("保存中...")},response:function(){a.hide()},success:function(n,t,i){d.show(),s(function(){c.fire("success","save",[n,e])},1500)},fail:function(e,n,t){u.alert(`保存失败: ${n}`)},error:function(){u.alert("保存错误: 网络繁忙，请稍候再试")}}),n.post(e)}}}),f("/DocAdd/Data/Data",function(e,n,t){const i=e("@definejs/local-storage"),r=e("@definejs/object");let o=new i(n.id),l={item:null};return{get(){let e=l.item;return e||(e=l.item=o.get()||{name:"",content:"",ext:""}),e},set(e,n){let t=r.isPlain(e)?{...e}:{[e]:n};t=r.filter(t,["name","content","ext"]);let i=l.item||{},c=t.content;return c&&(t.content=c.split("\r\n").join("\n")),l.item=y.assign(i,t),o.set(i),i}}}),f("/DocAdd/Data/Status",function(e,n,t){let i=new(e("@definejs/local-storage"))(n.id),r={status:i.get("status")||"init"};return{panel:null,set(e){e=r.status=e||r.status,i.set("status",e),this.panel.fire("status",e,[])},get:()=>r.status,confirm(e){"changed"==r.status?u.confirm("当前编辑器中存在未保存的内容，是否继续加载新内容？",e):e()}}}),f.panel("/DocAdd/Data",function(e,n,t){const i=n.require("API"),r=n.require("Data"),o=n.require("Status");return t.on("init",function(){o.panel=t,i.on("success",{read:function(e){r.set(e),o.set("read"),t.fire("render",[e])},save:function(e,n){r.set(e),o.set("saved"),t.fire("save",[e,n])}})}),t.on("render",function({name:e,content:n,ext:l}){if(e)o.confirm(function(){i.read(e)});else{if(n===M){let e=r.get();return o.set(),void t.fire("render",[e])}o.confirm(function(){let e=r.get(),i=r.set({name:"",content:n,ext:l}),c=""===n?"init":n!=e.content?"changed":"";o.set(c),t.fire("render",[i])})}}),{set(e){let n=r.get(),t=""===e?"init":e!=n.content?"changed":"";o.set(t),r.set("content",e)},save(e){let n=r.get(),t=n.name?"edit":"new";"edit"==t&&(e=n.name),e?i.save({id:e,mode:t,content:n.content}):u.alert("文件 id 不能为空。")},status:()=>o.get()}}),f("/DocAdd/Editor/CMD",function(e,n,t){let i=null;function r(e,n,t){"object"==typeof n&&(t=n,n=""),n=n||e,t=t||{empty:!1};let r=i.getSelections(),o=r.map(function(i){return i?i.startsWith(e)&&i.endsWith(n)?i.slice(e.length,0-n.length):e+i+n:t.empty?e+n:i});i.replaceSelections(o,r),r.length<2&&i.focus()}return{init:function(e){i=e},hr:function(){let e="----------\n";i.getCursor().ch>0&&(e="\n"+e),i.replaceSelection(e)},redo:function(){i.redo()},undo:function(){i.undo()},bold:function(){r("**")},italic:function(){r("*")},code:function(){r("`")},link:function(){r("[","](http://)",{empty:!0})},image:function(){r("![","](http://)",{empty:!0})},quote:function(){let e=i.getSelections(),n=e.map(function(e){return e?"\n\n> "+e+"\n\n":"\n\n> \n\n"});i.replaceSelections(n,e),n.length<2&&i.focus()},ol:function(){let e=i.getSelections(),n=e.map(function(e){if(!e)return"\n 1. ";let n=e.split("\n");return(n=n.map(function(e,n){let t=e.match(/^ \d\. /g)||e.match(/^\d\. /g);return t?e.slice(t[0].length):" "+(n+1)+". "+e})).join("\n")});i.replaceSelections(n,e)},ul:function(){let e=i.getSelections(),n=e.map(function(e){if(!e)return"\n - ";let n=e.split("\n");return(n=n.map(function(e,n){return e.startsWith(" - ")?e.slice(3):e.startsWith("- ")?e.slice(2):" - "+e})).join("\n")});i.replaceSelections(n,e)}}}),f("/DocAdd/Editor/File",function(e,n,t){const i=e("@definejs/date"),r=e("@definejs/string"),o=e("@definejs/loading"),l=e("File");let c=new o({mask:0});return{upload:function(e,n){let t=new p,o="upload/paste/"+i.format(t,"yyyy-MM-dd")+"/",a=i.format(t,"HHmmss")+"-"+r.random(4)+".png";c.show("上传中..."),l.upload({file:e,dir:o,name:a,done:function(e){if(c.hide(),!e)return void u.alert("上传失败");let t=r.format("![]({dest})",e);n&&n(t,e)}})},paste:function(){}}}),f("/DocAdd/Editor/Table",function(e,n,t){function i(e,n){let t=[],i=null;for(let r=0;r<e;r++)null!==(i=n(r,r==e-1))&&t.push(i);return t}return{create:function(e){let n=e.row,t=e.cell,r=[i(t,function(e,n){let t="|  列"+(e+1)+"  ";return n&&(t+="|"),t}),i(t,function(e,n){let t="|-------";return n&&(t+="|"),t}),...i(n,function(e){let n=e+1;return i(t,function(e,t){return t?"|   "+n+"   |":"|       "})})];return r="\n\n"+(r=(r=r.join("\n")).replace(/,/g,""))+"\n\n"}}}),f.panel("/DocAdd/Editor",function(e,n,t){const i=n.require("File"),r=n.require("CMD"),o=n.require("Table");let l=!1,a=null,d=null,u=t.$.find("textarea").get(0),f={".js":"javascript",".json":"javascript",".css":"css",".less":"css",".htm":"htmlmixed",".html":"htmlmixed"},m={ext:""};return t.on("init",function(){a=CodeMirror.fromTextArea(u,{mode:"gfm",cursorHeight:1,lineNumbers:!0,lineWrapping:!0,styleActiveLine:!0,smartIndent:!1,indentUnit:4,tabSize:4}),d=a.getDoc(),a.on("scroll",function(){if(l)return void(l=!1);let e=a.getScrollInfo();t.fire("scroll",[e])}),a.on("change",function(){let e=a.getDoc().getValue();e=e.split("\t").join("    "),t.fire("change",[{content:e,ext:m.ext}])}),t.$.on("keydown",function(e){(e.ctrlKey||e.metaKey)&&"s"==e.key&&(e.preventDefault(),t.fire("save"))}),r.init(a)}),t.$.on("paste",function(e){let n=e.originalEvent.clipboardData.files[0];n&&"image/png"==n.type&&i.upload(n,function(e,n){a.replaceSelection(e)})}),t.on("render",function(e={}){let n=e.content||"",t=e.ext||".md",i=f[t.toLowerCase()]||"gfm";m.ext=t,a.setOption("mode",i),d.setValue(n),s(function(){a.refresh()},100)}),{scroll:function(e){let n=a.getScrollInfo(),t=(n.height-n.clientHeight)*e.top/(e.height-n.clientHeight);l=!0,a.scrollTo(0,t)},getReadme:function(){return u.value},getContent:function(){return d.getValue()},setTheme:function(e){a.setOption("theme",e)},call:function(e){r[e]()},addTable:function(e){let n=o.create(e);c.log(n),a.replaceSelection(n),a.focus()},set:function(e,n){a.setOption(e,n)}}}),f("/DocAdd/Header/Switch",function(e,n,t){const i=e("@definejs/object"),r=e("@definejs/local-storage"),o=e("$");let l=new r(n.id),c={panel:null,act$on:null};return{init(e){c.panel=e,c.act$on=l.get()||{crlf:!0,fullscreen:!1,column:!0},i.each(c.act$on,function(n,t){let i=e.$.find(`[data-cmd="switch:${n}"]`);c.act$on[n]=!t,i.click()})},toggle(e){let{panel:n,act$on:t}=c,{cmd:i}=e.dataset,r=i.split(":")[1],a=t[r]=!t[r];l.set(t),o(e).toggleClass("on",a),n.fire("switch",r,[a])}}}),f.panel("/DocAdd/Header/Table",function(e,n,t){const i=e("@definejs/string"),r=e("@definejs/masker");let o=null;t.on("init",function(){function e(e){let n=[],t={};for(let i=0;i<e;i++)n.push(t);return n}t.template({"":function(e){return this.fill("all",e)},all:{"":function(n){let t=e(n.rows);return{rows:this.fill("row",t,n.cells)}},row:{"":function(n,t,i){let r=e(i);return{cells:this.fill("cell",r,t)}},cell:function(e,n,t){return{no:t,index:n}}}}}),t.$.on("mouseover","td",function(){let e=+this.getAttribute("data-no"),n=+this.getAttribute("data-index"),r=e+1,o=n+1,l=r+o<2?"插入表格":i.format("{row}行 x {cell}列 表格",{row:r,cell:o});t.$.find("div").html(l),t.$.find("td").each(function(){let t=+this.getAttribute("data-no"),i=+this.getAttribute("data-index"),r=t<=e&&i<=n;$(this).toggleClass("on",r)})}),t.$.on("click","td",function(){let e=+this.getAttribute("data-no"),n=+this.getAttribute("data-index");t.fire("add",[{row:e+1,cell:n+1}]),o.hide()}),(o=new r({volatile:!0,opacity:0})).on({hide:function(){t.hide()}})}),t.on("show",function(){o.show()}),t.on("render",function(e){t.fill({rows:9,cells:10})})}),f.panel("/DocAdd/Header/Validater",function(e,n,t){let i=new(e("@definejs/toast"))({icon:"times",duration:1200,mask:0,width:250}),r=150,o=[".md",".txt",".json",".js",".css",".html",".sql"];return{check:function(e){let n=e.val();function t(n){i.show(n),e.addClass("on"),s(function(){e.removeClass("on"),s(function(){e.addClass("on"),s(function(){e.removeClass("on")},r)},r)},r)}if(!n)return void t("文件名不能为空");let l=n.replace(/\\/g,"/");if(l.includes("../"))return t("不能引用到父目录中去");if(l.includes("./"))return t("不能使用相对路径");if(l.startsWith("."))return t("文件路径非法");if(!l.includes("."))return t("文件名必须包含后缀名");if(l.includes("..")||l.includes(":")||l.includes("*")||l.includes("?")||l.includes('"')||l.includes("<")||l.includes(">")||l.includes("|")||l.includes("//")||l.includes(" ")||l.includes("./"))return t("文件路径非法");let c=l.split(".").slice(-1)[0];return c="."+c.toLowerCase(),o.includes(c)?l:t("不能使用后缀名: "+c)}}}),f.panel("/DocAdd/Header",function(e,n,t){const i=e("@definejs/date"),r=n.require("Switch"),o=n.require("Table"),l=n.require("Validater");let c=t.$.find('[data-id="name"]');return t.on("init",function(){t.$.on("click","[data-cmd]",function(e){let{cmd:n}=this.dataset,i=n.split(":"),o=i.length>1?i[0]:"",l=i.length>1?i[1]:n;o?"editor"!=o?"switch"!=o||r.toggle(this):t.fire("editor",[l]):t.fire("cmd",n,[])}),t.$on("click",{'[data-id="table"]':function(){o.render()},'[data-id="demo"]':function(){let e=c.val();t.fire("cmd","demo",[e])},'[data-id="outline"]':function(){t.fire("cmd","outline",[])}}),o.on({add:function(e){t.fire("cmd","table",[e])}})}),t.on("render",function(e={}){let{name:n,ext:i}=e,o=!!n;c.val(n),c.attr({disabled:o,title:o?"这是一个已存在的文件，不允许编辑其路径。":""}),t.$.toggleClass("edit-mode",o),t.$.toggleClass("json",".json"==i),r.init(t)}),{saved:function(e){if(null===e)return t.$.find('[data-id="saved"] span').html("已保存"),void t.$.addClass("saved");if(e){let e=i.format(new p,"HH:mm:ss");t.$.addClass("saved"),t.$.find('[data-id="saved"] span').html("已保存 ["+e+"]")}else t.$.removeClass("saved")},get:function(){return l.check(c)}}}),f.panel("/DocAdd/Outline",function(e,n,t){const i=e("@definejs/masker"),r=e("Outline");let o=null,l=null;t.set("show",!1),t.on("init",function(){(o=new i({volatile:!0,opacity:0})).on({hide:function(){t.hide()}}),(l=new r({container:t.$.find(">div")})).on({item:function(e,n){t.fire("item",[e,n])}}),l.render(),t.$.on("click",'[data-cmd="close"]',function(e){t.hide()})}),t.on("show",function(){}),t.on("render",function(e){l.fill(e)})}),f.panel("/DocAdd/Preview",function(e,n,t){const i=e("MarkDoc");let r=t.$.find(">div"),o=!1,l=null,c=[".json",".js",".css",".less",".html",".htm"];return t.on("init",function(){(l=new i({container:r.get(0)})).on("hash",function(e){t.fire("hash",[e])}),l.on("render",function(e){let n=l.getOutlines();t.fire("render",[n])}),t.$.on("scroll",function(e){if(o)return void(o=!1);let n=r.outerHeight(),i=t.$.get(0).scrollTop;t.fire("scroll",[{height:n,top:i}])})}),t.on("render",function(e){let{content:n,ext:t}=e,i="";c.includes(t)&&(i=t.slice(1)),l.render({content:n,language:i,baseUrl:""})}),{scroll(e){let n=(r.outerHeight()-e.clientHeight)*e.top/(e.height-e.clientHeight);o=!0,t.$.get(0).scrollTo(0,n)},to(e){l.toOutline(e)}}}),f.panel("/DocAdd/Themes/List",function(e,n,t){const i=e("@definejs/tabs");let r=null,o=[{name:"default"},{name:"custom",desc:"深色"},{name:"3024-day"},{name:"3024-night",desc:"深色"},{name:"ambiance-mobile"},{name:"ambiance",desc:"深色"},{name:"base16-dark",desc:"深色"},{name:"base16-light"},{name:"blackboard",desc:"深色"},{name:"cobalt",desc:"深色"},{name:"eclipse"},{name:"elegant"},{name:"erlang-dark",desc:"深色"},{name:"lesser-dark",desc:"深色"},{name:"mbo",desc:"深色"},{name:"mdn-like"},{name:"midnight",desc:"深色"},{name:"monokai",desc:"深色"},{name:"neat"},{name:"neo"},{name:"night",desc:"深色"},{name:"paraiso-dark",desc:"深色"},{name:"paraiso-light"},{name:"pastel-on-dark",desc:"深色"},{name:"rubyblue",desc:"深色"},{name:"solarized"},{name:"the-matrix",desc:"深色"},{name:"tomorrow-night-eighties",desc:"深色"},{name:"twilight",desc:"深色"},{name:"vibrant-ink",desc:"深色"},{name:"xq-dark",desc:"深色"},{name:"xq-light"}];return t.set("show",!1),t.on("init",function(){(r=new i({container:t.$,selector:">li",activedClass:"on"})).on("change",function(e,n){e=o[n],t.fire("item",[e,n])}),t.$.on("click","[data-index]",function(e){let n=+this.dataset.index;r.active(n)}),t.template({"":function(e){return{items:this.fill("item",e.list)}},item:{"":function(e,n){let t=this.fill("desc",e);return{index:n,name:e.name,desc:t}},desc:function(e){return e.desc?{desc:e.desc}:""}}})}),t.on("render",function(e){t.fill({list:o}),"number"==typeof e&&r.active(e)}),{active:function(e){r.active(e)},slide:function(e,n){e?t.$.slideDown("fast",function(){let e=r.getActivedIndex();t.$.find(`li[data-index="${e}"]`).get(0).scrollIntoViewIfNeeded(),n&&n()}):t.$.slideUp("fast",n)}}}),f.panel("/DocAdd/Themes/Mask",function(e,n,t){const i=e("@definejs/masker");let r=null,o=!1;return t.on("init",function(){(r=new i({volatile:!0,opacity:0})).on({hide:function(){o=!1,t.fire("hide")},show:function(){o=!0,t.fire("show")}})}),t.on("render",function(){}),{toggle:function(){o?r.hide():r.show()}}}),f.panel("/DocAdd/Themes",function(e,n,t){const i=e("@definejs/local-storage"),r=n.require("List"),o=n.require("Mask");let l=null;return t.set("show",!1),t.on("init",function(){l=new i(n.id),o.on({show:function(){t.$.addClass("show"),r.slide(!0)},hide:function(){r.slide(!1),t.$.removeClass("show")}}),r.on({item:function(e,n){l.set("index",n),t.fire("item",[e.name])}})}),t.on("render",function(e){"number"==typeof e?l.set("index",e):e=l.get("index")||1,r.render(e),o.render()}),{toggle:function(){o.toggle()}}}),f.view("/DocAdd",function(e,n,t){const i=n.require("Editor"),r=n.require("Preview"),o=n.require("Themes"),l=n.require("Header"),c=n.require("Outline"),a=n.require("Data");t.on("init",function(){a.on({render:function(e){i.render(e),l.render(e),o.render()},save:function(e,n){"new"!=n.mode||t.render({name:e.name})},status:{init:function(){l.saved(!1)},changed:function(){l.saved(!1)},read:function(){l.saved(null)},saved:function(){l.saved(!0)}}}),i.on({save:function(){let e=l.get();a.save(e)},scroll:function(e){r.scroll(e)},change:function(e){a.set(e.content),r.render(e)}}),l.on({cmd:{save:function(){let e=l.get();a.save(e)},themes:function(){o.toggle()},new:function(){a.render({content:""})},format:function(){let e=r.$.find("code").text();i.render({content:e})},outline:function(){c.toggle()},demo:function(e){t.fire("demo",[e])},table:function(e){i.addTable(e)}},editor:function(e){i.call(e)},switch:{crlf:function(e){i.set("lineWrapping",e)},fullscreen:function(e){t.fire("fullscreen",[e])},column:function(e){t.$.toggleClass("full-editor",!e)}}}),r.on({render:function(e){c.render(e)},scroll:function(e){i.scroll(e)}}),o.on({item:function(e){i.setTheme(e)}}),c.on({item:function(e,n){r.to(n)}})}),t.on("render",function(e={}){a.render(e)}),t.on("close",function(){if("changed"==a.status())return u.confirm("当前编辑器中存在未保存的内容，是否继续关闭？",function(){t.fire("close")}),!1})}),f("/ModuleTree/API/Data",function(e,n,t){const i=e("@definejs/object"),r=n.data.none;function o(e){let n={};return i.each(e,function(e,t){e=function(e){return""===e?`/${r}`:e.startsWith("/")&&e.length>1?`/${r}${e}`:"/"!=e?`/${e}`:e}(e),t=t.map(function(e){return""===e&&(e=r),e}),n[e]=t}),n}function l(e,n){return!!e[n]}return{make(e){let{moduleStat:n}=e,{id$childs:t,id$parent:r,id$module:c}=n,a={"/":[]},s={"/":[]};return i.each(r,function(e,n){if(n||""===n)return;l(t,e)?a["/"].push(e):s["/"].push(e)}),i.each(t,function(e,n){let i=[],r=[];n.forEach(function(e){let n=l(t,e)?i:r,{name:o}=c[e];n.push(o)}),a[e]=i,s[e]=r}),a=o(a),s=o(s),{dir$dirs:a,dir$files:s,root:"模块树"}}}}),f.panel("/ModuleTree/Main/Content/Header",function(e,n,t){const i=e("File");let r={file:""};return t.on("init",function(){t.$on("click",{'[data-cmd="file"]':function(e){t.fire("file",[r.file])}})}),t.on("render",function(e){let n=i.getIcon(e);r.file=e,t.fill({icon:n.html,file:e})}),{}}),f.panel("/ModuleTree/Main/Content/MarkDoc",function(e,n,t){const i=e("MarkDoc");let r=null;return t.on("init",function(){r=new i({container:t.$})}),t.on("render",function(e){if(!e)return void r.render({content:"暂无内容",language:""});let{content:n,ext:t}=e,i=t.slice(1);r.render({content:n,language:i,baseUrl:"",code:{format:!1}})}),{}}),f.panel("/ModuleTree/Main/Content/Tabs",function(e,n,t){const i=e("@definejs/tabs"),r=e("@definejs/local-storage");let o=null,l=null,c=[{name:"JS",cmd:"js"},{name:"HTML",cmd:"html"}],a={index:0,list:[]};return t.on("init",function(){l=new r(n.id),a.index=l.get("index")||0,(o=new i({container:t.$,activedClass:"on",eventName:"click",selector:">li"})).on("change",function(e,n){a.index=n,e=a.list[n],l.set("index",n),t.fire(e.cmd)})}),t.on("render",function({js:e,html:n}){a.list=[],e&&a.list.push(c[0]),n&&a.list.push(c[1]),1==a.list.length&&(a.index=0),o.render(a.list,function(e,n){return{index:n,name:e.name}}),o.active(a.index),t.$.toggleClass("only-one",1==a.list.length)}),{}}),f.panel("/ModuleTree/Main/Content",function(e,n,t){const i=n.require("Header"),r=n.require("Tabs"),o=n.require("MarkDoc");let l={jsInfo:null,htmlInfo:null};return t.on("init",function(){function e(e){i.render(e.file),o.render(e)}i.on({file:function(e){t.fire("file",[e])}}),r.on({js:function(){e(l.jsInfo)},html:function(){e(l.htmlInfo)}}),o.on({render:function(e){t.fire("render",[e])}})}),t.on("render",function({item:e,stat:n}){l.item=e,l.stat=n;let{id:t}=e.data,i=n.moduleStat.id$info[t],o=n.htmlStat.id$info[t];l.jsInfo=i,l.htmlInfo=o,r.render({js:i,html:o})}),{}}),f.panel("/ModuleTree/Main/Dependent/Header",function(e,n,t){t.on("init",function(){}),t.on("render",function(e){})}),f("/ModuleTree/Main/Dependent/List/Data",function(e,n,t){return{get({item:e,stat:n}){let{id:t}=e.data,{ids:i,id$file:r,id$dependents:o,id$module:l}=n.moduleStat,c=[];if("string"==typeof t)c=e.data.publics;else{let e=y.keys(o);c=[...i,...e],c=[...new Set(c)]}let a=[],s=[];return(c=(c=c.sort()).map(e=>{if(!function(e){return!(!e||!e.startsWith("@")&&e.includes("/"))}(e))return null;let n=l[e],t=o[e]||[];return"string"==typeof t&&(t=[t]),t=t.map(e=>{let n=l[e];return{id:e,file:r[e],method:n.method,level:n.level}}),{id:e,module:n,$main:null,$gridview:null,found:m.isArray(n)?"more":e.startsWith("@")?"namespace":n?"1":"0",list:t}})).forEach(e=>{e&&(e.id.startsWith("@")?s.push(e):a.push(e))}),c=[...a,...s]}}}),f("/ModuleTree/Main/Dependent/List/GridView",function(e,n,t){e("$");const i=e("GridView");let r=[{caption:"模块ID",name:"id",width:300,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"定义方法",name:"method",width:110,class:"file",dragable:!0,delegate:"[data-cmd]"},{caption:"级别",name:"level",width:49,class:"number level",dragable:!0},{caption:"所在文件",name:"file",width:400,class:"file",dragable:!0,delegate:"[data-cmd]"}];return{render({container:e,list:n=[],cmdClick:t}){let o=new i({container:e,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:r});return o.on("process","cell",{id:function(e){return`<a data-cmd="id" href="javascript:">${e.row.data.id}</a>`},file:function(e){return`<a data-cmd="file" href="javascript:">${e.row.data.file}</a>`}}),o.on("click","cell",function(e,n){let i=n.target.dataset.cmd;i&&(n.stopPropagation(),t(i,e))}),o.render(),o.fill(n),o}}}),f.panel("/ModuleTree/Main/Dependent/List",function(e,n,t){const i=e("$"),r=n.require("Data"),o=n.require("GridView");let l={list:[]};t.on("init",function(){t.template({"":function({list:e}){return e.length?this.fill("item",e):this.fill("none",{})},item:{"":function(e,n){let t=e.list.length,i=e.found,r=this.fill("tip",{found:i,total:t});return{no:n,id:e.id,total:t,found:i,tip:r}},tip:function({found:e,total:n}){let t="0"==e?"该模块不存在":0==n?"该模块没有被任何模块依赖":"";return t?{tip:t}:""}}}),t.$on("click",{"li[data-no] h3":function(e){let n=this.parentNode.parentNode,{no:r}=n.dataset,c=i(n),a=l.list[r];c.toggleClass("on"),a.$gridview?a.$main.slideToggle("fast"):(a.$main=c.find('[data-id="main"]'),a.$gridview=c.find('[data-id="gridview"]'),o.render({container:a.$gridview,list:a.list,cmdClick:function(e,n){t.fire("cmd",[e,n.row.data])}}),s(()=>{a.$main.slideDown("fast")},100))},'[data-cmd="id"]':function(e){let n=this.innerText,{cmd:i}=this.dataset;t.fire("cmd",[i,{id:n}])}})}),t.on("render",function(e){c.log(n.id,e);let i=l.list=r.get(e);t.fill({list:i})})}),f.panel("/ModuleTree/Main/Dependent",function(e,n,t){const i=n.require("Header"),r=n.require("List");t.set("show",!1),t.on("init",function(){r.on({cmd:function(e,n){let i=n[e];t.fire(e,[i])}})}),t.on("render",function(e){i.render(e),r.render(e),t.show()})}),f.panel("/ModuleTree/Main/FileInfo",function(e,n,t){const i=e("File"),r=e("@definejs/date");t.on("init",function(){t.$on("click",{'[data-cmd="file"]':function(e){let n=this.innerText;t.fire("file",[n])},'[data-cmd="dir"]':function(e){let n=this.innerText;n.endsWith("/")&&(n=n.slice(0,-1)),t.fire("file",[n])}}),t.template(function(e,n){let t=i.getIcon(e.file),o=i.getSizeDesc(e.size),l=e.ext.slice(1)+" 文件",c=r.format(e.stat.birthtime,"yyyy-MM-dd HH:mm:ss"),a=r.format(e.stat.mtime,"yyyy-MM-dd HH:mm:ss");return{icon:t.html,name:e.name,file:e.file,ext:e.ext,md5:e.md5,dir:e.dir,lines:e.lines,type:l,size:o.value,sizeDesc:o.desc,birthtime:c,mtime:a,isUTF8:e.isUTF8?"是":"否"}})}),t.on("render",function({item:e,stat:n}){c.log(e,n);let{id:i}=e.data,r=n.moduleStat.id$info[i],o=n.htmlStat.id$info[i],l=o?[r,o]:[r];t.fill(l)})}),f.panel("/ModuleTree/Main/List/Filter/ChildDependents",function(e,n,t){const i=e("DropCheckList");let r=null,o=[{text:"N > 0",checked:!0,value:"N>0"},{text:"N = 0",checked:!0,value:"N=0"},{text:"N < 0",checked:!0,value:"N<0"}];return t.on("init",function(){(r=new i({container:t.$,text:"所依赖私有模块数 - 直接子模块数"})).on({check:function(e){t.fire("check",[e])},fill:function(e){t.fire("check",[e])}})}),t.on("render",function(){r.render(o)}),{}}),f.panel("/ModuleTree/Main/List/Filter/Childs",function(e,n,t){const i=e("DropCheckList");let r=null;return t.on("init",function(){(r=new i({container:t.$,text:"直接子模块"})).on({check:function(e){t.fire("check",[e])},fill:function(e){t.fire("check",[e])}})}),t.on("render",function(e){let n=e.map(e=>({text:e.name,checked:!0,value:e.id}));r.render(n)}),{}}),f.panel("/ModuleTree/Main/List/Filter/Dependents",function(e,n,t){const i=e("DropCheckList");let r=null,o=[{text:"N = 0",checked:!0,value:"N=0"},{text:"N > 0",checked:!0,value:"N>0"}];return t.on("init",function(){(r=new i({container:t.$,text:"被依赖模块数"})).on({check:function(e){t.fire("check",[e])},fill:function(e){t.fire("check",[e])}})}),t.on("render",function(){r.render(o)}),{}}),f.panel("/ModuleTree/Main/List/Filter/Fields",function(e,n,t){const i=e("DropCheckList");let r=null;return t.on("init",function(){(r=new i({container:t.$,text:"显示列"})).on({check:function(e){t.fire("check",[e])},fill:function(e){t.fire("check",[e])}})}),t.on("render",function(e){let n=e.map((e,n)=>({checked:!0,text:e.caption,value:n+1}));r.render(n)}),{}}),f.panel("/ModuleTree/Main/List/Filter/Levels",function(e,n,t){const i=e("DropCheckList");let r=null;return t.on("init",function(){(r=new i({container:t.$,text:"级别"})).on({check:function(e){t.fire("check",[e])},fill:function(e){t.fire("check",[e])}})}),t.on("render",function(e){e=e.map(e=>({text:`${e} 级`,checked:!0,value:e})),r.render(e)}),{}}),f.panel("/ModuleTree/Main/List/Filter/Methods",function(e,n,t){const i=e("DropCheckList");let r=null;return t.on("init",function(){(r=new i({container:t.$,text:"定义方法"})).on({check:function(e){t.fire("check",[e])},fill:function(e){t.fire("check",[e])}})}),t.on("render",function(e){e=e.map(e=>({text:e,checked:!0,value:e})),r.render(e)}),{}}),f.panel("/ModuleTree/Main/List/Filter",function(e,n,t){const i=n.require("Fields"),r=n.require("Childs"),o=n.require("ChildDependents"),l=n.require("Dependents"),c=n.require("Levels"),a=n.require("Methods");let d={field$checked:null,child$checked:null,childDependent$checked:null,dependent$checked:null,level$checked:null,method$checked:null};return t.on("init",function(){let e=null;function n(){e&&clearTimeout(e),e=s(function(){t.fire("change",[d])},200)}function u(e){let n={};return e.forEach(e=>{n[e.value]=e.checked}),n}i.on({check:function(e){d.field$checked=u(e),n()}}),r.on({check:function(e){d.child$checked=u(e),n()}}),o.on({check:function(e){d.childDependent$checked=u(e),n()}}),l.on({check:function(e){d.dependent$checked=u(e),n()}}),c.on({check:function(e){d.level$checked=u(e),n()}}),a.on({check:function(e){d.method$checked=u(e),n()}})}),t.on("render",function(e,n){i.render(n),r.render(e.childs),o.render(),l.render(),c.render(e.levels),a.render(e.methods)}),{}}),f.panel("/ModuleTree/Main/List/GridView",function(e,n,t){const i=e("GridView");let r=null,o=null,l=[{caption:"模块ID",name:"id",width:300,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"定义方法",name:"method",width:110,class:"file",dragable:!0,delegate:"[data-cmd]"},{caption:"级别",name:"level",width:49,class:"number level",dragable:!0},{caption:"被依赖模块数",name:"dependents",width:61,class:"number dependents",dragable:!0},{caption:"所依赖公共模块数",name:"publics",width:73,class:"number publics",dragable:!0},{caption:"所依赖私有模块数",name:"privates",width:73,class:"number privates",dragable:!0},{caption:"直接子模块数",name:"childs",width:61,class:"number childs",dragable:!0},{caption:"全部子模块数",name:"children",width:61,class:"number children",dragable:!0},{caption:"同级模块数",name:"siblings",width:61,class:"number siblings",dragable:!0},{caption:"所在的 js 文件",name:"file",width:400,class:"file",dragable:!0,delegate:"[data-cmd]"}];function c(e){if(!e)return"";let n=m.isArray(e)?e:[e];return{html:n.map(e=>{return r.fill("href",{cmd:"file",text:e})}).join("<br />"),count:n.length}}return t.on("init",function(){r=t.template(),(o=new i({container:t.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:l})).on("process","row",function(e){let n=e.data,t=[];0==n.dependents&&t.push("error dependents"),n.childs!=n.privates&&t.push("error childs privates"),t=(t=t.join(" ")).split(" "),t=[...new Set(t)],e.class=t.join(" ")}),o.on("process","cell",{id:function(e){let n=e.row.data;return r.fill("href",{cmd:"id",text:n.id})},file:function(e){let n=e.row.data,{html:t,count:i}=c(n.file);return i>1&&(e.class+=" error"),t},htmlFile:function(e){let n=e.row.data,{html:t,count:i}=c(n.htmlFile);return i>1&&(e.class+=" error"),t}}),o.on("click","cell",function(e,n){let i=n.target.dataset.cmd;if(!i)return;n.stopPropagation();let r=n.target.text;t.fire("cmd",[i,r])}),o.render()}),t.on("render",function(e){o.fill(e)}),{fields:l,toggleFields(e){o.toggleFields(e)}}}),f.panel("/ModuleTree/Main/List/Header",function(e,n,t){t.on("init",function(){}),t.on("render",function(){})}),f("/ModuleTree/Main/List/Data0",function(e,n,t){let i={item:null,stat:null};return{init({item:e,stat:n}){c.log(e),i.item=e,i.stat=n;let{list:t,children:r}=e,o=new Set,l=new Set;return r.forEach(e=>{let{level:n,method:t}=e.data.module;o.add(t),l.add(n)}),{methods:[...o],levels:[...l],childs:t}},filter(e){let{child$checked:n=null,childDependent$checked:t=null,dependent$checked:r=null,level$checked:o=null,method$checked:l=null}=e||{},{item:c,stat:a}=i,{id:s,children:d}=c.data,{ids:u,id$file:f,id$dependents:m,id$children:h,id$childs:p,id$publics:g,id$privates:w,id$parents:$,id$siblings:k,id$module:b}=a.moduleStat;"string"==typeof s&&(u=[s,...d]);let y=[];return u.forEach(e=>{let i=f[e],c=a.htmlStat.id$file[e],s=m[e]||[],d=p[e]||[],u=h[e]||[],v=k[e]||[],x=g[e]||[],M=w[e]||[],T=$[e]||[],q=b[e],{level:C,method:j}=q;if("string"==typeof s&&(s=[s]),n){if(![e,...T].some(e=>n[e]))return}if(r){let e=s.length;if(!r["N=0"]&&0==e)return;if(!r["N>0"]&&e>0)return}if(t){let e=M.length-d.length;if(!t["N>0"]&&e>0)return;if(!t["N=0"]&&0==e)return;if(!t["N<0"]&&e<0)return}if(o&&!o[C])return;if(l&&!l[j])return;let I={id:e,file:i,method:j,level:C,childs:d.length,children:u.length,dependents:s.length,publics:x.length,privates:M.length,siblings:v.length,htmlFile:c};y.push(I)}),y}}}),f("/ModuleTree/Main/List/Data",function(e,n,t){let i={item:null,stat:null};return{init({item:e,stat:n}){i.item=e,i.stat=n;let{list:t,children:r}=e,o=new Set,l=new Set;return r.forEach(e=>{let{level:n,method:t}=e.data.module;o.add(t),l.add(n)}),{methods:[...o],levels:[...l],childs:t}},filter(e={}){let{child$checked:n=null,childDependent$checked:t=null,dependent$checked:r=null,level$checked:o=null,method$checked:l=null}=e,{item:c,stat:a}=i,s=c.children;return c.parent&&(s=[c,...s]),s=(s=s.map(e=>{let{id:i,file:c,module:s,children:d=[],childs:u=[],dependents:f=[],parents:m=[],privates:h=[],publics:p=[],siblings:g=[]}=e.data,w=a.htmlStat.id$file[i];if("string"==typeof f&&(f=[f]),n){if(![i,...m].some(e=>n[e]))return}if(r){let e=f.length;if(!r["N=0"]&&0==e)return;if(!r["N>0"]&&e>0)return}if(t){let e=h.length-u.length;if(!t["N>0"]&&e>0)return;if(!t["N=0"]&&0==e)return;if(!t["N<0"]&&e<0)return}if((!o||o[s.level])&&(!l||l[s.method]))return{id:i,method:s.method,level:s.level,htmlFile:w,dependents:f.length,file:c,childs:u.length,children:d.length,publics:p.length,privates:h.length,siblings:g.length}})).filter(e=>!!e)}}}),f.panel("/ModuleTree/Main/List",function(e,n,t){const i=n.require("Header"),r=n.require("Data"),o=n.require("Filter"),l=n.require("GridView");t.set("show",!1),t.on("init",function(){o.on({change:function(e){let n=r.filter(e);l.render(n),c.log(e),l.toggleFields(e.field$checked)}}),l.on({cmd:function(e,n){t.fire(e,[n])}})}),t.on("render",function(e){let n=r.init(e),c=l.fields;i.render(),o.render(n,c),t.show()})}),f.panel("/ModuleTree/Main/ModuleInfo/Children/GridView",function(e,n,t){const i=e("GridView");let r=null,o=null;t.on("init",function(){o=t.template(),(r=new i({container:t.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"模块ID",name:"id",width:400,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"所在文件",name:"file",width:400,class:"file",dragable:!0,delegate:"[data-cmd]"}]})).on("process","row",function(e){}),r.on("process","cell",{id:function(e){let n=e.row.data;return o.fill("href",{cmd:"id",text:n.id})},file:function(e){let n=e.row.data;return o.fill("href",{cmd:"file",text:n.file})}}),r.on("click","cell",function(e,n){let i=n.target.dataset.cmd;i&&(n.stopPropagation(),t.fire("cmd",[i,e.row.data]))}),r.render()}),t.on("render",function(e){r.fill(e)})}),f.panel("/ModuleTree/Main/ModuleInfo/Childs/GridView",function(e,n,t){const i=e("GridView");let r=null,o=null;t.on("init",function(){o=t.template(),(r=new i({container:t.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"模块ID",name:"id",width:400,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"所在文件",name:"file",width:400,class:"file",dragable:!0,delegate:"[data-cmd]"}]})).on("process","row",function(e){}),r.on("process","cell",{id:function(e){let n=e.row.data;return o.fill("href",{cmd:"id",text:n.id})},file:function(e){let n=e.row.data;return o.fill("href",{cmd:"file",text:n.file})}}),r.on("click","cell",function(e,n){let i=n.target.dataset.cmd;i&&(n.stopPropagation(),t.fire("cmd",[i,e.row.data]))}),r.render()}),t.on("render",function(e){r.fill(e)})}),f.panel("/ModuleTree/Main/ModuleInfo/Dependents/GridView",function(e,n,t){const i=e("GridView");let r=null,o=null;t.on("init",function(){o=t.template(),(r=new i({container:t.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"模块ID",name:"id",width:400,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"所在文件",name:"file",width:400,class:"file",dragable:!0,delegate:"[data-cmd]"}]})).on("process","row",function(e){}),r.on("process","cell",{id:function(e){let n=e.row.data;return o.fill("href",{cmd:"id",text:n.id})},file:function(e){let n=e.row.data;return o.fill("href",{cmd:"file",text:n.file})}}),r.on("click","cell",function(e,n){let i=n.target.dataset.cmd;i&&(n.stopPropagation(),t.fire("cmd",[i,e.row.data]))}),r.render()}),t.on("render",function(e){r.fill(e)})}),f.panel("/ModuleTree/Main/ModuleInfo/Privates/GridView",function(e,n,t){const i=e("GridView");let r=null,o=null;t.on("init",function(){o=t.template(),(r=new i({container:t.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"模块ID",name:"id",width:400,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"所在文件",name:"file",width:400,class:"file",dragable:!0,delegate:"[data-cmd]"}]})).on("process","row",function(e){e.data.file||(e.class="not-found")}),r.on("process","cell",{id:function(e){let n=e.row.data;return o.fill("href",{cmd:"id",text:n.id})},file:function(e){let n=e.row.data;return n.file?o.fill("href",{cmd:"file",text:n.file}):"不存在"}}),r.on("click","cell",function(e,n){let i=n.target.dataset.cmd;i&&(n.stopPropagation(),t.fire("cmd",[i,e.row.data]))}),r.render()}),t.on("render",function(e){r.fill(e)})}),f.panel("/ModuleTree/Main/ModuleInfo/Publics/GridView",function(e,n,t){const i=e("GridView");let r=null,o=null;t.on("init",function(){o=t.template(),(r=new i({container:t.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"模块ID",name:"id",width:400,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"所在文件",name:"file",width:400,class:"file",dragable:!0,delegate:"[data-cmd]"}]})).on("process","row",function(e){}),r.on("process","cell",{id:function(e){let n=e.row.data.id;return o.fill("href",{cmd:"id",text:n})},file:function(e){let n=e.row.data;return o.fill("href",{cmd:"file",text:n.file||""})}}),r.on("click","cell",function(e,n){let i=n.target.dataset.cmd;i&&(n.stopPropagation(),t.fire("cmd",[i,e.row.data]))}),r.render()}),t.on("render",function(e){r.fill(e)})}),f.panel("/ModuleTree/Main/ModuleInfo/Siblings/GridView",function(e,n,t){const i=e("GridView");let r=null,o=null;t.on("init",function(){o=t.template(),(r=new i({container:t.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"模块ID",name:"id",width:400,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"所在文件",name:"file",width:400,class:"file",dragable:!0,delegate:"[data-cmd]"}]})).on("process","row",function(e){}),r.on("process","cell",{id:function(e){let n=e.row.data;return o.fill("href",{cmd:"id",text:n.id})},file:function(e){let n=e.row.data;return o.fill("href",{cmd:"file",text:n.file})}}),r.on("click","cell",function(e,n){let i=n.target.dataset.cmd;i&&(n.stopPropagation(),t.fire("cmd",[i,e.row.data]))}),r.render()}),t.on("render",function(e){r.fill(e)})}),f.panel("/ModuleTree/Main/ModuleInfo/Base",function(e,n,t){let i=n.data.none,r={item:null};t.on("init",function(){t.$on("click",{'[data-cmd="item"]':function(e){let n=r.item.parent;t.fire("item",[n])}})}),t.on("render",function({item:e,stat:n}){let{module:o,parent:l,dependents:c=[]}=e.data;"string"==typeof c&&(c=[c]),""===l&&(l=i),r.item=e,t.fill({id:o.id,name:o.name,parent:l||"",method:o.method,"factory-type":o.factory.type,dependents:c.length,level:o.level})})}),f.panel("/ModuleTree/Main/ModuleInfo/Children",function(e,n,t){const i=n.require("GridView");t.set("show",!1),t.on("init",function(){i.on({cmd:function(e,n){let i=n[e];t.fire(e,[i])}})}),t.on("render",function({item:e,stat:n}){let{id$file:r}=n.moduleStat,{children:o=[]}=e.data,l=o.map(e=>{return{id:e,file:r[e]}});i.render(l),t.show()})}),f.panel("/ModuleTree/Main/ModuleInfo/Childs",function(e,n,t){const i=n.require("GridView");t.set("show",!1),t.on("init",function(){i.on({cmd:function(e,n){let i=n[e];t.fire(e,[i])}})}),t.on("render",function({item:e,stat:n}){let{id$file:r}=n.moduleStat,{childs:o=[]}=e.data,l=o.map(e=>{return{id:e,file:r[e]}});i.render(l),t.show()})}),f.panel("/ModuleTree/Main/ModuleInfo/Dependents",function(e,n,t){const i=n.require("GridView");t.set("show",!1),t.on("init",function(){i.on({cmd:function(e,n){let i=n[e];t.fire(e,[i])}})}),t.on("render",function({item:e,stat:n}){let{id$file:r}=n.moduleStat,{dependents:o=[]}=e.data;m.isArray(o)||(o=[o]);let l=o.map(e=>{return{id:e,file:r[e]}});i.render(l),t.show()})}),f.panel("/ModuleTree/Main/ModuleInfo/Privates",function(e,n,t){const i=n.require("GridView");t.set("show",!1),t.on("init",function(){i.on({cmd:function(e,n){let i=n[e];t.fire(e,[i])}})}),t.on("render",function({item:e,stat:n}){let{id$file:r}=n.moduleStat,{id:o,privates:l=[]}=e.data,c=l.map(e=>{let n=`${o}/${e}`;return{id:n,file:r[n]}});i.render(c),t.show()})}),f.panel("/ModuleTree/Main/ModuleInfo/Publics",function(e,n,t){const i=n.require("GridView");t.set("show",!1),t.on("init",function(){i.on({cmd:function(e,n){let i=n[e];t.fire(e,[i])}})}),t.on("render",function({item:e,stat:n}){let{id$file:r}=n.moduleStat,{publics:o=[]}=e.data,l=o.map(e=>{return{id:e,file:r[e]}});i.render(l),t.show()})}),f.panel("/ModuleTree/Main/ModuleInfo/Siblings",function(e,n,t){const i=n.require("GridView");t.set("show",!1),t.on("init",function(){i.on({cmd:function(e,n){let i=n[e];t.fire(e,[i])}})}),t.on("render",function({item:e,stat:n}){let{id$file:r}=n.moduleStat,{siblings:o=[]}=e.data,l=o.map(e=>{return{id:e,file:r[e]}});i.render(l),t.show()})}),f.panel("/ModuleTree/Main/ModuleInfo",function(e,n,t){const i=n.require("Base"),r=n.require("Childs"),o=n.require("Children"),l=n.require("Siblings"),c=n.require("Publics"),a=n.require("Privates"),s=n.require("Dependents");t.on("init",function(){[i,r,o,l,c,a,s].forEach(e=>{e.on({item:function(e){t.fire("item",[e])},id:function(e){t.fire("id",[e])},file:function(e){t.fire("file",[e])}})})}),t.on("render",function(e){i.render(e),r.render(e),o.render(e),l.render(e),c.render(e),a.render(e),s.render(e)})}),f("/ModuleTree/Main/Nav/Data",function(e,n,t){return{make(e){let n=[e,...e.parents].reverse(),t=n.map(e=>e.name),i={type:e.list.length>0?"dir":"file",ext:".js"};return{list:n,names:t,path:e.data.id||"/",icon:i}}}}),f.panel("/ModuleTree/Main/Nav",function(e,n,t){const i=e("MenuNav"),r=n.require("Data");let o=null,l={list:[],item:null,stat:null};t.on("init",function(){(o=new i({container:t.$})).on({item:function(e,n){let i=l.list[n];t.fire("item",[i])},text:function(e){if("/"==e)return void t.fire("item",[{id:e}]);let n=l.stat.moduleStat.id$module[e];if(!n)return!1;t.fire("item",[n])}})}),t.on("render",function({item:e,stat:n}){let{list:t,names:i,path:c,icon:a}=r.make(e);l.item=e,l.stat=n,l.list=t,o.render({names:i,path:c,icon:a})})}),f.panel("/ModuleTree/Main/Pair/Filter/HtmlFile",function(e,n,t){const i=e("DropCheckList");let r=null,o=[{text:"N = 0",checked:!0,value:"N=0"},{text:"N = 1",checked:!0,value:"N=1"},{text:"N > 1",checked:!0,value:"N>1"}];return t.on("init",function(){(r=new i({container:t.$,text:"html 文件"})).on({check:function(e){t.fire("check",[e])},fill:function(e){t.fire("check",[e])}})}),t.on("render",function(){r.render(o)}),{}}),f.panel("/ModuleTree/Main/Pair/Filter/JsFile",function(e,n,t){const i=e("DropCheckList");let r=null,o=[{text:"N = 0",checked:!0,value:"N=0"},{text:"N = 1",checked:!0,value:"N=1"},{text:"N > 1",checked:!0,value:"N>1"}];return t.on("init",function(){(r=new i({container:t.$,text:"js 文件"})).on({check:function(e){t.fire("check",[e])},fill:function(e){t.fire("check",[e])}})}),t.on("render",function(){r.render(o)}),{}}),f.panel("/ModuleTree/Main/Pair/Filter",function(e,n,t){const i=n.require("JsFile"),r=n.require("HtmlFile");let o={js$checked:null,html$checked:null};return t.on("init",function(){let e=null;function n(){e&&clearTimeout(e),e=s(function(){t.fire("change",[o])},200)}function l(e){let n={};return e.forEach(e=>{n[e.value]=e.checked}),n}i.on({check:function(e){o.js$checked=l(e),n()}}),r.on({check:function(e){o.html$checked=l(e),n()}})}),t.on("render",function(e){i.render(),r.render()}),{}}),f.panel("/ModuleTree/Main/Pair/GridView",function(e,n,t){const i=e("GridView"),r=e("File");let o=null,l=null,c=[{caption:"模块ID",name:"id",width:300,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"所在的 js 文件",name:"file",width:400,class:"file",dragable:!0,delegate:"[data-cmd]"},{caption:"关联的 html 文件",name:"htmlFile",width:400,class:"file",dragable:!0,delegate:"[data-cmd]"}];function a(e){if(!e)return"";let n=m.isArray(e)?e:[e];return{html:n.map(e=>{let n=r.getIcon(e);return o.fill("href",{icon:n.html,cmd:"file",text:e})}).join("<br />"),count:n.length}}return t.on("init",function(){o=t.template(),(l=new i({container:t.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:c})).on("process","row",function(e){let n=e.data;n.htmlFile&&!n.file&&(e.class="error")}),l.on("process","cell",{id:function(e){let n=e.row.data;return o.fill("href",{icon:"",cmd:"id",text:n.id})},file:function(e){let n=e.row.data,{html:t,count:i}=a(n.file);return i>1&&(e.class+=" error"),t},htmlFile:function(e){let n=e.row.data,{html:t,count:i}=a(n.htmlFile);return i>1&&(e.class+=" error"),t}}),l.on("click","cell",function(e,n){let i=n.target.dataset.cmd;if(!i)return;n.stopPropagation();let r=n.target.text;t.fire("cmd",[i,r])}),l.render()}),t.on("render",function(e){l.fill(e)}),{}}),f.panel("/ModuleTree/Main/Pair/Header",function(e,n,t){t.on("init",function(){}),t.on("render",function(){})}),f("/ModuleTree/Main/Pair/Data",function(e,n,t){let i={item:null,stat:null};return{init({item:e,stat:n}){c.log(e),i.item=e,i.stat=n},filter(e={}){let{js$checked:n=null,html$checked:t=null}=e,{item:r,stat:o}=i,{moduleStat:l,htmlStat:c}=o,{id:a}=r.data,s=[...new Set([...l.ids,...c.ids])],d=[];if(r.parent){let e=""===a?"/":a;d=[a,...d=s.filter(n=>n.startsWith(e))]}else d=s;return d=(d=d.map(e=>{let i=l.id$file[e],r=c.id$file[e];if(n){let e="string"==typeof i?1:m.isArray(i)?i.length:0;if(!n["N=0"]&&0==e)return;if(!n["N=1"]&&1==e)return;if(!n["N>1"]&&e>1)return}if(t){let e="string"==typeof r?1:m.isArray(r)?r.length:0;if(!t["N=0"]&&0==e)return;if(!t["N=1"]&&1==e)return;if(!t["N>1"]&&e>1)return}return{id:e,htmlFile:r,file:i}})).filter(e=>!!e)}}}),f.panel("/ModuleTree/Main/Pair",function(e,n,t){const i=n.require("Header"),r=n.require("Data"),o=n.require("Filter"),l=n.require("GridView");t.set("show",!1),t.on("init",function(){o.on({change:function(e){let n=r.filter(e);l.render(n)}}),l.on({cmd:function(e,n){t.fire(e,[n])}})}),t.on("render",function(e){r.init(e),i.render(),o.render(),t.show()})}),f.panel("/ModuleTree/Main/Tree/Header",function(e,n,t){const i=e("CheckBox");let r=[{id:"secondary",text:"文件",chk:null},{id:"icon",text:"图标",chk:null},{id:"tab",text:"缩进",chk:null},{id:"color",text:"彩色",chk:null},{id:"hover",text:"悬停",chk:null}];t.on("init",function(){r.forEach(e=>{let n=new i({fireNow:!0,container:t.$.find(`[data-id="chk-${e.id}"]`),text:e.text});n.on("checked",function(n){t.fire("check",[{[e.id]:n}])}),e.chk=n}),t.$on("click","[data-cmd]",function(e){let{cmd:n}=e.target.dataset;t.fire("cmd",n,[])})}),t.on("render",function(e){r.forEach(n=>{let t=e[n.id];n.chk.render({checked:t})})})}),f.panel("/ModuleTree/Main/Tree/Main",function(e,n,t){const i=e("TextTree"),r=e("Clipboard");let o=null;return t.on("init",function(){(o=new i({container:t.$,secondaryKey:"file"})).on("cmd",function(e,n){t.fire("cmd",[e,n])})}),t.on("render",function(e){let{id:n,ids:i,id$file:r}=e,l=i.map(e=>{return{id:e,file:r[e]}});o.render(l),"string"==typeof n&&o.highlight(n),t.fire("render")}),{check(e){o.toggle(e)},copy(){let e=o.toString();r.copy(e)}}}),f.panel("/ModuleTree/Main/Tree",function(e,n,t){const i=n.require("Header"),r=n.require("Main");t.on("init",function(){i.on("check",function(e){r.check(e)}),i.on("cmd",{copy:function(){r.copy()}}),r.on({cmd:function(e,n){let i=n[e];t.fire(e,[i])},render:function(){i.render({secondary:!1,icon:!1,tab:!0,color:!0,hover:!1})}})}),t.on("render",function({item:e,stat:n}){let{id:t,parents:i,children:o}=e.data,{ids:l,id$file:c}=n.moduleStat;e.parent&&(l=[...i=i.slice(0).reverse(),t,...o]),r.render({id:t,ids:l,id$file:c})})}),f.panel("/ModuleTree/Main/Tabs",function(e,n,t){const i=e("@definejs/tabs"),r=e("@definejs/local-storage");let o=[{name:"依赖关系",cmd:"dependent",root:!0},{name:"模块列表",cmd:"list",root:!0},{name:"组织架构",cmd:"tree",root:!0},{name:"模块配对",cmd:"pair",root:!0},{name:"模块信息",cmd:"module"},{name:"文件信息",cmd:"file"},{name:"文件内容",cmd:"content"}],l=[],c=null,a=null,s={index:0,cmd$module:null};return t.on("init",function(){a=new r(n.id),s.index=a.get("index")||0,(c=new i({container:t.$.get(0),activedClass:"on",eventName:"click",selector:">li",repeated:!0})).on("change",function(e,n){s.index=n,e=l[n],a.set("index",n);let{cmd:i}=e,{cmd$module:r}=s;r&&y.keys(r).forEach(e=>{let n=r[e];e==i?t.fire("change",[n]):n.hide()}),t.fire("cmd",i,[])})}),t.on("render",function(e){l=o,e&&(l=l.filter(e=>e.root)),c.render(l,function(e,n){return{index:n,name:e.name}}),s.index>l.length-1&&(s.index=0),c.active(s.index)}),{map(e){s.cmd$module=e}}}),f.panel("/ModuleTree/Main",function(e,n,t){const i=n.require("Nav"),r=n.require("Tabs"),o=n.require("Content"),l=n.require("FileInfo"),c=n.require("ModuleInfo"),a=n.require("Tree"),s=n.require("List"),d=n.require("Dependent"),u=n.require("Pair");let f={item:null,stat:null};return t.on("init",function(){i.on({item:function(e){t.fire("item",[e])}}),r.map({module:c,file:l,content:o,tree:a,list:s,dependent:d,pair:u}),r.on({change:function(e){e.render(f)}}),[c,l,a,s,d,o,u].forEach(e=>{e.on({item:function(e){t.fire("item",[e])},id:function(e){t.fire("id",[e])},file:function(e){t.fire("file",[e])}})})}),t.on("render",function(e){let n=!(f.item=e.item).parent;f.stat=e.stat,i.render(e),r.render(n)}),{resize(...e){let n="calc(100% - "+e.reduce(function(e,n){return e+n},0)+"px)";t.$.css({width:n})}}}),f("/ModuleTree/Tree/Data",function(e,n,t){const i=n.data.none;function r(e){let n=[],t=[];return e.forEach(e=>{(e.list.length>0?n:t).push(e)}),n.sort((e,n)=>e.id>n.id?1:-1),t.sort((e,n)=>e.id.toUpperCase()>n.id.toUpperCase()?1:-1),[...n,...t]}return{make:function(e){let n=e.moduleStat,{level$ids:t}=n,o=t[1].map(e=>{return function e(n,t){let o=t.id$childs[n]||[],l=t.id$module[n],c=o.map(n=>e(n,t));return c=r(c),{id:n,name:l.name||i,open:!1,list:c,data:{id:n,children:t.id$children[n],childs:t.id$childs[n],dependents:t.id$dependents[n],file:t.id$file[n],info:t.id$info[n],module:t.id$module[n],parent:t.id$parent[n],parents:t.id$parents[n],privates:t.id$privates[n],publics:t.id$publics[n],siblings:t.id$siblings[n]}}}(e,n)});return[{id:"/",name:"模块树",open:!0,dirIcon:{close:"fas fa-folder",open:"fas fa-folder-open"},data:{},list:o=r(o)}]}}}),f.panel("/ModuleTree/Tree",function(e,n,t){const i=e("SidebarTree"),r=n.require("Data");n.data.none;let o=null;return t.on("init",function(){(o=new i({container:t.$,width:t.$.width(),dirIcon:{close:"fas fa-file-alt",open:"far fa-file-alt"},fileIcon:"fas fa-file"})).on({item:function(e){t.fire("item",[e])},dir:function(e){t.fire("dir",[e])},resize:function(){let e=o.$.outerWidth();t.$.width(e),t.fire("resize")}})}),t.on("render",function(e){let n=r.make(e);o.render(n)}),{open:function(e){o.open(e)}}}),f("/ModuleTree/API",function(e,n,t){const i=e("@definejs/emitter"),r=e("@definejs/loading"),o=e("API"),l=n.require("Data");let c=new i,a=new r({mask:0});return{on:c.on.bind(c),get:function(){let e=new o("Stat.get",{});e.on({request:function(){a.show("加载中...")},response:function(){a.hide()},success:function(e,n,t){let i=l.make(e);c.fire("success","get",[e,i])},fail:function(e,n,t,i){u.alert("获取模块列表失败: {0}",n)},error:function(e,n,t,i){u.alert("获取模块列表错误: 网络繁忙，请稍候再试")}}),e.get()}}}),f.view("/ModuleTree",function(e,n,t){const i=e("@definejs/session-storage"),r=n.require("API"),o=n.require("Tree"),l=n.require("Main");let c=new i(n.id),a={item:null,stat:null};t.on("init",function(){r.on("success",{get:function(e,n){a.stat=e,o.render(e),o.open(a.item.id)}}),o.on({item:function(e){a.item=e,c.set("id",e.id),l.render(a)},resize:function(){let e=o.$.outerWidth();l.resize(e,6)}}),l.on({item:function(e){o.open(e.id)},id:function(e){if(e.startsWith("@definejs/")){let n=`/f/definejs/src/${e}`;t.fire("file",[n])}else o.open(e)},file:function(e){t.fire("file",[e])}})}),t.on("render",function(e){e=e||c.get("id")||1,a.item={id:e},r.get()})}),f.panel("/Setting/Header/List",function(e,n,t){let i=[{name:"显示",value:"show",icon:"fas fa-window-maximize"},{name:"隐藏",value:"hide",icon:"far fa-window-maximize"}];return t.on("init",function(){t.template(function(e,n){return{index:n,name:e.name,icon:e.icon,value:e.value}}),t.$on("click",{'[type="radio"]':function(e){let{checked:n,value:r}=e.target;t.fire("check",[r,i])}})}),t.on("render",function(e){t.fill(i),t.$.find(`[type="radio"][value="${e}"]`).click()}),{}}),f.panel("/Setting/Header",function(e,n,t){const i=e("Settings.Header"),r=n.require("List");return t.on("init",function(){r.on({check:function(e,n){i.set(e)}})}),t.on("render",function(){let e=i.get();r.render(e)}),{}}),f.panel("/Setting/Local/List",function(e,n,t){let i=[{name:"简体中文",value:"chinese",icon:"fas fa-flag red"},{name:"English",value:"english",icon:"fas fa-flag-usa blue"}];return t.on("init",function(){t.template(function(e,n){return{index:n,name:e.name,icon:e.icon,value:e.value}}),t.$on("click",{'[type="radio"]':function(e){let{checked:n,value:r}=e.target;t.fire("check",[r,i])}})}),t.on("render",function(e){t.fill(i),t.$.find(`[type="radio"][value="${e}"]`).click()}),{}}),f.panel("/Setting/Local",function(e,n,t){const i=e("Settings.Language"),r=n.require("List");return t.on("init",function(){r.on({check:function(e,n){i.set(e)}})}),t.on("render",function(){let e=i.get();r.render(e)}),{}}),f.panel("/Setting/Theme/List",function(e,n,t){let i=[{name:"Blue",value:"blue"},{name:"Light",value:"light"}];return t.on("init",function(){t.template(function(e,n){return{index:n,name:e.name,value:e.value}}),t.$on("click",{'[type="radio"]':function(e){let{checked:n,value:r}=e.target;t.fire("check",[r,i])}})}),t.on("render",function(e){t.fill(i),t.$.find(`[type="radio"][value="${e}"]`).click()}),{}}),f.panel("/Setting/Theme",function(e,n,t){const i=e("Settings.Theme"),r=n.require("List");return t.on("init",function(){r.on({check:function(e,n){i.set(e)}})}),t.on("render",function(){let e=i.get();r.render(e)}),{}}),f.view("/Setting",function(e,n,t){const i=n.require("Header"),r=n.require("Theme"),o=n.require("Local");return t.on("init",function(){}),t.on("render",function(){i.render(),r.render(),o.render()}),{}}),f("/Terminal/Command/FileList",function(e,n,t){const i=e("@definejs/loading"),r=e("@definejs/emitter"),o=e("API");let l=new r,c=new i({mask:0});return{on:l.on.bind(l),get:function(){let e=new o("FileList.read",{});e.on({request:function(){c.show("加载中...")},response:function(){c.hide()},success:function(e,n,t){l.fire("success",[e])},fail:function(e,n,t,i){u.alert("获取文件列表失败: {0}",n)},error:function(e,n,t,i){u.alert("获取文件列表错误: 网络繁忙，请稍候再试")}}),e.get({id:"/"})}}}),f("/Terminal/Command/Source",function(e,n,t){const i=e("@definejs/query");let r=new(e("@definejs/emitter")),o=u.config("API"),l=null;return t={on:r.on.bind(r),open:function(e){let n=e.split(" ");e=n[0],n=n.slice(1);let a=i.add(`${o.url}sse/Terminal.exec`,{cmd:e,args:JSON.stringify(n)});t.close(),(l=new EventSource(a)).addEventListener("open",function(e){}),l.addEventListener("stdout",function(e){let n=JSON.parse(e.data);r.fire("stdout",[n])}),l.addEventListener("error",function(e){let{data:n}=e;n!==M?((n=JSON.parse(n)).msg=JSON.stringify(JSON.parse(n.msg),null,4),r.fire("error",[n])):t.close()}),l.addEventListener("stderr",function(e){let n=JSON.parse(e.data);r.fire("stderr",[n])}),l.onmessage=function(e){c.log("onmessage",e)}},close(){if(l)return l.close(),l=null,!0}}}),f("/Terminal/Footer/History",function(e,n,t){let i=new(e("@definejs/local-storage"))(n.id),r=i.get("list")||[],o={index:r.length};return{get(e){let n=o.index+e;if(!(n<0||n>=r.length))return o.index=n,r[n]},push(e){r.push(e),i.set("list",r),o.index=r.length}}}),f.panel("/Terminal/Footer/Input",function(e,n,t){let i=null;return t.on("init",function(){i=t.$.get(0),t.$.on("keyup",function(e){let n=e.keyCode,i=e.target.value;if(13==n&&i)return t.fire("enter",[i]),void(e.target.value="")}),t.$.on("keydown",function(e){let n=e.keyCode;if(38!=n&&40!=n);else{e.preventDefault();let i=n-39;t.fire("move",[i])}}),t.$.on("focusin",function(){t.fire("focus",[!0])}),t.$.on("focusout",function(){t.fire("focus",[!1])})}),t.on("render",function(e){i.value=e||"",s(()=>{i.focus()},200)}),{}}),f("/Terminal/Logs/List/Colors",function(e,n,t){let i={reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29],black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],gray:[90,39],brightRed:[91,39],brightGreen:[92,39],brightYellow:[93,39],brightBlue:[94,39],brightMagenta:[95,39],brightCyan:[96,39],brightWhite:[97,39],bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgGray:[100,49],bgBrightRed:[101,49],bgBrightGreen:[102,49],bgBrightYellow:[103,49],bgBrightBlue:[104,49],bgBrightMagenta:[105,49],bgBrightCyan:[106,49],bgBrightWhite:[107,49]};return{render(e){let n=e;return y.keys(i).forEach(function(e){let t=i[e],r=`[${t[0]}m`,o=`[${t[1]}m`;n=(n=n.split(r).join(`<span class="colors ${e}">`)).split(o).join("</span>")}),n}}}),f("/Terminal/Logs/List/File",function(e,n,t){const i=e("@definejs/string");let r={fs:null,files:[]};return{render(e,n){if(!n)return e;let{files:t}=function(e){if(e===r.fs)return r;let{list:n,root:t}=e;t.endsWith("/")&&(t=t.slice(0,-1));let i=n.map(e=>`${t}${e.name}`);return i=i.sort(function(e,n){return e.length>n.length?-1:1}),r.fs=e,r.files=i,r}(n);return t.forEach((n,t)=>{let r=`<a data-cmd="file" data-value="{${t}}">{${t}}</a>`;e=i.replaceAll(e,n,r)}),e=i.format(e,t)}}}),f("/Terminal/Logs/List/HTML",function(e,n,t){return{render(e){if("string"!=typeof e)return"";return e=(e=(e=(e=(e=e.replace(/[<>]/g,function(e){return"&#"+e.charCodeAt(0)+";"})).split(" ").join('<b class="empty"></b>')).split("│").join('<b class="linkY">│</b>')).split("\r\n").join("<br />")).split("\n").join("<br />")}}}),f.panel("/Terminal/Logs/Header",function(e,n,t){const i=e("CheckBox");let r=[{id:"time",cmd:"time",checked:!0,fireNow:!0,text:"时间"},{id:"color",cmd:"color",checked:!0,fireNow:!0,text:"彩色"},{id:"highlight",cmd:"highlight",checked:!1,fireNow:!0,text:"高亮当前行"},{id:"border",cmd:"border",checked:!1,fireNow:!0,text:"边线"}];return t.on("init",function(){t.$on("click",{"[data-cmd]":function(e){let{cmd:n}=e.currentTarget.dataset;t.fire("cmd",n,[])}}),r=r.map(e=>{let n=new i({checked:e.checked,fireNow:e.fireNow,text:e.text,container:t.$.find(`[data-id="chk-${e.id}"]`)});return n.on("checked",function(n){t.fire("check",e.cmd,[n])}),n})}),t.on("render",function(){r.forEach(e=>{e.render()})}),{close(e){}}}),f.panel("/Terminal/Logs/List",function(e,n,t){const i=e("@definejs/date"),r=n.require("Colors"),o=n.require("File"),l=n.require("HTML");let c=null,a=[],s={input:'<i class="fas fa-terminal"></i>',info:'<i class="fas fa-info-circle"></i>',stdout:""};return t.on("init",function(){c=t.template(),t.$on("click",{"[data-cmd]":function(e){let{cmd:n,value:i}=e.target.dataset;t.fire("cmd",[n,i])}})}),t.on("render",function(e,n){let{msg:d,time:u,type:f}=e;a.push(e),u=i.format(u,"HH:mm:ss"),d=l.render(d),d=r.render(d),d=o.render(d,n);let m=s[f=f||"stdout"]||"",h=a.length-1,p=a[h-1],g=!1;if(p){g=u==i.format(p.time,"HH:mm:ss")}let w=c.fill({time:u,"same-time":g?"same":"",index:h,msg:d,type:f,icon:m});t.$.append(w),t.$.find(`[data-index="${h}"]`).get(0).scrollIntoViewIfNeeded()}),{add(e,n){t.render({type:e,time:p.now(),msg:n})},clear(){a=[],t.$.html("")},showTime(e){t.$.toggleClass("hide-time",!e)},showColor(e){t.$.toggleClass("show-color",e)},showHighlight(e){t.$.toggleClass("show-highlight",e)},showBorder(e){t.$.toggleClass("show-border",e)}}}),f("/Terminal/Command",function(e,n,t){const i=e("@definejs/emitter"),r=n.require("Source"),o=n.require("FileList");let l=new i,c={cmd:"",fs:null,init:!1};return{on:l.on.bind(l),run(e){c.cmd=e,c.init||(c.init=!0,o.on("success",function(e){c.fs=e,r.open(c.cmd)}),r.on("stdout",function(e){e.type="stdout",l.fire("data",[e,c.fs])}),r.on("stderr",function(e){e.type="stderr",l.fire("data",[e,c.fs])}),r.on("error",function(e){e.type="error",l.fire("data",[e,c.fs])})),c.fs?r.open(e):o.get()},close:()=>r.close()}}),f.panel("/Terminal/Footer",function(e,n,t){const i=n.require("History"),r=n.require("Input");return t.on("init",function(){r.on({enter:function(e){i.push(e),t.fire("submit",[e])},focus:function(e){t.$.toggleClass("focus",e)},move:function(e){let n=i.get(e);r.render(n)}})}),t.on("render",function(){r.render("")}),{}}),f.panel("/Terminal/Logs",function(e,n,t){const i=n.require("Header"),r=n.require("List");return t.on("init",function(){i.on({cmd:{clear:function(){r.clear()},close:function(){t.fire("close")}},check:{time:function(e){r.showTime(e)},color:function(e){r.showColor(e)},highlight:function(e){r.showHighlight(e)},border:function(e){r.showBorder(e)}}}),r.on({cmd:function(e,n){t.fire("cmd",[e,n])}})}),t.on("render",function(e,n){i.render(),r.render(e,n)}),{add(e){"clear"!=e?(r.add("input",e),t.fire("add",[e])):r.clear()},close(e){e&&r.add("info","已断开连接")}}}),f.view("/Terminal",function(e,n,t){const i=n.require("Command"),r=n.require("Logs"),o=n.require("Footer");t.on("init",function(){i.on("data",function(e,n){r.render(e,n)}),r.on({cmd:function(e,n){t.fire("cmd",e,[n])},close:function(){let e=i.close();r.close(e)},add:function(e){i.run(e)}}),o.on({submit:function(e){r.add(e)}})}),t.on("render",function(){o.render()})}),f("/Tool/Main/JS/Editor/CMD",function(e,n,t){let i=null;function r(e,n,t){"object"==typeof n&&(t=n,n=""),n=n||e,t=t||{empty:!1};let r=i.getSelections(),o=r.map(function(i){return i?i.startsWith(e)&&i.endsWith(n)?i.slice(e.length,0-n.length):e+i+n:t.empty?e+n:i});i.replaceSelections(o,r),r.length<2&&i.focus()}return{init:function(e){i=e},hr:function(){let e="----------\n";i.getCursor().ch>0&&(e="\n"+e),i.replaceSelection(e)},redo:function(){i.redo()},undo:function(){i.undo()},bold:function(){r("**")},italic:function(){r("*")},code:function(){r("`")},link:function(){r("[","](http://)",{empty:!0})},image:function(){r("![","](http://)",{empty:!0})},quote:function(){let e=i.getSelections(),n=e.map(function(e){return e?"\n\n> "+e+"\n\n":"\n\n> \n\n"});i.replaceSelections(n,e),n.length<2&&i.focus()},ol:function(){let e=i.getSelections(),n=e.map(function(e){if(!e)return"\n 1. ";let n=e.split("\n");return(n=n.map(function(e,n){let t=e.match(/^ \d\. /g)||e.match(/^\d\. /g);return t?e.slice(t[0].length):" "+(n+1)+". "+e})).join("\n")});i.replaceSelections(n,e)},ul:function(){let e=i.getSelections(),n=e.map(function(e){if(!e)return"\n - ";let n=e.split("\n");return(n=n.map(function(e,n){return e.startsWith(" - ")?e.slice(3):e.startsWith("- ")?e.slice(2):" - "+e})).join("\n")});i.replaceSelections(n,e)}}}),f("/Tool/Main/JS/Editor/File",function(e,n,t){const i=e("@definejs/date"),r=e("@definejs/string"),o=e("@definejs/loading"),l=e("File");let c=new o({mask:0});return{upload:function(e,n){let t=new p,o="upload/paste/"+i.format(t,"yyyy-MM-dd")+"/",a=i.format(t,"HHmmss")+"-"+r.random(4)+".png";c.show("上传中..."),l.upload({file:e,dir:o,name:a,done:function(e){if(c.hide(),!e)return void u.alert("上传失败");let t=r.format("![]({dest})",e);n&&n(t,e)}})},paste:function(){}}}),f("/Tool/Main/JS/Editor/Table",function(e,n,t){function i(e,n){let t=[],i=null;for(let r=0;r<e;r++)null!==(i=n(r,r==e-1))&&t.push(i);return t}return{create:function(e){let n=e.row,t=e.cell,r=[i(t,function(e,n){let t="|  列"+(e+1)+"  ";return n&&(t+="|"),t}),i(t,function(e,n){let t="|-------";return n&&(t+="|"),t}),...i(n,function(e){let n=e+1;return i(t,function(e,t){return t?"|   "+n+"   |":"|       "})})];return r="\n\n"+(r=(r=r.join("\n")).replace(/,/g,""))+"\n\n"}}}),f.panel("/Tool/Main/JS/Editor",function(e,n,t){const i=n.require("File"),r=n.require("CMD");n.require("Table"),n.require("Headers");let o=!1,l=null,c=null,a=t.$.find("textarea").get(0),d={".js":"javascript",".json":"javascript",".css":"css",".less":"css",".htm":"htmlmixed",".html":"htmlmixed"},u={ext:""};return t.on("init",function(){l=CodeMirror.fromTextArea(a,{mode:"gfm",cursorHeight:1,lineNumbers:!0,lineWrapping:!0,styleActiveLine:!0,smartIndent:!1,indentUnit:4,tabSize:4}),c=l.getDoc(),l.on("scroll",function(){if(o)return void(o=!1);let e=l.getScrollInfo();t.fire("scroll",[e])}),l.on("change",function(){let e=l.getDoc().getValue();e=e.split("\t").join("    "),t.fire("change",[{content:e,ext:u.ext}])}),t.$.on("keydown",function(e){(e.ctrlKey||e.metaKey)&&"s"==e.key&&(e.preventDefault(),t.fire("save"))}),r.init(l)}),t.$.on("paste",function(e){let n=e.originalEvent.clipboardData.files[0];n&&"image/png"==n.type&&i.upload(n,function(e,n){l.replaceSelection(e)})}),t.on("render",function(e={}){let n=e.content||"",t=e.ext||".js",i=d[t.toLowerCase()]||"gfm";u.ext=t,l.setOption("mode",i),c.setValue(n),s(function(){l.refresh()},100)}),{scroll:function(e){let n=l.getScrollInfo(),t=(n.height-n.clientHeight)*e.top/(e.height-n.clientHeight);o=!0,l.scrollTo(0,t)},setTheme:function(e){l.setOption("theme",e)},call:function(e){r[e]()},set:function(e,n){l.setOption(e,n)},highlight(n){const i=e("$");let r=t.$.find('.CodeMirror-code[role="presentation"]>div');r.removeClass("on"),i(r[n-1]).addClass("on")}}}),f("/Tool/Main/JS/Header/Switch",function(e,n,t){const i=e("@definejs/object"),r=e("@definejs/local-storage"),o=e("$");let l=new r(n.id),c={panel:null,act$on:null};return{init(e){c.panel=e,c.act$on=l.get()||{crlf:!1,fullscreen:!1},i.each(c.act$on,function(n,t){let i=e.$.find(`[data-cmd="switch:${n}"]`);c.act$on[n]=!t,i.click()})},toggle(e){let{panel:n,act$on:t}=c,{cmd:i}=e.dataset,r=i.split(":")[1],a=t[r]=!t[r];l.set(t),o(e).toggleClass("on",a),n.fire("switch",r,[a])}}}),f.panel("/Tool/Main/JS/Header",function(e,n,t){e("CheckBox");const i=n.require("Switch");return t.on("init",function(){t.$.on("click","[data-cmd]",function(e){let{cmd:n}=this.dataset,r=n.split(":"),o=r.length>1?r[0]:"",l=r.length>1?r[1]:n;o?"editor"!=o?"switch"!=o||i.toggle(this):t.fire("editor",[l]):t.fire("cmd",n,[])})}),t.on("render",function(){i.init(t)}),{set(e){t.$.find('[data-id="md5"]').html(e),t.$.find('[data-cmd="copy"]').toggle(!!e)}}}),f.panel("/Tool/Main/JS/Preview",function(e,n,t){const i=e("MarkDoc");let r=t.$.find('[data-id="markdoc"]'),o=!1,l=null,c=[".json",".js",".css",".less",".html",".htm"];return t.on("init",function(){(l=new i({container:r.get(0)})).on("hash",function(e){t.fire("hash",[e])}),l.on("render",function(e){let n=l.getOutlines();t.fire("render",[n])}),t.$.on("scroll",function(e){if(o)return void(o=!1);let n=r.outerHeight(),i=t.$.get(0).scrollTop;t.fire("scroll",[{height:n,top:i}])}),t.$on("click",{'[data-cmd="compile"]':function(e){t.fire("compile")}})}),t.on("render",function(e){if(t.$.toggleClass("markdoc-mode",!!e),!e)return;let{content:n,ext:i,minify:r}=e,o="";c.includes(i)&&(o=i.slice(1)),l.render({content:n,language:o,sample:r?"code":"pre",code:{language:!1,numbers:!r}}),l.$.toggleClass("minify",r)}),{scroll(e){let n=(r.outerHeight()-e.clientHeight)*e.top/(e.height-e.clientHeight);o=!0,t.$.get(0).scrollTo(0,n)}}}),f.panel("/Tool/Main/JS/Themes/List",function(e,n,t){const i=e("@definejs/tabs");let r=null,o=[{name:"default"},{name:"custom",desc:"深色"},{name:"3024-day"},{name:"3024-night",desc:"深色"},{name:"ambiance-mobile"},{name:"ambiance",desc:"深色"},{name:"base16-dark",desc:"深色"},{name:"base16-light"},{name:"blackboard",desc:"深色"},{name:"cobalt",desc:"深色"},{name:"eclipse"},{name:"elegant"},{name:"erlang-dark",desc:"深色"},{name:"lesser-dark",desc:"深色"},{name:"mbo",desc:"深色"},{name:"mdn-like"},{name:"midnight",desc:"深色"},{name:"monokai",desc:"深色"},{name:"neat"},{name:"neo"},{name:"night",desc:"深色"},{name:"paraiso-dark",desc:"深色"},{name:"paraiso-light"},{name:"pastel-on-dark",desc:"深色"},{name:"rubyblue",desc:"深色"},{name:"solarized"},{name:"the-matrix",desc:"深色"},{name:"tomorrow-night-eighties",desc:"深色"},{name:"twilight",desc:"深色"},{name:"vibrant-ink",desc:"深色"},{name:"xq-dark",desc:"深色"},{name:"xq-light"}];return t.set("show",!1),t.on("init",function(){(r=new i({container:t.$,selector:">li",activedClass:"on"})).on("change",function(e,n){e=o[n],t.fire("item",[e,n])}),t.$.on("click","[data-index]",function(e){let n=+this.dataset.index;r.active(n)}),t.template({"":function(e){return{items:this.fill("item",e.list)}},item:{"":function(e,n){let t=this.fill("desc",e);return{index:n,name:e.name,desc:t}},desc:function(e){return e.desc?{desc:e.desc}:""}}})}),t.on("render",function(e){t.fill({list:o}),"number"==typeof e&&r.active(e)}),{active:function(e){r.active(e)},slide:function(e,n){e?t.$.slideDown("fast",function(){let e=r.getActivedIndex();t.$.find(`li[data-index="${e}"]`).get(0).scrollIntoViewIfNeeded(),n&&n()}):t.$.slideUp("fast",n)}}}),f.panel("/Tool/Main/JS/Themes/Mask",function(e,n,t){const i=e("@definejs/masker");let r=null,o=!1;return t.on("init",function(){(r=new i({volatile:!0,opacity:0})).on({hide:function(){o=!1,t.fire("hide")},show:function(){o=!0,t.fire("show")}})}),t.on("render",function(){}),{toggle:function(){o?r.hide():r.show()}}}),f.panel("/Tool/Main/JS/Themes",function(e,n,t){const i=e("@definejs/local-storage"),r=n.require("List"),o=n.require("Mask");let l=null;return t.set("show",!1),t.on("init",function(){l=new i(n.id),o.on({show:function(){t.$.addClass("show"),r.slide(!0)},hide:function(){r.slide(!1),t.$.removeClass("show")}}),r.on({item:function(e,n){l.set("index",n),t.fire("item",[e.name])}})}),t.on("render",function(e){"number"==typeof e?l.set("index",e):e=l.get("index")||1,r.render(e),o.render()}),{toggle:function(){o.toggle()}}}),f("/Tool/Main/JS/API",function(e,n,t){const i=e("@definejs/emitter"),r=e("@definejs/loading"),o=e("API");let l=new i,c=new r({mask:0});return{on:l.on.bind(l),minify:function(e){let n=new o("JS.minify",{});n.on({request:function(){c.show("压缩中...")},response:function(){c.hide()},success:function(e,n,t){l.fire("success",[e])},fail:function(e,n,t,i){let r=t.data;u.alert(`压缩 js 失败: ${n}，所在行号：${r.line}`,function(){l.fire("fail",[r])})},error:function(e,n,t,i){u.alert("压缩 js 错误: 网络繁忙，请稍候再试")}}),n.post({content:e})}}}),f("/Tool/Main/JS/Data",function(e,n,t){let i=new(e("@definejs/local-storage"))(n.id),r={content:i.get("content")||"//请输入 js 代码内容。\nfunction test() {\n    \n}\n"};return{get:()=>r.content,set:e=>(r.content=e,i.set("content",e),e)}}),f.panel("/Tool/Main/JS",function(e,n,t){const i=e("Clipboard"),r=n.require("Data"),o=n.require("API"),l=n.require("Editor"),c=n.require("Preview"),a=n.require("Themes"),s=n.require("Header");let d={content:"",js:""};t.on("init",function(){o.on({success:function({js:e,md5:n}){d.js=e,s.set(n),c.render({content:e,ext:".js",minify:!0})},fail:function(e){l.highlight(e.line)}}),s.on({cmd:{themes:function(){a.toggle()},copy:function(){i.copy(d.js)}},editor:function(e){l.call(e)},switch:{crlf:function(e){l.set("lineWrapping",e)},fullscreen:function(e){t.fire("fullscreen",[e])},column:function(e){t.$.toggleClass("full-editor",!e)}}}),a.on({item:function(e){l.setTheme(e)}}),l.on({scroll:function(e){c.scroll(e)},change:function({content:e}){d.content=e,r.set(e),s.set(""),c.render()}}),c.on({compile:function(){o.minify(d.content)},scroll:function(e){l.scroll(e)}})}),t.on("render",function(e){let n=e||r.get();l.render({content:n}),s.render(),a.render(),e&&o.minify(e)})}),f("/Tool/Main/Less/Editor/CMD",function(e,n,t){let i=null;function r(e,n,t){"object"==typeof n&&(t=n,n=""),n=n||e,t=t||{empty:!1};let r=i.getSelections(),o=r.map(function(i){return i?i.startsWith(e)&&i.endsWith(n)?i.slice(e.length,0-n.length):e+i+n:t.empty?e+n:i});i.replaceSelections(o,r),r.length<2&&i.focus()}return{init:function(e){i=e},hr:function(){let e="----------\n";i.getCursor().ch>0&&(e="\n"+e),i.replaceSelection(e)},redo:function(){i.redo()},undo:function(){i.undo()},bold:function(){r("**")},italic:function(){r("*")},code:function(){r("`")},link:function(){r("[","](http://)",{empty:!0})},image:function(){r("![","](http://)",{empty:!0})},quote:function(){let e=i.getSelections(),n=e.map(function(e){return e?"\n\n> "+e+"\n\n":"\n\n> \n\n"});i.replaceSelections(n,e),n.length<2&&i.focus()},ol:function(){let e=i.getSelections(),n=e.map(function(e){if(!e)return"\n 1. ";let n=e.split("\n");return(n=n.map(function(e,n){let t=e.match(/^ \d\. /g)||e.match(/^\d\. /g);return t?e.slice(t[0].length):" "+(n+1)+". "+e})).join("\n")});i.replaceSelections(n,e)},ul:function(){let e=i.getSelections(),n=e.map(function(e){if(!e)return"\n - ";let n=e.split("\n");return(n=n.map(function(e,n){return e.startsWith(" - ")?e.slice(3):e.startsWith("- ")?e.slice(2):" - "+e})).join("\n")});i.replaceSelections(n,e)}}}),f("/Tool/Main/Less/Editor/File",function(e,n,t){const i=e("@definejs/date"),r=e("@definejs/string"),o=e("@definejs/loading"),l=e("File");let c=new o({mask:0});return{upload:function(e,n){let t=new p,o="upload/paste/"+i.format(t,"yyyy-MM-dd")+"/",a=i.format(t,"HHmmss")+"-"+r.random(4)+".png";c.show("上传中..."),l.upload({file:e,dir:o,name:a,done:function(e){if(c.hide(),!e)return void u.alert("上传失败");let t=r.format("![]({dest})",e);n&&n(t,e)}})},paste:function(){}}}),f("/Tool/Main/Less/Editor/Table",function(e,n,t){function i(e,n){let t=[],i=null;for(let r=0;r<e;r++)null!==(i=n(r,r==e-1))&&t.push(i);return t}return{create:function(e){let n=e.row,t=e.cell,r=[i(t,function(e,n){let t="|  列"+(e+1)+"  ";return n&&(t+="|"),t}),i(t,function(e,n){let t="|-------";return n&&(t+="|"),t}),...i(n,function(e){let n=e+1;return i(t,function(e,t){return t?"|   "+n+"   |":"|       "})})];return r="\n\n"+(r=(r=r.join("\n")).replace(/,/g,""))+"\n\n"}}}),f.panel("/Tool/Main/Less/Editor",function(e,n,t){const i=n.require("File"),r=n.require("CMD");n.require("Table"),n.require("Headers");let o=!1,l=null,c=null,a=t.$.find("textarea").get(0),d={".js":"javascript",".json":"javascript",".css":"css",".less":"css",".htm":"htmlmixed",".html":"htmlmixed"},u={ext:""};return t.on("init",function(){l=CodeMirror.fromTextArea(a,{mode:"gfm",cursorHeight:1,lineNumbers:!0,lineWrapping:!0,styleActiveLine:!0,smartIndent:!1,indentUnit:4,tabSize:4}),c=l.getDoc(),l.on("scroll",function(){if(o)return void(o=!1);let e=l.getScrollInfo();t.fire("scroll",[e])}),l.on("change",function(){let e=l.getDoc().getValue();e=e.split("\t").join("    "),t.fire("change",[{content:e,ext:u.ext}])}),t.$.on("keydown",function(e){(e.ctrlKey||e.metaKey)&&"s"==e.key&&(e.preventDefault(),t.fire("save"))}),r.init(l)}),t.$.on("paste",function(e){let n=e.originalEvent.clipboardData.files[0];n&&"image/png"==n.type&&i.upload(n,function(e,n){l.replaceSelection(e)})}),t.on("render",function(e={}){let n=e.content||"",t=e.ext||".less",i=d[t.toLowerCase()]||"gfm";u.ext=t,l.setOption("mode",i),c.setValue(n),s(function(){l.refresh()},100)}),{scroll:function(e){let n=l.getScrollInfo(),t=(n.height-n.clientHeight)*e.top/(e.height-n.clientHeight);o=!0,l.scrollTo(0,t)},setTheme:function(e){l.setOption("theme",e)},call:function(e){r[e]()},set:function(e,n){l.setOption(e,n)},highlight(n){const i=e("$");let r=t.$.find('.CodeMirror-code[role="presentation"]>div');r.removeClass("on"),i(r[n-1]).addClass("on")}}}),f("/Tool/Main/Less/Header/Switch",function(e,n,t){const i=e("@definejs/object"),r=e("@definejs/local-storage"),o=e("$");let l=new r(n.id),c={panel:null,act$on:null};return{init(e){c.panel=e,c.act$on=l.get()||{crlf:!0,fullscreen:!1,column:!0},i.each(c.act$on,function(n,t){let i=e.$.find(`[data-cmd="switch:${n}"]`);c.act$on[n]=!t,i.click()})},toggle(e){let{panel:n,act$on:t}=c,{cmd:i}=e.dataset,r=i.split(":")[1],a=t[r]=!t[r];l.set(t),o(e).toggleClass("on",a),n.fire("switch",r,[a])}}}),f.panel("/Tool/Main/Less/Header",function(e,n,t){const i=e("CheckBox"),r=n.require("Switch");let o=[{id:"minify",text:"压缩",checked:!1,chk:null}];return t.on("init",function(){o.forEach(e=>{let n=new i({fireNow:!0,container:t.$.find(`[data-id="chk-${e.id}"]`),text:e.text});n.on("checked",function(n){t.fire("check",[{[e.id]:n}])}),e.chk=n}),t.$.on("click","[data-cmd]",function(e){let{cmd:n}=this.dataset,i=n.split(":"),o=i.length>1?i[0]:"",l=i.length>1?i[1]:n;o?"editor"!=o?"switch"!=o||r.toggle(this):t.fire("editor",[l]):t.fire("cmd",n,[])})}),t.on("render",function(){r.init(t),o.forEach(e=>{e.chk.render({checked:e.checked})})}),{set(e){t.$.find('[data-id="md5"]').html(e),t.$.find('[data-cmd="copy"]').toggle(!!e)}}}),f.panel("/Tool/Main/Less/Preview",function(e,n,t){const i=e("MarkDoc");let r=t.$.find('[data-id="markdoc"]'),o=!1,l=null,c=[".json",".js",".css",".less",".html",".htm"];return t.on("init",function(){(l=new i({container:r.get(0)})).on("hash",function(e){t.fire("hash",[e])}),l.on("render",function(e){let n=l.getOutlines();t.fire("render",[n])}),t.$.on("scroll",function(e){if(o)return void(o=!1);let n=r.outerHeight(),i=t.$.get(0).scrollTop;t.fire("scroll",[{height:n,top:i}])}),t.$on("click",{'[data-cmd="compile"]':function(e){t.fire("compile")}})}),t.on("render",function(e){if(t.$.toggleClass("markdoc-mode",!!e),!e)return;let{content:n,ext:i,minify:r}=e,o="";c.includes(i)&&(o=i.slice(1)),l.render({content:n,language:o,sample:r?"code":"pre",code:{language:!1,numbers:!r}}),l.$.toggleClass("minify",r)}),{scroll(e){let n=(r.outerHeight()-e.clientHeight)*e.top/(e.height-e.clientHeight);o=!0,t.$.get(0).scrollTo(0,n)}}}),f.panel("/Tool/Main/Less/Themes/List",function(e,n,t){const i=e("@definejs/tabs");let r=null,o=[{name:"default"},{name:"custom",desc:"深色"},{name:"3024-day"},{name:"3024-night",desc:"深色"},{name:"ambiance-mobile"},{name:"ambiance",desc:"深色"},{name:"base16-dark",desc:"深色"},{name:"base16-light"},{name:"blackboard",desc:"深色"},{name:"cobalt",desc:"深色"},{name:"eclipse"},{name:"elegant"},{name:"erlang-dark",desc:"深色"},{name:"lesser-dark",desc:"深色"},{name:"mbo",desc:"深色"},{name:"mdn-like"},{name:"midnight",desc:"深色"},{name:"monokai",desc:"深色"},{name:"neat"},{name:"neo"},{name:"night",desc:"深色"},{name:"paraiso-dark",desc:"深色"},{name:"paraiso-light"},{name:"pastel-on-dark",desc:"深色"},{name:"rubyblue",desc:"深色"},{name:"solarized"},{name:"the-matrix",desc:"深色"},{name:"tomorrow-night-eighties",desc:"深色"},{name:"twilight",desc:"深色"},{name:"vibrant-ink",desc:"深色"},{name:"xq-dark",desc:"深色"},{name:"xq-light"}];return t.set("show",!1),t.on("init",function(){(r=new i({container:t.$,selector:">li",activedClass:"on"})).on("change",function(e,n){e=o[n],t.fire("item",[e,n])}),t.$.on("click","[data-index]",function(e){let n=+this.dataset.index;r.active(n)}),t.template({"":function(e){return{items:this.fill("item",e.list)}},item:{"":function(e,n){let t=this.fill("desc",e);return{index:n,name:e.name,desc:t}},desc:function(e){return e.desc?{desc:e.desc}:""}}})}),t.on("render",function(e){t.fill({list:o}),"number"==typeof e&&r.active(e)}),{active:function(e){r.active(e)},slide:function(e,n){e?t.$.slideDown("fast",function(){let e=r.getActivedIndex();t.$.find(`li[data-index="${e}"]`).get(0).scrollIntoViewIfNeeded(),n&&n()}):t.$.slideUp("fast",n)}}}),f.panel("/Tool/Main/Less/Themes/Mask",function(e,n,t){const i=e("@definejs/masker");let r=null,o=!1;return t.on("init",function(){(r=new i({volatile:!0,opacity:0})).on({hide:function(){o=!1,t.fire("hide")},show:function(){o=!0,t.fire("show")}})}),t.on("render",function(){}),{toggle:function(){o?r.hide():r.show()}}}),f.panel("/Tool/Main/Less/Themes",function(e,n,t){const i=e("@definejs/local-storage"),r=n.require("List"),o=n.require("Mask");let l=null;return t.set("show",!1),t.on("init",function(){l=new i(n.id),o.on({show:function(){t.$.addClass("show"),r.slide(!0)},hide:function(){r.slide(!1),t.$.removeClass("show")}}),r.on({item:function(e,n){l.set("index",n),t.fire("item",[e.name])}})}),t.on("render",function(e){"number"==typeof e?l.set("index",e):e=l.get("index")||1,r.render(e),o.render()}),{toggle:function(){o.toggle()}}}),f("/Tool/Main/Less/API",function(e,n,t){const i=e("@definejs/emitter"),r=e("@definejs/loading"),o=e("API");let l=new i,c=new r({mask:0});return{on:l.on.bind(l),compile:function(e){let n=new o("Less.compile",{});n.on({request:function(){c.show("编译中...")},response:function(){c.hide()},success:function(e,n,t){l.fire("success",[e])},fail:function(e,n,t,i){let r=t.data;u.alert(`编译 less 失败: ${n}，所在行号：${r.line}`,function(){l.fire("fail",[r])})},error:function(e,n,t,i){u.alert("编译 less 错误: 网络繁忙，请稍候再试")}}),n.post({content:e.content,minify:e.minify})}}}),f("/Tool/Main/Less/Data",function(e,n,t){let i=new(e("@definejs/local-storage"))(n.id),r={content:i.get("content")||"//请输入 less 内容。\nbody {\n\tcolor: red;\n    div {\n    \tfont-size: 16px;\n    }\n}\n"};return{get:()=>r.content,set:e=>(r.content=e,i.set("content",e),e)}}),f.panel("/Tool/Main/Less",function(e,n,t){const i=e("Clipboard"),r=n.require("Data"),o=n.require("API"),l=n.require("Editor"),c=n.require("Preview"),a=n.require("Themes"),s=n.require("Header");let d={content:"",minify:!1,css:""};t.on("init",function(){o.on({success:function({css:e,md5:n}){d.css=e,s.set(n),c.render({content:e,ext:".css",minify:d.minify})},fail:function(e){l.highlight(e.line)}}),s.on({cmd:{themes:function(){a.toggle()},copy:function(){i.copy(d.css)}},editor:function(e){l.call(e)},switch:{crlf:function(e){l.set("lineWrapping",e)},fullscreen:function(e){t.fire("fullscreen",[e])},column:function(e){t.$.toggleClass("full-editor",!e)}},check:function(e){d.minify=e.minify,s.set(""),c.render()}}),a.on({item:function(e){l.setTheme(e)}}),l.on({scroll:function(e){c.scroll(e)},change:function({content:e}){d.content=e,r.set(e),s.set(""),c.render()}}),c.on({compile:function(){o.compile(d)},scroll:function(e){l.scroll(e)}})}),t.on("render",function(e){let n=e||r.get();l.render({content:n}),s.render(),a.render(),e&&o.compile(d)})}),f("/Tool/Main/MD5/API",function(e,n,t){const i=e("@definejs/emitter"),r=e("@definejs/loading"),o=e("API");let l=new i,c=new r({mask:0});return{on:l.on.bind(l),get:function(e){let n=new o("Crypto.md5",{});n.on({request:function(){c.show("加载中...")},response:function(){c.hide()},success:function(e,n,t){l.fire("success",[e])},fail:function(e,n,t,i){u.alert("获取 MD5 信息失败: {0}",n)},error:function(e,n,t,i){u.alert("获取 MD5 信息错误: 网络繁忙，请稍候再试")}}),n.post({content:e})}}}),f.panel("/Tool/Main/MD5/Input",function(e,n,t){return t.on("init",function(){t.$on("click",{button:function(){let e=t.$.find("textarea").val();e=e.split("\n").join("\r\n"),t.fire("submit",[e])}})}),t.on("render",function(){}),{}}),f.panel("/Tool/Main/MD5/Output",function(e,n,t){return t.on("init",function(){}),t.on("render",function(e){t.fill({md5:e.md5})}),{}}),f.panel("/Tool/Main/MD5",function(e,n,t){const i=n.require("API"),r=n.require("Input"),o=n.require("Output");return t.on("init",function(){r.on({submit:function(e){i.get(e)}}),i.on({success:function(e){o.render(e)}})}),t.on("render",function(){r.render()}),{}}),f.panel("/Tool/Main/QRCode/Main/Input",function(e,n,t){return t.on("init",function(){t.$on("click",{button:function(){let e=t.$.find("textarea").val();t.fire("submit",[e])}})}),t.on("render",function(){}),{}}),f.panel("/Tool/Main/QRCode/Main/Output",function(e,n,t){return t.on("init",function(){}),t.on("render",function(e,n){let i=`${`http://${e.host}:${e.port}`}${e.qrcode.path}?url=${encodeURIComponent(n)}`,r=`${i}&size=10`,o=`${i}&size=10&margin=4`;t.fill({url:n,src:r,href:o})}),{}}),f.panel("/Tool/Main/QRCode/Statics/List",function(e,n,t){return t.on("init",function(){t.template(function(e,n){let{qrcode:t,url:i}=e,r=`${t}?url=${encodeURIComponent(i)}`;return{index:n,url:i,href:`${r}&size=10&margin=4`,src:`${r}&size=10`}})}),t.on("render",function(e){t.fill(e)}),{}}),f("/Tool/Main/QRCode/API",function(e,n,t){const i=e("@definejs/emitter"),r=e("@definejs/loading"),o=e("API");let l=new i,a=new r({mask:0});return{on:l.on.bind(l),get:function(){let e=new o("Server.get",{});e.on({request:function(){a.show("加载中...")},response:function(){a.hide()},success:function(e,n,t){c.log(e),e.host=e.host||"localhost",l.fire("success","get",[e])},fail:function(e,n,t,i){u.alert("获取服务器信息失败: {0}",n)},error:function(e,n,t,i){u.alert("获取服务器信息错误: 网络繁忙，请稍候再试")}}),e.get()}}}),f.panel("/Tool/Main/QRCode/Main",function(e,n,t){const i=n.require("Input"),r=n.require("Output");let o={server:null};return t.on("init",function(){i.on({submit:function(e){r.render(o.server,e)}})}),t.on("render",function(e){o.server=e,i.render()}),{}}),f.panel("/Tool/Main/QRCode/Statics",function(e,n,t){const i=n.require("List");return t.on("init",function(){}),t.on("render",function(e){let n=`http://${e.host}:${e.port}`,t=e.statics.map(t=>({url:`${n}${t}`,qrcode:`${n}${e.qrcode.path}`}));i.render(t)}),{}}),f.panel("/Tool/Main/QRCode",function(e,n,t){const i=n.require("API"),r=n.require("Main"),o=n.require("Statics");t.on("init",function(){i.on("success",{get:function(e){r.render(e),o.render(e)}})}),t.on("render",function(){i.get()})}),f.panel("/Tool/Main",function(e,n,t){const i=n.require("QRCode"),r=n.require("MD5"),o=n.require("Less"),l=n.require("JS");let c={cmd$module:{}};return t.on("init",function(){[o,l].forEach(e=>{e.on({fullscreen:function(e){t.fire("fullscreen",[e])}})})}),t.on("render",function(e,t){let{cmd:a}=e.data,s=c.cmd$module[a];s?t?s.render(...t):s.show():(t=t||[],(s=c.cmd$module[a]=n.require(a)).render(...t)),[i,r,o,l].forEach(e=>{e!=s&&e.hide()})}),{resize(...e){let n="calc(100% - "+e.reduce(function(e,n){return e+n},0)+"px)";t.$.css({width:n})}}}),f("/Tool/Tree/Data",function(e,n,t){let i=[{name:"二维码",icon:"fas fa-qrcode",panel:"QRCode"},{name:"内容指纹",icon:"fas fa-fingerprint",panel:"MD5"},{name:"Less 编译",icon:"fab fa-less",panel:"Less"},{name:"JS 压缩",icon:"fab fa-node-js",panel:"JS"}];return{make:function(e){return i.map((e,n)=>({name:e.name,id:e.panel,fileIcon:e.icon,open:!1,data:{cmd:e.panel}}))}}}),f.panel("/Tool/Tree",function(e,n,t){const i=e("SidebarTree"),r=n.require("Data");let o=null;return t.on("init",function(){(o=new i({container:t.$,width:t.$.width(),header:!1,resizer:!1})).on({item:function(...e){t.fire("item",e)},dir:function(...e){t.fire("dir",e)},resize:function(...e){let n=o.$.outerWidth();t.$.width(n),t.fire("resize",e)}})}),t.on("render",function(){let e=r.make();o.render(e)}),{open:function(e){o.open(e)}}}),f.view("/Tool",function(e,n,t){const i=e("@definejs/session-storage"),r=n.require("Tree"),o=n.require("Main");let l=null,a={item:null,args:null};return t.on("init",function(){l=new i(n.id),r.on({item:function(e){c.log(e);let n=a.args;a.item=e,a.args=null,l.set("id",e.id),o.render(e,n)},resize:function(){let e=r.$.outerWidth();o.resize(e,6)}}),o.on({fullscreen:function(e){t.$.toggleClass("fullscreen",e),t.fire("fullscreen",[e])}})}),t.on("render",function(e,n){e=e||l.get("id")||1,a.args=n||null,r.render(),r.open(e)}),{}}),f.route("DocAdd",function(e,n){return{demo:function(e){let n=`#!${e}`;t.open(n)}}}),f.route("FileList",function(e,n){const i=n.require("Master");return{demo:function(e){let n=`#!${e}`;t.open(n)},open:function(e){t.open(e)},edit:function(e){i.open("DocAdd",[{name:e}])},"compile-less":function(e){let n=[e];i.open("Tool",["Less",n])},"minify-js":function(e){let n=[e];i.open("Tool",["JS",n])}}}),f.route("HtmlTree",function(e,n){const t=n.require("Master");return{file:function(e){t.open("FileList",[e])}}}),f.route("MD5",function(e,n){const t=n.require("Master");return{cmd:{file:function(e){t.open("FileList",[e])}}}}),f.route("ModuleTree",function(e,n){const t=n.require("Master");return{file:function(e){t.open("FileList",[e])}}}),f.route("SideMenus",function(e,n){const t=n.require("Master");return{file:function(e){t.open("FileList",[e])}}}),f.route("Terminal",function(e,n){const t=n.require("Master");return{cmd:{file:function(e){t.open("FileList",[e])}}}}),u.launch(function(e,n,t){const i=e("Settings.Theme"),r=n.require("Router"),o=n.require("Markdoc"),l=n.require("Master"),c=n.require("Loading");c.show(),o.on({loading:function(e){c.toggle(e)}}),l.on({require:function(e){return n.require(e)},ready:function(){},render:function(){c.hide(),i.set()}}),r.on({master:function(e){o.hide(),l.render(e)},markdoc:function(e){l.hide(),o.render(e)}}),r.render()})}(top,parent,window,document,location,localStorage,sessionStorage,window.console||{log:function(){},dir:function(){},clear:function(){},error:function(){},info:function(){},debug:function(){},warn:function(){}},history,setTimeout,setInterval,definejs,definejs.require("AppModule").define,Array,Boolean,Date,Error,Function,Math,Number,Object,RegExp,String);