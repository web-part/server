!function(e,t,n,i,r,o,l,c,a,s,d,u,f,m,h,p,g,w,b,k,v,y,x,M){!function(e){let t=e.require("AppModule"),i=n.define=t.define;v.assign(i,{panel:e.panel,view:e.view,module:e.define,data:e.data,route:e.route,proxy:e.proxy}),i.data(["/ModuleTree/API/Data","/ModuleTree/Tree/Data","/ModuleTree/Tree","/ModuleTree/Main/ModuleInfo/Base"],{none:"(app)"}),i.data({"Settings.Header":"hide","Settings.Language":"chinese","Settings.Theme":"light"}),e.config({API:{url:`http://localhost:${r.port}/api/`},Proxy:{base:"api/"},App:{name:`webpart-server-${r.port}`},Masker:{fadeIn:200,fadeOut:200}})}(n.definejs),f("data.Sidebar",function(e,t,n){return[{language$name:{chinese:"首页",english:"Home"},icon:"fas fa-home",view:"Home",args:[]},{language$name:{chinese:"文件资源",english:"Files"},icon:"fa fa-folder-open",view:"FileList",args:[]},{language$name:{chinese:"模块系统",english:"Module Tree"},icon:"fab fa-connectdevelop",view:"ModuleTree",args:[]},{language$name:{chinese:"html 系统",english:"HTML Tree"},icon:"fa fa-sitemap",view:"HtmlTree",args:[]},{language$name:{chinese:"日志",english:"Logs"},icon:"fas fa-comment-dots",view:"Log",args:[]},{language$name:{chinese:"写文档",english:"Markdoc"},icon:"fa fa-edit",view:"DocAdd"},{language$name:{chinese:"终端",english:"Terminal"},icon:"fas fa-terminal",view:"Terminal",args:[]},{language$name:{chinese:"常用工具",english:"Tools"},icon:"fas fa-tools",view:"Tool",args:[]},{language$name:{chinese:"偏好设置",english:"Settings"},icon:"fas fa-cogs",view:"Setting",args:[]},{language$name:{chinese:"代理",english:"Proxy"},icon:"fas fa-network-wired",view:"Proxy",args:[]},{language$name:{chinese:"帮助手册",english:"Help"},icon:"fa fa-question-circle",view:"Help",args:[]}]}),f("CheckBox.defaults",{checked:!1,fireNow:!0,checkedClass:"far fa-check-square checked",uncheckedClass:"far fa-square"}),f("CheckBox",function(e,t,n){const i=e("$"),r=e("@definejs/object"),o=e("@definejs/template"),l=e("@definejs/emitter");let c=e("CheckBox.defaults"),a=new Map,s=new o("#tpl-CheckBox");return class{constructor(e){e=v.assign({},c,e);let t=new l(this),n={checked:e.checked,text:e.text,fireNow:e.fireNow,checkedClass:e.checkedClass,uncheckedClass:e.uncheckedClass,$:i(e.container),emitter:t,bind:!1};a.set(this,n)}render(e={}){let t=a.get(this),n=r.filter(e,["checked","text"]);v.assign(t,n);let i=s.fill({class:t.checked?t.checkedClass:t.uncheckedClass,text:t.text});t.$.html(i),t.$.addClass("CheckBox"),t.fireNow&&t.emitter.fire("checked",[t.checked]),t.bind||(t.$.on("click",function(e){let n=t.checked=!t.checked,i=t.$.find("i");n?(i.removeClass(t.uncheckedClass),i.addClass(t.checkedClass)):(i.removeClass(t.checkedClass),i.addClass(t.uncheckedClass)),t.emitter.fire("checked",[n])}),t.bind=!0)}on(...e){a.get(this).emitter.on(...e)}destroy(){let e=a.get(this);e.emitter.destroy(),e.$=null,a.delete(this)}}}),f("Dialog/Drager",function(e,t,r){const o=e("$"),l=e("@definejs/masker");let c=0,a=0,s=0,d=0,u="",f=i.body,m=null,h={},p=null;function g(e){f.style.cursor=u,p&&p.$.removeClass("draging"),m&&m.hide(),e&&e.preventDefault(),p=null}return o(f).on({mousedown:function(e){(p=h[e.target.id])&&(c=e.pageX,a=e.pageY,u=f.style.cursor,f.style.cursor="move",s=p.$.css("margin-left"),d=p.$.css("margin-top"),s=parseInt(s),d=parseInt(d),p.$.addClass("draging"),(m=m||new l({opacity:0,background:"red","z-index":1025})).show(),n.getSelection().removeAllRanges())},mousemove:function(e){if(!p)return;if(1!=e.which)return void g();let t=e.pageX-c,n=e.pageY-a,i=s+t,r=d+n;p.$.css({"margin-left":i,"margin-top":r})},mouseup:function(e){g(e)}}),{set:function(e,t){h[e]=t},remove:function(e){delete h[e]}}}),f("Dialog/Events",function(e,t,n){const r=e("$");return{bind:function(e){let t={keyup:function(t){13==t.keyCode&&e.visible&&(t.stopPropagation(),e.emitter.fire("enter",[t]))}};r(i.body).on(t),r("#"+e.id).on(t),r("#"+e.headerId).on("click","i",function(){e.this.close()}),r("#"+e.footerId).on("click","button[data-index]",function(){let t=+this.getAttribute("data-index"),n=e.footer.buttons[t],i=n.name||x(t);e.emitter.fire("button",i,[n,t]),e.emitter.fire("button",[n,t]),("autoClose"in n?n.autoClose:e.autoClose)&&e.this.close(!0)})}}}),f("Dialog/Meta",function(e,t,n){const i=e("@definejs/string");return{create:function(e,t){let n="Dialog-"+i.random(4),r=e.footer;r=m.isArray(r)?{content:"",buttons:r}:"string"==typeof r?{content:r,buttons:[]}:r||{};let o={dragable:e.dragable,resizable:e.resizable,cssClass:e.cssClass,autoClose:e.autoClose,mask:e.mask,"z-index":e["z-index"],width:e.width,height:e.height,container:e.container,title:e.title,content:e.content,footer:r,maxWidth:e.maxWidth,minWidth:e.minWidth,maxHeight:e.maxHeight,minHeight:e.minHeight,attributes:e.attributes,masker:null,id:n,headerId:n+"-header",contentId:n+"-content",footerId:n+"-footer",sizerId:n+"-sizer",rendered:!1,visible:!1,$:null,this:this};return v.assign(o,t),o}}}),f("Dialog/Resizer",function(e,t,n){const r=e("$");let o=0,l=0,c=0,a=0,s="",d=i.body,u={},f=null,m=null,h=null;function p(e){d.style.cursor=s,e&&e.preventDefault(),m&&m.removeClass("resizing"),f=null,m=null,h=null}function g(e,t){let n=e+" x "+t;h.html(n)}return r(d).on({mousedown:function(e){let t=e.target,n=t.getAttribute("data-id");if(f=u[n])return o=e.pageX,l=e.pageY,s=d.style.cursor,d.style.cursor=r(t).css("cursor"),c=f.$.css("width"),a=f.$.css("height"),c=parseInt(c),a=parseInt(a),(m=r("#"+f.headerId)).addClass("resizing"),h=r("#"+f.sizerId),g(c,a),!1},mousemove:function(e){if(!f)return;if(1!=e.which)return void p();let t=e.pageX-o,n=e.pageY-l,i=c+t,r=a+n,s=f.maxWidth;s&&i>s&&(i=s);let d=f.minWidth;d&&i<d&&(i=d);let u=f.maxHeight;u&&r>u&&(r=u);let m=f.minHeight;m&&r<m&&(r=m),f.$.css({width:i,height:r}),g(i,r)},mouseup:function(e){p(e)}}),{set:function(e,t){u[e]=t},remove:function(e){delete u[e]}}}),f("Dialog/Style",function(e,t,n){const i=e("@definejs/object");function r(e){return(e=0-(e=parseInt(e))/2)+"px"}return{get:function(e){var t=i.filter(e,["height","width","z-index"]),n=t.width;n?(t.width=parseInt(n)+"px",t["margin-left"]=r(n)):delete t.width;var o=t.height;o?(t.height=parseInt(o)+"px",t["margin-top"]=r(o)):delete t.height;var l=[];for(var c in t){var a=c+": "+t[c];l.push(a)}return t=l.join("; ")+";"}}}),f("Dialog/Template",function(e,t){let n=new(e("@definejs/template"))("#tpl-Dialog");return n.process({"":function(e){let t=this.fill("header",e),n=this.fill("content",e),i=this.fill("footer",e),r=v.entries(e.attributes).map(function(e){return e[0]+'="'+e[1]+'"'});return this.fix("attributes"),{id:e.id,headerId:e.headerId,contentId:e.contentId,footerId:e.footerId,attributes:r.join(" "),cssClass:e.cssClass,style:e.style,header:t,content:n,footer:i}},header:function(e){return{title:e.title,sizerId:e.sizerId}},content:function(e){return e.content},footer:{"":function(e){let t=e.footer;return{content:this.fill("content",t),buttons:this.fill("buttons",t),resizer:this.fill("resizer",e)}},content:function(e){return e.content},buttons:{"":function(e){let t=e.buttons;return t&&0!=t.length?{buttons:t=this.fill("button",t)}:""},button:function(e,t){return{index:t,text:e.text,cssClass:e.cssClass||""}}},resizer:function(e){return e.resizable?{id:e.id}:""}}}),n}),f("Dialog.defaults",{cssClass:"",mask:!0,title:"",content:"",width:0,height:0,"z-index":1024,maxWidth:0,maxHeight:0,minWidth:200,minHeight:160,dragable:!0,resizable:!0,autoClose:!0,attributes:{},footer:{content:"",buttons:[]}}),f("Dialog",function(e,t,n){const r=e("$"),o=e("@definejs/emitter"),l=e("@definejs/masker"),c=e("@definejs/panel"),a=t.require("Meta"),s=t.require("Template"),d=t.require("Drager"),u=t.require("Resizer"),f=t.require("Style"),h=t.require("Events");let p=e("Dialog.defaults"),g=new Map;function w(e){e=v.assign({},p,e);let t=new o(this),n=a.create(e,{this:this,emitter:t});g.set(this,n),this.id=n.id,this.$=n.$}return w.prototype={constructor:w,id:"",$:null,render:function(e){e=e||{};let t=g.get(this),n=t.emitter;if(t.rendered)return this.set(e),this.show(),void n.fire("render",[e]);let o=t.title=e.title||t.title,c=t.content=e.content||t.content,a=t.footer=e.footer||t.footer,m=f.get(t),p=t.headerId,w=s.fill({id:t.id,headerId:p,contentId:t.contentId,footerId:t.footerId,sizerId:t.sizerId,cssClass:t.cssClass,resizable:t.resizable,attributes:t.attributes,style:m,title:o,content:c,footer:a});r(i.body).prepend(w),t.rendered=!0,this.$=t.$=r("#"+t.id),t.$.toggleClass("auto-size",!t.width||!t.height),t.mask&&(t.masker=new l({"z-index":t["z-index"]-1})),t.dragable&&d.set(p,t),t.resizable&&u.set(t.id,t),h.bind(t),this.show(),n.fire("first-render",[e]),n.fire("render",[e])},show:function(){let e=g.get(this);if(!e.rendered||e.visible)return;let t=e.masker;if(t){let n=l.normalize(e.mask);t.show(n)}e.$.show(),e.visible=!0,e.emitter.fire("show")},close:function(e){let t=g.get(this);if(!t.rendered||!t.visible)return;let n=t.emitter;if(!e){if(!1===(e=n.fire("before-close").slice(-1)[0]))return}let i=t.masker;i&&i.hide(),t.$.hide(),t.visible=!1,n.fire("close")},set:function(e,t){let n="object"==typeof e?e:{[e]:t},i=g.get(this),o={title:"header",content:"content",footer:"footer"};for(e in n){let l=o[e];if(l){let e=s.fill(l,n),t=i[l+"Id"];r("#"+t).html(e)}else switch(t=n[e],e){case"width":case"height":i.$.css(e,t)}}},on:function(e,t){let n=g.get(this).emitter,i=m.from(arguments);n.on(i)},destroy:function(){let e=g.get(this);if(!e)return;e.emitter.destroy(),e.masker.destroy(),e.$.off();let t=e.$.get(0);t.parentNode.removeChild(t),d.remove(e.headerId),u.remove(e.id)}},v.assign(w,{panel:function(e){let t=e.content,n=e.container,i=e.footer,r=t.$.get(0),o=n.$.get(0),l=i&&!m.isArray(i)?i.$.get(0):null,a={};m.from(o.attributes).map(function(e){let t=e.name;"class"!=t&&(a[t]=e.value)});let s=v.assign({},e,{content:r.outerHTML,cssClass:o.className,attributes:a});s.footer=l?l.outerHTML:i;let d=new w(s);return d.on({"first-render":function(){o.parentNode.removeChild(o),r.parentNode.removeChild(r),l&&l.parentNode.removeChild(l),n.set("$");let e=`[data-panel^="${o.getAttribute("data-panel")}"]`,t=n.$.find(e).toArray();t=t.map(function(e){return e.getAttribute("data-panel")}),c.update(t),o=null,r=null,l=null}}),d}}),w}),f("DropCheckList/Events",function(e,t,n){e("$");return{bind:function(e){e.binded||(e.binded=!0,e.$.on("click","button",function(t){e.visible?e.masker.hide():e.masker.show()}),e.$.on("click",'[data-id="chk-all"]',function(t){let{list:n,all:i,tpl:r,emitter:o,$list:l}=e,c=!i.checked;i.fill(c);let a=r.fill("item",n);l.html(a),o.fire("check","all",[c,n]),o.fire("check",[n])}),e.$.on("click","li[data-index]",function(t){let{list:n,all:i,tpl:r,emitter:o}=e,l=+this.dataset.index,c=n[l];c.checked=!c.checked,i.fill();let a=r.fill("item",c,l);this.outerHTML=a,o.fire("check","item",[c,l,n]),o.fire("check",[n])}))}}}),f("DropCheckList/Masker",function(e,t,n){const i=e("@definejs/masker");return{create:function(e){let t=new i({volatile:!0,opacity:0});return t.on({show:function(){e.$.addClass("show"),e.visible=!0,e.$main.slideDown(80)},hide:function(){e.$.removeClass("show"),e.visible=!1,e.$main.slideUp(50)}}),t}}}),f("DropCheckList/Meta",function(e,t,n){let i=new(e("@definejs/id-maker"))(t.parent.id);return{create:function(e,t){let{container:n,list:r,text:o}=e,l={id:i.next(),$:null,this:null,emitter:null,masker:null,tpl:null,$main:null,$list:null,$container:$(n),text:o,width:e.width||"auto",maxTextWidth:0,container:n,list:r||[],binded:!1,visible:!1,all:{$:null,text:"全选",checked:!1,fill(e){let{all:t,list:n,tpl:i}=l,r=n.length,o=0;"boolean"==typeof e?(o=e?r:0,t.checked=e,n.forEach(t=>{t.checked=e})):(n.forEach(e=>{e.checked&&o++}),e=t.checked=o>0&&o==r);let c=i.fill("all",{text:t.text,checked:e,count:o,total:r});l.$.toggleClass("not-all-checked",!e),t.$.html(c)}}};return v.assign(l,t),l}}}),f("DropCheckList/Template",function(e,t){const n=e("@definejs/string"),i=e("@definejs/template");return{create:function(e){let t=new i("#tpl-DropCheckList");return t.process({"":function(){return{id:e.id,text:e.text}},all:function(e){return{checked:e.checked?"checked":"",icon:e.checked?"check-":"",text:e.text,count:e.count,total:e.total}},item:function(t,i){let{text:r,checked:o}=t,l=8*n.getByteLength(r);return e.maxTextWidth=b.max(l,e.maxTextWidth),{index:i,text:r,checked:o?"checked":"",icon:o?"check-":""}}}),t}}}),f("DropCheckList.defaults",{}),f("DropCheckList",function(e,t,n){const i=e("@definejs/emitter"),r=t.require("Meta"),o=t.require("Template"),l=t.require("Events"),c=t.require("Masker"),a=e("DropCheckList.defaults"),s=new Map;return class{constructor(e){e=v.assign({},a,e);let t=new i(this),n=r.create(e,{emitter:t,this:this});s.set(this,n),v.assign(this,{id:n.id,$:n.$})}render(e){let t=s.get(this);if(e&&(t.list=e),t.$)return void this.fill();let n=(t.tpl=o.create(t)).fill({});$(t.container).html(n),t.$=this.$=$(`#${t.id}`),t.$main=t.$.find('[data-id="main"]'),t.all.$=t.$.find('[data-id="all"]'),t.$list=t.$.find('[data-id="list"]'),t.masker=c.create(t),l.bind(t),this.fill()}fill(e){let t=s.get(this);e=t.list=e||t.list;let n=t.width,i=t.tpl.fill("item",e);t.all.fill(),t.$list.html(i),"auto"==n&&(n=t.maxTextWidth+50),n>0&&(n=b.max(n,110),t.$main.width(n),t.all.$.width(n)),t.emitter.fire("fill",[e])}on(...e){s.get(this).emitter.on(...e)}}}),f("DropList/Current",function(e,t,n){let i={item:null,row:null,event:null,hover:null,keyword:"",html:""};return{create:function(){return v.assign({},i)},reset:function(e,t){t=t||{},v.assign(e.current,i,t),e.this.hover(0)}}}),f("DropList/Field",function(e,t,n){function i(e,t){return"function"==typeof t?t(e):e[t]}return{map:function(e,t){return t=t||[],e?t=t.map(function(t){return{id:e.id?i(t,e.id):"",title:e.title?i(t,e.title):"",item:t,disabled:!1}}):t}}}),f("DropList/Filter",function(e,t,n){return{bind:function(e){let t=e.filters;e.this.on("change",function(n){this.fill(e.list,n,function(e,i){return!t||function(e,t,n){let i=t.length;for(let r=0;r<i;r++){let i=t[r],o=!1;if("object"==typeof i){let e=i;i=e.name,o=e.ignoreCase}let l=e[i];if("number"==typeof l&&(l=x(l)),"string"==typeof l&&(o&&(l=l.toLowerCase(),n=n.toLowerCase()),l.includes(n)))return!0}return!1}(e,t,n)})})}}}),f("DropList/Input",function(e,t,n){const r=e("$");return{create:function(e){let t=i.getElementById(e.txtId),n=!1;return r(t).on({focus:function(){e.disabled||(e.masker.show(),function(e){let t=e.field,n=e.current.item;if(!t||!t.focus||!n)return;let i=e.getValue(n.item,t.focus);e.this.set("text",i),e.this.select()}(e))},blur:function(){e.hovering||(e.masker.hide(),function(e){let t=e.field,n=e.current.item;if(!t||!t.text||!n)return;let i=e.getValue(n.item,t.text);e.this.set("text",i)}(e))},click:function(e){},input:function(){n||e.change()},compositionstart:function(e){n=!0},compositionend:function(t){n=!1,e.change()},keydown:function(n){let i=n.keyCode,r=e.current,o=r.hover;if(13==i)return r.event=n,o&&e.this.select(o.index),void t.blur();let l=o?o.index:-1,c=38==i,a=40==i,s=e.length-1;(c||a)&&((l=c?l-1:l+1)<0?l=s:l>s&&(l=0),e.this.hover(l),n.preventDefault())}}),t}}}),f("DropList/Masker",function(e,t,n){const i=e("@definejs/masker");return{create:function(e){let t=new i({volatile:!0,opacity:e.mask,container:e.dialog,position:"absolute"});return t.on({show:function(){e.$.addClass("on"),e.visible=!0,e.adjust(),e.$table.get(0).scrollIntoViewIfNeeded();let t=e.current.row;t&&t.element.scrollIntoViewIfNeeded(),e.emitter.fire("focus")},hide:function(){let t=e.old.item;if(""===e.txt.value&&!e.empty&&t&&(e.this.fill(e.list),e.this.select(t)),!e.custom&&!e.current.item&&!!e.text)return e.$txt.addClass("error"),u.alert("输入的数据不存在，请重新输入。",function(){e.txt.focus()}),!1;e.$.removeClass("on"),e.visible=!1,e.emitter.fire("blur")}}),t}}}),f("DropList/Meta",function(e,t,n){const i=e("@definejs/string"),r=e("$");return{create:function(e,t){let n=e.filters,o=e.columns;!0===n&&(n=o||null);let l={id:i.random(),txtId:i.random(),tableId:i.random(),$:null,$table:null,$txt:null,txt:null,this:null,emitter:null,table:null,masker:null,tpl:null,container:e.container,cssClass:e.cssClass,tableClass:e.tableClass,text:e.text,readonly:e.readonly,disabled:e.disabled,custom:e.custom,order:e.order,empty:e.empty,mask:e.mask,dialog:e.dialog,field:e.field,tabIndex:e.tabIndex,maxLength:e.maxLength,columns:o,filters:n,direction:"",visible:!1,hovering:!1,list:[],length:0,current:{},old:{},getValue:function(e,t){return"function"==typeof t?t(e):e[t]},change:function(e){let t=arguments.length>0,n=l.txt,i=r(n);if((e=t?x(e):n.value)===l.text)return;let o=""===e;i.removeClass("error"),l.text=n.title=e,t&&(n.value=e),t||l.emitter.fire("change",[e]),o&&l.emitter.fire("empty",[]),n.placeholder=l.current.item&&o?"(无内容)":""},adjust:function(){if(!l.visible)return;l.$.removeClass("right");let e=l.$table.outerWidth(),t=r(l.dialog).width(),n=l.$table.offset().left-r(l.dialog).offset().left,i=l.direction=n+e>t?"right":"left";l.$.toggleClass("right","right"==i)}};return v.assign(l,t),l}}}),f("DropList/Table",function(e,t,n){const i=e("@definejs/escape"),r=e("Table");return{create:function(e){let t=e.columns.map(function(e){return{name:e}}),n=new r({container:"#"+e.tableId,fields:t,order:e.order,class:e.tableClass,columnName:"name"});return n.on("process",{row:function(t){let n=e.field.title;n&&(t.title=e.getValue(t.data.item,n))},cell:function(t){let n=e.emitter.fire("process",[t]).slice(-1)[0];n===M&&(n=null==(n=t.row.data.item[t.name])?"":n,n=i.html(n));let r=e.current,o=r.keyword;return n.includes(o)&&r.index<0&&(r.index=t.row.index),o&&(n=x(n).split(o).join(r.html)),n}}),n.on("fill",function(t){let n=e.length=t.length,i=b.max(e.current.index,0);e.$table.removeClass("loading").toggleClass("nodata",!n),e.$txt.removeClass("error"),e.this.hover(i),e.adjust()}),n.on("render",function(){this.$.on("mouseover",function(){e.hovering=!0}),this.$.on("mouseout",function(){e.hovering=!1})}),n.on("click",{row:function(t,n){e.current.event=n,e.this.select(t.index)}}),n},getRow:function(e,t){let n=e.get("rows"),i=typeof t;if("number"==i)return n[t];if("function"==i)return n.find(function(e,n){return t(e.data,n)});if(!t)return null;let r=t;return"object"==i&&(r=x(t.id)),n.find(function(e,t){return e.data.id==r})}}}),f("DropList/Template",function(e,t){const n=e("@definejs/template");return{create:function(e){let t=new n("#tpl-DropList");return t.process({"":function(){this.fix(["maxlength","readonly","disabled","tabIndex"]);let t=e.tabIndex,n=e.maxLength;return t=t?'tabindex="'+t+'"':"",n=n?'maxlength="'+e.maxLength+'"':"",{txtId:e.txtId,tableId:e.tableId,text:e.text,readonly:e.readonly?"readonly":"",disabled:e.disabled?"disabled":"",tabindex:t,maxlength:n}}}),t}}}),f("DropList.defaults",function(e,t,n){return{cssClass:"DropList",tableClass:"",text:"",readonly:!1,disabled:!1,custom:!1,order:!1,empty:!1,mask:0,dialog:i.body,columns:[],field:null,filters:!0,container:null,tabIndex:"",maxLength:0}}),f("DropList",function(e,t){const n=e("$"),i=e("@definejs/emitter"),r=e("@definejs/array"),o=e("@definejs/object"),l=t.require("Current"),a=t.require("Field"),d=t.require("Filter"),u=t.require("Input"),f=t.require("Masker"),m=t.require("Meta"),h=t.require("Table"),p=t.require("Template"),g=e("DropList.defaults");let w=new Map;function $(e){e=v.assign({},g,e);let t=new i(this),n=l.create(),r=m.create(e,{emitter:t,current:n,this:this});w.set(this,r),v.assign(this,{id:r.id,$:r.$,meta:r}),d.bind(r)}return $.prototype={constructor:$,id:"",$:null,render:function(e){let t=w.get(this),i=(t.tpl=p.create(t)).fill(t);t.$=this.$=n(t.container),t.$.html(i),t.$.addClass(t.cssClass),(t.table=h.create(t)).render(),t.txt=u.create(t),t.masker=f.create(t),t.$table=n("#"+t.tableId),t.$txt=n(t.txt),e&&this.fill(e)},fill:function(e,t,n){"function"==typeof t&&(n=t,t="");let i=w.get(this);e=r.map(e,function(e,t){if(!n)return e;let r=n.call(i.this,e,t);return!1===r?null:"object"==typeof r?r:e}),t||(i.list=e);let o=a.map(i.field,e),c=t?i.tpl.fill("keyword",{keyword:t}):"",s=i.current;s.item&&v.assign(i.old,s),l.reset(i,{keyword:t,html:c,index:-1}),i.table.fill(o),i.emitter.fire("fill",[e])},select:function(e){let t=w.get(this),i=t.txt;if(0==arguments.length)return i.select(),i.value;let r=h.getRow(t.table,e);if(!r)return void c.warn("要选择的项无法找到:",e);let o=r.data;if(o.disabled)return void c.warn("要选择的项已给禁用:",o);let l=t.current;if(l.item===o)return t.masker&&t.masker.hide(),void c.warn("要选择的项已给选中:",o);let a=l.row,d=l.item,u=l.event;l.row=r,l.item=o,l.event=null,a&&n(a.element).removeClass("on"),n(r.element).addClass("on"),t.$txt.removeClass("error"),r.element.scrollIntoViewIfNeeded(),this.hover(r.index),u&&s(function(){t.visible&&t.masker&&t.masker.hide()},50);let f=t.field;if(f&&f.text){let e=t.getValue(o.item,f.text);this.set("text",e)}t.emitter.fire("select",[o,{index:r.index,row:r,item:o,event:u,keyword:l.keyword,oldRow:a,oldItem:d}])},hover:function(e){let t=w.get(this),i=t.table.get(e),r=t.current.hover;if(!i)return r&&n(r.element).removeClass("hover"),void(t.current.hover=null);i!==r&&(t.current.hover=i,r&&n(r.element).removeClass("hover"),n(i.element).addClass("hover"),i.element.scrollIntoViewIfNeeded())},set:function(e,t){let n=o.isPlain(e)?e:{[e]:t},i=w.get(this);o.each(n,function(e,t){switch(e){case"text":i.change(t);break;case"disabled":t=!!t,i.txt.disabled=i.disabled=t;break;case"list":i.list=t||[]}})},get:function(e){let t=w.get(this),n=t.current;if(!e)return n.item;switch(e){case"text":case"disabled":case"length":return t[e]}},reset:function(){let e=w.get(this),t=e.current.row;t&&n(t.element).removeClass("on hover"),e.old={},l.reset(e),this.set({text:"",disabled:!1}),e.emitter.fire("reset")},on:function(){w.get(this).emitter.on(...arguments)},destroy:function(){let e=w.get(this);e&&(e.emitter.destroy(),e.table.destroy(),e.masker.destroy(),e.tpl.destroy(),e.current=null,e.$=null,e.txt=null,e.this=null,e.$txt=null,e.$table=null,e.masker=null,w.delete(this))}},$}),f("File/API",function(e,t,n){const i=e("@definejs/emitter"),r=e("@definejs/loading"),o=e("API");return{create(){let e=new i,t=new r({mask:0});return{on:e.on.bind(e),read:function(n,i){let r=new o("FileList.read",{});r.on({request:function(){t.show("加载中...")},response:function(){t.hide()},success:function(t,n,i){e.fire("success","read",[t])},fail:function(e,t,n,i){u.alert("获取文件内容失败: {0}",t)},error:function(e,t,n,i){u.alert("获取文件内容错误: 网络繁忙，请稍候再试")}}),n.startsWith("/")||(n=n.split("/").slice(1).join("/")),r.get({id:n})}}}}}),f("File/Ext",function(e,t,n){return{get(e){if(!e.includes("."))return"";let t=e.split(".").slice(-1)[0];return t=(t=t?`.${t}`:"").toLowerCase()}}}),f("File/Icon",function(e,t,n){let i={dir:"fa fa-folder",file:"fas fa-file-alt",".css":"fab fa-css3-alt",".doc":"fas fa-file-word",".docx":"fas fa-file-word",".html":"fab fa-html5",".js":"fab fa-js-square",".json":"fab fa-npm",".less":"fab fa-less",".md":"fab fa-markdown",".map":"fas fa-globe",".bmp":"fas fa-file-image",".jpg":"fas fa-file-image",".png":"fas fa-file-image"};return{get({type:e,ext:t}){if("dir"==e){let t=i.dir,n=`FileIcon dir ${t}`;return{type:e,icon:t,className:n,html:`<i class="${n}"></i>`}}let n=t.slice(1),r=i[t]||i.file,o=`FileIcon file ${n} ${r}`;return{type:e,ext:t,extName:n,className:o,icon:r,html:`<i class="${o}"></i>`}}}}),f("File/Size",function(e,t,n){return{getDesc:function(e){return e?e<1024?{value:e,desc:"B"}:(e/=1024)<1024?{value:e=b.ceil(e),desc:"KB"}:(e/=1024)<1024?((e=e.toFixed(2)).endsWith("0")&&(e=e.slice(0,-1)),e.endsWith("0")&&(e=e.slice(0,-2)),{value:e,desc:"MB"}):((e=(e/=1024).toFixed(2)).endsWith("0")&&(e=e.slice(0,-1)),e.endsWith("0")&&(e=e.slice(0,-2)),{value:e,desc:"GB"}):{value:0,desc:""}}}}),f("File",function(e,t,n){const i=t.require("API"),r=t.require("Ext"),o=t.require("Icon"),l=t.require("Size");return{API:i.create,getSizeDesc:(...e)=>l.getDesc(...e),getIcon(e){"string"==typeof e&&(e={name:e});let{ext:t,type:n,name:i}=e;return t=t||r.get(i),o.get({ext:t,type:n})},getExt:e=>r.get(e)}}),f("GridView/Check",function(e,t,n){const i=e("$");return{item:function(e,t,n){let r=t[e.primaryKey],o=e.current,l=o.id$item,c=new Set(o.list);return n===M&&(n=!l[r]),n?(l[r]=t,c.add(r)):(delete l[r],c.delete(r)),o.list=[...c],i("#"+e.countId).html(c.size),c=e.this.get(),e.emitter.fire("check",[{item:t,checked:n,list:c,id$item:l}]),n},all:function(e){let t=e.list,n=e.current.id$item,r=e.primaryKey,o=t.length,l=o>0;for(let e=0;e<o;e++){if(!n[t[e][r]]){l=!1;break}}i("#"+e.checkAllId).toggleClass("on",l)}}}),f("GridView/Fields",function(e,t,n){const i=e("GridView.defaults");return{get:function(e){let t=e.fields,n=e.check,r=e.order,o=[];return n=!0===n?i.check:n,r=!0===r?i.order:r,n&&o.push({name:n.name,width:n.width,caption:"",class:n.class,dragable:n.dragable}),r&&o.push({name:r.name,width:r.width,caption:r.caption,class:r.class,dragable:r.dragable}),t.forEach(function(e){o.push({name:e.name,width:e.width,caption:e.caption,class:e.class,dragable:e.dragable,delegate:e.delegate})}),o},sumWidth:function(e){let t=0;return e.map(function(e){t+=e.width}),t}}}),f("GridView/Meta",function(e,t,n){const i=e("@definejs/string");return{create:function(e,t){let n=e.all,r=n?n.length:e.total,o={id:i.random(),pagerId:i.random(),tableId:i.random(),headerId:i.random(),counterId:i.random(),countId:i.random(),checkAllId:i.random(),nodataId:i.random(),$:null,$container:null,$nodata:null,table:null,pager:null,tpl:null,resizer:null,checkItem:null,checkAll:null,all:n,total:r,container:e.container,class:e.class,no:e.no,size:e.size,sizes:e.sizes,sumWidth:0,check:e.check,order:e.order,primaryKey:e.primaryKey,footer:!!e.footer,list:[],oldList:null,selectedMode:!1,current:{list:[],id$item:{}}};return v.assign(o,t),o}}}),f("GridView/Pager",function(e,t,n){const i=e("Pager");return{create:function(e){let t=new i({container:"#"+e.pagerId,total:e.total,size:e.size,sizes:e.sizes});return t.on({change:function(t,n){e.no=t,e.size=n,e.selectedMode=!1,e.emitter.fire("page","change",[t,n])},error:function(t){e.emitter.fire("page","error",[t])}}),t},list:function(e,t,n){let i=(t-1)*n,r=i+n;return e.slice(i,r)}}}),f("GridView/Resizer",function(e,t,n){const i=e("$"),r=e("TableResizer");return{create:function(e){let t=null,n=new r({table:"#"+e.headerId,fields:e.fields});return n.on("render",function(){let t="#"+e.checkAllId;this.$.on("click",t,function(){let t=i(this),n=!t.hasClass("on");t.toggleClass("on",n),e.table.column("check",function(t){t.ctrl.toggleClass("on",n),e.checkItem(t.row.data,n)})})}),n.on({render:function(n,i){(t=new r({table:e.table.get("element"),dragable:!1,fields:i})).render()},change:function(n){t.set(n),e.$.width(n.width+10)}}),n}}}),f("GridView/Table",function(e,t,n){const i=e("$"),r=e("Table");return{create:function(e){let t=new r({container:"#"+e.tableId,fields:e.fields,order:!1,columnName:"name"});return t.on("process",{row:function(t){t.value=t.data[e.primaryKey],e.emitter.fire("process","row",[t])},cell:{"":function(t){let n=e.emitter.fire("process","cell",t.name,[t]),i=n.slice(-1)[0];return i===M&&(i=(n=e.emitter.fire("process","cell",[t])).slice(-1)[0]),i===M&&(i=t.row.data[t.name]),t.value=i,i},check:function(t){let n=t.row,i=e.current.id$item[n.value];return e.tpl.fill("check-item",{index:n.index,checked:i?"on":""})},order:function(t){let n=t.row.index+1;return!e.order.global||e.selectedMode?n:(e.no-1)*e.size+n}}}),t.on("render",function(){t.$.on("click",'[data-cmd="check-item"]',function(){let n=this.parentNode.id,r=t.get(n),o=e.checkItem(r.row.data);i(this).toggleClass("on",o),e.checkAll()})}),t.on("fill",function(n){e.list=n,e.check&&(e.checkAll(),t.column("check",function(e){e.ctrl=i(e.element).find('[data-cmd="check-item"]')}))}),t.on("click",{"":function(n){e.emitter.fire("click","table",[t,n])},row:function(t,n){e.emitter.fire("click","row",[t,n])},cell:function(t,n){e.emitter.fire("click","cell",t.name,[t,n]),e.emitter.fire("click","cell",[t,n])}}),e.fields.forEach(function(n){let i=n.delegate;i&&t.on("click","cell",n.name,i,function(t,n,r){e.emitter.fire("click","cell",t.name,i,[t,n,r])})}),t}}}),f("GridView/Template",function(e,t,n){const i=e("@definejs/template");return{create:function(e){let t=new i("#tpl-GridView"),n=e.fields;return e.check&&(n[0].caption=t.fill("check-all",{})),t.process({"":function(){return{header:this.fill("header",{fields:n}),id:e.id,class:e.class,sumWidth:e.sumWidth+10,"no-footer":e.footer?"":"no-footer",headerId:e.headerId,tableId:e.tableId,pagerId:e.pagerId,counterId:e.counterId,countId:e.countId,checkAllId:e.checkAllId,nodataId:e.nodataId}},header:{"":function(e){let t=e.fields;return{cells:this.fill("cell",t)}},cell:function(e,t){return{caption:e.caption}}}}),t}}}),f("GridView.defaults",{size:20,all:null,class:"",primaryKey:"id",footer:!0,sizes:[10,20,30,40,50],check:{name:"check",width:43,class:"check",dragable:!1},order:{name:"order",width:50,caption:"序号",global:!0,dragable:!0,class:"order"}}),f("GridView",function(e,t,n){const i=e("$"),r=e("@definejs/emitter"),o=e("@definejs/array"),l=e("@definejs/object"),c=t.require("Template"),a=t.require("Table"),s=t.require("Pager"),d=t.require("Resizer"),u=t.require("Fields"),f=t.require("Check"),m=t.require("Meta"),h=e("GridView.defaults");let p=new Map,g=0;function w(e){e=v.assign({},h,e);let t=new r(this),n=u.get(e),i=e.width,o=u.sumWidth(n);"auto"==i&&(i=o+264),t.id=`GridView-Emitter-${g++}`;let l=m.create(e,{emitter:t,fields:n,width:i,sumWidth:o,this:this,checkItem:function(e,t){return f.item(l,e,t)},checkAll:function(){return f.all(l)}});p.set(this,l),v.assign(this,{id:l.id}),l.all&&this.on("pager","change",function(e,t){if(!l.all)return;let n=s.list(l.all,e,t);this.fill(n)})}return w.prototype={constructor:w,id:"",$:null,render:function(e={}){let t=p.get(this),n=t.container=e.container||t.container;t.tpl=c.create(t),t.$container=i(n);let r=t.tpl.fill(t);t.$container.html(r),t.$=this.$=t.$container.find(`#${t.id}`),t.$nodata=t.$.find(`#${t.nodataId}`),t.table=a.create(t),t.resizer=d.create(t),t.pager=s.create(t),t.table.render(),t.resizer.render(),t.pager.render(),t.$.on("click","#"+t.counterId,function(){let e=t.selectedMode=!t.selectedMode,n=e?t.this.get():t.oldList;i(this).toggleClass("selected-mode",e),t.table.fill(n)})},fill:function(e,t){let n=p.get(this);t&&(e=o.map(e,t)),n.oldList=e,n.table.fill(e),n.$nodata.toggle(0==e.length),n.emitter.fire("fill",[e])},check:function(e){let t=p.get(this);e&&e.forEach(function(e){t.checkItem(e,!0)}),t.list&&this.fill(t.list)},clear:function(){let e=p.get(this),t=e.current;t.list.length&&(t.id$item={},t.list=[],e.table.column("check",function(e){e.ctrl.removeClass("on")}),i("#"+e.checkAllId).removeClass("on"),i("#"+e.countId).html(0),e.emitter.fire("clear"))},set:function(e){let t=p.get(this),n=e.all,i=l.filter(e,["total","size","no"]);l.isEmpty(i)||(v.assign(t,i),t.pager.render(i)),n&&(t.all=n)},get:function(){let e=p.get(this),t=e.current.list||[],n=e.current.id$item;return t=t.map(function(e){return n[e]})},to:function(e){p.get(this).pager.to(e)},destroy:function(){let e=p.get(this);e&&(e.emitter.destroy(),e.resizer.destroy(),e.table.destroy(),e.pager.destroy(),e.tpl.destroy(),p.delete(this))},on:function(){p.get(this).emitter.on(...arguments)}},v.assign(w,{}),w}),f("MarkDoc/Href/Url",function(e,t,n){const i=e("@definejs/query"),r=e("@definejs/hash"),o=e("resolveUrl");function l(e,t){if(0!=t.indexOf("."))return t;let n=e.split("/").slice(0,-1).join("/")+"/",i=o(n,t),r=o("./");return i=i.slice(r.length)}return{getHref:function(e,t){let n=i.get(e)||{},r=n.file,o=n.dir;if(!r)return e;o&&(o=l(t,o));let c=r.split(",");return c=c.map(function(e){return e=l(t,e)}),r=c.join(","),o&&(e=i.add(e,"dir",o)),e=i.add(e,"file",r)},getHash:function(e){let t=i.get(e);return r.set("",t)}}}),f("MarkDoc/Code",function(e,t,i){const r=e("$"),o=e("@definejs/string"),l=e("@definejs/json");return{each:function(e,t){r(e).find("code[data-language]").each(function(e){let n=this.innerText,i=this.getAttribute("data-language");t({element:this,content:n,language:i},e)})},format:function(e){if("json"==e.getAttribute("data-language")){let t=e.innerText,i=l.parse(t);return i&&(i=n.JSON.stringify(i,null,4),e.innerHTML=i),i}},language:function(e,t){return o.format(e.samples.language,{language:t,foldable:e.code.foldable?"foldable":""})},wrap:function(e,t){let n=r(t.element.parentNode),i=t.language+t.numbers;n.wrap(e.samples.source),n.before(i),n.height(t.height);let o=n.parent().find(">ul"),l=10*o.find(">li").length.toString().length+15;o.css("width",l),n.css("margin-left",l)}}}),f("MarkDoc/Content",function(e,t,i){const r=e("@definejs/string"),o=n.marked;return{get:function(e,t){let n=t.language,i=t.content,l=t.process;if("html"!=n&&"htm"!=n||(n="",i=["``` html",i,"```"].join("\r\n")),n){let t=/[&'"<>\/\\\-\x00-\x09\x0b-\x0c\x1f\x80-\xff]/g;i=i.replace(t,function(e){return"&#"+e.charCodeAt(0)+";"}),i=r.format(e.samples.pre,{language:n,content:i})}else i=o(i),l&&(i=l(i));return i}}}),f("MarkDoc/Events",function(e,t,n){const i=e("$");return{bind:function(e,t){e.bind=!0,e.code.foldable&&e.$.on("click",'[data-cmd="language"]',function(e){i(this.parentNode).toggleClass("on"),e.stopPropagation()}),e.code.foldable&&e.$.on("click",'[data-cmd="source-code"]',function(){let e=i(this);e.hasClass("on")&&e.removeClass("on")}),e.$.on("click",'a[href^="#"]',function(t){let n=this.getAttribute("href");t.preventDefault(),e.emitter.fire("hash",[n])}),e.titles.foldable&&e.$.on("click",e.titles.selector,function(t){"span"==t.target.tagName.toLowerCase()&&i(this).nextUntil(e.titles.selector).animate({height:"toggle",opacity:"toggle"})})}}}),f("MarkDoc/Highlight",function(e,t,i){const r=e("@definejs/string"),o=n.hljs;return{highlight:function(e,t){if(!t)return"";t=r.replaceAll(t,"&lt;","<"),t=r.replaceAll(t,"&gt;",">");try{return o.highlight(e,t).value}catch(e){return t}}}}),f("MarkDoc/Href",function(e,t,n){const i=t.require("Url");return{format:function(e,t){t&&e.$.find("a").each(function(){let e=this,n=e.getAttribute("href");(n.startsWith("#")||n.startsWith("?"))&&e.setAttribute("target","_self"),n.startsWith("?")&&(n=i.getHref(n,t),n=i.getHash(n),e.setAttribute("href",n))})}}}),f("MarkDoc/Image",function(e,t,n){const i=e("$");return{format:function(e,t){t&&i(e).find("img").each(function(){let e=this.getAttribute("src");!e||e.startsWith("http://")||e.startsWith("https://")||(this.src=t+e)})}}}),f("MarkDoc/Lines",function(e,t,n){const i=e("@definejs/string");return n={getNumbers:function(e,t){let r=e.samples.numbers,o=e.samples["numbers.item"],l=t.split(/\r\n|\n|\r/),c=n.getHeight(l);l[l.length-1]||(l=l.slice(0,-1));let a=l.map(function(e,t){return i.format(o,{no:t+1})});return i.format(r,{height:c,items:a.join(""),total:a.length})},getHeight:function(e){return m.isArray(e)||(e=e.split(/\r\n|\n|\r/)),20*e.length}}}),f("MarkDoc/Meta",function(e,t,n){const i=e("$"),r=e("@definejs/string"),o=e("@definejs/template");let l={format:!0,language:!0,numbers:!0,foldable:!0},c={selector:"h1,h2,h3,h4,h5,h6",foldable:!0};return{create:function(e,t){let n=new o("#tpl-MarkDoc"),a=v.assign({},l,e.code),s=v.assign({},c,e.titles),d=e.container,u={id:r.random(),container:d,code:{format:a.format,language:a.language,numbers:a.numbers,foldable:a.foldable},this:null,emitter:null,$:i(d),tpl:n,bind:!1,outline:{visible:!0},current:{},titles:{selector:s.selector,foldable:s.foldable},samples:{source:n.sample("source"),language:n.sample("language"),pre:n.sample("pre"),numbers:n.sample("numbers"),"numbers.item":n.sample("numbers","item"),title:n.sample("title")}};return v.assign(u,t),u}}}),f("MarkDoc/Titles",function(e,t,n){const i=e("$");return{render:function(e){let t=e.samples.title,n=e.titles.selector,r="";return e.$.find(n).each(function(){let e=i(this),o=e.nextUntil(n);r=r||e.text(),e.wrapInner(t),e.toggleClass("title",o.length>0)}),r}}}),f("MarkDoc",function(e,t,n){const i=e("$"),r=e("@definejs/array"),o=e("@definejs/emitter"),l=t.require("Meta"),c=t.require("Content"),a=t.require("Events"),d=t.require("Titles"),u=t.require("Href"),f=t.require("Code"),m=t.require("Highlight"),h=t.require("Lines"),p=t.require("Image");let g=new Map;function w(e){let t=new o(this),n=l.create(e,{this:this,emitter:t});g.set(this,n),v.assign(this,{id:n.id,$:n.$,data:{}}),this.on("process",function(e){return e=(e=(e=e.split("<li>[ ] ").join('<li class="todo-list-item"> <i class="far fa-square"></i>')).split("<li>[#] ").join('<li class="todo-list-item"> <i class="fas fa-check-square"></i>')).split("<li>[x] ").join('<li class="todo-list-item"> <i class="fas fa-check-square"></i>')})}return w.prototype={constructor:w,$:null,data:{},render:function(e){let t=g.get(this),n=t.current,r=!!e.language,o=c.get(t,{language:e.language,content:e.content,process:function(e){let n=t.emitter.fire("process",[e]);return n.length>0?n[0]:e}});e.code&&v.assign(t.code,e.code),e.titles&&v.assign(t.titles,e.titles),t.$.html(o),t.$.addClass("MarkDoc"),t.$.toggleClass("SourceMode",r),t.outline.visible=!0,t.bind||a.bind(t),p.format(t.$,e.imgUrl),f.each(t.$,function(e,n){let r=e.element,o=e.language,l=t.code;l.format&&f.format(r);let c=r.innerText,a=h.getHeight(c);f.wrap(t,{element:r,height:a,language:l.language?f.language(t,o):"",numbers:l.numbers?h.getNumbers(t,c):""}),c=m.highlight(o,c),i(r).addClass("hljs").html(c)});let l=d.render(t);r||u.format(t,e.baseUrl),n.code=t.$.find("pre>code"),n.html=n.code.html(),n.ul=t.$.find("ul"),t.emitter.fire("render",[{title:l}])},show:function(){let e=g.get(this);e.$.show(...arguments),e.emitter.fire("show")},hide:function(){let e=g.get(this);e.$.hide(...arguments),e.emitter.fire("hide")},outline:function(){let e=g.get(this),t=e.$.find(">*:not("+e.titles.selector+")"),n=e.outline.visible?"hide":"show";t.animate({height:n,opacity:n},"fast"),e.outline.visible=!e.outline.visible},empty:function(e){let t=g.get(this).current,n=t.code,i=t.ul,o=t.html;if(e){let e=h.getHeight(o);return n.parent().height(e),i.find("li").show(),void n.html(o)}let l=(o=n.html()).split(/\r\n|\n|\r/);o=(l=r.map(l,function(e){return e.length>0?e:null})).join("\r\n"),n.html(o);let c=h.getHeight(o);n.parent().height(c);let a=l.length-1;i.find("li").show(),i.find("li:gt("+a+")").hide()},on:function(){g.get(this).emitter.on(...arguments)},toOutline:function(e){let t=g.get(this),n=t.$.find(t.titles.selector).get(e);if(!n)return;let r=i(n);n.scrollIntoViewIfNeeded?n.scrollIntoViewIfNeeded():n.scrollIntoView();r.addClass("on"),s(function(){r.removeClass("on"),s(function(){r.addClass("on"),s(function(){r.removeClass("on")},200)},200)},200)},getOutlines:function(){let e=g.get(this),t=e.$.find(e.titles.selector).toArray();return t=t.map(function(e){return{level:+e.nodeName.slice(1),text:e.innerText}})}},w}),f.panel("MenuNav/Panel/Icon",function(e,t,n){const i=e("@definejs/panel"),r=e("File");return{create(e){let t=new i(`[data-panel="${e.id}/Icon"]`);return t.on("init",function(){}),t.on("render",function(e){let n=e;e&&"object"==typeof e&&(n=(e=r.getIcon(e)).html),t.$.html(n)}),t.wrap({})}}}),f.panel("MenuNav/Panel/List",function(e,t,n){const i=e("@definejs/panel");return{create(e){let t=new i(`[data-panel="${e.id}/List"]`);return t.on("init",function(){t.$on("click",{"[data-index]":function(e){let n=+this.dataset.index;t.fire("item",[n]),e.stopPropagation()}}),t.$.on("click",function(e){t.fire("text",[])})}),t.on("render",function(n){let i=e.tpl.fill("item",n);t.$.html(i)}),t.wrap({})}}}),f.panel("MenuNav/Panel/Text",function(e,t,n){const i=e("@definejs/panel");return{create(e){let t=new i(`[data-panel="${e.id}/Text"]`),n=null,r={path:""};return t.set("show",!1),t.on("init",function(){n=t.$.find("input").get(0),t.$bind("input",{blur:function(e){t.fire("blur")},click:function(e){let t=n.value.length;n.selectionEnd-n.selectionStart==t&&(n.selectionStart=t,n.selectionEnd=t)},change:function(e){let i=n.value;i!=r.path&&(n.value=r.path,r.path=i,t.fire("change",[i]))},keyup:function(e){13==e.keyCode&&n.blur()}})}),t.on("render",function(e){r.path=n.value=e}),t.on("show",function(){n.focus(),n.select()}),t.wrap({})}}}),f("MenuNav/Meta",function(e,t,n){let i=new(e("@definejs/id-maker"))(t.parent.id);return{create:function(e,t){let n={id:i.next(),container:e.container,this:null,emitter:null,tpl:null,panel:null};return v.assign(n,t),n}}}),f("MenuNav/Panel",function(e,t,n){const i=e("@definejs/panel"),r=t.require("Icon"),o=t.require("List"),l=t.require("Text");return{create(e){const t=r.create(e),n=o.create(e),c=l.create(e);let a=new i(`[data-panel="${e.id}"]`),s={names:[],path:""};return a.on("init",function(){n.on({item:function(e){let t=s.names.slice(0,e+1);a.fire("item",[t,e])},text:function(){"string"==typeof s.path&&(n.hide(),c.show())}}),c.on({blur:function(){n.show(),c.hide()},change:function(e){a.fire("text",[e]).includes(!1)&&c.render(s.path)}})}),a.on("render",function(e){let{names:i,path:r,icon:o}=e;s.names=i,s.path=r,t.render(o),n.render(i),"string"==typeof r&&c.render(r),a.$.toggleClass("no-icon",!o),a.fire("render",[e])}),a.wrap({})}}}),f("MenuNav/Template",function(e,t,n){const i=e("@definejs/template");return{create:function(e){let t=new i("#tpl-MenuNav");return t.process({"":function(){return{id:e.id}},item:function(e,t){return{index:t,name:e}}}),t}}}),f("MenuNav.defaults",{}),f("MenuNav",function(e,t,n){const i=e("@definejs/emitter"),r=e("$"),o=t.require("Panel"),l=t.require("Meta"),c=t.require("Template"),a=e("MenuNav.defaults"),s=new Map;return class{constructor(e){e=v.assign({},a,e);let t=new i(this),n=l.create(e,{this:this,emitter:t});s.set(this,n),v.assign(this,{id:n.id,$:n.$})}init(){let e=s.get(this);if(!e.panel){if(e.tpl=c.create(e),e.container){let t=this.fill();r(e.container).html(t)}e.panel=o.create(e),this.$=e.panel.$,e.panel.on({item:function(t,n){e.emitter.fire("item",[t,n])},text:function(t){return e.emitter.fire("text",[t]).slice(-1)[0]},render:function(t){e.emitter.fire("render",[t])}})}}fill(){return s.get(this).tpl.fill({})}render(e){let t=s.get(this);this.init(),t.panel.render(e)}on(...e){s.get(this).emitter.on(...e)}}}),f("MenuTree/Data",function(e,t,n){let i=new(e("@definejs/id-maker"))(t.parent.id);return n={make(e,t){let r={},o={},l=[],c={list:e=function e(t,r,o,l){return t?t=t.map(t=>{let c=t.id;"string"!=typeof c&&"string"!=typeof(c=JSON.stringify(c))&&(c=i.next("item")),o.cid++;let a={id:c,cid:o.cid,level:0,name:t.name,open:t.open,dirIcon:t.dirIcon,fileIcon:t.fileIcon,data:t.data,list:[],parent:r||null,parents:[],children:[]};return a.list=e(t.list,a,o,l),n.trace(a,function(e){e.children.push(a),a.parents.push(e)}),a.level=a.parents.length,a.children.sort((e,t)=>e.cid-t.cid),l(a),a}):[]}(e,null,{cid:0},function(e){r[e.id]=e,o[e.cid]=e,l.push(e)}),items:l,id$item:r,cid$item:o};return t&&v.assign(t,c),c},trace(e,t){let i=e.parent;i&&(t(i),n.trace(i,t))}}}),f("MenuTree/Events",function(e,t,n){const i=e("$");function r(e,t,n){let i=n.find('> div > i[data-cmd="icon-dir"]'),r=n.children("ul"),o=t.open=!t.open,l=o?"open":"close",c=t.dirIcon||e.dirIcon;o?(i.removeClass(c.close),i.addClass(c.open),r.slideDown("fast")):(i.removeClass(c.open),i.addClass(c.close),r.slideUp("fast")),n.toggleClass("open",o),e.emitter.fire(l,[t])}return{bind:function(e){e.$.on("click",'[data-cmd="item"]',function(t){let n=this.parentNode,{id:o}=n.dataset,l=e.id$item[o],c=i(n),{current:a}=e;c.children("ul");a&&e.$.find(`[data-id="${a.id}"]`).removeClass("on"),c.addClass("on"),e.current=l,l.list.length>0?l===a?r(e,l,c):(l.open||r(e,l,c),e.emitter.fire("item",[l])):e.emitter.fire("item",[l]),this.scrollIntoViewIfNeeded()}),e.$.on("click",'[data-cmd="icon-dir"]',function(t){t.stopPropagation();let n=this.parentNode.parentNode,{id:o}=n.dataset,l=e.id$item[o],c=i(n);r(e,l,c)})}}}),f("MenuTree/Meta",function(e,t,n){let i=new(e("@definejs/id-maker"))(t.parent.id);return{create:function(e,t){let n={id:i.next(),container:e.container,dirIcon:e.dirIcon,fileIcon:e.fileIcon,$:null,this:null,emitter:null,tpl:null,list:[],items:[],id$item:{},cid$item:{},current:null};return v.assign(n,t),n}}}),f("MenuTree/Template",function(e,t,n){const i=e("@definejs/template");return{create:function(e){let t=new i("#tpl-MenuTree");function n(e,n){let i=e.list.length>0?"dir":"file";return t.fill("root",i,e)}function r(t){let n=e.emitter.fire("fill","name",[t]).slice(-1)[0];return n===M&&(n=t.name),n}return t.process({"":function(){let t=this.fill("root",e.list);return{id:e.id,roots:t}},root:{"":function(e,t){return{root:n(e)}},dir:function(t){let{open:i,id:o}=t,l=t.list.map(n),c=e.current,a=t.dirIcon||e.dirIcon;return"string"==typeof a&&(a={close:a,open:a}),{id:o,name:r(t)||"",open:i?"open":"",on:c&&o==c.id?"on":"",display:i?"display: block;":"display: none;",icon:i?a.open:a.close,items:l}},file:function(t,n){let{id:i,fileIcon:o}=t,{current:l}=e;return{id:i,name:r(t),icon:o||e.fileIcon,on:l&&i==l.id?"on":""}}}}),t}}}),f("MenuTree.defaults",{container:null,dirIcon:{close:"fa fa-folder",open:"fa fa-folder-open"},fileIcon:"fas fa-file-alt"}),f("MenuTree",function(e,t,n){const i=e("@definejs/emitter"),r=e("$"),o=t.require("Data"),l=t.require("Events"),c=t.require("Meta"),a=t.require("Template"),s=e("MenuTree.defaults"),d=new Map;return class{constructor(e){e=v.assign({},s,e);let t=new i(this),n=c.create(e,{this:this,emitter:t});d.set(this,n),v.assign(this,{id:n.id,$:n.$})}render(e=[]){let t=d.get(this);if(t.$)e.length>0&&this.update(e);else{if(t.tpl=a.create(t),t.container&&e.length>0){let n=this.fill(e);r(t.container).html(n)}t.$=this.$=r(`#${t.id}`),l.bind(t)}}fill(e){let t=d.get(this);return o.make(e,t),t.tpl.fill({})}update(e){let t=d.get(this);o.make(e,t);let n=t.tpl.fill("root",t.list);t.$.html(n)}open(e){let t=d.get(this),n=null;if("string"==typeof e){if(!(n=t.id$item[e]))throw new g(`不存在 id 为 '${e}' 的节点`)}else{if("number"!=typeof e)throw new g("无法识别的参数 id。");if(!(n=t.cid$item[e]))throw new g(`不存在 cid 为 '${e}' 的节点`)}n.open=!0,o.trace(n,function(e){e.open=!0}),this.render(t.list),n.list.length>0&&(n.open=!1),(n.$=n.$||t.$.find(`li[data-id="${n.id}"]`)).find('>[data-cmd="item"]').trigger("click")}on(...e){d.get(this).emitter.on(...e)}}}),f("Outline/Events",function(e,t,n){const i=e("$");return{bind:function(e){e.$.on("click","li[data-index]",function(t){let n=+this.getAttribute("data-index"),i=e.list[n];e.emitter.fire("item",[i,n])}),e.$.on("click","i[data-index]",function(t){let n=e.list,r=+this.getAttribute("data-index"),o=n[r];if(0==(o.children||[]).length)return;let l=i(this),a=l.hasClass("closed"),s=r+1,d=n.slice(s).findIndex(function(e,t){return e.level<=o.level});d=d<0?n.length:d+s,c.log(s,d),l.toggleClass("opened",a),l.toggleClass("closed",!a),l.attr({title:a?"点击收起子级":"点击展开子级"}),t.stopPropagation(),n.slice(s,d).forEach(function(t,n){n+=s;let i=e.$.find(`li[data-index="${n}"]`),r="closed-count",o=i.data(r)||0;a?--o<=0&&(o=0,i.slideDown("fast")):(o++,i.slideUp("fast")),i.data(r,o)})})}}}),f("Outline/Meta",function(e,t,n){const i=e("@definejs/string");return{create:function(e,t){let n={id:i.random(),container:e.container,this:null,emitter:null,$:null,tpl:null,list:null};return v.assign(n,t),n}}}),f("Outline/Template",function(e,t,n){const i=e("@definejs/template"),r=e("@definejs/string");return{create:function(){let e=new i("#tpl-Outline");return e.process({"":function(e){let t=e.list;return{items:this.fill("item",t)}},item:{"":function(e,t){let n=e.level,i=n-1,o=e.children||[];return i=(i=r.random(i).split("")).map(function(){return{}}),{index:t,level:n,tabs:i=this.fill("tab",i),text:e.text,opened:o.length>0?"opened":"","folder-title":o.length>0?"点击收起子级":""}},tab:function(e,t){return{}}}}),e}}}),f("Outline",function(e,t,n){const i=e("$"),r=e("@definejs/emitter"),o=t.require("Meta"),l=t.require("Events"),c=t.require("Template");let a=new Map;function s(e){let t=new r(this),n=c.create(),i=o.create(e,{this:this,emitter:t,tpl:n});a.set(this,i),v.assign(this,{id:i.id,$:i.$,data:{}})}return s.prototype={constructor:s,$:null,data:{},render:function(e){let t=a.get(this);t.$=i(t.container),(e=e||t.list)&&this.fill(e),t.$.show(),l.bind(t)},fill:function(e){e.forEach(function(t,n){t.parent=null;let i=t.level;if(1!=i)for(let r=n-1;r>=0;r--){let n=e[r];if(i>n.level)return t.parent=n,n.children=n.children||[],void n.children.push(t)}});let t=a.get(this),n=t.tpl.fill({list:e});return t.list=e,t.$&&t.$.html(n),n},show:function(){let e=a.get(this);e.$.show(...arguments),e.emitter.fire("show")},hide:function(){let e=a.get(this);e.$.hide(...arguments),e.emitter.fire("hide")},on:function(){a.get(this).emitter.on(...arguments)}},s}),f("Pager/Events",function(e,t){return{bind:function(e){let t=e.txtId,n=e.sizerId,r=e.this;function o(){let e=+i.getElementById(t).value;r.to(e)}e.$.on("click","[data-no]",function(){if($(this).hasClass("active"))return;let e=+this.getAttribute("data-no");r.to(e)}),e.$.on("click",'[data-button="to"]',function(){o()}),e.$.on("click",'[data-button="previous"]',function(){r.previous()}),e.$.on("click",'[data-button="next"]',function(){r.next()}),e.$.on("change","#"+n,function(){let t=this.selectedIndex,n=e.sizes[t];r.render({size:n,no:1}),r.to(1)}),e.$.on("keydown","#"+t,function(e){let t=e.keyCode;c.log(t),13!=t?48<=t&&t<=57||96<=t&&t<=105||(8==t||37==t||39==t||46==t)||112<=t&&t<=123||e.preventDefault():o()})}}}),f("Pager/JumpNo",function(e,t){return{get:function(e,t,n){return e<=1?e:t==e?e-1:(t>n?i=t+1:(i=t-1)<1&&(i=2),i);var i}}}),f("Pager/Regions",function(e,t){return{get:function(e,t){return e<=10?[{from:1,to:e,more:!1}]:t<=3?[{from:1,to:5,more:!0}]:t<=5?[{from:1,to:t+2,more:!0}]:t>=e-1?[{from:1,to:2,more:!0},{from:e-5,to:e,more:!1}]:[{from:1,to:2,more:!0},{from:t-2,to:t+2,more:t+2!=e}]}}}),f("Pager/Sizes",function(e,t){return{get:function(e,t){return e=[t=t||e[0],...e],(e=[...new Set(e)]).sort(function(e,t){return e>t?1:-1}),e}}}),f("Pager/Template",function(e,t){const n=e("@definejs/template"),i=e("@definejs/array");let r=new n("#tpl-Pager");return r.process({"":function(e){let t=e.no,n=e.count;return{regions:this.fill("region",e.regions,t),sizes:this.fill("size",e.sizes,e.size),count:e.count,total:e.total,ulId:e.ulId,txtId:e.txtId,sizerId:e.sizerId,toNo:e.toNo,"first-disabled-class":t==b.min(1,n)?"disabled":"","final-disabled-class":t==n?"disabled":"","jump-disabled-class":0==n?"disabled":""}},region:{"":function(e,t,n){let r=e.from,o=e.to,l=i.pad(r,o+1);l=this.fill("item",l,n);let c=e.more||"";return c&&(c=this.fill("more",{})),l+c},item:function(e,t,n){return{no:e,active:e==n?"active":""}},more:function(e){return e}},size:function(e,t,n){return this.fix("selected"),{value:e,selected:e==n?'selected="selected"':""}}}),r}),f("Pager.defaults",{container:"",total:0,current:1,size:20,min:0,sizes:[10,20,30,40,50]}),f("Pager",function(e,t){const n=e("$"),i=e("@definejs/emitter"),r=e("@definejs/string"),o=t.require("Events"),l=t.require("JumpNo"),c=t.require("Regions"),a=t.require("Sizes"),s=e("Pager.defaults");let d=new Map;function u(e){e=v.assign({},s,e);let t=r.random(),n=new i(this),o=e.size,l=a.get(e.sizes,o),c={id:t,txtId:r.random(),ulId:r.random(),sizerId:r.random(),$:null,ctn:e.container,no:e.no||1,size:o,total:e.total||0,min:e.min||0,count:0,last:0,sizes:l,emitter:n,this:this};d.set(this,c),v.assign(this,{id:t,meta:c,$:c.$})}return u.prototype={constructor:u,id:"",$:null,render:function(e){e=e||{};let i=d.get(this),r="number"==typeof e.total?e.total:i.total,a="number"==typeof e.size?e.size:i.size,s="number"==typeof e.min?e.min:i.min,u="number"==typeof e.no?e.no:i.no,f=b.ceil(r/a),m=!!i.$;if(0==f)return void(i.$&&i.$.hide());if(u<1||u>f)return i.emitter.fire("error",["输入的页码值只能从 1 到 "+f]),!1;if(i.$=this.$=n(i.ctn),i.count=f,i.no=u,i.total=r,i.size=a,i.min=s,m||o.bind(i),f<s)return void i.$.hide();let h=t.require("Template"),p=c.get(f,u),g=l.get(f,u,i.last),w=h.fill({regions:p,no:u,count:f,total:r,toNo:g,txtId:i.txtId,sizerId:i.sizerId,sizes:i.sizes,size:i.size});i.$.html(w).show()},to:function(e){let t=d.get(this),n=t.emitter,i=/^\d+$/.test(e);i?(e=parseInt(e),!1!==(i=this.render({no:e}))&&(t.last=t.no,t.no=e,n.fire("change",[e,t.size]))):n.fire("error",["输入的页码必须是数字"])},previous:function(){let e=d.get(this).no-1;e<1||this.to(e)},next:function(){let e=d.get(this),t=e.no+1;t>e.count||this.to(t)},first:function(){this.to(1)},final:function(){let e=d.get(this).count;this.to(e)},refresh:function(){let e=d.get(this).no;this.to(e)},on:function(){let e=d.get(this).emitter,t=m.from(arguments);e.on(t)},destroy:function(){let e=d.get(this);e.emitter.off(),e.$&&e.$.html("").undelegate(),d.delete(this)}},u}),f("Settings.Header",function(e,t,n){const i=e("@definejs/local-storage"),r=e("@definejs/emitter");let o=new i(t.id),l=new r,a={value:o.get("value")||t.data||"hide"};return{on:l.on.bind(l),get:()=>a.value,set(e){let n=a.value;e!=n&&(e?(o.set("value",e),a.value=e):e=n,l.fire("change",[e,n]),c.log(t.id,"set",e))}}}),f("Settings.Language",function(e,t,n){const i=e("@definejs/local-storage"),r=e("@definejs/emitter");let o=new i(t.id),l=new r,a={value:o.get("value")||t.data||"chinese"};return{on:l.on.bind(l),get:()=>a.value,set(e){let n=a.value;e!=n&&(e?(o.set("value",e),a.value=e):e=n,l.fire("change",[e,n]),c.log(t.id,"set",e))}}}),f("Settings.Theme",function(e,t,n){const r=e("@definejs/local-storage"),o=e("@definejs/emitter");let l=new r(t.id),c=new o,a={value:l.get("value")||t.data||"light"};return{on:c.on.bind(c),get:()=>a.value,set(e){let t=a.value;if(e==t)return;e?(l.set("value",e),a.value=e):e=t;let n=i.body;[...n.classList].forEach(e=>{e.startsWith("theme-")&&n.classList.remove(e)}),n.classList.add(`theme-${e}`),c.fire("change",[e,t])}}}),f("SidebarTree/Panel/Resizer/Masker",function(e,t,n){const i=e("@definejs/masker");let r=null;return{show(){(r=r||new i({opacity:0})).show()},hide(){r&&r.hide()}}}),f("SidebarTree/Panel/Header",function(e,t,n){const i=e("@definejs/panel"),r=e("CheckBox");return{create(e){let t=new i(`[data-panel="${e.id}/Header"]`),n=null,o={dirOnly:!1};return t.set("show",!1),t.on("init",function(){(n=new r({fireNow:!0,container:t.$.find('[data-cmd="dirOnly"]'),text:"仅目录"})).on("checked",function(e){o.dirOnly=e,t.fire("dir-only",[e])}),t.$on("click",{"[data-cmd]":function(e){let{cmd:n}=this.dataset;t.fire(n)}})}),t.on("render",function(e){e=e||{},t.$.toggleClass("back",!!e.back),t.$.toggleClass("forward",!!e.forward),t.$.toggleClass("up",!!e.up),t.$.toggleClass("root",!!e.root),t.$.toggleClass("dir-only",!!e.dirOnly),n.render({checked:o.dirOnly})}),t.wrap({})}}}),f("SidebarTree/Panel/Main",function(e,t,n){const i=e("@definejs/panel"),r=e("MenuTree");return{create(e){let t=new i(`[data-panel="${e.id}/Main"]`),n=null,o={item:null,index:-1,list:[]};return t.on("init",function(){let i={container:t.$},{fileIcon:l,dirIcon:c}=e;l&&(i.fileIcon=l),c&&(i.dirIcon=c),(n=new r(i)).on({item:function(e){let i=e.id;"/"!=i&&i.endsWith("/")?n.open(e.parent.id):function(e){e!==o.item&&(o.index++,o.list[o.index]=e,o.item=e,t.fire("item",[e,{back:o.index>0,forward:o.index<o.list.length-1,up:!(!e||!e.parent),root:!!e.parent,dirOnly:e.list.length>0}]),t.fire(e.data.type,[e]))}(e)},fill:{name:function(e){return t.fire("fill","name",[e]).slice(-1)[0]}}})}),t.on("render",function(e){o.item=null,o.list=[],o.index=-1,n.render(e)}),t.wrap({open:function(e){n.open(e)},back:function(){let e=o.index-1,t=o.list[e];t&&(o.index=e-1,this.open(t.id))},forward:function(){let e=o.index+1,t=o.list[e];t&&this.open(t.id)},up:function(){let e=o.item,t=e?e.parent:null;t&&this.open(t.id)},root:function(){this.open(1)},dirOnly:function(e){t.$.toggleClass("dir-only",!!e)}})}}}),f("SidebarTree/Panel/Resizer",function(e,t,n){const r=e("@definejs/panel"),o=t.require("Masker");return{create(e){let t=new r(`[data-panel="${e.id}/Resizer"]`);return t.set("show",!1),t.on("init",function(){let e=!1,n=0,r="",l=i.body,c=t.$.get(0);$(l).on({mousedown:function(i){i.target===c&&(e=!0,n=i.pageX,r=l.style.cursor,l.style.cursor="ew-resize",o.show(),t.fire("start"))},mousemove:function(i){if(!e)return;let r=i.pageX-n;t.fire("change",[r])},mouseup:function(n){e&&(e=!1,l.style.cursor=r,o.hide(),t.fire("stop"))}})}),t.on("render",function(e){}),t.wrap()}}}),f("SidebarTree/Meta",function(e,t,n){let i=new(e("@definejs/id-maker"))(t.parent.id);return{create:function(e,t){let n={id:i.next(),container:e.container,width:e.width,minWidth:e.minWidth,fileIcon:e.fileIcon,dirIcon:e.dirIcon,header:e.header,resizer:e.resizer,this:null,emitter:null,tpl:null,panel:null};return v.assign(n,t),n}}}),f("SidebarTree/Panel",function(e,t,n){const i=e("@definejs/panel"),r=t.require("Header"),o=t.require("Main"),l=t.require("Resizer");return{create(e){const t=r.create(e),n=o.create(e),c=l.create(e);let a=new i(`[data-panel="${e.id}"]`);return a.on("init",function(){n.on({item:function(e,n){a.fire("item",[e]),t.render(n)},dir:function(e){a.fire("dir",[e])},file:function(e){a.fire("dir",[e])},fill:{name:function(e){return a.fire("fill","name",[e]).slice(-1)[0]}}}),t.on({back:function(){n.back()},forward:function(){n.forward()},up:function(){n.up()},root:function(){n.root()},"dir-only":function(e){n.dirOnly(e)}})}),a.on("init",function(){function t(){return a.$.outerWidth()}function n(e){a.$.outerWidth(e)}let i=t();c.on({change:function(t){let r=i+t;r<e.minWidth?n(e.minWidth):(n(r),a.fire("resize"))},stop:function(){i=t()}})}),a.on("render",function(i){t.render(),n.render(i),c.render(),e.header&&t.show(),e.resizer&&c.show()}),a.wrap({open:function(e){n.open(e)}})}}}),f("SidebarTree/Template",function(e,t,n){const i=e("@definejs/template");return{create:function(e){let t=new i("#tpl-SidebarTree");return t.process({"":function(){return{id:e.id,width:e.width,"header-display":e.header?"":"display: none;","resizer-display":e.resizer?"":"display: none;"}}}),t}}}),f("SidebarTree.defaults",{container:null,width:300,minWidth:220,fileIcon:"",dirIcon:null,header:!0,resizer:!0}),f("SidebarTree",function(e,t,n){const i=e("@definejs/emitter"),r=e("$"),o=t.require("Panel"),l=t.require("Meta"),c=t.require("Template"),a=e("SidebarTree.defaults"),s=new Map;return class{constructor(e){e=v.assign({},a,e);let t=new i(this),n=l.create(e,{this:this,emitter:t});s.set(this,n),v.assign(this,{id:n.id,$:n.$})}init(){let e=s.get(this);if(!e.panel){if(e.tpl=c.create(e),e.container){let t=this.fill();r(e.container).html(t)}e.panel=o.create(e),this.$=e.panel.$,e.panel.on({item:function(t){e.emitter.fire("item",[t])},dir:function(t){e.emitter.fire("dir",[t])},resize:function(){e.emitter.fire("resize")},fill:{name:function(t){return e.emitter.fire("fill","name",[t]).slice(-1)[0]}}})}}fill(){return s.get(this).tpl.fill({})}render(e){let t=s.get(this);this.init(),t.panel.render(e)}on(...e){s.get(this).emitter.on(...e)}open(e){s.get(this).panel.open(e)}}}),f("Table/Meta/Column",function(e,t,n){const i=e("@definejs/string");return{create:function(e){let t=i.random(),n={name:e.name,caption:e.caption,index:e.index,field:e.field,table:e.table,id:t,cells:[],data:{},deps:[],infers:[],type:"Table.Column",change:null,sum:function(t){let i=0;return n.cells.map(function(n,r){let o=t?t.call(e.table,n,r):n.value;null!==o&&(i+=o=o||0)}),i}};return n}}}),f("Table/Meta",function(e,t,n){const i=e("@definejs/string"),r=t.require("Column");return{create:function(e,t){let n=e.count||e.details.length,o={},l={},c=e.fields.map(function(n,i){let c=n[e.columnName],a=n[e.captionName],s=r.create({name:c,caption:a,index:i,field:n,table:t.this});return o[c]=s,l[s.id]=s,s}),a={id:i.random(),fields:e.fields,columnName:e.columnName,captionName:e.captionName,details:e.details,container:e.container,width:e.width,class:e.class,order:e.order,attributes:e.attributes,count:n,columns:c,id$column:l,name$column:o,rows:[],id$row:{},id$cell:{},emitter:null,tpl:null,element:null,$:null,$tbody:null,$container:null,this:null};return v.assign(a,t),a}}}),f("Table/Order",function(e,t,n){let i={sample:"{order}",add:!0,index:0};return{normalize:function(e){let t=e.order;if(!t)return e;!0===t&&(t={}),t=v.assign({},i,t);let n=e.fields.slice(0),r={[e.columnName]:"order",caption:"序号"},o=t.index;return t.add?n.splice(o,0,r):n[o]=r,e=v.assign({},e,{order:t,fields:n})}}}),f("Table/Reaction",function(e,t,n){const i=e("@definejs/object");function r(e,t,n,i){let r=e[t];r?(i&&(r.change=i),n&&(r.deps.splice(0),r.deps.push(...n),n.map(function(n){let i=e[n];if(!i)return void c.warn("不存在名为 "+t+" 的列。");let r=i.infers;(r=new Set(r)).add(t),i.infers.splice(0),i.infers.push(...r)}))):c.warn("不存在名为 "+t+" 的列。")}return{set:function(e,t,n){let o=this;if(i.isPlain(e))i.each(e,function(e,t){m.isArray(t)?r(o,e,t,null):"function"!=typeof t?r(o,e,t.deps,t.change):r(o,e,null,t)});else if(i.isPlain(t)){let n=t;r(o,e,n.deps,n.change)}else"function"==typeof t&&(n=t,t=null),r(o,e,t,n)}}}),f("Table/Row",function(e,t,n){const r=e("@definejs/string");return n={create:function(e,t){let n=e.rows,i=r.random(),o=n.length,l=v.assign({},t),a={},s=e.id$row[i]={id:i,index:o,type:"Table.Row",cells:null,table:e.this,element:null,data:l,name$cell:a,value:null,title:"",class:"",attributes:{index:o}};return s.valueOf=function(e){return a[e].value},s.cells=e.fields.map(function(t,n){let i=r.random(),o=e.columns[n],l=e.order.index==n,d=t[e.columnName],u=t[e.captionName],f=e.id$cell[i]={id:i,name:d,caption:u,type:"Table.Cell",row:s,field:t,index:n,isOrder:l,column:o,table:e.this,ctrl:null,element:null,value:null,data:{},deps:o.deps,infers:o.infers,title:"",html:"",class:t.class||"",attributes:{index:n,name:d}};return f.change=function(t,n){(n=n||[]).push(f),f.value=t,c.log(n),f.infers.map(function(t){let i=e.name$column[t],r=a[t],o=i.change;if(n.includes(r)||!o)return;let l=o.apply(r,[f,n]);l!==M&&(r.value=l)}),e.emitter.fire("change",f.name,[f]),e.emitter.fire("change",[f])},o.cells.push(f),a[d]=f,f}),n.push(s),s},add:function(e,t){let r=e.rows.length,o=n.create(e,t),l=e.tpl.fill("tr",o,r);return e.$tbody.append(l),o.element=i.getElementById(o.id),o.cells.map(function(e){e.element=i.getElementById(e.id)}),o},remove:function(e,t){let n=e.rows,i=n[t];n.splice(t,1),delete e.id$row[i.id],i.cells.map(function(t){let n=t.ctrl;n&&n.destroy(),delete e.id$cell[t.id],t.ctrl=null,t.element=null}),e.columns.map(function(e,n){e.cells.splice(t,1)});let r=i.element;return r&&r.parentNode.removeChild(r),i.element=null,n.slice(t).map(function(n,i){if(i=n.index=i+t,"index"in n.attributes&&(n.element.setAttribute("data-index",i),n.attributes.index=i),e.order){let t=e.tpl;n.cells.map(function(e){if(!e.isOrder)return;let n=t.fill("tr","td",e,0,i);e.element.innerHTML=n})}}),i},move:function(e,t,n){let i=e.rows,r=t+n;if(0==n||r<0||r>i.length-1)return;let o=i[t],l=i[r],c=o.element.parentNode;i.splice(t,1),i.splice(r,0,o),n>0?c.insertBefore(l.element,o.element):c.insertBefore(o.element,l.element),i.map(function(t,n){t.index!=n&&(t.index=n,"index"in t.attributes&&(t.element.setAttribute("data-index",n),t.attributes.index=n),e.order&&t.cells.map(function(t){if(!t.isOrder)return;let i=e.tpl.fill("tr","td",t,0,n);t.element.innerHTML=i}))}),e.emitter.fire("move",[o,n])}}}),f("Table/Static",function(e,t,n){const i=e("@definejs/object");return n={eachCell:function(e,t){m.isArray(e)||(e=[e]);let n=[];e.map(function(e){switch(e.type){case"Table.Cell":n.push(e);break;case"Table.Column":case"Table.Row":n=n.concat(e.cells);break;default:throw new g("无法识别的 type 值: "+type)}}),n.map(t)},column:function(e,t,i){let r=[];if(m.isArray(e)){e.map(function(e){if(!n.isRow(e))return;let i=e.name$cell[t];i&&r.push(i)})}else if(n.isRow(e)){let n=e.name$cell[t];n&&r.push(n)}else{let n=e.get("name$column")[t];n&&(r=n.cells||[])}r.map(function(e,t){i(e,t)})},isCell:function(e){return i.isPlain(e)&&"Table.Cell"==e.type},isRow:function(e){return i.isPlain(e)&&"Table.Row"==e.type},isColumn:function(e){return i.isPlain(e)&&"Table.Column"==e.type}}}),f("Table/Template",function(e,t){const n=e("@definejs/template"),i=e("@definejs/string");function r(e){return e?(e=v.entries(e).map(function(e){return"data-"+e[0]+'="'+e[1]+'"'})).join(" "):""}function o(e){let t=e.title;return t===M||""===t?"":'title="'+t+'"'}function l(e){let t=e.class;return m.isArray(t)&&(t=t.join(" ")),t?'class="'+t+'"':""}return{create:function(e){let t=new n("#tpl-Table"),c=e.emitter;return t.process({"":function(){this.fix("attributes");let t=e.width||"";t&&(t="width: "+t+"px;");let n=this.fill("tr",e.rows),i=r(e.attributes),o=e.class||"";return{id:e.id,class:o+" Table",width:t,rows:n,attributes:i}},tr:{"":function(e,t){this.fix(["class","attributes","title"]),c.fire("process","row",[e,t]);let n=r(e.attributes),i=this.fill("td",e.cells,t),a=o(e),s=l(e);return{id:e.id,class:s,attributes:n,title:a,cells:i}},td:{"":function(t,n,a){this.fix(["class","attributes","title"]);let s="";if(t.isOrder)s=i.format(e.order.sample,{index:n,no:a,order:a+1});else{let e=c.fire("process","cell",t.name,[t,n]);(s=e.slice(-1)[0])===M&&(s=(e=c.fire("process","cell",[t,n])).slice(-1)[0]);let i=typeof s;"number"!=i&&"boolean"!=i||(s=x(s))}let d=!1===t.field.visible?"display: none;":"",u=r(t.attributes),f=o(t),m=l(t);return{id:t.id,cid:t.column.id,html:s||"",class:m,attributes:u,display:d,title:f}}}}}),t}}}),f("Table.defaults",{$:null,fields:[],width:0,widths:[],class:"",process:{},order:!1,details:[],columnName:"fieldName",captionName:"caption"}),f("Table",function(e,t,n){const r=e("$"),o=e("@definejs/emitter"),l=e("@definejs/object"),a=t.require("Reaction"),s=t.require("Static"),d=t.require("Template"),u=t.require("Row"),f=t.require("Order"),h=t.require("Meta"),p=e("Table.defaults");let w=new Map;function $(e){e=v.assign({},p,e),e=f.normalize(e);let t=new o(this),n=h.create(e,{emitter:t,this:this});n.tpl=d.create(n),w.set(this,n),v.assign(this,{id:n.id,meta:n});for(let e=0;e<n.count;e++)this.new(n.details[e]);let i=e.reaction;i&&this.reaction(i),this.on("process","cell",function(e){return(e.row.data||{})[e.name]})}return $.prototype={constructor:$,id:"",$:null,render:function(){let e=w.get(this),t=e.rows,n=e.tpl.fill({});if(e.$container=r(e.container),!e.$container.length)throw new g("不存在容器节点: "+e.container);return e.$container.html(n),e.rows.map(function(e){e.element=i.getElementById(e.id),e.cells.map(function(e){e.element=i.getElementById(e.id)})}),e.element=i.getElementById(e.id),e.$=this.$=r(e.element),e.$tbody=e.$.find(">tbody"),e.fields.forEach(function(t,n){let i=t.delegate;i&&(m.isArray(i)?i:[i]).forEach(function(n){let i='>tr>td[data-name="'+t[e.columnName]+'"] '+n;e.$tbody.on("click",i,function(t){let i=r(this).parents().toArray(),o=i.length;for(let r=0;r<o;r++){let o=i[r].id,l=e.id$cell[o];if(l){e.emitter.fire("click","cell",l.name,n,[l,t,this]);break}}})})}),e.$tbody.on("click",">tr>td",function(t){let n=e.id$cell[this.id];e.emitter.fire("click","cell",n.name,[n,t]),e.emitter.fire("click","cell",[n,t])}),e.$tbody.on("click",">tr",function(t){let n=e.id$row[this.id];e.emitter.fire("click","row",[n,t])}),e.$tbody.on("click",function(t){e.emitter.fire("click",[t])}),e.emitter.fire("render",[t]),n},new:function(e){let t=w.get(this),n=u.create(t,e);return t.emitter.fire("new",[n,e]),n},add:function(e){let t=w.get(this);if(m.isArray(e)){let n=e.map(function(e){return u.add(t,e)});return t.emitter.fire("add",[n]),n}let n=u.add(t,e);return t.emitter.fire("add",[n]),n},remove:function(e){let t=w.get(this);"number"!=typeof e&&(e=t.rows.length-1);let n=u.remove(t,e);t.emitter.fire("remove",[n,e])},move:function(e,t){let n=w.get(this),i=typeof e,r="number"==i?n.rows[e]:"string"==i?n.id$row[e]:"object"==i?n.id$row[e.id]:null;if(!r)throw new g("传入的参数 item 不属性当前 table 的表格行。");u.move(n,r.index,t)},fill:function(e){this.clear();let t=w.get(this),n=e.map(function(e){return this.new(e)},this),r=t.tpl.fill("tr",n);t.$tbody.html(r),n.map(function(e){e.element=i.getElementById(e.id),e.cells.map(function(e){e.element=i.getElementById(e.id)})}),t.emitter.fire("fill",[e])},clear:function(){let e=w.get(this);e.rows.map(function(e){e.cells.map(function(e){let t=e.ctrl;t&&t.destroy&&t.destroy()})}),e.columns.map(function(e){e.cells.splice(0)}),e.id$row={},e.id$cell={},e.rows.splice(0),e.$tbody.html(""),e.emitter.fire("clear")},get:function(e){let t=w.get(this),n=t.rows;if(0==arguments.length)return n;if("number"==typeof e)return n[e];switch(e){case"id$row":case"id$cell":case"id$column":case"name$column":case"rows":case"columns":case"element":case"details":return t[e];case"length":return n.length}return"string"==typeof e?t.id$cell[e]||t.id$row[e]||t.id$column[e]:void 0},set:function(e,t){let n=w.get(this);switch(e){case"width":n[e]=t}},column:function(e,t){let n=w.get(this).name$column[e];if(n)return n.cells.map(function(e,n){t&&t(e,n)}),n;c.warn("不存在名为 "+e+" 的列。")},reaction:function(e,t,n){let i=w.get(this);a.set.call(i.name$column,...arguments)},destroy:function(){let e=w.get(this);if(!e)return;let t=e.element;e.tpl.destroy(),e.emitter.destroy(),t.parentNode.removeChild(t),e.$tbody.off(),e.$.off(),l.each(e.id$cell,function(e,t){let n=t.ctrl;n&&n.destroy&&n.destroy()}),w.delete(this)},on:function(){w.get(this).emitter.on(...arguments)}},v.assign($,s),$}),f("TableResizer/Mouse/Masker",function(e){const t=e("@definejs/masker");let n=null;return{show(){(n=n||new t({opacity:0})).show()},hide(){n&&n.hide()}}}),f("TableResizer/Cols",function(e,t){let n=new(e("@definejs/template"))("#tpl-TableResizer");return n.process({colgroup:{"":function(e){return{cols:this.fill("col",e.fields)}},col:function(e,t){return{index:t,width:e.width,display:e.visible?"":"display: none;"}}}}),{fill:function(e,t){let i=n.fill("colgroup",{fields:t});return e.prepend(i),e.find("colgroup>col").toArray()}}}),f("TableResizer/Fields",function(e,t){return{normalize:function(e){return e=e.map(function(e,t){let n=!("visible"in(e=v.assign({},e)))||e.visible;n&&e.width;return e.visible=!!n,e.dragable=!1!==e.dragable,e.width=e.width||0,e})},sum:function(e){let t=0;return e=e.map(function(e,n){e.visible&&(t+=e.width)}),t}}}),f("TableResizer/Meta",function(e,t,n){const i=e("@definejs/string");return{create:function(e,t){let n={id:i.random(),emitter:null,table:null,$:null,this:null,selector:e.table,dragable:e.dragable,rowspan:e.rowspan,minWidth:e.minWidth,indexKey:e.indexKey,cssClass:e.cssClass,fields:null,width:0,cols:[],id$index:{},cell$ids:new Map};return v.assign(n,t),n}}}),f("TableResizer/Mouse",function(e,t,n){const r=e("$"),o=t.require("Masker");let l={},c=!1,a=0,s=0,d=0,u="",f="",m=null,h=i.body;return r(h).on({mousedown:function(e){f=e.target.id;let t=l[f];if(!t)return;let n=t.id$index[f],i=t.fields[n],s=n==t.fields.length-1;c=!0,d=e.pageX,u=h.style.cursor,h.style.cursor="ew-resize",a=i.width,(m=r("#"+f+">b")).addClass("on"),m.toggleClass("last",s),m.html(a+"px"),o.show()},mousemove:function(e){if(!c)return;let t=l[f],n=e.pageX-d,i=a+n;if(i<t.minWidth)return;let r=t.fields,o=t.id$index[f],u=t.cols[o],h=s=t.width+n;u.width=r[o].width=i,t.$.width(h),m.html(i+"px"),t.emitter.fire("change",[{index:o,dx:n,tdWidth:i,width:h,fields:r}])},mouseup:function(){let e=l[f];e&&(e.width=s,f="",c=!1,h.style.cursor=u,o.hide(),m&&m.removeClass("on"))}}),{set:function(e,t){l[e]=t},remove:function(e){delete l[e]}}}),f("TableResizer/Rows",function(e,t){const n=e("@definejs/array");return{get:function(e,t){let i=m.from(e.rows).slice(0,t),r=n.pad(0,t).map(function(){return[]});return i.map(function(e,t){let i=0,o=r[t],l=o.length;l>0&&(i=o.findIndex(function(e){return!e}))<0&&(i=l),m.from(e.cells).map(function(e,l){let c=e.getAttribute("rowspan"),a=e.getAttribute("colspan");c=k(c)||1,a=k(a)||1,n.pad(0,c).map(function(o){let l=r[o+t];n.pad(0,a).map(function(t){l[i+t]=e})}),o[i+=a]&&(i=o.findIndex(function(e){return!e}))<0&&(i=o.length)})}),r}}}),f("TableResizer.defaults",{dragable:!0,rowspan:1,minWidth:20,indexKey:"data-target-index",cssClass:"TableResizer",fields:[]}),f("TableResizer",function(e,t){const n=e("$"),r=e("@definejs/string"),o=e("@definejs/emitter"),l=e("@definejs/template"),c=t.require("Cols"),a=t.require("Mouse"),s=t.require("Rows"),d=t.require("Fields"),u=t.require("Meta"),f=e("TableResizer.defaults");let m=new Map,h=new l("#tpl-TableResizer");function p(e){e=v.assign({},f,e);let t=new o(this),n=d.normalize(e.fields),i=e.width||d.sum(n),r=u.create(e,{emitter:t,this:this,fields:n,width:i});m.set(this,r),v.assign(this,{id:r.id,meta:r})}return p.prototype={constructor:p,id:"",$:null,render:function(){this.destroy(!0);let e=m.get(this);e.$=this.$=n(e.selector),e.$.addClass(e.cssClass);let t=e.table=e.$.get(0),i=s.get(t,e.rowspan);e.dragable&&i.map(function(t){t.map(function(t,i){let o=r.random(),l=t.getAttribute(e.indexKey);if(null!==l){let n=e.cell$ids.get(t)||[],i=n.length;if(n.push(o),e.cell$ids.set(t,n),i!=l)return}let c=e.fields[i],s=h.fill("resizer",{id:o,display:!1===c.dragable?"display: none;":""});n(t).append(s),e.id$index[o]=i,a.set(o,e)})}),e.cols=c.fill(e.$,e.fields),e.$.width(e.width),e.emitter.fire("render",[e.width,e.fields])},set:function(e){let t=e.index,n=e.width,i=e.tdWidth,r=m.get(this);r.fields[t].width=i,r.cols[t].width=i,r.width=n,r.$.width(n)},on:function(){m.get(this).emitter.on(...arguments)},destroy:function(e){let t=m.get(this);if(v.keys(t.id$index).map(function(e){a.remove(e);let t=i.getElementById(e);t&&t.parentNode.removeChild(t)}),!e){let e=t.$.find(">colgroup").get(0);e&&e.parentNode.removeChild(e),t.emitter.destroy(),t.$.removeClass(t.cssClass),m.delete(this)}}},p}),f("TextTree/Events",function(e,t,n){const r=e("$");let o={};return{bind:function(e){let t=`#${e.id} [data-cmd]`;r(i.body).on("click",t,function(t){let{cmd:n,index:i}=t.currentTarget.dataset;if("icon-dir"==n)return;i=k(i);let r=e.items[i];e.emitter.fire("cmd",n,[r]),e.emitter.fire("cmd",[n,r])}),r(i.body).on("click",t,function(t){let{cmd:n,index:i}=t.currentTarget.dataset;if("icon-dir"!=n)return;let l=r(this),a=e.items[i],{id:s}=a,d=l.hasClass("closed"),u=`#${e.id} li[data-id^="${s}${e.seperator}"]`;l.toggleClass("closed",!d),o[s]=!d,c.log(o),r(u).each(function(){let t=r(this);if(!d)return void t.slideUp("fast");let{id:n}=this.dataset;(function(e,t){let n,i;do{n=t[e],i=o[n],e=n}while("string"==typeof n&&!i);return i})(n,e.id$parent)?t.slideUp("fast"):t.slideDown("fast")})})}}}),f("TextTree/Meta",function(e,t,n){const i=e("@definejs/string"),r=e("@definejs/tree");let o=0;return{create:function(e,t){let n={id:`TextTree-${o++}-${i.random(4)}`,seperator:e.seperator,secondaryKey:e.secondaryKey,container:e.container,emptyText:e.emptyText,showSecondary:e.showSecondary,showIcon:e.showIcon,showTab:e.showTab,showColor:e.showColor,showHover:e.showHover,highlightIndex:-1,items:[],id$item:{},id$index:{},id$children:{},id$childs:{},id$parent:{},id$parents:{},id$siblings:{},tree:null,$:null,this:null,emitter:null,tpl:null,makeData:function(e,t){let i=function(e,t){let n={},i={},r={},o={},l={},a={},s={},d=e.map((e,l)=>{let{id:c}=e,a=c.split(t),s=(a.slice(-1)[0],null),d=[];if(n[c]=e,a.length>1){let e=s=a.slice(0,-1).join(t),n=o[e]||[];n.push(c),o[e]=n,d=(d=(d=a.map((e,t)=>a.slice(0,t+1).join("/"))).reverse()).slice(1)}return i[c]=s,r[c]=d,c});d.forEach((e,n)=>{let r=d.filter(n=>n.startsWith(`${e}${t}`));l[e]=r,s[e]=n;let c=i[e];if("string"==typeof c){let t=(o[c]||[]).filter(t=>t!=e);a[e]=[...new Set(t)]}});let u={ids:d,id$item:n,id$children:l,id$childs:o,id$parent:i,id$parents:r,id$siblings:a,id$index:s};return c.log(u),u}(e=e||[],t=t||n.seperator);return v.assign(n,{id$item:i.id$item,id$index:i.id$index,id$children:i.id$children,id$childs:i.id$childs,id$parent:i.id$parent,id$parents:i.id$parents,id$siblings:i.id$siblings}),i},toggleHideClass:function(e,t){n.$&&("boolean"==typeof t?n.$.toggleClass(e,!t):n.$.toggleClass(e))}},{ids:l}=n.makeData(e.list);return n.tree=new r(l,n.seperator),v.assign(n,t),n}}}),f("TextTree/Template",function(e,t,n){const i=e("@definejs/template");return{create:function(e){let t=new i("#tpl-TextTree");function n(e,n){let i=t.fill(e,n);return i=(i=i.trim()).split("\n").join("")}return t.process({"":function(t){let n=this.fill("item",t.list);return{id:t.id,items:n,"hide-tab":e.showTab?"":"hide-tab","hide-icon":e.showIcon?"":"hide-icon","hide-secondary":e.showSecondary?"":"hide-secondary","hide-color":e.showColor?"":"hide-color","hide-hover":e.showHover?"":"hide-hover"}},item:function(t,i){let{tabs:r,key:o,linker:l,id:c}=t,a=(e.id$children[c]||[]).length>0;return o=o||e.emptyText,r=n("tabs",t),o=n("key",{key:o,index:i,id:c,isDir:a}),{id:c,tabs:r,linker:l=n("linker",t),key:o,index:i,type:a?"dir":"file","not-found":e.id$item[c]?"":"not-found"}},tabs:function(e){let{tabs:t}=e,i=0;return{tabs:t=t.split("").map(function(e,t){e=e.trim(),i++,e.length>0&&(i=0);let r="";return(!e&&0==t||4==i)&&(r="grouper",i=0),n("b",{class:r,text:e})})}},key:{"":function(e){let t=this.fill("secondary",e),n=this.fill("icon",e);return{...e,icon:n,secondary:t}},icon:function({isDir:e}){return{type:e?"dir":"file",icon:e?"fas fa-angle-down":"far fa-circle"}},secondary:function(t){let{secondaryKey:n}=e;if(!n)return"";let i=t.index,r=e.id$item[t.id];return r?{secondary:r[n],secondaryKey:n,index:i}:{}}}}),t}}}),f("TextTree.defaults",{seperator:"/",emptyText:"(app)",secondaryKey:"",showSecondary:!1,showIcon:!1,showTab:!1,showColor:!1,showHover:!1}),f("TextTree",function(e,t,n){const i=e("@definejs/emitter"),r=e("@definejs/object"),o=e("$"),l=t.require("Events"),a=t.require("Meta"),s=t.require("Template"),d=e("TextTree.defaults");let u=new Map;return class{constructor(e){e=v.assign({},d,e);let t=new i(this),n=a.create(e,{this:this,emitter:t});n.tpl=s.create(n),u.set(this,n),v.assign(this,{id:n.id,$:n.$}),l.bind(n)}render(e){let t=u.get(this);if(e){let{ids:n}=t.makeData(e);t.tree.clear(),n.forEach(e=>{let n=e.split(t.seperator);t.tree.set(n)})}let n=t.tree.render(function(e,n){let{key:i,nodes:r,keys:o,value:l}=e,{tabs:c,linker:a,content:s}=n;return{id:o.join(t.seperator),tabs:c,key:i,linker:a}});t.items=n;let i=t.tpl.fill({id:t.id,list:n});return t.container&&(o(t.container).html(i),t.$=t.this.$=o(`#${t.id}`)),i}toString(e){let t=u.get(this);return e===M&&t.$&&(e=!t.$.hasClass("hide-secondary")),t.tree.render(function(n,i){let{key:r,nodes:o,keys:l,value:c}=n,{tabs:a,linker:s,content:d}=i,u="";if(e){let e=l.join(t.seperator);u=t.id$item[e][t.secondaryKey]}let f=`${a}${s} ${r||t.emptyText}`;return u&&(f=f+" "+u),f}).join("\n")}on(...e){u.get(this).emitter.on(...e)}toggle(e){let t=u.get(this);r.isPlain(e)?r.each(e,function(e,n){t.toggleHideClass(`hide-${e}`,n)}):t.$.toggle(e)}highlight(e){let t=u.get(this),n=t.id$index[e];n<0?c.warn(`不存在 id 为 ${e} 的项。`):(t.highlightIndex&&t.$.find(`[data-cmd="id"][data-index="${t.highlightIndex}"]`).removeClass("on"),t.$.find(`[data-cmd="id"][data-index="${n}"]`).addClass("on"),t.highlightIndex=n)}}}),f("$",function(e,t,i){return n.definejs.require("jquery")}),f("API",function(e,t,n){const i=e("@definejs/api");return function(e,t){var n=new i(e,t),r=(n.get.bind(n),n.post.bind(n));return n.post=function(e,t){return r({data:e},t)},n}}),f("Clipboard",function(e,t,n){let r=new(e("@definejs/toast"))({duration:1200});return{copy(e){let t=i.createElement("textarea");t.setAttribute("readonly","readonly"),t.style.height=0,i.body.appendChild(t),t.value=e,t.select(),i.execCommand("copy")&&r.show("已复制"),i.body.removeChild(t)}}}),f("List",function(e,t,n){const i=e("@definejs/emitter");let r=new Map;function o(e){let t={emitter:new i(this),list:(e=e||[]).slice(0),reserves:e.slice(0)};r.set(this,t)}return o.prototype={constructor:o,add:function(e){let t=this.index(e);if(t>=0)return t;let n=r.get(this),i=n.list,o=n.emitter;return i.push(e),t=i.length-1,o.fire("change",[i.slice(0)]),o.fire("add",[e,t]),t},insert:function(e,t){let n=r.get(this),i=n.list,o=n.emitter;return e+=1,i.splice(e,0,t),o.fire("change",[i.slice(0)]),o.fire("insert",[t,e]),e},remove:function(e){"object"==typeof e&&(e=this.index(e));let t=r.get(this),n=t.emitter,i=t.list,o=i[e];if(o)return i.splice(e,1),n.fire("change",[i.slice(0)]),n.fire("remove",[o,e]),o},clear:function(e){let t=r.get(this),n=(t.list,t.emitter),i=t.reserves;t.list=e?[]:i.slice(0),n.fire("change",[t.list.slice(0)]),n.fire("clear")},get:function(e){let t=r.get(this).list;return 0==arguments.length?t.slice(0):t[e]},index:function(e){let t=r.get(this).list,n=e.id;return t.findIndex(function(e,t){return e.id==n})},on:function(e,t){r.get(this).emitter.on(...arguments)}},o}),f("Panel",function(e,t,n){const i=e("$"),r={key:"panel",prefix:"./"};function o(e,t){let n=[e];return function e(t,n,i){let{key:r,prefix:o}=i;let l=t.parentNode;if(!l)return;let c=l.dataset||{};let a=c[r];if(a&&(n.push(l),!a.startsWith(o)))return;e(l,n,i)}(e,n,t),n.reverse(),n}return{pad(e,t){t=t||r;let{key:n,prefix:l}=t;e=e||i(`[data-${n}^="${l}"]`).toArray(),c.log(e),e.forEach(function(e){let{dataset:i}=e;if(!i)return;let r=i[n];if(!r||!r.startsWith(l))return;let c=o(e,t);if(c[0].dataset[n].startsWith(l))throw new g(`无法找到值为完整 data-${n} 的父节点。`);c.forEach((e,t)=>{let i=e.dataset[n];if(!i.startsWith(l))return;let r=c[t-1],o=i.slice(l.length),a=`${r.dataset[n]}/${o}`;e.dataset[n]=a,e.dataset[`${n}_old`]=i})})}}}),f("resolveUrl",function(e,t,i){return n.resolveUrl}),f.panel("/Loading",function(e,t,n){}),f.panel("/Markdoc/Content",function(e,t,n){const i=e("MarkDoc");let r=null;return n.on("init",function(){(r=new i({container:n.$.find('[data-id="content"]')})).on("render",function(e){let t=r.getOutlines();n.fire("render",[{title:e.title,outlines:t}])}),r.on("hash",function(e){n.fire("hash",[e])})}),n.on("render",function(e,t){r.render({content:e,baseUrl:t.url,language:t.isCode?t.ext:""})}),{toOutline:function(e){r.toOutline(e)},font:function(e){r.$.css({"font-size":e+"px"})}}}),f.panel("/Markdoc/Header",function(e,t,n){const i=e("@definejs/string");let r=[{cmd:"numbers",text:"行号",checked:!0},{cmd:"comment",text:"注释",checked:!0}];return n.set("show",!1),n.on("init",function(){n.$.on("click","[data-index]",function(){let e=+this.getAttribute("data-index"),t=r[e].cmd,i=this.checked;i?s(function(){n.fire("check",[t,i])},200):n.fire("check",[t,i])}),n.template({"":function(e){return this.fill("html",e)},html:{"":function(e){let t=this.fill("item",e.list);return{url:e.url,name:e.name,items:t}},item:function(e,t){return{id:i.random(),index:t,text:e.text,checked:e.checked?"checked":""}}}})}),n.on("render",function(e){e.isCode?(n.fill({url:e.url,name:e.name,list:r}),n.show()):n.hide()}),{leave:function(e){n.$.toggleClass("fixed",e)}}}),f.panel("/Markdoc/Outline",function(e,t,n){const i=e("Outline");let r=null;n.set("show",!1),n.on("init",function(){n.$.on("scroll","ul",function(e){e.stopPropagation(),c.log(e)}),(r=new i({container:n.$.find('[data-id="container"]')})).on({item:function(e,t){n.fire("item",[e,t])}}),r.render()}),n.on("render",function(e){r.fill(e)})}),f.panel("/Markdoc/Tools",function(e,t,n){let i=[{cmd:"top",text:"顶部",icon:"fas fa-chevron-up"},{cmd:"home",text:"首页",icon:"fas fa-home"},{cmd:"outline",text:"提纲",icon:"fas fa-list"},{cmd:"font",text:"字体",icon:"fas fa-font"},{cmd:"print",text:"打印",icon:"fas fa-print"},{cmd:"bottom",text:"底部",icon:"fas fa-chevron-down"}],o={list:[14,16,18,20],index:1};return n.set("show",!1),n.on("init",function(){n.$on("click",'[data-cmd="{value}"]',{top:function(){n.fire("top")},home:function(){r.hash=""},font:function(){let e=o.list,t=o.index+1;t>=e.length&&(t=0),o.index=t,n.fire("font",[e[t]])},outline:function(){n.fire("outline")},print:function(){n.fire("print")},bottom:function(){n.fire("bottom")}}),n.template(function(e,t){return{index:t,cmd:e.cmd||"",text:e.text||"",icon:e.icon||""}})}),n.on("render",function(){n.fill(i),n.show()}),{set:function(e){n.$.find('[data-cmd="outline"]').toggle(!e)}}}),f("/Markdoc/API",function(e,t,n){const i=e("@definejs/emitter"),r=e("API");let o=new i;return{on:o.on.bind(o),read:function(e){let t=new r("FileList.read",{});t.on({request:function(){o.fire("loading",[!0])},response:function(){o.fire("loading",[!1])},success:function(e,t,n){let{content:i,isImage:r,url:l}=e;r&&(i=`![ ](${l})`),o.fire("success",[i])},fail:function(e,t,n,i){u.alert("获取文件内容失败: {0}",t)},error:function(e,t,n,i){u.alert("获取文件内容错误: 网络繁忙，请稍候再试")}}),t.get({id:e})}}}),f("/Markdoc/Url",function(e,t,n){let i=["md","txt","markdown"],r=["bmp","gif","jpg","jpeg","png"];return{parse(e){let t=e.startsWith("@"),n=t?e.slice(1):e,o=n.split(".").slice(-1)[0],l=n.split("/").slice(-1)[0],c=function(e){return(e=(e=e.split("#")[0]).split("?")[0]).split("/").slice(0,-1).join("/")+"/"}(n),a=i.includes(o)||r.includes(o);return{url:n,name:l,dir:c,ext:o,isCode:t||!a}}}}),f.panel("/Markdoc",function(e,t,n){const r=t.require("API"),o=t.require("Header"),l=t.require("Content"),a=t.require("Url"),s=t.require("Outline"),d=t.require("Tools");let u={info:null};return n.on("init",function(){o.on({check:function(e,t){n.$.toggleClass(`no-${e}`,!t)}}),r.on({loading:function(e){n.fire("loading",[e])},success:function(e){l.render(e,u.info)}}),l.on({render:function({title:e,outlines:t}){i.title=e,s.render(t),d.render()}}),s.on({item:function(e,t){l.toOutline(t)}}),d.on({top:function(){},bottom:function(){let e=n.$.get(0).scrollHeight;c.log(t.id,e),scrollTo(0,e)},outline:function(){s.toggle()},print:function(){function e(){n.$.toggleClass("print")}e(),i.execCommand("print")&&e()},font:function(e){l.font(e)}})}),n.on("render",function(e){let t=u.info=a.parse(e);n.$.toggleClass("source",t.isCode),o.render(t),r.read(t.url)}),{}}),f("/Master/PageList/List",function(e,t,n){return new(e("List"))([])}),f("/Master/PageList/Mask",function(e,t,n){const i=e("@definejs/panel"),r=e("@definejs/masker");let o=null,l=!1,c=new i;return c.on("init",function(){(o=new r({volatile:!0,opacity:0})).on({hide:function(){l=!1,c.fire("hide")},show:function(){l=!0,c.fire("show")}})}),c.on("render",function(){}),c.wrap({toggle:function(){l?o.hide():o.show()}})}),f.panel("/Master/PageList/Tabs",function(e,t,n){const i=e("$"),r=e("@definejs/tabs"),o=e("Settings.Language");let l=null,c={index:0,list:[]};n.on("init",function(){(l=new r({container:n.$.get(0),selector:">li",eventName:"click",indexKey:"data-index",activedClass:"on"})).on("change",function(e,t){c.index=t,n.fire("active",[e,t])}),l.template(function(e,t){return{index:t,name:e.name,icon:e.icon,"close-display":"Home"==e.view?"display: none;":""}}),o.on("change",function(e,t){n.render(c.list),l.reset(),l.active(c.index)}),n.$on("click",{'[data-cmd="close"]':function(e){e.stopPropagation();let t=+this.parentNode.getAttribute("data-index"),i=c.list[t];if(n.fire("before-close",[i,t]).includes(!1))return!1;a.close(t,!0)}})}),n.on("render",function(e){let t=o.get(),n=c.list=e.map(e=>(e.name=e.language$name[t],e));l.render(n)});let a=null;return a={active(e,t){c.index=e,l.active(e,t);let i=n.$.find(">li").get(e);if(i){(i.scrollIntoViewIfNeeded||i.scrollIntoView).call(i)}},index:()=>l.getActivedIndex(),close(e,t){let r=c.list[e];l.remove(e),n.$.find(`>li[data-index="${e}"]`).animate({height:0},function(){i(this).hide(),t&&n.fire("after-close",[r,e])})}}}),f.panel("/Master/PageList",function(e,t,n){const i=t.require("List"),r=t.require("Tabs"),o=t.require("Mask");return n.on("init",function(){let e=n.$.find(">div");n.$on("click",{">i":function(e){o.toggle()},'[data-cmd="refresh"]':function(e){n.fire("refresh")}}),o.on({hide:function(){e.slideUp("fast"),n.$.removeClass("show")},show:function(){e.slideDown("fast"),n.$.addClass("show")}}),i.on({change:function(e){r.render(e)},remove:function(e,t){r.active(t-1,!0)}}),r.on({active:function(e,t){n.fire("active",[e,t])},"before-close":function(e,t){if(n.fire("before-close",[e,t]).includes(!1))return!1},"after-close":function(e,t){i.remove(t),n.fire("after-close",[e,t])}})}),n.on("render",function(){r.render([]),o.render()}),{open:function(e){let t=i.index(e);t<0&&(t=r.index(),t=i.insert(t,e)),r.active(t,!1)},close:function(e){let t=i.index({id:e});r.close(t,!1),i.remove(t)}}}),f("/Master/PageTabs/List",function(e,t,n){return new(e("List"))([])}),f.panel("/Master/PageTabs/Tabs",function(e,t,n){const i=e("$"),r=e("@definejs/tabs"),o=e("Settings.Language");let l=null,c={index:0,list:[]};n.on("init",function(){(l=new r({container:n.$.get(0),selector:">li",eventName:"click",indexKey:"data-index",activedClass:"on"})).on("change",function(e,t){c.index=t,n.fire("active",[e,t])}),l.template(function(e,t){return{index:t,name:e.name,icon:e.icon,"close-display":"Home"==e.view?"display: none;":""}}),o.on("change",function(e,t){n.render(c.list),l.reset(),l.active(c.index)}),n.$on("click",{'[data-cmd="close"]':function(e){e.stopPropagation();let t=+this.parentNode.getAttribute("data-index"),i=c.list[t];if(n.fire("before-close",[i,t]).includes(!1))return!1;a.close(t,!0)}})}),n.on("render",function(e){let t=o.get(),n=c.list=e.map(e=>(e.name=e.language$name[t],e));l.render(n)});let a=null;return a={active(e,t){c.index=e,l.active(e,t);let i=n.$.find(">li").get(e);if(i){(i.scrollIntoViewIfNeeded||i.scrollIntoView).call(i)}},index:()=>l.getActivedIndex(),close(e,t){let r=c.list[e];l.remove(e),n.$.find(`>li[data-index="${e}"]`).animate({width:0,padding:0},function(){i(this).hide(),t&&n.fire("after-close",[r,e])})}}}),f.panel("/Master/PageTabs",function(e,t,n){const i=t.require("List"),r=t.require("Tabs");return n.on("init",function(){i.on({change:function(e){r.render(e)},remove:function(e,t){r.active(t-1,!0)}}),r.on({active:function(e,t){n.fire("active",[e,t])},"before-close":function(e,t){if(n.fire("before-close",[e,t]).includes(!1))return!1},"after-close":function(e,t){i.remove(t),n.fire("after-close",[e,t])}})}),n.on("render",function(){r.render([])}),{open(e){let t=i.index(e);t<0&&(t=r.index(),t=i.insert(t,e)),r.active(t,!1)},close(e){let t=i.index({id:e});r.close(t,!1),i.remove(t)}}}),f("/Master/Sidebar/List/Data",function(e,t,n){const i=e("Settings.Language");return{make(e){let t=i.get();return e.map((e,n)=>((e={...e}).id=e.view,e.index=n,e.name=e.language$name[t],e))},set(e,t){e.forEach(e=>{e.name=e.language$name[t]})}}}),f.panel("/Master/Sidebar/Header",function(e,t,n){const i=e("@definejs/local-storage");let r=null,o=!0;n.on("init",function(){r=new i(t.id),(o=r.get("visible"))===M&&(o=!0),n.fire("toggle",[o]),n.$.on("click",function(){o=!o,r.set("visible",o),n.fire("toggle",[o])})}),n.on("render",function(){})}),f.panel("/Master/Sidebar/List",function(e,t,n){const i=e("@definejs/tabs"),r=e("Settings.Language"),o=t.require("Data");let l=null,c={index:-1,list:[]};return n.on("init",function(){(l=new i({container:n.$,selector:">li",activedClass:"on",repeated:!0})).on("change",function(e,t){t!=c.index?(e=c.list[t],c.index=t,n.fire("item",[e])):n.fire("refresh",[e])}),n.template(function(e,t){return{index:t,name:e.name,icon:e.icon,class:e.border?"group":""}}),r.on("change",function(e,t){o.set(c.list,e),n.fill(c.list),l.reset(),l.active(c.index)})}),n.on("render",function(e){let t=c.list=o.make(e);l.render(t),n.fire("render",[t])}),{active:function(e){let t=e.index;"number"!=typeof t&&(t=-1),c.index=t,l.active(t,!1)},get:function(e){return c.list.find(function(t,n){return t.view===e})}}}),f.panel("/Master/Sidebar",function(e,t,n){const i=e("@definejs/package"),r=t.require("Header"),o=t.require("List");return n.on("init",function(){r.on({toggle:function(e){n.fire("toggle",[e])}}),o.on({render:function(e){n.fire("render",[e])},item:function(e){n.fire("item",[e])},refresh:function(e){n.fire("refresh",[e])}})}),n.on("render",function(){i.load("data.Sidebar",function(){let t=e("data.Sidebar");r.render(),o.render(t)})}),{active(e){if("string"==typeof e&&(e=o.get(e)),e)return o.active(e),e}}}),f.panel("/Master/Views",function(e,t,n){const i=e("@definejs/package");let r={current:null,view$bind:new Map,view$rendered:new Map};function o(e){let t=n.fire("require",[e])[0];if(t)return r.view$bind.get(t)||(r.view$bind.set(t,!0),t.on("close",function(...t){n.fire("close",[e])}),t.on("fullscreen",function(...e){n.fire("fullscreen",e)}),t.on("title",function(...e){n.fire("title",e)})),t}function l(e,t={}){let{args:i=[],render:o=null,title:l=""}=t;r.current&&r.current.hide(),r.current=e,null===o&&(o=!r.view$rendered.get(e)),n.fire("title",[l]),o?(r.view$rendered.set(e,!0),e.render(...i)):e.show()}return n.on("init",function(){}),n.on("render",function(e,t){if("object"==typeof e){let n=e;e=n.view,t={title:n.name,...t}}let r=o(e);r?l(r,t):i.load(e,function(i){if(!i)return c.warn(`不存在视图 ${e} 对应的 package 文件。`),void n.fire("404",[e,t]);let r=i.html;r&&n.$.append(r.content);let a=o(e);if(!a)return c.warn(`无法获取到视图 ${e}`),void n.fire("404",[e,t]);l(a,t)})}),{close(e,t){let n=o(e);if(n)return!n.close(...t).includes(!1)&&(n.$.fadeOut("slow",function(){n.hide()}),r.current===n&&(r.current=null),void r.view$rendered.delete(n))},refresh(e){"string"==typeof(e=e||r.current)&&(e=o(e)),e&&(e.refresh(),r.view$rendered.set(e,!0))}}}),f.panel("/Master/Container",function(e,t,n){const i=e("Settings.Header");n.on("init",function(){i.on("change",function(e,t){n.$.toggleClass("no-header","hide"==e)})}),n.on("render",function(){let e=i.get();n.$.toggleClass("no-header","hide"==e)})}),f.panel("/Master",function(e,t,n){const o=t.require("Sidebar"),l=t.require("Container"),a=t.require("PageTabs"),s=t.require("PageList"),d=t.require("Views");let u={rendered:!1,view:""};function f(e){if(!e)return;c.log(e);let t=o.active(e);a.open(t),s.open(t),d.render(t)}return n.on("init",function(){o.on({render:function(e){let t=e[0].view;a.render(),s.render(),f(t),u.view!=t.view&&(f(u.view),u.view=""),n.fire("ready")},item:function(e){r.hash="#"+e.view},refresh:function(e){d.refresh()},toggle:function(e){n.$.toggleClass("hide",!e)}}),a.on({active:function(e,t){r.hash="#"+e.view},"before-close":function(e,t){return d.close(e.view,[t])},"after-close":function(e,t){s.close(e.id)}}),s.on({active:function(e,t){r.hash="#"+e.view},"before-close":function(e,t){return d.close(e.view,[t])},"after-close":function(e,t){a.close(e.id)},refresh:function(){d.refresh()}}),d.on({require:function(e){return n.fire("require",[e])[0]},404:function(e,t){d.render("404",{args:[e],render:!0,title:`404 - ${t.title}`})},close:function(e){a.close(e),s.close(e)},title:function(e){i.title=`webpart - ${e}`},fullscreen:function(...e){n.$.toggleClass("fullscreen",...e)}})}),n.on("render",function(e){e?u.rendered?f(e):(u.view=e,u.rendered=!0,o.render(),l.render()):r.hash="#Home"}),n.on("after-render",function(){n.fire("render")}),{open:function(e,t){d.render(e,{args:t,render:!0}),r.hash="#"+e}}}),f.panel("/Router",function(e,t,i){const r=e("@definejs/hash");i.on("init",function(){r.onchange(n,!0,function(e,t){if((e=e||"").startsWith("!")){let t=e.slice(1);i.fire("markdoc",[t])}else i.fire("master",[e])})}),i.on("render",function(){})}),f.view("/404",function(e,t,n){n.on("init",function(){}),n.on("render",function(e){c.log(t.id,e)})}),f.view("/Error",function(e,t,n){n.on("init",function(){}),n.on("render",function(e,t){n.fill({name:e.name,ex:t.stack}),c.log(t)})}),f("/FileList/Body/Main/Icon/List/Data",function(e,t,n){const i=e("File");function r(e,t){return(e=e.name)==(t=t.name)?0:e>t?1:-1}return{get(e){let t=[],n=[];return e.forEach(e=>{let{data:r}=e,{name:o,type:l}=r,c=i.getExt(o),a=o.split("/").slice(-1)[0],s={...r,ext:c,sname:a};("dir"==l?t:n).push(s)}),t=t.sort(r),n=n.sort(r),e=[...t,...n]}}}),f.panel("/FileList/Body/Main/Icon/List",function(e,t,n){const i=e("File"),r=t.require("Data");let o=[];return n.on("init",function(){n.template(function(e,t){return{index:t,icon:i.getIcon(e).html,name:e.sname}}),n.$on("click",{"[data-index]":function(e){let t=+this.dataset.index,i=o[t];n.fire("item",[i])}})}),n.on("render",function(e){o=r.get(e),n.fill(o)}),{}}),f.panel("/FileList/Body/Main/Icon",function(e,t,n){const i=t.require("List");return n.on("init",function(){i.on({item:function(e){n.fire("item",[e])}})}),n.on("render",function(e){i.render(e.item.list)}),{}}),f.panel("/FileList/Body/Main/List/Dir/Filter/CWD",function(e,t,n){const i=e("CheckBox");let r=null;n.on("init",function(){(r=new i({fireNow:!0,container:n.$,text:"仅当前目录"})).on("checked",function(e){n.fire("change",[e])})}),n.on("render",function(e){r.render({checked:e})})}),f.panel("/FileList/Body/Main/List/Dir/Filter/ChildDirs",function(e,t,n){const i=e("@definejs/array"),r=e("DropCheckList");let o=null;return n.on("init",function(){function e(e){e=i.map(e,function(e){return e.checked?e.value:null}),n.fire("check",[e])}(o=new r({container:n.$,text:"直接子目录",fireNow:!0})).on({check:function(t){e(t)},fill:function(t){e(t)}})}),n.on("render",function(e){e=i.map(e,e=>{let{type:t,name:n}=e.data;return"dir"==t?{text:e.name,checked:!0,value:n}:null}),o.render(e)}),{}}),f.panel("/FileList/Body/Main/List/Dir/Filter/Dirs",function(e,t,n){const i=e("DropCheckList");let r=null,o=[{text:"N = 0",checked:!0,value:"N=0"},{text:"N > 0",checked:!0,value:"N>0"}];return n.on("init",function(){(r=new i({container:n.$,text:"目录数"})).on({check:function(e){n.fire("check",[e])}})}),n.on("render",function(){r.render(o)}),{}}),f.panel("/FileList/Body/Main/List/Dir/Filter/Files",function(e,t,n){const i=e("DropCheckList");let r=null,o=[{text:"N = 0",checked:!0,value:"N=0"},{text:"N > 0",checked:!0,value:"N>0"}];return n.on("init",function(){(r=new i({container:n.$,text:"文件数"})).on({check:function(e){n.fire("check",[e])}})}),n.on("render",function(){r.render(o)}),{}}),f.panel("/FileList/Body/Main/List/Dir/Filter/Name",function(e,t,n){n.on("init",function(){n.$.on("input","input",function(){n.fire("change",[this.value])})}),n.on("render",function(){})}),f.panel("/FileList/Body/Main/List/Dir/Filter",function(e,t,n){const i=t.require("Name"),r=t.require("CWD"),o=t.require("Files"),l=t.require("Dirs"),a=t.require("ChildDirs");let d={name:"",cwd:!1,files$checked:null,dirs$checked:null,childDirs:null};n.on("init",function(){let e=null;function t(t){v.assign(d,t),clearTimeout(e),e=s(function(){n.fire("change",[d])},100)}function u(e){let t={};return e.forEach(e=>{t[e.value]=e.checked}),t}i.on({change:function(e){t({name:e})}}),r.on({change:function(e){t({cwd:e})}}),o.on({check:function(e){t({files$checked:u(e)})}}),l.on({check:function(e){t({dirs$checked:u(e)})}}),a.on({check:function(e){c.log(e),t({childDirs:e})}})}),n.on("render",function(e){i.render(),r.render(d.cwd),o.render(),l.render(),a.render(e.list)})}),f.panel("/FileList/Body/Main/List/Dir/GridView",function(e,t,n){e("@definejs/date");const i=e("GridView"),r=e("File");let o=null,l=null,c={keyword:"",keywordHtml:""};n.on("init",function(){l=n.template(),(o=new i({container:n.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"路径",name:"name",width:600,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"大小",name:"size",width:95,class:"size number",dragable:!0},{caption:"文件数",name:"files",width:74,class:"files number",dragable:!0},{caption:"目录数",name:"dirs",width:74,class:"dirs number",dragable:!0}]})).on("process","row",function(e){}),o.on("process","cell",{name:function(e){let t=e.row.data,n=t.name,i=r.getIcon(t.item);return c.keyword&&(n=n.split(c.keyword).join(c.keywordHtml)),l.fill("name",{icon:i.html,name:n})},files:function(e){let t=e.row.data;e.class+=` files-${t.files}`}}),o.on("click","cell",{name:{"":function(e,t){},"[data-cmd]":function(e,t){t.stopPropagation();let i=e.row.data.item;n.fire("item",[i])}}}),o.on("click","table",function(e,t){e.column("name",function(e){$(e.element).removeClass("text")})}),o.render()}),n.on("render",function(e,t={}){let n=c.keyword=t.keyword||"",i=t.root||"";n&&(c.keywordHtml='<span class="keyword">'+n+"</span>"),e=e.map(function(e,t){let n="file"==e.type,o=r.getSizeDesc(e.size),{name:l}=e;return n||(l+="/"),{name:i+l,size:o.value+" "+o.desc,dirs:e.dirs.length,files:e.files.length,item:e}}),o.fill(e)})}),f("/FileList/Body/Main/List/Dir/Data",function(e,t,n){let i={list:[],dirs:[]};function r(e,t,n){return t&&(e=e.filter(n)),e}return{init(e){i.list=e,i.dirs=e.filter(e=>"dir"==e.type),i.dirs.forEach(t=>{let n=t.stat.size,i=t.name,r=[],o=[];e.forEach(e=>{let{name:t,stat:l,type:c}=e;t.startsWith(`${i}/`)&&("file"==c?(n+=l.size,r.push(e)):o.push(e))}),t.files=r,t.dirs=o,t.size=n})},filter:function(e){let{cwd:t="",name:n="",files$checked:o=null,dirs$checked:l=null,childDirs:c=null}=e,a=i.dirs;return a=r(a=r(a=r(a=r(a,n,function(e){return e.name.includes(n)}),t,function(e){let{name:n}=e;return"/"==t?!n.slice(1).includes("/"):!n.slice(t.length+1).includes("/")}),o,function(e){let t=e.files.length;return!(!o["N=0"]&&0==t)&&!(!o["N>0"]&&t>0)}),l,function(e){let t=e.dirs.length;return!(!l["N=0"]&&0==t)&&!(!l["N>0"]&&t>0)}),t||(a=r(a,c,function(e){let{name:t}=e;return c.some(e=>t==e||t.startsWith(`${e}/`))})),a}}}),f.panel("/FileList/Body/Main/List/Dir",function(e,t,n){const i=t.require("Filter"),r=t.require("GridView"),o=t.require("Data");let l={root:"",item:null};return n.on("init",function(){i.on({change:function(e){e=v.assign({},e,{cwd:e.cwd?l.item.id:""});let t=o.filter(e);r.render(t,{keyword:e.name,root:l.root})}}),r.on({item:function(e){n.fire("item",[e])}})}),n.on("render",function(e){e.item!==l.item?(l.item=e.item,l.root=e.root,o.init(e.list),i.render(e.item)):n.show()}),{}}),f.panel("/FileList/Body/Main/List/File/Filter/CWD",function(e,t,n){const i=e("CheckBox");let r=null;n.on("init",function(){(r=new i({fireNow:!0,container:n.$,text:"仅当前目录"})).on("checked",function(e){n.fire("change",[e])})}),n.on("render",function(e){r.render({checked:e})})}),f.panel("/FileList/Body/Main/List/File/Filter/ChildDirs",function(e,t,n){const i=e("@definejs/array"),r=e("DropCheckList");let o=null;return n.on("init",function(){function e(e){e=i.map(e,function(e){return e.checked?e.value:null}),n.fire("check",[e])}(o=new r({container:n.$,text:"直接子目录",fireNow:!0})).on({check:function(t){e(t)},fill:function(t){e(t)}})}),n.on("render",function(e){e=i.map(e,e=>{let{type:t,name:n}=e.data;return"dir"==t?{text:e.name,checked:!0,value:n}:null}),o.render(e)}),{}}),f.panel("/FileList/Body/Main/List/File/Filter/Encoding",function(e,t,n){const i=e("DropCheckList");let r=null,o=[{text:"UTF8",checked:!0,value:"utf8"},{text:"其它",checked:!0,value:"other"}];return n.on("init",function(){(r=new i({container:n.$,text:"编码"})).on({check:function(e){n.fire("check",[e])}})}),n.on("render",function(){r.render(o)}),{}}),f.panel("/FileList/Body/Main/List/File/Filter/MD5",function(e,t,n){const i=e("DropCheckList");let r=[{text:"N = 1",checked:!0,value:"N=1"},{text:"N > 1",checked:!0,value:"N>1"}];return n.on("init",function(){chk=new i({container:n.$,text:"重复文件"}),chk.on({check:function(e){n.fire("check",[e])}})}),n.on("render",function(){chk.render(r)}),{}}),f.panel("/FileList/Body/Main/List/File/Filter/Name",function(e,t,n){n.on("init",function(){n.$.on("input","input",function(){n.fire("change",[this.value])})}),n.on("render",function(){})}),f.panel("/FileList/Body/Main/List/File/Filter/Type",function(e,t,n){const i=e("DropCheckList");let r=null,o=[];return n.on("init",function(){(r=new i({container:n.$,text:"类型"})).on({check:function(e){n.fire("check",[e])}})}),n.on("render",function(e){o=e.map(e=>({text:`${e.slice(1)} 文件`,checked:!0,value:e})),r.render(o),n.fire("check",[o])}),{}}),f.panel("/FileList/Body/Main/List/File/Filter",function(e,t,n){const i=t.require("Type"),r=t.require("Encoding"),o=t.require("Name"),l=t.require("CWD"),a=t.require("MD5"),d=t.require("ChildDirs");let u={name:"",cwd:!1,ext$checked:null,encoding$checked:null,md5$checked:null,childDirs:null};n.on("init",function(){let e=null;function t(t){v.assign(u,t),clearTimeout(e),e=s(function(){n.fire("change",[u])},100)}function f(e){let t={};return e.forEach(e=>{t[e.value]=e.checked}),t}o.on({change:function(e){t({name:e})}}),l.on({change:function(e){t({cwd:e})}}),i.on({check:function(e){t({ext$checked:f(e)})}}),r.on({check:function(e){t({encoding$checked:f(e)})}}),a.on({check:function(e){t({md5$checked:f(e)})}}),d.on({check:function(e){c.log(e),t({childDirs:e})}})}),n.on("render",function({exts:e,item:t}){i.render(e),r.render(),l.render(u.cwd),o.render(),a.render(),d.render(t.list)})}),f.panel("/FileList/Body/Main/List/File/GridView",function(e,t,n){const i=e("@definejs/date"),r=e("GridView"),o=e("File");let l=null,c=null,a={keyword:"",keywordHtml:""};n.on("init",function(){c=n.template(),(l=new r({container:n.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"路径",name:"name",width:600,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"大小",name:"size",width:70,class:"size number",dragable:!0},{caption:"编码",name:"isUTF8",width:80,class:"utf8",dragable:!0},{caption:"MD5",name:"md5",width:285,class:"md5",dragable:!0}]})).on("process","row",function(e){e.class=e.data.item.type}),l.on("process","cell",{name:function(e){let t=e.row.data,n=t.name,i=o.getIcon(t.item);return a.keyword&&(n=n.split(a.keyword).join(a.keywordHtml)),c.fill("name",{icon:i.html,name:n})},md5:function(e){let t=e.row.data.item,{md5:n,files:i}=t,r=i.slice(-1)[0];i.length>1&&(e.class+=" repeat",t===r&&(e.row.class+=" md5-group-bottom"))}}),l.on("click","cell",{name:{"":function(e,t){},"[data-cmd]":function(e,t){t.stopPropagation();let i=e.row.data.item;n.fire("item",[i])}}}),l.on("click","table",function(e,t){e.column("name",function(e){$(e.element).removeClass("text")})}),l.render()}),n.on("render",function(e,t={}){let n=a.keyword=t.keyword||"",r=t.root||"";n&&(a.keywordHtml='<span class="keyword">'+n+"</span>"),l.$.toggleClass("md5-repeat-mode",t.isMd5Mode),e=e.map(function(e,t){let n=e.stat,l=i.format(n.birthtime,"yyyy-MM-dd HH:mm:ss"),c=i.format(n.mtime,"yyyy-MM-dd HH:mm:ss"),a="file"==e.type,s=o.getSizeDesc(n.size),{isUTF8:d,name:u}=e;return a||(u+="/"),{name:r+u,typeDesc:a?e.ext.slice(1)+" 文件":"目录",size:s.value+" "+s.desc,birthtime:l,mtime:c,isUTF8:a?d?"UTF8":"其它":"",md5:e.md5,item:e}}),l.fill(e)})}),f("/FileList/Body/Main/List/File/Data",function(e,t,n){const i=e("@definejs/array");let r={list:[],files:[],exts:[],md5$files:{}};function o(e,t,n){return t&&(e=e.filter(n)),e}return{init(e){let t=new Set;return r.md5$files={},r.list=e,r.files=e.filter(e=>{if("dir"==e.type)return!1;let{ext:n,md5:o}=e,{md5$files:l}=r;return t.add(n.toLowerCase()),i.add(l,o,e),e.files=l[o],!0}),r.exts=[...t],r},filter:function(e){let{cwd:t="",name:n="",ext$checked:i=null,encoding$checked:l=null,md5$checked:c=null,childDirs:a=null}=e,s=r.files;s=o(s=o(s=o(s=o(s=o(s,n,function(e){return e.name.includes(n)}),t,function(e){let{name:n}=e;return"/"==t?!n.slice(1).includes("/"):!n.slice(t.length+1).includes("/")}),i,function(e){let t=e.ext.toLowerCase();return i[t]}),l,function(e){let t=e.isUTF8?"utf8":"other";return l[t]}),c,function(e){let{md5:t}=e,n=r.md5$files[t].length;return!(!c["N=1"]&&1==n)&&!(!c["N>1"]&&n>1)}),t||(s=o(s,a,function(e){let{name:t}=e;return a.some(e=>t==e||t.startsWith(`${e}/`))}));let d=!1;if(c&&c["N>1"]&&!c["N=1"]){let e={};s.forEach(t=>{let{md5:n,files:i}=t;e[n]=i}),d=!0,s=[],v.keys(e).forEach(t=>{let n=e[t];s=[...s,...n]})}return{list:s,isMd5Mode:d}}}}),f.panel("/FileList/Body/Main/List/File",function(e,t,n){const i=t.require("Filter"),r=t.require("GridView"),o=t.require("Data");let l={root:"",item:null};return n.on("init",function(){i.on({change:function(e){e=v.assign({},e,{cwd:e.cwd?l.item.id:""});let{list:t,isMd5Mode:n}=o.filter(e);r.render(t,{keyword:e.name,root:l.root,isMd5Mode:n})}}),r.on({item:function(e){n.fire("item",[e])}})}),n.on("render",function(e){if(e.item===l.item)return void n.show();let{exts:t}=o.init(e.list);l.item=e.item,l.root=e.root,i.render({exts:t,item:l.item})}),{}}),f.panel("/FileList/Body/Main/List/Tabs",function(e,t,n){const i=e("@definejs/tabs"),r=e("@definejs/local-storage");let o=null,l=null,c={index:0,list:[{name:"文件",cmd:"file"},{name:"目录",cmd:"dir"}]};return n.on("init",function(){l=new r(t.id),c.index=l.get("index")||0,(o=new i({container:n.$,activedClass:"on",eventName:"click",selector:">li"})).on("change",function(e,t){c.index=t,e=c.list[t],l.set("index",t),n.fire(e.cmd)})}),n.on("render",function(e){o.render(c.list,function(e,t){return{index:t,name:e.name}}),"number"==typeof e?c.index=e:e=c.index,o.active(e)}),{}}),f.panel("/FileList/Body/Main/List",function(e,t,n){const i=t.require("Tabs"),r=t.require("File"),o=t.require("Dir");let l={opt:null};return n.on("init",function(){i.on({file:function(){r.render(l.opt),o.hide()},dir:function(){r.hide(),o.render(l.opt)}}),r.on({item:function(e){n.fire("item",[e])}}),o.on({item:function(e){n.fire("item",[e])}})}),n.on("render",function(e){l.opt=e,i.render()}),{}}),f.panel("/FileList/Body/Main/Tree/Header",function(e,t,n){const i=e("CheckBox");let r=[{id:"icon",text:"图标",chk:null},{id:"tab",text:"缩进",chk:null},{id:"color",text:"彩色",chk:null},{id:"hover",text:"悬停",chk:null}];n.on("init",function(){r.forEach(e=>{let t=new i({fireNow:!0,container:n.$.find(`[data-id="chk-${e.id}"]`),text:e.text});t.on("checked",function(t){n.fire("check",[{[e.id]:t}])}),e.chk=t}),n.$on("click","[data-cmd]",function(e){let{cmd:t}=e.target.dataset;n.fire("cmd",t,[])})}),n.on("render",function(e){r.forEach(t=>{let n=e[t.id];t.chk.render({checked:n})})})}),f.panel("/FileList/Body/Main/Tree/Main",function(e,t,n){const i=e("TextTree"),r=e("Clipboard");let o=null;return n.on("init",function(){(o=new i({container:n.$})).on("cmd",function(e,t){n.fire("cmd",[e,t])})}),n.on("render",function(e){let{id:t,list:i}=e;o.render(i),"string"==typeof t&&o.highlight(t),n.fire("render")}),{check(e){o.toggle(e)},copy(){let e=o.toString();r.copy(e)}}}),f.panel("/FileList/Body/Main/Tree",function(e,t,n){const i=t.require("Header"),r=t.require("Main");n.on("init",function(){i.on("check",function(e){r.check(e)}),i.on("cmd",{copy:function(){r.copy()}}),r.on({cmd:function(e,t){n.fire("cmd",e,[t])},render:function(){i.render({icon:!1,tab:!0,color:!0,hover:!1})}})}),n.on("render",function(e){let{item:t,list:n,root:i}=e;n=n.map(e=>{return{id:i+e.name}});let o="/"==t.id?i:i+t.id,l=o.split("/");n=[...l.map((e,t)=>{return{id:l.slice(0,t+1).join("/")}}),...n],r.render({id:o,list:n})})}),f.panel("/FileList/Body/Main/Tabs",function(e,t,n){const i=e("@definejs/tabs"),r=e("@definejs/local-storage");let o=null,l=null,c={index:0,list:[{name:"平铺",cmd:"icon",root:!0},{name:"列表",cmd:"list",root:!0},{name:"架构",cmd:"tree",root:!0}],cmd$module:null};return n.on("init",function(){l=new r(t.id),c.index=l.get("index")||0,(o=new i({container:n.$.get(0),activedClass:"on",eventName:"click",selector:">li",repeated:!0})).on("change",function(e,t){c.index=t,e=c.list[t],l.set("index",t);let{cmd:i}=e,{cmd$module:r}=c;r&&v.keys(r).forEach(e=>{let t=r[e];e==i?n.fire("change",[t]):t.hide()}),n.fire("cmd",i,[])})}),n.on("render",function(){o.render(c.list,function(e,t){return{index:t,name:e.name}}),o.active(c.index)}),{map(e){c.cmd$module=e}}}),f.panel("/FileList/Body/Main",function(e,t,n){const i=t.require("Tabs"),r=t.require("Tree"),o=t.require("List"),l=t.require("Icon");let c={root:"",list:[],item:null};return n.on("init",function(){i.map({tree:r,list:o,icon:l}),i.on({change:function(e){e.render(c)}}),o.on({item:function(e){n.fire("item",[e])}}),l.on({item:function(e){n.fire("item",[e])}}),r.on("cmd",{id:function(e){let t=e.id.slice(c.root.length);n.fire("item",[{name:t||"/"}])}})}),n.on("render",function(e){let t=e.root;t.endsWith("/")&&(t=t.slice(0,-1)),c.root=t,c.list=e.list,c.item=e.item,i.render()}),{}}),f("/FileList/Body/Nav/Data",function(e,t,n){return{make(e){let{type:t,root:n}=e,i="file"==t?e.name:e.item.id,r="file"==t?e:e.item.data,o=`${n}${i}`.split("/").filter(e=>!!e);return{names:o,path:o.join("/"),icon:r}}}}),f.panel("/FileList/Body/Nav",function(e,t,n){const i=e("MenuNav"),r=t.require("Data");let o=null,l={root:""};n.on("init",function(){(o=new i({container:n.$})).on({item:function(e,t){c.log(t,e);let i={name:`/${e.slice(1).join("/")}`};n.fire("item",[i])},text:function(e){if(!e.startsWith(l.root))return!1;e.endsWith("/")&&(e=e.slice(0,-1));let t={name:`/${e.slice(l.root.length)}`};n.fire("item",[t])},render:function(e){n.fire("render",[e])}})}),n.on("render",function(e){l.root=e.root,e=r.make(e),o.render(e)})}),f.panel("/FileList/Body/Preview/MarkDoc",function(e,t,n){const i=e("@definejs/escape"),r=e("MarkDoc");let o=null,l=[".json",".js",".css",".html",".htm",".less"];return n.on("init",function(){(o=new r({container:n.$})).on("render",function(e){let t=o.getOutlines();n.fire("render",[t])})}),n.on("render",function(e){let t=e.content,r=e.ext.toLowerCase(),c="",a=!0;"source"==e.type?(t=i.html(t),c=r.slice(1),a=!1):l.includes(r)&&(c=r.slice(1)),o.render({content:t,language:c,baseUrl:"",code:{format:a}}),n.$.toggleClass("image",e.isImage)}),{outline:function(e){o.toOutline(e)}}}),f.panel("/FileList/Body/Preview/Tabs",function(e,t,n){const i=e("@definejs/tabs");var r=[{name:"预览",type:"preview"},{name:"源码",type:"source"}],o=0,l=null;n.on("init",function(){(l=new i({container:n.$,activedClass:"on",eventName:"click",selector:">li",repeated:!0})).on("change",function(e,t){o=t,e=r[t],n.fire("change",[e.type])})}),n.on("render",function(e){l.render(r,function(e,t){return{index:t,name:e.name}}),"number"==typeof e?o=e:e=o,l.active(e)})}),f.panel("/FileList/Body/Preview",function(e,t,n){const i=t.require("Tabs"),r=t.require("MarkDoc");let o={};return n.on("init",function(){i.on({change:function(e){o.type=e,r.render(o)}}),r.on({render:function(e){n.fire("render",[e])}})}),n.on("render",function(e){let t=e.isImage,n=t?".md":e.ext;o={content:e.content,ext:n,isImage:t,type:""},i.render()}),{get:function(){return o},outline:function(e){r.outline(e)}}}),f.panel("/FileList/Body",function(e,t,n){const i=t.require("Nav"),r=t.require("Main"),o=t.require("Preview");return n.on("init",function(){i.on({render:function(e){n.fire("path",[e])},item:function(e){n.fire("item",[e])}}),r.on({item:function(e){n.fire("item",[e])}}),o.on({render:function(e){n.fire("outline",[e])}})}),n.on("render",function(e,t){i.render(t),"file"==e?(r.hide(),o.render(t)):"dir"==e&&(o.hide(),r.render(t))}),{outline:o.outline,resize(...e){let t="calc(100% - "+e.reduce(function(e,t){return e+t},0)+"px)";n.$.css({width:t})}}}),f.panel("/FileList/Sidebar/Operation",function(e,t,n){const i=e("@definejs/local-storage");let r={visible:!0},o=null;n.on("init",function(){o=new i(t.id),r.visible=o.get("visible"),r.visible===M&&(r.visible=!0),n.$.on("click","[data-cmd]",function(){let e=this.getAttribute("data-cmd");if("detail"==e)return r.visible=!r.visible,void n.refresh();n.fire("cmd",[e])})}),n.on("render",function({detail:e,item:t}){let i=r.visible,l="file"==e.type,c=!t.parent;n.fill({"detail-class":i?"right":"left","open-display":l?"":"display: none;","edit-display":l?"":"display: none;","demo-display":l?"":"display: none;","delete-display":c?"display: none;":""}),n.fire("detail",[i]),o.set("visible",i)})}),f.panel("/FileList/Sidebar/Outline",function(e,t,n){var i=e("Outline"),r=null;n.set("show",!1),n.on("init",function(){(r=new i({container:n.$})).on({item:function(e,t){n.fire("item",[e,t])}}),r.render()}),n.on("render",function(e){r.fill(e)})}),f("/FileList/Sidebar/Stat/Types",function(e,t,n){const i=e("@definejs/object"),r=e("File");let o=[".png",".jpg",".jpeg",".gif",".bmp"];return{get:function(e){if(!e)return[];let t={dir:0,file:0,image:0,size:0,isUTF8:0,notUTF8:0},n={};e.forEach(function(e,i){let r=e.type;if(t[r]++,"dir"==r)return;let l=e.ext.toLowerCase(),c=e.isUTF8?"isUTF8":"notUTF8";n[l]=(n[l]||0)+1,o.includes(l)&&t.image++,t.size+=e.stat.size,t[c]++});let l=[{name:"全部",value:e.length,desc:"个",class:"spliter"}],c=t.size;return c&&(c=r.getSizeDesc(c),l.push({name:"大小",value:c.value,desc:c.desc,class:"dir-size"})),t.dir&&l.push({name:"目录",value:t.dir,desc:"个"}),t.file&&l.push({name:"文件",value:t.file,desc:"个"}),l.push({name:"UTF8 编码",value:t.isUTF8,desc:"个"}),l.push({name:"其它编码",value:t.notUTF8,desc:"个"}),t.image&&l.push({name:"图片",value:t.image,desc:"个"}),v.keys(i.sort(n)).forEach(function(e,t){let i=n[e],r=e.slice(1)+" 文件",o=0==t?"spliter":"";l.push({name:r,value:i,desc:"个",class:o})}),l}}}),f.panel("/FileList/Sidebar/Stat",function(e,t,n){const i=e("File"),r=e("@definejs/date"),o=t.require("Types");n.on("init",function(){n.template({"":function(e){return this.fill("table",e)},table:{"":function(e){let{stat:t,type:n,name:l}=e,c="dir"==n?"目录":e.ext.slice(1)+" 文件",a=r.format(t.birthtime,"yyyy-MM-dd HH:mm:ss"),s=r.format(t.mtime,"yyyy-MM-dd HH:mm:ss"),d=i.getSizeDesc(t.size),u=o.get(e.list),f=l.split("/").slice(-1)[0],m=e.root.slice(0,-1);return u=this.fill("type",u),{sname:f,name:m+l,ext:e.ext,md5:e.md5,size:d.value,sizeDesc:d.desc,birthtime:a,mtime:s,type:c,types:u}},type:function(e,t){return{name:e.name,value:e.value,desc:e.desc||"",class:e.class||""}}}})}),n.on("render",function(e){c.log(e),n.fill(e),n.$.toggleClass("dir","dir"==e.type)})}),f.panel("/FileList/Sidebar/Tabs",function(e,t,n){const i=e("@definejs/tabs");var r=[{name:"常规",type:"general"},{name:"提纲",type:"outline"}],o=0,l=null;n.on("init",function(){(l=new i({container:n.$.get(0),activedClass:"on",eventName:"click",selector:">li",repeated:!0})).on("change",function(e,t){o=t,e=r[t],n.fire(e.type)})}),n.on("render",function(e){var t=e.index,n=e.outline,i=n?r:r.slice(0,-1);l.render(i,function(e,t){return{index:t,name:e.name}}),"number"==typeof t?o=t:t=o,n||(t=0),l.active(t)})}),f.panel("/FileList/Sidebar",function(e,t,n){const i=t.require("Stat"),r=t.require("Operation"),o=t.require("Outline"),l=t.require("Tabs");let c={width:0};return n.on("init",function(){l.on({general:function(){i.show(),r.show(),o.hide()},outline:function(){i.hide(),r.hide(),o.show()}}),r.on({cmd:function(e){n.fire("operation",e)},detail:function(e){c.width=c.width||n.$.width();let t=e?c.width:0;n.$.width(t),n.fire("hide",[t])}}),o.on({item:function(e,t){n.fire("outline",[e,t])}})}),n.on("render",function({detail:e,item:t}){let n="file"==t.data.type&&!e.isImage;i.render(e),r.render({detail:e,item:t}),l.render({outline:n})}),{outline:function(e){o.render(e)}}}),f("/FileList/Tree/Data",function(e,t,n){const i=e("File");function r(e){let{className:t}=i.getIcon({name:e});return t}return{make:function(e){let t=function e(t,n){let{dir$dirs:i,dir$files:o}=t;return i[n].map(function(i){let l=n+"/"+i;l=l.replace(/\/+/g,"/");let c=e(t,l),a=o[l];return a=a.map(function(e){let t=l+"/"+e;return{name:e,id:t,fileIcon:r(e),data:{type:"file",name:t,parent:l}}}),(c=[...c,...a]).length||c.push({name:"(空目录)",id:l+"/",data:{type:"file",name:"",parent:l}}),{name:i,id:l,data:{type:"dir",name:l,parent:n},list:c}})}(e,"/"),n=e.dir$files["/"];return n=n.map(function(e){let t="/"+e;return{name:e,id:t,fileIcon:r(e),data:{type:"file",name:t,parent:"/"}}}),t=[...t,...n],[{name:e.root.split("/").slice(-1)[0],id:"/",open:!0,data:{type:"dir",name:"/"},list:t}]}}}),f.panel("/FileList/Tree",function(e,t,n){const i=e("SidebarTree"),r=t.require("Data");let o=null;return n.on("init",function(){(o=new i({container:n.$,width:n.$.width()})).on({item:function(...e){n.fire("item",e)},dir:function(...e){n.fire("dir",e)},resize:function(...e){let t=o.$.outerWidth();n.$.width(t),n.fire("resize",e)}})}),n.on("render",function(e){let t=r.make(e);o.render(t)}),{open:function(e){o.open(e)}}}),f("/FileList/API",function(e,t,n){const i=e("@definejs/emitter"),r=e("@definejs/string"),o=e("@definejs/loading"),l=e("@definejs/toast"),c=e("API");let a=new i,s=new o({mask:0}),d=new l({duration:1500,mask:0});return{on:a.on.bind(a),get:function(){let e=new c("FileList.get",{});e.on({request:function(){s.show("加载中...")},response:function(){s.hide()},success:function(e,t,n){a.fire("success","get",[e])},fail:function(e,t,n,i){u.alert("获取文件列表失败: {0}",t)},error:function(e,t,n,i){u.alert("获取文件列表错误: 网络繁忙，请稍候再试")}}),e.get()},read:function(e){let t=new c("FileList.read",{});t.on({request:function(){s.show("加载中...")},response:function(){s.hide()},success:function(t,n,i){t.content;if(t.isImage){let e="![ ]({url})";t.content=r.format(e,{url:t.url})}let o=e.data.type,l={detail:t,item:e};a.fire("success","read",o,[l])},fail:function(e,t,n,i){u.alert("获取文件内容失败: {0}",t)},error:function(e,t,n,i){u.alert("获取文件内容错误: 网络繁忙，请稍候再试")}}),t.get({id:e.id})},delete:function(e){let t=e.data.type,n=`你确认要删除该${{file:"文件",dir:"目录"}[t]}（${e.id}）吗？ `;"dir"==t&&(n+='<p style="color: red;">这将会连同它的所有子目录和文件一起删除。</p>'),n+='<p style="color: #FF5722; font-weight: bold;">该操作会直接从服务器上删除目标项，且不可恢复！</p>',u.confirm(n,function(){let n=new c("FileList.delete");n.on({request:function(){s.show("删除中...")},response:function(){s.hide()},success:function(t,n,i){d.show("删除成功",function(t){a.fire("success","delete",[{id:e.id,parent:e.parent.id}])})},fail:function(e,t,n,i){u.alert("删除失败: {0}",t)},error:function(e,t,n,i){u.alert("删除错误: 网络繁忙，请稍候再试")}}),n.post({id:e.id,type:t})})}}}),f.view("/FileList",function(e,t,n){const i=e("@definejs/session-storage"),r=t.require("API"),o=t.require("Tree"),l=t.require("Sidebar"),c=t.require("Body");let a=new i(t.id),s={item:{id:"/"},detail:null};n.on("init",function(){r.on("success",{get:function(e){let t=function(e,t){return t==e?"/":(t.startsWith(`${e}/`)&&(t=t.slice(e.length)),t)}(e.root,s.item.id);s.item.id=t,o.render(e),o.open(t)},read:{dir:function({detail:e,item:t}){c.render("dir",{list:e.list,item:t,root:e.root}),l.render({detail:e,item:t})},file:function({detail:e,item:t}){s.detail=e,c.render("file",e),l.render({detail:e,item:t})}},delete:function(e){s.item.id=e.parent,r.get()}}),o.on({item:function(e){a.set("id",e.id),s.item=e,r.read(e)},resize:function(){let e=o.$.outerWidth(),t=l.$.outerWidth();c.resize(e,t,6)}}),c.on({outline:function(e){l.outline(e)},item:function(e){o.open(e.name)},path:function(e){}}),l.on({outline:function(e,t){c.outline(t)},hide:function(e){let t=o.$.outerWidth();c.resize(t,e,6)}}),l.on("operation",{refresh:function(){r.get()},delete:function(){r.delete(s.item)},open:function(){n.fire("open",[s.detail.url])},edit:function(){n.fire("edit",[s.item.id])},demo:function(){n.fire("demo",[s.item.id])}})}),n.on("render",function(e){let t=e||a.get("id")||"/";s.path=t,s.item={id:t},r.get()})}),f("/Home/FileList/Main/Data",function(e,t,n){const i=new Set([".png",".jpg",".jpeg",".gif",".bmp"]);return{parse(e){let t=[],n=[],r=[],o={},l=0,c={is:0,not:0};e.forEach(e=>{let{type:a,ext:s,stat:d,isUTF8:u}=e;"dir"!=a?(n.push(e),function(e,t,n){let i=e[t];i||(i=e[t]=[]),i.push(n)}(o,s,e),i.has(s)&&r.push(e),l+=d.size,c[u?"is":"not"]++):t.push(e)});let a=v.keys(o).map(e=>{return{ext:e,files:o[e]}});return{list:e,dirs:t,files:n,images:r,ext$files:o,exts:a,size:l,utf8:c}}}}),f("/Home/FileList/API",function(e,t,n){const i=e("@definejs/emitter"),r=e("API");let o=new i;return{on:o.on.bind(o),get:function(){let e=new r("FileList.read",{});e.on({request:function(){},response:function(){},success:function(e,t,n){o.fire("success","get",[e])},fail:function(e,t,n,i){u.alert("获取文件列表失败: {0}",t)},error:function(e,t,n,i){u.alert("获取文件列表错误: 网络繁忙，请稍候再试")}}),e.get({id:"/"})}}}),f.panel("/Home/FileList/Loading",function(e,t,n){n.on("init",function(){}),n.on("render",function(){})}),f.panel("/Home/FileList/Main",function(e,t,n){const i=e("File"),r=t.require("Data");n.on("init",function(){n.template({"":function(e){return this.fill("html",e)},html:{"":function(e){let{list:t,dirs:n,files:r,images:o,ext$files:l,exts:c,size:a,utf8:s}=e,d=this.fill("type",c),u=i.getSizeDesc(a);return{all:t.length,sizeValue:u.value,sizeDesc:u.desc,dir:n.length,file:r.length,image:o.length,types:d,isUTF8:s.is,notUTF8:s.not}},type:function(e,t){let{ext:n,files:i}=e;return{ext:n=n.slice(1)||"(none)",count:i.length}}}})}),n.on("render",function(e){e=r.parse(e.list),n.fill(e)})}),f("/Home/JsModule/Main/Data",function(e,t,n){return{parse(e){c.log(t.id,e);let{ids:n,id$module:i,id$children:r,singles:o,level$ids:l}=e.moduleStat,a=[],s=[],d=[],u=[],f=[],m=[],h=[];n.forEach(e=>{if(!e)return void a.push(e);let{level:t}=i[e];(r[e]||[]).length>0&&u.push(e),1==t?s.push(e):d.push(e);let n=i[e],{method:o}=n;o.endsWith(".view")?f.push(e):o.endsWith(".panel")?m.push(e):h.push(e)});let p=v.keys(l).map(e=>{return{level:e,ids:l[e]}});return{ids:n,nones:a,publics:s,privates:d,singles:o,parents:u,views:f,panels:m,defines:h,levels:p}}}}),f("/Home/JsModule/API",function(e,t,n){const i=e("@definejs/emitter"),r=e("API");let o=new i;return{on:o.on.bind(o),get:function(){let e=new r("Stat.get",{});e.on({request:function(){},response:function(){},success:function(e,t,n){o.fire("success","get",[e])},fail:function(e,t,n,i){u.alert("获取统计数据失败: {0}",t)},error:function(e,t,n,i){u.alert("获取统计数据错误: 网络繁忙，请稍候再试")}}),e.get()}}}),f.panel("/Home/JsModule/Loading",function(e,t,n){n.on("init",function(){}),n.on("render",function(){})}),f.panel("/Home/JsModule/Main",function(e,t,n){const i=t.require("Data");n.on("init",function(){n.template({"":function(e){return this.fill("html",e)},html:{"":function(e){let{ids:t,nones:n,publics:i,privates:r,singles:o,parents:l,views:c,panels:a,defines:s,levels:d}=e,u=this.fill("level",d);return{all:t.length,none:n.length,public:i.length,private:r.length,view:c.length,panel:a.length,define:s.length,single:o.length,parent:l.length,child:r.length,levels:u}},level:function(e){return{level:e.level,count:e.ids.length}}}})}),n.on("render",function(e){let t=i.parse(e);n.fill(t)})}),f.panel("/Home/FileList",function(e,t,n){const i=t.require("API"),r=t.require("Loading"),o=t.require("Main");n.on("init",function(){i.on("success",{get:function(e){r.hide(),o.render(e)}})}),n.on("render",function(){o.hide(),r.render(),i.get()})}),f.panel("/Home/JsModule",function(e,t,n){const i=t.require("API"),r=t.require("Loading"),o=t.require("Main");n.on("init",function(){i.on("success",{get:function(e){r.hide(),o.render(e)}})}),n.on("render",function(){o.hide(),r.render(),i.get()})}),f.view("/Home",function(e,t,n){const i=t.require("JsModule"),r=t.require("FileList");n.on("init",function(){}),n.on("render",function(){i.render(),r.render()})}),f.panel("/HtmlTree/Main/HtmlBlock/BaseInfo/Children/GridView",function(e,t,n){const i=e("GridView");let r=null,o=null;n.on("init",function(){o=n.template(),(r=new i({container:n.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"节点名称",name:"name",width:300,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"所在文件",name:"file",width:500,class:"file",dragable:!0,delegate:"[data-cmd]"}]})).on("process","row",function(e){}),r.on("process","cell",{name:function(e){let t=e.row.data;return o.fill("href",{cmd:"id",text:t.name})},file:function(e){let t=e.row.data;return o.fill("href",{cmd:"file",text:t.file})}}),r.on("click","cell",function(e,t){let i=t.target.dataset.cmd;i&&(t.stopPropagation(),n.fire("cmd",[i,e.row.data]))}),r.render()}),n.on("render",function(e){r.fill(e)})}),f.panel("/HtmlTree/Main/HtmlBlock/BaseInfo/Childs/GridView",function(e,t,n){const i=e("GridView");let r=null,o=null;n.on("init",function(){o=n.template(),(r=new i({container:n.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"节点名称",name:"name",width:300,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"所在文件",name:"file",width:500,class:"file",dragable:!0,delegate:"[data-cmd]"}]})).on("process","row",function(e){}),r.on("process","cell",{name:function(e){let t=e.row.data;return o.fill("href",{cmd:"id",text:t.name})},file:function(e){let t=e.row.data;return o.fill("href",{cmd:"file",text:t.file})}}),r.on("click","cell",function(e,t){let i=t.target.dataset.cmd;i&&(t.stopPropagation(),n.fire("cmd",[i,e.row.data]))}),r.render()}),n.on("render",function(e){r.fill(e)})}),f.panel("/HtmlTree/Main/HtmlBlock/BaseInfo/Base",function(e,t,n){const i=e("@definejs/escape");let r={node:null};n.on("init",function(){n.template(function(e){let{data:t,parent:n}=e,r=i.html(t.tags.begin),o=i.html(t.tags.end),l=JSON.stringify(t.patterns,null,4);return{tabs:t.tabs,beginNo:t.begin+1,endNo:t.end+1,beginTag:r,endTag:o,patterns:l,parent:`${n.cid} - ${n.name}`}}),n.$on("click",{'[data-cmd="parent"]':function(e){let t=r.node.parent.id;n.fire("id",[t])},'[data-cmd="file"]':function(e){let t=r.node.data.file;n.fire("file",[t])},'[data-cmd="dir"]':function(e){let t=r.node.data.link.dir;t.endsWith("/")&&(t=t.slice(0,-1)),n.fire("file",[t])},'[data-cmd="rel"]':function(e){n.fire("rel")}})}),n.on("render",function(e){r.node=e,n.fill(e)})}),f.panel("/HtmlTree/Main/HtmlBlock/BaseInfo/Children",function(e,t,n){const i=t.require("GridView");n.set("show",!1),n.on("init",function(){i.on({cmd:function(e,t){let i=t[e];n.fire(e,[i])}})}),n.on("render",function(e){let t=e.children.map(e=>{let{data:t}=e;return{id:e.id,name:`${e.cid} - ${e.name}`,file:t.file,list:e.list.length}});i.render(t),n.show()})}),f.panel("/HtmlTree/Main/HtmlBlock/BaseInfo/Childs",function(e,t,n){const i=t.require("GridView");n.set("show",!1),n.on("init",function(){i.on({cmd:function(e,t){let i=t[e];n.fire(e,[i])}})}),n.on("render",function(e){let t=e.list.map(e=>{let{data:t}=e;return{id:e.id,name:`${e.cid} - ${e.name}`,file:t.file,list:e.list.length}});i.render(t),n.show()})}),f.panel("/HtmlTree/Main/HtmlBlock/BaseInfo",function(e,t,n){const i=t.require("Base"),r=t.require("Childs"),o=t.require("Children");n.on("init",function(){[i,r,o].forEach(e=>{e.on({file:function(e){n.fire("file",[e])},id:function(e){n.fire("id",[e])}})}),i.on({rel:function(){n.fire("rel")}})}),n.on("render",function(e){i.render(e),r.render(e),e.children.length>e.list.length?o.render(e):o.hide()})}),f("/HtmlTree/Main/HtmlBlock/Rel/Data",function(e,t,n){return{get(e){let{parent:t}=e;return{file:t.data.file,content:t.data.content,beginNo:e.data.begin,endNo:e.data.end}}}}),f.panel("/HtmlTree/Main/HtmlBlock/Rel/Header",function(e,t,n){const i=e("File");let r={file:""};return n.on("init",function(){n.$on("click",{'[data-cmd="file"]':function(e){n.fire("file",[r.file])}})}),n.on("render",function(e){let t=i.getIcon(e);r.file=e,n.fill({icon:t.html,file:e})}),{}}),f.panel("/HtmlTree/Main/HtmlBlock/Rel/MarkDoc",function(e,t,n){const i=e("MarkDoc"),r=e("$");let o=null;return n.on("init",function(){o=new i({container:n.$})}),n.on("render",function(e){o.render({content:e,language:"html",baseUrl:"",code:{format:!0}})}),{highlight(e,t){let n=o.$.find("ul.line-numbers>li").toArray();(n=n.slice(e,t+1)).forEach(e=>{r(e).addClass("on")}),s(()=>{n[0].scrollIntoViewIfNeeded()},200)}}}),f.panel("/HtmlTree/Main/HtmlBlock/Rel",function(e,t,n){const i=t.require("Data"),r=t.require("Header"),o=t.require("MarkDoc");return n.on("init",function(){r.on({file:function(e){n.fire("file",[e])}})}),n.on("render",function(e){let{file:t,content:n,beginNo:l,endNo:c}=i.get(e);r.render(t),o.render(n),o.highlight(l,c)}),{}}),f.panel("/HtmlTree/Main/HtmlBlock/Render",function(e,t,n){const i=e("MarkDoc");let r=null;return n.on("init",function(){r=new i({container:n.$})}),n.on("render",function(e){let t=e.data.block.render,n=e.data.tabs;if(n>0){t=t.split("\n").map(e=>e.slice(n)).join("\n")}r.render({content:t,language:"html",baseUrl:"",code:{format:!0}})}),{}}),f.panel("/HtmlTree/Main/HtmlBlock/Tabs",function(e,t,n){const i=e("@definejs/tabs"),r=e("@definejs/local-storage");let o=[{name:"基本信息",cmd:"base"},{name:"引用原文",cmd:"rel"},{name:"渲染内容",cmd:"render"}],l=null,c=null,a={index:0,list:[],cmd$module:null};return n.on("init",function(){c=new r(t.id),a.index=c.get("index")||0,(l=new i({container:n.$.get(0),activedClass:"on",eventName:"click",selector:">li",repeated:!0})).on("change",function(e,t){a.index=t,e=a.list[t],c.set("index",t);let{cmd:i}=e,{cmd$module:r}=a;r&&v.keys(r).forEach(e=>{let t=r[e];e==i?n.fire("change",[t]):t.hide()}),n.fire("cmd",i,[])})}),n.on("render",function(e){a.list=o,e&&(a.list=a.list.filter(e=>e.root)),l.render(a.list,function(e,t){return{index:t,name:e.name}}),a.index>a.list.length-1&&(a.index=0),l.active(a.index)}),{active(e){let t=a.list.findIndex(t=>t.cmd==e);l.active(t)},map(e){a.cmd$module=e}}}),f.panel("/HtmlTree/Main/HtmlBlock",function(e,t,n){const i=t.require("Tabs"),r=t.require("BaseInfo"),o=t.require("Rel"),l=t.require("Render");let c={item:null};return n.on("init",function(){i.map({base:r,rel:o,render:l}),i.on({change:function(e){e.render(c.item)}}),[r,o].forEach(e=>{e.on({file:function(e){n.fire("file",[e])},id:function(e){n.fire("id",[e])}})}),r.on({rel:function(){i.active("rel")}})}),n.on("render",function(e){c.item=e,i.render()}),{}}),f.panel("/HtmlTree/Main/HtmlLink/BaseInfo/Children/GridView",function(e,t,n){const i=e("GridView");let r=null,o=null;n.on("init",function(){o=n.template(),(r=new i({container:n.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"节点名称",name:"name",width:300,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"所在文件",name:"file",width:500,class:"file",dragable:!0,delegate:"[data-cmd]"}]})).on("process","row",function(e){}),r.on("process","cell",{name:function(e){let t=e.row.data;return o.fill("href",{cmd:"id",text:t.name})},file:function(e){let t=e.row.data;return o.fill("href",{cmd:"file",text:t.file})}}),r.on("click","cell",function(e,t){let i=t.target.dataset.cmd;i&&(t.stopPropagation(),n.fire("cmd",[i,e.row.data]))}),r.render()}),n.on("render",function(e){r.fill(e)})}),f.panel("/HtmlTree/Main/HtmlLink/BaseInfo/Childs/GridView",function(e,t,n){const i=e("GridView");let r=null,o=null;n.on("init",function(){o=n.template(),(r=new i({container:n.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"节点名称",name:"name",width:300,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"所在文件",name:"file",width:500,class:"file",dragable:!0,delegate:"[data-cmd]"}]})).on("process","row",function(e){}),r.on("process","cell",{name:function(e){let t=e.row.data;return o.fill("href",{cmd:"id",text:t.name})},file:function(e){let t=e.row.data;return o.fill("href",{cmd:"file",text:t.file})}}),r.on("click","cell",function(e,t){let i=t.target.dataset.cmd;i&&(t.stopPropagation(),n.fire("cmd",[i,e.row.data]))}),r.render()}),n.on("render",function(e){r.fill(e)})}),f.panel("/HtmlTree/Main/HtmlLink/BaseInfo/Base",function(e,t,n){const r=e("MarkDoc");let o=null,l={node:null};n.on("init",function(){n.template({"":function(e){let t=e.data.href?"static":"block";return this.fill(t,e)},static:function(e){let{data:t,parent:n}=e,l=function(e){return(o=o||new r({container:i.createElement("div")})).render({content:e,language:"html",code:{numbers:!1,language:!1}}),e=o.$.html()}(t.item);return{href:t.href,file:t.file,tabs:t.tabs,no:t.no+1,dir:t.link.dir,rel:l,parent:`${n.cid} - ${n.name}`}},block:function(e){let{data:t,parent:n}=e;return{file:t.file,dir:t.link.dir,parent:`${n.cid} - ${n.name}`}}}),n.$on("click",{'[data-cmd="parent"]':function(e){let t=l.node.parent.id;n.fire("id",[t])},'[data-cmd="file"]':function(e){let t=l.node.data.file;n.fire("file",[t])},'[data-cmd="dir"]':function(e){let t=l.node.data.link.dir;t.endsWith("/")&&(t=t.slice(0,-1)),n.fire("file",[t])},'[data-cmd="rel"]':function(e){n.fire("rel")}})}),n.on("render",function(e){l.node=e,n.fill(e)})}),f.panel("/HtmlTree/Main/HtmlLink/BaseInfo/Children",function(e,t,n){const i=t.require("GridView");n.set("show",!1),n.on("init",function(){i.on({cmd:function(e,t){let i=t[e];n.fire(e,[i])}})}),n.on("render",function(e){let t=e.children.map(e=>{let{data:t}=e,n=t.link.content.split("\n");return{id:e.id,name:`${e.cid} - ${e.name}`,file:t.file,lines:n.length,list:e.list.length}});i.render(t),n.show()})}),f.panel("/HtmlTree/Main/HtmlLink/BaseInfo/Childs",function(e,t,n){const i=t.require("GridView");n.set("show",!1),n.on("init",function(){i.on({cmd:function(e,t){let i=t[e];n.fire(e,[i])}})}),n.on("render",function(e){let t=e.list.map(e=>{let{data:t}=e,n=t.link.content.split("\n");return{id:e.id,name:`${e.cid} - ${e.name}`,file:t.file,lines:n.length,list:e.list.length}});i.render(t),n.show()})}),f.panel("/HtmlTree/Main/HtmlLink/BaseInfo",function(e,t,n){const i=t.require("Base"),r=t.require("Childs"),o=t.require("Children");n.on("init",function(){[i,r,o].forEach(e=>{e.on({file:function(e){n.fire("file",[e])},id:function(e){n.fire("id",[e])}})}),i.on({rel:function(){n.fire("rel")}})}),n.on("render",function(e){i.render(e),r.render(e),e.children.length>e.list.length?o.render(e):o.hide()})}),f("/HtmlTree/Main/HtmlLink/Content/Data",function(e,t,n){return{get(e){let{data:t}=e,{content:n,file:i}=t.link;return{file:i,content:n}}}}),f.panel("/HtmlTree/Main/HtmlLink/Content/Header",function(e,t,n){const i=e("File");let r={file:""};return n.on("init",function(){n.$on("click",{'[data-cmd="file"]':function(e){n.fire("file",[r.file])}})}),n.on("render",function(e){let t=i.getIcon(e);r.file=e,n.fill({icon:t.html,file:e})}),{}}),f.panel("/HtmlTree/Main/HtmlLink/Content/MarkDoc",function(e,t,n){const i=e("MarkDoc"),r=e("$");let o=null;return n.on("init",function(){o=new i({container:n.$})}),n.on("render",function(e){o.render({content:e,language:"html",baseUrl:"",code:{format:!0}})}),{highlight(e,t){let n=[];o.$.find("ul.line-numbers>li").each(function(i){let o=this;e<=i&&i<=t&&(r(o).addClass("on"),n.push(o))}),n.length>0&&s(()=>{n[0].scrollIntoViewIfNeeded()},200)}}}),f.panel("/HtmlTree/Main/HtmlLink/Content",function(e,t,n){const i=t.require("Data"),r=t.require("Header"),o=t.require("MarkDoc");return n.on("init",function(){r.on({file:function(e){n.fire("file",[e])}})}),n.on("render",function(e){let{file:t,content:n}=i.get(e);r.render(t),o.render(n)}),{}}),f.panel("/HtmlTree/Main/HtmlLink/FileInfo",function(e,t,n){const i=e("File"),r=e("@definejs/date"),o=i.API();let l={file:"",dir:""};n.on("init",function(){n.$on("click",{'[data-cmd="file"]':function(e){n.fire("file",[l.file])},'[data-cmd="dir"]':function(e){n.fire("file",[l.dir])}}),o.on("success",{read:function(e){let t=l.file.split("/").slice(-1)[0],o=e.content.split("\n"),{stat:c}=e,a=i.getSizeDesc(c.size),s=e.ext.slice(1)+" 文件",d=r.format(c.birthtime,"yyyy-MM-dd HH:mm:ss"),u=r.format(c.mtime,"yyyy-MM-dd HH:mm:ss");n.fill({name:t,file:l.file,dir:l.dir,ext:e.ext,md5:e.md5,type:s,lines:o.length,size:a.value,sizeDesc:a.desc,birthtime:d,mtime:u,isUTF8:e.isUTF8?"是":"否"})}})}),n.on("render",function(e){let{file:t}=e.data;t!=l.file&&(l.file=t,l.dir=t.split("/").slice(0,-1).join("/"),o.read(t))})}),f("/HtmlTree/Main/HtmlLink/Rel/Data",function(e,t,n){return{get(e){let{parent:t}=e,{data:n}=t;if(n.link){let n=t.data.link,i=e.data.no;return{file:n.file,content:n.content,beginNo:i,endNo:i}}if(n.block){let e=t.parent.data;return{file:e.file,content:e.content,beginNo:n.begin,endNo:n.end}}if("MasterPage"==n.type){let n=t.data,i=e.data.no;return{file:n.file,content:n.content,beginNo:i,endNo:i}}throw new g("无法识别的 node 节点。")}}}),f.panel("/HtmlTree/Main/HtmlLink/Rel/Header",function(e,t,n){const i=e("File");let r={file:""};return n.on("init",function(){n.$on("click",{'[data-cmd="file"]':function(e){n.fire("file",[r.file])}})}),n.on("render",function(e){let t=i.getIcon(e);r.file=e,n.fill({icon:t.html,file:e})}),{}}),f.panel("/HtmlTree/Main/HtmlLink/Rel/MarkDoc",function(e,t,n){const i=e("MarkDoc"),r=e("$");let o=null;return n.on("init",function(){o=new i({container:n.$})}),n.on("render",function(e){o.render({content:e,language:"html",baseUrl:"",code:{format:!0}})}),{highlight(e,t){let n=o.$.find("ul.line-numbers>li").toArray();(n=n.slice(e,t+1)).forEach(e=>{r(e).addClass("on")}),s(()=>{n[0].scrollIntoViewIfNeeded()},200)}}}),f.panel("/HtmlTree/Main/HtmlLink/Rel",function(e,t,n){const i=t.require("Data"),r=t.require("Header"),o=t.require("MarkDoc");return n.on("init",function(){r.on({file:function(e){n.fire("file",[e])}})}),n.on("render",function(e){let{file:t,content:n,beginNo:l,endNo:c}=i.get(e);r.render(t),o.render(n),o.highlight(l,c)}),{}}),f.panel("/HtmlTree/Main/HtmlLink/Render",function(e,t,n){const i=e("MarkDoc");let r=null;return n.on("init",function(){r=new i({container:n.$})}),n.on("render",function(e){let t=e.data.link.render,n=e.data.tabs;if(n>0){t=t.split("\n").map(e=>e.slice(n)).join("\n")}r.render({content:t,language:"html",baseUrl:"",code:{format:!0}})}),{}}),f.panel("/HtmlTree/Main/HtmlLink/Tabs",function(e,t,n){const i=e("@definejs/tabs"),r=e("@definejs/local-storage");let o=[{name:"基本信息",cmd:"base"},{name:"引用原文",cmd:"rel"},{name:"渲染内容",cmd:"render"},{name:"文件内容",cmd:"content"},{name:"文件信息",cmd:"file"}],l=null,c=null,a={index:0,list:[],cmd$module:null};return n.on("init",function(){c=new r(t.id),a.index=c.get("index")||0,(l=new i({container:n.$.get(0),activedClass:"on",eventName:"click",selector:">li",repeated:!0})).on("change",function(e,t){a.index=t,e=a.list[t],c.set("index",t);let{cmd:i}=e,{cmd$module:r}=a;r&&v.keys(r).forEach(e=>{let t=r[e];e==i?n.fire("change",[t]):t.hide()}),n.fire("cmd",i,[])})}),n.on("render",function(e){a.list=o,e&&(a.list=a.list.filter(e=>e.root)),l.render(a.list,function(e,t){return{index:t,name:e.name}}),a.index>a.list.length-1&&(a.index=0),l.active(a.index)}),{active(e){let t=a.list.findIndex(t=>t.cmd==e);l.active(t)},map(e){a.cmd$module=e}}}),f.panel("/HtmlTree/Main/HtmlLink",function(e,t,n){const i=t.require("Tabs"),r=t.require("Content"),o=t.require("FileInfo"),l=t.require("BaseInfo"),c=t.require("Rel"),a=t.require("Render");let s={item:null};return n.on("init",function(){i.map({base:l,file:o,content:r,rel:c,render:a}),i.on({change:function(e){e.render(s.item)}}),[o,l,c,r].forEach(e=>{e.on({file:function(e){n.fire("file",[e])},id:function(e){n.fire("id",[e])}})}),l.on({rel:function(){i.active("rel")}})}),n.on("render",function(e){s.item=e,i.render()}),{}}),f.panel("/HtmlTree/Main/JsLink/BaseInfo/Base",function(e,t,n){const r=e("MarkDoc");let o=null,l={node:null,dir:""};n.on("init",function(){n.template({"":function(e){let t=e.data.html?"static":"block";return this.fill(t,e)},static:function(e){let{data:t,parent:n}=e,c=function(e){return(o=o||new r({container:i.createElement("div")})).render({content:e,language:"html",code:{numbers:!1,language:!1}}),e=o.$.html()}(t.html),a=t.file.split("/").slice(0,-1).join("/");return l.dir=a,{type:t.link.type,href:t.href,file:t.file,tabs:t.tabs,no:t.no+1,dir:a,rel:c,parent:`${n.cid} - ${n.name}`}},block:function(e){let{data:t,parent:n}=e,i=t.file.split("/").slice(0,-1).join("/");return l.dir=i,{type:t.link.type,file:t.file,dir:i,parent:`${n.cid} - ${n.name}`}}}),n.$on("click",{'[data-cmd="parent"]':function(e){let t=l.node.parent.id;n.fire("id",[t])},'[data-cmd="file"]':function(e){let t=l.node.data.file;n.fire("file",[t])},'[data-cmd="dir"]':function(e){n.fire("file",[l.dir])},'[data-cmd="rel"]':function(e){n.fire("rel")}})}),n.on("render",function(e){l.node=e,n.fill(e)})}),f.panel("/HtmlTree/Main/JsLink/BaseInfo",function(e,t,n){const i=t.require("Base");n.on("init",function(){[i].forEach(e=>{e.on({file:function(e){n.fire("file",[e])},id:function(e){n.fire("id",[e])}})}),i.on({rel:function(){n.fire("rel")}})}),n.on("render",function(e){i.render(e)})}),f("/HtmlTree/Main/JsLink/Compile/API",function(e,t,n){const i=e("@definejs/emitter"),r=e("@definejs/loading"),o=e("API");let l=new i,a=new r({mask:0});return{on:l.on.bind(l),compile:function(e){let t=new o("Less.compile",{});t.on({request:function(){a.show("编译中...")},response:function(){a.hide()},success:function(e,t,n){c.log(e),l.fire("success","compile",[e])},fail:function(e,t,n,i){},error:function(e,t,n,i){u.alert("获取解析错误: 网络繁忙，请稍候再试")}}),t.post({file:e.file,dest:e.dest,minify:!1})}}}),f.panel("/HtmlTree/Main/JsLink/Compile/Header",function(e,t,n){const i=e("File");let r={file:""};return n.on("init",function(){n.$on("click",{'[data-cmd="file"]':function(e){n.fire("file",[r.file])}})}),n.on("render",function(e){let t=i.getIcon(e);r.file=e,n.fill({icon:t.html,file:e})}),{}}),f.panel("/HtmlTree/Main/JsLink/Compile/MarkDoc",function(e,t,n){const i=e("MarkDoc");let r=null;return n.on("init",function(){r=new i({container:n.$})}),n.on("render",function(e){r.render({content:e,language:"css"})}),{}}),f.panel("/HtmlTree/Main/JsLink/Compile",function(e,t,n){const i=t.require("API"),r=t.require("Header"),o=t.require("MarkDoc");return n.on("init",function(){r.on({file:function(e){n.fire("file",[e])}}),i.on("success",{compile:function(e){o.render(e.css)}})}),n.on("render",function(e){let{file:t,dest:n}=e.data;r.render(n.file),i.compile({file:t,dest:n.file})}),{}}),f.panel("/HtmlTree/Main/JsLink/Content/Header",function(e,t,n){const i=e("File");let r={file:""};return n.on("init",function(){n.$on("click",{'[data-cmd="file"]':function(e){n.fire("file",[r.file])}})}),n.on("render",function(e){let t=i.getIcon(e);r.file=e,n.fill({icon:t.html,file:e})}),{}}),f.panel("/HtmlTree/Main/JsLink/Content/MarkDoc",function(e,t,n){const i=e("MarkDoc"),r=e("$");let o=null;return n.on("init",function(){o=new i({container:n.$})}),n.on("render",function({content:e,ext:t}){let n=t.startsWith(".")?t.slice(1):t;o.render({content:e,language:n,baseUrl:"",code:{format:!0}})}),{highlight(e,t){let n=[];o.$.find("ul.line-numbers>li").each(function(i){let o=this;e<=i&&i<=t&&(r(o).addClass("on"),n.push(o))}),n.length>0&&s(()=>{n[0].scrollIntoViewIfNeeded()},200)}}}),f.panel("/HtmlTree/Main/JsLink/Content",function(e,t,n){const i=e("File").API(),r=t.require("Header"),o=t.require("MarkDoc");let l={file:""};return n.on("init",function(){r.on({file:function(e){n.fire("file",[e])}}),i.on("success",{read:function(e){o.render(e)}})}),n.on("render",function(e){let{file:t}=e.data;t!=l.file&&(l.file=t,r.render(t),i.read(t))}),{}}),f.panel("/HtmlTree/Main/JsLink/FileInfo",function(e,t,n){const i=e("File"),r=e("@definejs/date"),o=i.API();let l={file:"",dir:""};n.on("init",function(){n.$on("click",{'[data-cmd="file"]':function(e){n.fire("file",[l.file])},'[data-cmd="dir"]':function(e){n.fire("file",[l.dir])}}),o.on("success",{read:function(e){let t=l.file,o=t.split("/").slice(-1)[0],c=e.content.split("\n"),{stat:a}=e,s=i.getSizeDesc(a.size),d=e.ext.slice(1)+" 文件",u=r.format(a.birthtime,"yyyy-MM-dd HH:mm:ss"),f=r.format(a.mtime,"yyyy-MM-dd HH:mm:ss");n.fill({name:o,file:t,ext:e.ext,md5:e.md5,dir:l.dir,type:d,lines:c.length,size:s.value,sizeDesc:s.desc,birthtime:u,mtime:f,isUTF8:e.isUTF8?"是":"否",utf8Class:e.isUTF8})}})}),n.on("render",function(e){let{file:t}=e.data;t!=l.file&&(l.file=t,l.dir=t.split("/").slice(0,-1).join("/"),o.read(t))})}),f("/HtmlTree/Main/JsLink/Rel/Data",function(e,t,n){return{get(e){let{parent:t}=e,{data:n}=t;if(n.link){let n=t.data.link,i=e.data.no;return{file:n.file,content:n.content,beginNo:i,endNo:i}}if(n.block){let e=t.parent.data;return{file:e.file,content:e.content,beginNo:n.begin,endNo:n.end}}if("MasterPage"==n.type){let n=t.data,i=e.data.no;return{file:n.file,content:n.content,beginNo:i,endNo:i}}throw new g("无法识别的 node 节点。")}}}),f.panel("/HtmlTree/Main/JsLink/Rel/Header",function(e,t,n){const i=e("File");let r={file:""};return n.on("init",function(){n.$on("click",{'[data-cmd="file"]':function(e){n.fire("file",[r.file])}})}),n.on("render",function(e){let t=i.getIcon(e);r.file=e,n.fill({icon:t.html,file:e})}),{}}),f.panel("/HtmlTree/Main/JsLink/Rel/MarkDoc",function(e,t,n){const i=e("MarkDoc"),r=e("$");let o=null;return n.on("init",function(){o=new i({container:n.$})}),n.on("render",function(e){o.render({content:e,language:"html",baseUrl:"",code:{format:!0}})}),{highlight(e,t){let n=o.$.find("ul.line-numbers>li").toArray();(n=n.slice(e,t+1)).forEach(e=>{r(e).addClass("on")}),s(()=>{n[0].scrollIntoViewIfNeeded()},200)}}}),f.panel("/HtmlTree/Main/JsLink/Rel",function(e,t,n){const i=t.require("Data"),r=t.require("Header"),o=t.require("MarkDoc");return n.on("init",function(){r.on({file:function(e){n.fire("file",[e])}})}),n.on("render",function(e){let{file:t,content:n,beginNo:l,endNo:c}=i.get(e);r.render(t),o.render(n),o.highlight(l,c)}),{}}),f.panel("/HtmlTree/Main/JsLink/Render",function(e,t,n){const i=e("MarkDoc");let r=null;return n.on("init",function(){r=new i({container:n.$})}),n.on("render",function(e){let t=e.data.link.render,n=e.data.tabs;if(n===M&&(n=e.parent.data.tabs),n>0){t=t.split("\n").map(e=>e.slice(n)).join("\n")}r.render({content:t,language:"html",baseUrl:"",code:{format:!0}})}),{}}),f.panel("/HtmlTree/Main/JsLink/Tabs",function(e,t,n){const i=e("@definejs/tabs"),r=e("@definejs/local-storage");let o=[{name:"基本信息",cmd:"base"},{name:"引用原文",cmd:"rel"},{name:"渲染内容",cmd:"render"},{name:"文件信息",cmd:"file"},{name:"文件内容",cmd:"content"},{name:"编译内容",cmd:"compile"}],l=null,c=null,a={index:0,list:[],cmd$module:null};return n.on("init",function(){c=new r(t.id),a.index=c.get("index")||0,(l=new i({container:n.$.get(0),activedClass:"on",eventName:"click",selector:">li",repeated:!0})).on("change",function(e,t){a.index=t,e=a.list[t],c.set("index",t);let{cmd:i}=e,{cmd$module:r}=a;r&&v.keys(r).forEach(e=>{let t=r[e];e==i?n.fire("change",[t]):t.hide()}),n.fire("cmd",i,[])})}),n.on("render",function(e){a.list=o,e||(a.list=a.list.filter(e=>"compile"!=e.cmd)),l.render(a.list,function(e,t){return{index:t,name:e.name}}),a.index>a.list.length-1&&(a.index=0),l.active(a.index)}),{active(e){let t=a.list.findIndex(t=>t.cmd==e);l.active(t)},map(e){a.cmd$module=e}}}),f.panel("/HtmlTree/Main/JsLink",function(e,t,n){const i=t.require("Tabs"),r=t.require("Content"),o=t.require("FileInfo"),l=t.require("BaseInfo"),c=t.require("Rel"),a=t.require("Compile"),s=t.require("Render");let d={item:null};return n.on("init",function(){i.map({base:l,file:o,content:r,rel:c,compile:a,render:s}),i.on({change:function(e){e.render(d.item)}}),[o,l,c,r,a].forEach(e=>{e.on({file:function(e){n.fire("file",[e])},id:function(e){n.fire("id",[e])}})}),l.on({rel:function(){i.active("rel")}})}),n.on("render",function(e){let t="LessLink"==e.data.link.type;d.item=e,i.render(t)}),{}}),f("/HtmlTree/Main/Nav/Data",function(e,t,n){return{make(e){let t=[e,...e.parents].reverse(),n=t.map(e=>e.name),i={type:e.list.length>0?"dir":"file",name:e.data.file||".html"};n.join(">");return{list:t,names:n,icon:i}}}}),f.panel("/HtmlTree/Main/Nav",function(e,t,n){const i=e("MenuNav"),r=t.require("Data");let o=null,l={list:[],item:null,stat:null};n.on("init",function(){(o=new i({container:n.$})).on({item:function(e,t){let i=l.list[t];n.fire("item",[i])}})}),n.on("render",function(e){let{list:t,names:n,path:i,icon:c}=r.make(e);l.list=t,o.render({names:n,path:i,icon:c})})}),f.panel("/HtmlTree/Main",function(e,t,n){const i=t.require("Nav"),r=t.require("JsLink"),o=t.require("HtmlLink"),l=t.require("HtmlBlock");t.require("MasterPage");return n.on("init",function(){i.on({item:function(e){n.fire("id",[e.id])}}),[r,o,l].forEach(e=>{e.on({file:function(e){n.fire("file",[e])},id:function(e){n.fire("id",[e])}})})}),n.on("render",function(e){i.render(e);let{link:t,block:n}=e.data;t?("HtmlLink"==t.type?(r.hide(),o.render(e)):(r.render(e),o.hide()),l.hide()):n?(r.hide(),o.hide(),l.render(e)):(r.hide(),o.hide(),l.hide())}),{resize(...e){let t="calc(100% - "+e.reduce(function(e,t){return e+t},0)+"px)";n.$.css({width:t})}}}),f("/HtmlTree/Tree/Data",function(e,t,n){const i=e("File");function r(e,t){let{link:n}=e,o=n.list,l=e.href,c=i.getIcon(e.file);return l||(l=e.file,t&&l.startsWith(t)&&(l=l.slice(t.length))),o&&(o=o.map(e=>r(e))),{name:l,id:n.id,open:!1,fileIcon:c.className,data:e,list:o}}function o(e){return e=e.map(e=>{return r(e)})}function l(e,t){return e=e.map(e=>{let{block:n}=e,i=n.list.map(e=>r(e,n.dir));return{name:n.id,id:n.id,open:!1,dirIcon:t,data:e,list:i}})}return{make:e=>e.masterBlock.list.map(({master:e})=>{let t=o(e.cssLinks),n=o(e.lessLinks),i=o(e.htmlLinks),r=o(e.jsLinks),c=l(e.lessBlocks,{open:"less-block far fa-list-alt",close:"less-block fas fa-list-alt"}),a=l(e.htmlBlocks,{open:"html-block far fa-list-alt",close:"html-block fas fa-list-alt"}),s=l(e.jsBlocks,{open:"js-block far fa-list-alt",close:"js-block fas fa-list-alt"});return{name:e.file,id:e.id,open:!0,data:e,list:[...t,...n,...c,...i,...a,...r,...s]}})}}),f.panel("/HtmlTree/Tree",function(e,t,n){const i=e("SidebarTree"),r=t.require("Data");let o=null;return n.on("init",function(){(o=new i({container:n.$,width:n.$.width(),dirIcon:{close:"fas fa-file-alt",open:"far fa-file-alt"}})).on({item:function(...e){n.fire("item",e)},dir:function(...e){n.fire("dir",e)},resize:function(){let e=o.$.outerWidth();n.$.width(e),n.fire("resize")},fill:{name:function(e){let{name:t,cid:n,list:i}=e,r=`${n} - ${t}`;return i.length>0&&(r=`${r} <b class="child-count">(${i.length})</b>`),r}}})}),n.on("render",function(e){let t=r.make(e);o.render(t)}),{open:function(e){o.open(e)}}}),f("/HtmlTree/API",function(e,t,n){const i=e("@definejs/emitter"),r=e("@definejs/loading"),o=e("API");let l=new i,a=new r({mask:0});return{on:l.on.bind(l),get:function(){let e=new o("HtmlTree.parse",{});e.on({request:function(){a.show("加载中...")},response:function(){a.hide()},success:function(e,t,n){c.log(e),l.fire("success","get",[e])},fail:function(e,t,n,i){},error:function(e,t,n,i){u.alert("获取解析错误: 网络繁忙，请稍候再试")}}),e.get({usePack:!1})}}}),f.view("/HtmlTree",function(e,t,n){const i=e("@definejs/session-storage"),r=t.require("API"),o=t.require("Tree"),l=t.require("Main");let a=new i(t.id),s={cid:0};n.on("init",function(){r.on("success",{get:function(e){o.render(e),o.open(s.cid)}}),o.on({item:function(e){c.log(e),s.cid=e.cid,a.set("cid",e.cid),l.render(e)},resize:function(){let e=o.$.outerWidth();l.resize(e,6)}}),l.on({file:function(e){n.fire("file",[e])},id:function(e){o.open(e)}})}),n.on("render",function(){s.cid=a.get("cid")||1,r.get()})}),f.panel("/Log/Filter/Dates",function(e,t,n){const i=e("DropCheckList");let r=null;return n.on("init",function(){(r=new i({container:n.$,text:"日期"})).on({check:function(e){n.fire("check",[e])}})}),n.on("render",function(e){e=e.map(e=>({text:e,checked:!0,value:e})),r.render(e)}),{}}),f.panel("/Log/Filter/Types",function(e,t,n){const i=e("DropCheckList");let r=null;return n.on("init",function(){(r=new i({container:n.$,text:"类型"})).on({check:function(e){n.fire("check",[e])}})}),n.on("render",function(e){e=e.map(e=>({text:e,checked:!0,value:e})),r.render(e)}),{}}),f.panel("/Log/Filter",function(e,t,n){const i=t.require("Types"),r=t.require("Dates");let o={type$checked:null,date$checked:null};return n.on("init",function(){function e(e){let t={};return e.forEach(e=>{t[e.value]=e.checked}),t}i.on({check:function(t){o.type$checked=e(t),n.fire("change",[o])}}),r.on({check:function(t){o.date$checked=e(t),n.fire("change",[o])}})}),n.on("render",function(e){i.render(e.names),r.render(e.dates),n.fire("change",[o])}),{}}),f.panel("/Log/Header",function(e,t,n){const i=e("CheckBox");let r=[{id:"time",cmd:"time",checked:!0,fireNow:!0,text:"时间"},{id:"color",cmd:"color",checked:!0,fireNow:!0,text:"彩色"},{id:"highlight",cmd:"highlight",checked:!1,fireNow:!0,text:"高亮当前行"},{id:"border",cmd:"border",checked:!1,fireNow:!0,text:"边线"}];return n.on("init",function(){n.$on("click",{"[data-cmd]":function(e){let{cmd:t}=e.currentTarget.dataset;n.fire("cmd",t,[])}}),r=r.map(e=>{let t=new i({checked:e.checked,fireNow:e.fireNow,text:e.text,container:n.$.find(`[data-id="chk-${e.id}"]`)});return t.on("checked",function(t){n.fire("check",[e.cmd,t])}),t})}),n.on("render",function(){r.forEach(e=>{e.render()})}),{close(e){}}}),f("/Log/List/Template/Colors",function(e,t,n){let i={reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29],black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],gray:[90,39],brightRed:[91,39],brightGreen:[92,39],brightYellow:[93,39],brightBlue:[94,39],brightMagenta:[95,39],brightCyan:[96,39],brightWhite:[97,39],bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgGray:[100,49],bgBrightRed:[101,49],bgBrightGreen:[102,49],bgBrightYellow:[103,49],bgBrightBlue:[104,49],bgBrightMagenta:[105,49],bgBrightCyan:[106,49],bgBrightWhite:[107,49]};return{render(e){let t=e;return v.keys(i).forEach(function(e){let n=i[e],r=`[${n[0]}m`,o=`[${n[1]}m`;t=(t=t.split(r).join(`<span class="colors ${e}">`)).split(o).join("</span>")}),t}}}),f("/Log/List/Template/File",function(e,t,n){const i=e("@definejs/string");let r={fs:null,files:[]};return{render(e,t){if(!t)return e;let{files:n}=function(e){if(e===r.fs)return r;let{list:t,root:n}=e;n.endsWith("/")&&(n=n.slice(0,-1));let i=t.map(e=>`${n}${e.name}`);return i=i.sort(function(e,t){return e.length>t.length?-1:1}),r.fs=e,r.files=i,r}(t);return n.forEach((t,n)=>{let r=`<a data-cmd="file" data-value="{${n}}">{${n}}</a>`;e=i.replaceAll(e,t,r)}),e=i.format(e,n)}}}),f("/Log/List/Template/HTML",function(e,t,n){return{render(e){if("string"!=typeof e)return"";return e=(e=(e=(e=(e=e.replace(/[<>]/g,function(e){return"&#"+e.charCodeAt(0)+";"})).split(" ").join('<b class="empty"></b>')).split("│").join('<b class="linkY">│</b>')).split("\r\n").join("<br />")).split("\n").join("<br />")}}}),f("/Log/List/Template",function(e,t,n){const i=t.require("Colors"),r=t.require("File"),o=t.require("HTML");let l={input:'<i class="fas fa-terminal"></i>',info:'<i class="fas fa-info-circle"></i>',stdout:""},c={panel:null,meta:null};return{init(e,t){c.panel=e,c.meta=t;let n=e.template();n.template("group","item").fix("datetime"),n.process({"":function(e){return{groups:this.fill("group",e.groups)}},group:{"":function(e,t){let{list:n}=e;return{no:t,date:e.date,total:n.length,items:"<li> loading... </li>"}},item:{"":function(e,n,c){let{date:a,time:s,name:d,msg:u}=e,{list:f,no:m,baseIndex:h}=c;"number"==typeof h&&(n+=h),u=o.render(u),u=i.render(u),u=r.render(u,t.fs);let p=d||"stdout",g=l[p]||"",w=f[n-1],$=`${a} ${s}`;return{no:m,index:n,time:s=w&&s==w.time?"":this.fill("time",e),datetime:s?"":`data-dt="${$}"`,sameTime:s?"":"same-time",type:p,icon:g,msg:u}},time:function(e){return{time:e.time}}}}})},fillGroup(e){let{panel:t,meta:n}=c,i=n.groups[e],{date:r,list:o}=i,l=t.$.find(`ul[data-group="${r}"]`),a={list:o,no:e},s=t.template().fill("group","item",o,a);l.html(s)},getGroup(e){let{panel:t,meta:n}=c,i=n.groups[e],{date:r,list:o}=i,l=t.$.find(`ul[data-group="${r}"]`);return{date:r,list:o,$ul:l,filled:l.find(">li[data-index]").length>0,no:e}}}}),f.panel("/Log/List",function(e,t,n){const i=t.require("Template");let r={list:[],groups:[],date$list:[],date$time$list:[]};function o(){let e=r.groups.length-1;if(e<0)return;let t=r.groups[e].list.length-1,i=n.$.find(`li[data-id="${e}-${t}"]`).get(0);i&&i.scrollIntoViewIfNeeded()}return n.on("init",function(){i.init(n,r),n.$on("click",{"[data-date]":function(e){let{no:t}=this.dataset,n=$(this.parentNode),{$ul:r,filled:o}=i.getGroup(t);n.toggleClass("hide"),o?r.slideToggle("fast"):(r.slideDown("fast"),s(()=>{i.fillGroup(t)},200))},'[data-cmd="datetime"]':function(e){let t=this.parentNode,{no:n,index:i}=t.dataset,o=r.groups[n],{date:l,time:c}=o.list[i],a=$(t.parentNode);$(t).toggleClass("fold-same-time"),a.find(`li[data-dt="${l} ${c}"]`).slideToggle("fast")}})}),n.on("render",function(e){c.log(t.id,e),r.list=e.list,r.groups=e.groups,r.date$list=e.date$list,r.date$time$list=e.date$time$list,n.fill(r),o()}),{add(e){let{list:t,groups:l}=e,c=1==l.length?l[0]:null,a=r.groups.slice(-1)[0]||null;if(!c||!a||c.date!=a.date)return!1;t=c.list;let s=r.groups.length-1,{$ul:d,filled:u}=i.getGroup(s);u||i.fillGroup(s);let f=n.template().fill("group","item",t,{list:t,no:s,baseIndex:a.list.length});return d.append(f),a.list=[...a.list,...t],o(),!0},clear(){r.groups=[],n.$.html("")},check(e,t){"time"==e?n.$.toggleClass(`hide-${e}`,!t):n.$.toggleClass(`show-${e}`,t)}}}),f("/Log/API",function(e,t,n){const i=e("@definejs/emitter"),r=e("@definejs/loading"),o=e("API");let l=new i,c=new r({mask:0});return{on:l.on.bind(l),get:function(){let e=new o("Log.get",{});e.on({request:function(){c.show("加载中...")},response:function(){c.hide()},success:function(e,t,n){l.fire("success","get",[e])},fail:function(e,t,n,i){u.alert("获取日志列表失败: {0}",t)},error:function(e,t,n,i){u.alert("获取日志列表错误: 网络繁忙，请稍候再试")}}),e.get()},clear(){let e=new o("Log.clear",{});e.on({request:function(){c.show("处理中...")},response:function(){c.hide()},success:function(e,t,n){l.fire("success","clear",[])},fail:function(e,t,n,i){u.alert(`清空日志失败: ${t}`)},error:function(e,t,n,i){u.alert("清空日志错误: 网络繁忙，请稍候再试")}}),e.get()}}}),f("/Log/Data",function(e,t,n){const i=e("@definejs/array"),r=e("@definejs/date");return{parse(e,t={}){let{date$checked:n=null,type$checked:o=null}=t,l=new Set,c=new Set,a={},s={};e.forEach(e=>{if(!e)return;let t=r.format(e.time,"yyyy-MM-dd HH:mm:ss").split(" "),d=t[0],u=t[1],{name:f}=e;if(n&&!n[d])return;if(o&&!o[f])return;l.add(f),c.add(d);let m={date:d,time:u,timestamp:e.time,name:f,msg:e.msg};i.add(a,d,m),i.add(s,d,u,m)});let d=[...c].map(e=>({date:e,list:a[e]||[]}));return{names:[...l],dates:[...c],list:e,groups:d,date$list:a,date$time$list:s}}}}),f("/Log/SSE",function(e,t,n){let i=new(e("@definejs/emitter")),r=u.config("API"),o=null;return n={on:i.on.bind(i),open:function(){let e=`${r.url}sse/Log.watch`;n.close(),(o=new EventSource(e)).addEventListener("open",function(e){}),o.addEventListener("reset",function(e){let t=JSON.parse(e.data);i.fire("reset",[t])}),o.addEventListener("add",function(e){let t=JSON.parse(e.data);i.fire("add",[t])}),o.addEventListener("error",function(e){let{data:t}=e;if(t===M)return u.alert("服务器可能已经关闭了。"),void n.close();(t=JSON.parse(t)).msg=JSON.stringify(JSON.parse(t.msg),null,4),i.fire("error",[t])}),o.onmessage=function(e){c.log("onmessage",e)}},close(){if(o)return o.close(),o=null,!0}}}),f.view("/Log",function(e,t,n){const i=t.require("API"),r=t.require("SSE"),o=t.require("Data"),l=t.require("Filter"),c=t.require("Header"),a=t.require("List");let s={list:[]};n.on("init",function(){c.on({check:function(e,t){a.check(e,t)},cmd:{reload:function(){i.get()},clear:function(){u.confirm("确认要清空服务器端的日志列表？",function(){i.clear()})},close:function(){panel.fire("close")}}}),l.on({change:function(e){let t=o.parse(s.list,e);a.render(t)}}),a.on({cmd:function(e,t){panel.fire("cmd",[e,t])}}),i.on("success",{get:function(e){let t=o.parse(e);s.list=e,c.render(),l.render(t),r.open()},clear:function(){a.clear()}}),r.on({reset:function(e){a.render(e)},add:function(e){let t=o.parse(e);a.add(t)||(s.list=[...s.list,...e],t=o.parse(s.list),l.render(t),a.render(t))}})}),n.on("render",function(){i.get()})}),f("/DocAdd/Data/API",function(e,t,n){const i=e("@definejs/emitter"),r=e("@definejs/loading"),o=e("@definejs/toast"),l=e("API");let c=new i,a=new r({mask:0}),d=new o({text:"保存成功",duration:1500,mask:0});return{on:c.on.bind(c),read(e,t){let n=new l("FileList.read");n.on({request:function(){a.show("读取中...")},response:function(){a.hide()},success:function(e,t,n){c.fire("success","read",[e])},fail:function(e,t,n){u.alert("读取失败: {0}",t)},error:function(){u.alert("读取错误: 网络繁忙，请稍候再试")}}),n.get({id:e})},save(e){let t=new l("FileList.write");t.on({request:function(){a.show("保存中...")},response:function(){a.hide()},success:function(t,n,i){d.show(),s(function(){c.fire("success","save",[t,e])},1500)},fail:function(e,t,n){u.alert(`保存失败: ${t}`)},error:function(){u.alert("保存错误: 网络繁忙，请稍候再试")}}),t.post(e)}}}),f("/DocAdd/Data/Data",function(e,t,n){const i=e("@definejs/local-storage"),r=e("@definejs/object");let o=new i(t.id),l={item:null};return{get(){let e=l.item;return e||(e=l.item=o.get()||{name:"",content:"",ext:""}),e},set(e,t){let n=r.isPlain(e)?{...e}:{[e]:t};n=r.filter(n,["name","content","ext"]);let i=l.item||{},c=n.content;return c&&(n.content=c.split("\r\n").join("\n")),l.item=v.assign(i,n),o.set(i),i}}}),f("/DocAdd/Data/Status",function(e,t,n){let i=new(e("@definejs/local-storage"))(t.id),r={status:i.get("status")||"init"};return{panel:null,set(e){e=r.status=e||r.status,i.set("status",e),this.panel.fire("status",e,[])},get:()=>r.status,confirm(e){"changed"==r.status?u.confirm("当前编辑器中存在未保存的内容，是否继续加载新内容？",e):e()}}}),f.panel("/DocAdd/Data",function(e,t,n){const i=t.require("API"),r=t.require("Data"),o=t.require("Status");return n.on("init",function(){o.panel=n,i.on("success",{read:function(e){r.set(e),o.set("read"),n.fire("render",[e])},save:function(e,t){r.set(e),o.set("saved"),n.fire("save",[e,t])}})}),n.on("render",function({name:e,content:t,ext:l}){if(e)o.confirm(function(){i.read(e)});else{if(t===M){let e=r.get();return o.set(),void n.fire("render",[e])}o.confirm(function(){let e=r.get(),i=r.set({name:"",content:t,ext:l}),c=""===t?"init":t!=e.content?"changed":"";o.set(c),n.fire("render",[i])})}}),{set(e){let t=r.get(),n=""===e?"init":e!=t.content?"changed":"";o.set(n),r.set("content",e)},save(e){let t=r.get(),n=t.name?"edit":"new";"edit"==n&&(e=t.name),e?i.save({id:e,mode:n,content:t.content}):u.alert("文件 id 不能为空。")},status:()=>o.get()}}),f("/DocAdd/Editor/CMD",function(e,t,n){let i=null;function r(e,t,n){"object"==typeof t&&(n=t,t=""),t=t||e,n=n||{empty:!1};let r=i.getSelections(),o=r.map(function(i){return i?i.startsWith(e)&&i.endsWith(t)?i.slice(e.length,0-t.length):e+i+t:n.empty?e+t:i});i.replaceSelections(o,r),r.length<2&&i.focus()}return{init:function(e){i=e},hr:function(){let e="----------\n";i.getCursor().ch>0&&(e="\n"+e),i.replaceSelection(e)},redo:function(){i.redo()},undo:function(){i.undo()},bold:function(){r("**")},italic:function(){r("*")},code:function(){r("`")},link:function(){r("[","](http://)",{empty:!0})},image:function(){r("![","](http://)",{empty:!0})},quote:function(){let e=i.getSelections(),t=e.map(function(e){return e?"\n\n> "+e+"\n\n":"\n\n> \n\n"});i.replaceSelections(t,e),t.length<2&&i.focus()},ol:function(){let e=i.getSelections(),t=e.map(function(e){if(!e)return"\n 1. ";let t=e.split("\n");return(t=t.map(function(e,t){let n=e.match(/^ \d\. /g)||e.match(/^\d\. /g);return n?e.slice(n[0].length):" "+(t+1)+". "+e})).join("\n")});i.replaceSelections(t,e)},ul:function(){let e=i.getSelections(),t=e.map(function(e){if(!e)return"\n - ";let t=e.split("\n");return(t=t.map(function(e,t){return e.startsWith(" - ")?e.slice(3):e.startsWith("- ")?e.slice(2):" - "+e})).join("\n")});i.replaceSelections(t,e)}}}),f("/DocAdd/Editor/File",function(e,t,n){const i=e("@definejs/date"),r=e("@definejs/string"),o=e("@definejs/loading"),l=e("File");let c=new o({mask:0});return{upload:function(e,t){let n=new p,o="upload/paste/"+i.format(n,"yyyy-MM-dd")+"/",a=i.format(n,"HHmmss")+"-"+r.random(4)+".png";c.show("上传中..."),l.upload({file:e,dir:o,name:a,done:function(e){if(c.hide(),!e)return void u.alert("上传失败");let n=r.format("![]({dest})",e);t&&t(n,e)}})},paste:function(){}}}),f("/DocAdd/Editor/Headers",function(e,t,n){return{get:function(e){let t=[],n=[],i=0,r=[];return e.children[0].children?e.children.forEach(function(e){r.push(...e.children)}):r=e.children,r.forEach(function(e){e.lines.forEach(function(e){let n={top:i,no:t.length,height:e.height,text:e.text};t.push(n),i+=e.height})}),t.forEach(function(e,i){let r=(t[i+1]||{}).text||"";(function(e,t){if(!e)return!1;let n=e.trimStart(),i=e.length-n.length;return!(!(n.startsWith("#")&&i<=3)&&(n=t.trimStart(),(i=t.length-n.length)>3||n.length<2||(n=n.split("=").join(""))&&(n=n.split("-").join(""))))})(e.text,r)&&n.push(e)}),n},find:function(e,t){let n=e.findIndex(function(e,n){return e.top>=t}),i=e[n];return{index:n,prev:e[n-1],item:i,next:e[n+1],headers:e}}}}),f("/DocAdd/Editor/Table",function(e,t,n){function i(e,t){let n=[],i=null;for(let r=0;r<e;r++)null!==(i=t(r,r==e-1))&&n.push(i);return n}return{create:function(e){let t=e.row,n=e.cell,r=[i(n,function(e,t){let n="|  列"+(e+1)+"  ";return t&&(n+="|"),n}),i(n,function(e,t){let n="|-------";return t&&(n+="|"),n}),...i(t,function(e){let t=e+1;return i(n,function(e,n){return n?"|   "+t+"   |":"|       "})})];return r="\n\n"+(r=(r=r.join("\n")).replace(/,/g,""))+"\n\n"}}}),f.panel("/DocAdd/Editor",function(e,t,n){const i=t.require("File"),r=t.require("CMD"),o=t.require("Table");t.require("Headers");let l=!1,a=null,d=null,u=n.$.find("textarea").get(0),f={".js":"javascript",".json":"javascript",".css":"css",".less":"css",".htm":"htmlmixed",".html":"htmlmixed"},m={ext:""};return n.on("init",function(){a=CodeMirror.fromTextArea(u,{mode:"gfm",cursorHeight:1,lineNumbers:!0,lineWrapping:!0,styleActiveLine:!0,smartIndent:!1,indentUnit:4,tabSize:4}),d=a.getDoc(),a.on("scroll",function(){if(l)return void(l=!1);let e=a.getScrollInfo();n.fire("scroll",[e])}),a.on("change",function(){let e=a.getDoc().getValue();e=e.split("\t").join("    "),n.fire("change",[{content:e,ext:m.ext}])}),n.$.on("keydown",function(e){(e.ctrlKey||e.metaKey)&&"s"==e.key&&(e.preventDefault(),n.fire("save"))}),r.init(a)}),n.$.on("paste",function(e){let t=e.originalEvent.clipboardData.files[0];t&&"image/png"==t.type&&i.upload(t,function(e,t){a.replaceSelection(e)})}),n.on("render",function(e={}){let t=e.content||"",n=e.ext||".md",i=f[n.toLowerCase()]||"gfm";m.ext=n,a.setOption("mode",i),d.setValue(t),s(function(){a.refresh()},100)}),{scroll:function(e){let t=a.getScrollInfo(),n=(t.height-t.clientHeight)*e.top/(e.height-t.clientHeight);l=!0,a.scrollTo(0,n)},getReadme:function(){return u.value},getContent:function(){return d.getValue()},setTheme:function(e){a.setOption("theme",e)},call:function(e){r[e]()},addTable:function(e){let t=o.create(e);c.log(t),a.replaceSelection(t),a.focus()},set:function(e,t){a.setOption(e,t)}}}),f("/DocAdd/Header/Switch",function(e,t,n){const i=e("@definejs/object"),r=e("@definejs/local-storage"),o=e("$");let l=new r(t.id),c={panel:null,act$on:null};return{init(e){c.panel=e,c.act$on=l.get()||{crlf:!0,fullscreen:!1,column:!0},i.each(c.act$on,function(t,n){let i=e.$.find(`[data-cmd="switch:${t}"]`);c.act$on[t]=!n,i.click()})},toggle(e){let{panel:t,act$on:n}=c,{cmd:i}=e.dataset,r=i.split(":")[1],a=n[r]=!n[r];l.set(n),o(e).toggleClass("on",a),t.fire("switch",r,[a])}}}),f.panel("/DocAdd/Header/Table",function(e,t,n){const i=e("@definejs/string"),r=e("@definejs/masker");let o=null;n.on("init",function(){function e(e){let t=[],n={};for(let i=0;i<e;i++)t.push(n);return t}n.template({"":function(e){return this.fill("all",e)},all:{"":function(t){let n=e(t.rows);return{rows:this.fill("row",n,t.cells)}},row:{"":function(t,n,i){let r=e(i);return{cells:this.fill("cell",r,n)}},cell:function(e,t,n){return{no:n,index:t}}}}}),n.$.on("mouseover","td",function(){let e=+this.getAttribute("data-no"),t=+this.getAttribute("data-index"),r=e+1,o=t+1,l=r+o<2?"插入表格":i.format("{row}行 x {cell}列 表格",{row:r,cell:o});n.$.find("div").html(l),n.$.find("td").each(function(){let n=+this.getAttribute("data-no"),i=+this.getAttribute("data-index"),r=n<=e&&i<=t;$(this).toggleClass("on",r)})}),n.$.on("click","td",function(){let e=+this.getAttribute("data-no"),t=+this.getAttribute("data-index");n.fire("add",[{row:e+1,cell:t+1}]),o.hide()}),(o=new r({volatile:!0,opacity:0})).on({hide:function(){n.hide()}})}),n.on("show",function(){o.show()}),n.on("render",function(e){n.fill({rows:9,cells:10})})}),f.panel("/DocAdd/Header/Validater",function(e,t,n){let i=new(e("@definejs/toast"))({icon:"times",duration:1200,mask:0,width:250}),r=150,o=[".md",".txt",".json",".js",".css",".html",".sql"];return{check:function(e){let t=e.val();function n(t){i.show(t),e.addClass("on"),s(function(){e.removeClass("on"),s(function(){e.addClass("on"),s(function(){e.removeClass("on")},r)},r)},r)}if(!t)return void n("文件名不能为空");let l=t.replace(/\\/g,"/");if(l.includes("../"))return n("不能引用到父目录中去");if(l.includes("./"))return n("不能使用相对路径");if(l.startsWith("."))return n("文件路径非法");if(!l.includes("."))return n("文件名必须包含后缀名");if(l.includes("..")||l.includes(":")||l.includes("*")||l.includes("?")||l.includes('"')||l.includes("<")||l.includes(">")||l.includes("|")||l.includes("//")||l.includes(" ")||l.includes("./"))return n("文件路径非法");let c=l.split(".").slice(-1)[0];return c="."+c.toLowerCase(),o.includes(c)?l:n("不能使用后缀名: "+c)}}}),f.panel("/DocAdd/Header",function(e,t,n){const i=e("@definejs/date"),r=t.require("Switch"),o=t.require("Table"),l=t.require("Validater");let c=n.$.find('[data-id="name"]');return n.on("init",function(){n.$.on("click","[data-cmd]",function(e){let{cmd:t}=this.dataset,i=t.split(":"),o=i.length>1?i[0]:"",l=i.length>1?i[1]:t;o?"editor"!=o?"switch"!=o||r.toggle(this):n.fire("editor",[l]):n.fire("cmd",t,[])}),n.$on("click",{'[data-id="table"]':function(){o.render()},'[data-id="demo"]':function(){let e=c.val();n.fire("cmd","demo",[e])},'[data-id="outline"]':function(){n.fire("cmd","outline",[])}}),o.on({add:function(e){n.fire("cmd","table",[e])}})}),n.on("render",function(e={}){let{name:t,ext:i}=e,o=!!t;c.val(t),c.attr({disabled:o,title:o?"这是一个已存在的文件，不允许编辑其路径。":""}),n.$.toggleClass("edit-mode",o),n.$.toggleClass("json",".json"==i),r.init(n)}),{saved:function(e){if(null===e)return n.$.find('[data-id="saved"] span').html("已保存"),void n.$.addClass("saved");if(e){let e=i.format(new p,"HH:mm:ss");n.$.addClass("saved"),n.$.find('[data-id="saved"] span').html("已保存 ["+e+"]")}else n.$.removeClass("saved")},get:function(){return l.check(c)}}}),f.panel("/DocAdd/Outline",function(e,t,n){const i=e("@definejs/masker"),r=e("Outline");let o=null,l=null;n.set("show",!1),n.on("init",function(){(o=new i({volatile:!0,opacity:0})).on({hide:function(){n.hide()}}),(l=new r({container:n.$.find(">div")})).on({item:function(e,t){n.fire("item",[e,t])}}),l.render(),n.$.on("click",'[data-cmd="close"]',function(e){n.hide()})}),n.on("show",function(){}),n.on("render",function(e){l.fill(e)})}),f.panel("/DocAdd/Preview",function(e,t,n){const i=e("MarkDoc");let r=n.$.find(">div"),o=!1,l=null,c=[".json",".js",".css",".less",".html",".htm"];return n.on("init",function(){(l=new i({container:r.get(0)})).on("hash",function(e){n.fire("hash",[e])}),l.on("render",function(e){let t=l.getOutlines();n.fire("render",[t])}),n.$.on("scroll",function(e){if(o)return void(o=!1);let t=r.outerHeight(),i=n.$.get(0).scrollTop;n.fire("scroll",[{height:t,top:i}])})}),n.on("render",function(e){let{content:t,ext:n}=e,i="";c.includes(n)&&(i=n.slice(1)),l.render({content:t,language:i,baseUrl:""})}),{scroll(e){let t=(r.outerHeight()-e.clientHeight)*e.top/(e.height-e.clientHeight);o=!0,n.$.get(0).scrollTo(0,t)},to(e){l.toOutline(e)}}}),f.panel("/DocAdd/Themes/List",function(e,t,n){const i=e("@definejs/tabs");let r=null,o=[{name:"default"},{name:"custom",desc:"深色"},{name:"3024-day"},{name:"3024-night",desc:"深色"},{name:"ambiance-mobile"},{name:"ambiance",desc:"深色"},{name:"base16-dark",desc:"深色"},{name:"base16-light"},{name:"blackboard",desc:"深色"},{name:"cobalt",desc:"深色"},{name:"eclipse"},{name:"elegant"},{name:"erlang-dark",desc:"深色"},{name:"lesser-dark",desc:"深色"},{name:"mbo",desc:"深色"},{name:"mdn-like"},{name:"midnight",desc:"深色"},{name:"monokai",desc:"深色"},{name:"neat"},{name:"neo"},{name:"night",desc:"深色"},{name:"paraiso-dark",desc:"深色"},{name:"paraiso-light"},{name:"pastel-on-dark",desc:"深色"},{name:"rubyblue",desc:"深色"},{name:"solarized"},{name:"the-matrix",desc:"深色"},{name:"tomorrow-night-eighties",desc:"深色"},{name:"twilight",desc:"深色"},{name:"vibrant-ink",desc:"深色"},{name:"xq-dark",desc:"深色"},{name:"xq-light"}];return n.set("show",!1),n.on("init",function(){(r=new i({container:n.$,selector:">li",activedClass:"on"})).on("change",function(e,t){e=o[t],n.fire("item",[e,t])}),n.$.on("click","[data-index]",function(e){let t=+this.dataset.index;r.active(t)}),n.template({"":function(e){return{items:this.fill("item",e.list)}},item:{"":function(e,t){let n=this.fill("desc",e);return{index:t,name:e.name,desc:n}},desc:function(e){return e.desc?{desc:e.desc}:""}}})}),n.on("render",function(e){n.fill({list:o}),"number"==typeof e&&r.active(e)}),{active:function(e){r.active(e)},slide:function(e,t){e?n.$.slideDown("fast",function(){let e=r.getActivedIndex();n.$.find(`li[data-index="${e}"]`).get(0).scrollIntoViewIfNeeded(),t&&t()}):n.$.slideUp("fast",t)}}}),f.panel("/DocAdd/Themes/Mask",function(e,t,n){const i=e("@definejs/masker");let r=null,o=!1;return n.on("init",function(){(r=new i({volatile:!0,opacity:0})).on({hide:function(){o=!1,n.fire("hide")},show:function(){o=!0,n.fire("show")}})}),n.on("render",function(){}),{toggle:function(){o?r.hide():r.show()}}}),f.panel("/DocAdd/Themes",function(e,t,n){const i=e("@definejs/local-storage"),r=t.require("List"),o=t.require("Mask");let l=null;return n.set("show",!1),n.on("init",function(){l=new i(t.id),o.on({show:function(){n.$.addClass("show"),r.slide(!0)},hide:function(){r.slide(!1),n.$.removeClass("show")}}),r.on({item:function(e,t){l.set("index",t),n.fire("item",[e.name])}})}),n.on("render",function(e){"number"==typeof e?l.set("index",e):e=l.get("index")||1,r.render(e),o.render()}),{toggle:function(){o.toggle()}}}),f.view("/DocAdd",function(e,t,n){const i=t.require("Editor"),r=t.require("Preview"),o=t.require("Themes"),l=t.require("Header"),c=t.require("Outline"),a=t.require("Data");n.on("init",function(){a.on({render:function(e){i.render(e),l.render(e),o.render()},save:function(e,t){"new"!=t.mode||n.render({name:e.name})},status:{init:function(){l.saved(!1)},changed:function(){l.saved(!1)},read:function(){l.saved(null)},saved:function(){l.saved(!0)}}}),i.on({save:function(){let e=l.get();a.save(e)},scroll:function(e){r.scroll(e)},change:function(e){a.set(e.content),r.render(e)}}),l.on({cmd:{save:function(){let e=l.get();a.save(e)},themes:function(){o.toggle()},new:function(){a.render({content:""})},format:function(){let e=r.$.find("code").text();i.render({content:e})},outline:function(){c.toggle()},demo:function(e){n.fire("demo",[e])},table:function(e){i.addTable(e)}},editor:function(e){i.call(e)},switch:{crlf:function(e){i.set("lineWrapping",e)},fullscreen:function(e){n.fire("fullscreen",[e])},column:function(e){n.$.toggleClass("full-editor",!e)}}}),r.on({render:function(e){c.render(e)},scroll:function(e){i.scroll(e)}}),o.on({item:function(e){i.setTheme(e)}}),c.on({item:function(e,t){r.to(t)}})}),n.on("render",function(e={}){a.render(e)}),n.on("close",function(){if("changed"==a.status())return u.confirm("当前编辑器中存在未保存的内容，是否继续关闭？",function(){n.fire("close")}),!1})}),f("/ModuleTree/API/Data",function(e,t,n){const i=e("@definejs/object"),r=t.data.none;function o(e){let t={};return i.each(e,function(e,n){e=function(e){return""===e?`/${r}`:e.startsWith("/")&&e.length>1?`/${r}${e}`:"/"!=e?`/${e}`:e}(e),n=n.map(function(e){return""===e&&(e=r),e}),t[e]=n}),t}function l(e,t){return!!e[t]}return{make(e){let{moduleStat:t}=e,{id$childs:n,id$parent:r,id$module:c}=t,a={"/":[]},s={"/":[]};return i.each(r,function(e,t){if(t||""===t)return;l(n,e)?a["/"].push(e):s["/"].push(e)}),i.each(n,function(e,t){let i=[],r=[];t.forEach(function(e){let t=l(n,e)?i:r,{name:o}=c[e];t.push(o)}),a[e]=i,s[e]=r}),a=o(a),s=o(s),{dir$dirs:a,dir$files:s,root:"模块树"}}}}),f.panel("/ModuleTree/Main/Dependent/Header",function(e,t,n){n.on("init",function(){}),n.on("render",function(e){})}),f("/ModuleTree/Main/Dependent/List/Data",function(e,t,n){return{get({item:e,stat:t}){let{id:n}=e.data,{ids:i,id$file:r,id$dependents:o,id$module:l}=t.moduleStat,c=[];if("string"==typeof n)c=e.data.publics;else{let e=v.keys(o);c=[...i,...e],c=[...new Set(c)]}let a=[],s=[];return(c=(c=c.sort()).map(e=>{if(!function(e){return!(!e||!e.startsWith("@")&&e.includes("/"))}(e))return null;let t=l[e],n=o[e]||[];return"string"==typeof n&&(n=[n]),n=n.map(e=>{let t=l[e];return{id:e,file:r[e],method:t.method,level:t.level}}),{id:e,module:t,$main:null,$gridview:null,found:m.isArray(t)?"more":e.startsWith("@")?"namespace":t?"1":"0",list:n}})).forEach(e=>{e&&(e.id.startsWith("@")?s.push(e):a.push(e))}),c=[...a,...s]}}}),f("/ModuleTree/Main/Dependent/List/GridView",function(e,t,n){e("$");const i=e("GridView");let r=[{caption:"模块ID",name:"id",width:300,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"定义方法",name:"method",width:110,class:"file",dragable:!0,delegate:"[data-cmd]"},{caption:"级别",name:"level",width:49,class:"number level",dragable:!0},{caption:"所在文件",name:"file",width:400,class:"file",dragable:!0,delegate:"[data-cmd]"}];return{render({container:e,list:t=[],cmdClick:n}){let o=new i({container:e,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:r});return o.on("process","cell",{id:function(e){return`<a data-cmd="id" href="javascript:">${e.row.data.id}</a>`},file:function(e){return`<a data-cmd="file" href="javascript:">${e.row.data.file}</a>`}}),o.on("click","cell",function(e,t){let i=t.target.dataset.cmd;i&&(t.stopPropagation(),n(i,e))}),o.render(),o.fill(t),o}}}),f.panel("/ModuleTree/Main/Dependent/List",function(e,t,n){const i=e("$"),r=t.require("Data"),o=t.require("GridView");let l={list:[]};n.on("init",function(){n.template({"":function({list:e}){return e.length?this.fill("item",e):this.fill("none",{})},item:{"":function(e,t){let n=e.list.length,i=e.found,r=this.fill("tip",{found:i,total:n});return{no:t,id:e.id,total:n,found:i,tip:r}},tip:function({found:e,total:t}){let n="0"==e?"该模块不存在":0==t?"该模块没有被任何模块依赖":"";return n?{tip:n}:""}}}),n.$on("click",{"li[data-no] h3":function(e){let t=this.parentNode.parentNode,{no:r}=t.dataset,c=i(t),a=l.list[r];c.toggleClass("on"),a.$gridview?a.$main.slideToggle("fast"):(a.$main=c.find('[data-id="main"]'),a.$gridview=c.find('[data-id="gridview"]'),o.render({container:a.$gridview,list:a.list,cmdClick:function(e,t){n.fire("cmd",[e,t.row.data])}}),s(()=>{a.$main.slideDown("fast")},100))},'[data-cmd="id"]':function(e){let t=this.innerText,{cmd:i}=this.dataset;n.fire("cmd",[i,{id:t}])}})}),n.on("render",function(e){c.log(t.id,e);let i=l.list=r.get(e);n.fill({list:i})})}),f.panel("/ModuleTree/Main/Dependent",function(e,t,n){const i=t.require("Header"),r=t.require("List");n.set("show",!1),n.on("init",function(){r.on({cmd:function(e,t){let i=t[e];n.fire(e,[i])}})}),n.on("render",function(e){i.render(e),r.render(e),n.show()})}),f.panel("/ModuleTree/Main/FileInfo",function(e,t,n){const i=e("File"),r=e("@definejs/date");let o={info:null};n.on("init",function(){n.$on("click",{'[data-cmd="file"]':function(e){let t=o.info.file;n.fire("file",[t])},'[data-cmd="dir"]':function(e){let t=o.info.dir;t.endsWith("/")&&(t=t.slice(0,-1)),n.fire("file",[t])}})}),n.on("render",function({item:e,stat:t}){let{info:l}=e.data,c=i.getSizeDesc(l.size),a=l.ext.slice(1)+" 文件",s=r.format(l.stat.birthtime,"yyyy-MM-dd HH:mm:ss"),d=r.format(l.stat.mtime,"yyyy-MM-dd HH:mm:ss");o.info=l,n.fill({name:l.name,file:l.file,ext:l.ext,md5:l.md5,dir:l.dir,lines:l.lines,type:a,size:c.value,sizeDesc:c.desc,birthtime:s,mtime:d,isUTF8:l.isUTF8?"是":"否"})})}),f.panel("/ModuleTree/Main/List/Filter/ChildDependents",function(e,t,n){const i=e("DropCheckList");let r=null,o=[{text:"N > 0",checked:!0,value:"N>0"},{text:"N = 0",checked:!0,value:"N=0"},{text:"N < 0",checked:!0,value:"N<0"}];return n.on("init",function(){(r=new i({container:n.$,text:"所依赖私有模块数 - 直接子模块数"})).on({check:function(e){n.fire("check",[e])}})}),n.on("render",function(){r.render(o)}),{}}),f.panel("/ModuleTree/Main/List/Filter/Dependents",function(e,t,n){const i=e("DropCheckList");let r=null,o=[{text:"N = 0",checked:!0,value:"N=0"},{text:"N > 0",checked:!0,value:"N>0"}];return n.on("init",function(){(r=new i({container:n.$,text:"被依赖模块数"})).on({check:function(e){n.fire("check",[e])}})}),n.on("render",function(){r.render(o)}),{}}),f.panel("/ModuleTree/Main/List/Filter/Levels",function(e,t,n){const i=e("DropCheckList");let r=null;return n.on("init",function(){(r=new i({container:n.$,text:"级别"})).on({check:function(e){n.fire("check",[e])}})}),n.on("render",function(e){e=e.map(e=>({text:`${e} 级`,checked:!0,value:e})),r.render(e)}),{}}),f.panel("/ModuleTree/Main/List/Filter/Methods",function(e,t,n){const i=e("DropCheckList");let r=null;return n.on("init",function(){(r=new i({container:n.$,text:"定义方法"})).on({check:function(e){n.fire("check",[e])}})}),n.on("render",function(e){e=e.map(e=>({text:e,checked:!0,value:e})),r.render(e)}),{}}),f.panel("/ModuleTree/Main/List/Filter",function(e,t,n){const i=t.require("ChildDependents"),r=t.require("Dependents"),o=t.require("Levels"),l=t.require("Methods");let c={childDependent$checked:null,dependent$checked:null,level$checked:null,method$checked:null};return n.on("init",function(){function e(e){let t={};return e.forEach(e=>{t[e.value]=e.checked}),t}i.on({check:function(t){c.childDependent$checked=e(t),n.fire("change",[c])}}),r.on({check:function(t){c.dependent$checked=e(t),n.fire("change",[c])}}),o.on({check:function(t){c.level$checked=e(t),n.fire("change",[c])}}),l.on({check:function(t){c.method$checked=e(t),n.fire("change",[c])}})}),n.on("render",function(e){i.render(),r.render(),o.render(e.levels),l.render(e.methods),n.fire("change",[c])}),{}}),f.panel("/ModuleTree/Main/List/GridView",function(e,t,n){const i=e("GridView");let r=null,o=null;n.on("init",function(){r=n.template(),(o=new i({container:n.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"模块ID",name:"id",width:300,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"定义方法",name:"method",width:110,class:"file",dragable:!0,delegate:"[data-cmd]"},{caption:"级别",name:"level",width:49,class:"number level",dragable:!0},{caption:"被依赖模块数",name:"dependents",width:61,class:"number dependents",dragable:!0},{caption:"所依赖公共模块数",name:"publics",width:73,class:"number publics",dragable:!0},{caption:"所依赖私有模块数",name:"privates",width:73,class:"number privates",dragable:!0},{caption:"直接子模块数",name:"childs",width:61,class:"number childs",dragable:!0},{caption:"全部子模块数",name:"children",width:61,class:"number children",dragable:!0},{caption:"同级模块数",name:"siblings",width:61,class:"number siblings",dragable:!0},{caption:"所在文件",name:"file",width:400,class:"file",dragable:!0,delegate:"[data-cmd]"}]})).on("process","row",function(e){let t=e.data,n=[];0==t.dependents&&n.push("error dependents"),t.childs!=t.privates&&n.push("error childs privates"),n=(n=n.join(" ")).split(" "),n=[...new Set(n)],e.class=n.join(" ")}),o.on("process","cell",{id:function(e){let t=e.row.data;return r.fill("href",{cmd:"id",text:t.id})},file:function(e){let t=e.row.data;return r.fill("href",{cmd:"file",text:t.file})}}),o.on("click","cell",function(e,t){let i=t.target.dataset.cmd;i&&(t.stopPropagation(),n.fire("cmd",[i,e.row.data]))}),o.render()}),n.on("render",function(e){o.fill(e)})}),f.panel("/ModuleTree/Main/List/Header",function(e,t,n){n.on("init",function(){}),n.on("render",function(){})}),f("/ModuleTree/Main/List/Data",function(e,t,n){let i={item:null,stat:null};return{init({item:e,stat:t}){i.item=e,i.stat=t;let{method$ids:n,level$ids:r}=t.moduleStat;return{methods:v.keys(n),levels:v.keys(r)}},filter(e){let{childDependent$checked:t=null,dependent$checked:n=null,level$checked:r=null,method$checked:o=null}=e||{},{item:l,stat:c}=i,{id:a,children:s}=l.data,{ids:d,id$file:u,id$dependents:f,id$children:m,id$childs:h,id$publics:p,id$privates:g,id$siblings:w,id$module:$}=c.moduleStat;"string"==typeof a&&(d=[a,...s]);let b=[];return d.forEach(e=>{let i=u[e],l=f[e]||[],c=h[e]||[],a=m[e]||[],s=w[e]||[],d=p[e]||[],k=g[e]||[],v=$[e],{level:y,method:x}=v;if("string"==typeof l&&(l=[l]),n){let e=l.length;if(!n["N=0"]&&0==e)return;if(!n["N>0"]&&e>0)return}if(t){let e=k.length-c.length;if(!t["N>0"]&&e>0)return;if(!t["N=0"]&&0==e)return;if(!t["N<0"]&&e<0)return}if(r&&!r[y])return;if(o&&!o[x])return;let M={id:e,file:i,method:x,level:y,childs:c.length,children:a.length,dependents:l.length,publics:d.length,privates:k.length,siblings:s.length};b.push(M)}),b}}}),f.panel("/ModuleTree/Main/List",function(e,t,n){const i=t.require("Header"),r=t.require("Data"),o=t.require("Filter"),l=t.require("GridView");n.set("show",!1),n.on("init",function(){o.on({change:function(e){let t=r.filter(e);l.render(t)}}),l.on({cmd:function(e,t){let i=t[e];n.fire(e,[i])}})}),n.on("render",function(e){let l=r.init(e);c.log("==============",t.id,e,l),i.render(),o.render(l),n.show()})}),f.panel("/ModuleTree/Main/ModuleInfo/Children/GridView",function(e,t,n){const i=e("GridView");let r=null,o=null;n.on("init",function(){o=n.template(),(r=new i({container:n.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"模块ID",name:"id",width:400,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"所在文件",name:"file",width:400,class:"file",dragable:!0,delegate:"[data-cmd]"}]})).on("process","row",function(e){}),r.on("process","cell",{id:function(e){let t=e.row.data;return o.fill("href",{cmd:"id",text:t.id})},file:function(e){let t=e.row.data;return o.fill("href",{cmd:"file",text:t.file})}}),r.on("click","cell",function(e,t){let i=t.target.dataset.cmd;i&&(t.stopPropagation(),n.fire("cmd",[i,e.row.data]))}),r.render()}),n.on("render",function(e){r.fill(e)})}),f.panel("/ModuleTree/Main/ModuleInfo/Childs/GridView",function(e,t,n){const i=e("GridView");let r=null,o=null;n.on("init",function(){o=n.template(),(r=new i({container:n.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"模块ID",name:"id",width:400,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"所在文件",name:"file",width:400,class:"file",dragable:!0,delegate:"[data-cmd]"}]})).on("process","row",function(e){}),r.on("process","cell",{id:function(e){let t=e.row.data;return o.fill("href",{cmd:"id",text:t.id})},file:function(e){let t=e.row.data;return o.fill("href",{cmd:"file",text:t.file})}}),r.on("click","cell",function(e,t){let i=t.target.dataset.cmd;i&&(t.stopPropagation(),n.fire("cmd",[i,e.row.data]))}),r.render()}),n.on("render",function(e){r.fill(e)})}),f.panel("/ModuleTree/Main/ModuleInfo/Dependents/GridView",function(e,t,n){const i=e("GridView");let r=null,o=null;n.on("init",function(){o=n.template(),(r=new i({container:n.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"模块ID",name:"id",width:400,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"所在文件",name:"file",width:400,class:"file",dragable:!0,delegate:"[data-cmd]"}]})).on("process","row",function(e){}),r.on("process","cell",{id:function(e){let t=e.row.data;return o.fill("href",{cmd:"id",text:t.id})},file:function(e){let t=e.row.data;return o.fill("href",{cmd:"file",text:t.file})}}),r.on("click","cell",function(e,t){let i=t.target.dataset.cmd;i&&(t.stopPropagation(),n.fire("cmd",[i,e.row.data]))}),r.render()}),n.on("render",function(e){r.fill(e)})}),f.panel("/ModuleTree/Main/ModuleInfo/Privates/GridView",function(e,t,n){const i=e("GridView");let r=null,o=null;n.on("init",function(){o=n.template(),(r=new i({container:n.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"模块ID",name:"id",width:400,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"所在文件",name:"file",width:400,class:"file",dragable:!0,delegate:"[data-cmd]"}]})).on("process","row",function(e){e.data.file||(e.class="not-found")}),r.on("process","cell",{id:function(e){let t=e.row.data;return o.fill("href",{cmd:"id",text:t.id})},file:function(e){let t=e.row.data;return t.file?o.fill("href",{cmd:"file",text:t.file}):"不存在"}}),r.on("click","cell",function(e,t){let i=t.target.dataset.cmd;i&&(t.stopPropagation(),n.fire("cmd",[i,e.row.data]))}),r.render()}),n.on("render",function(e){r.fill(e)})}),f.panel("/ModuleTree/Main/ModuleInfo/Publics/GridView",function(e,t,n){const i=e("GridView");let r=null,o=null;n.on("init",function(){o=n.template(),(r=new i({container:n.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"模块ID",name:"id",width:400,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"所在文件",name:"file",width:400,class:"file",dragable:!0,delegate:"[data-cmd]"}]})).on("process","row",function(e){}),r.on("process","cell",{id:function(e){let t=e.row.data.id;return o.fill("href",{cmd:"id",text:t})},file:function(e){let t=e.row.data;return o.fill("href",{cmd:"file",text:t.file||""})}}),r.on("click","cell",function(e,t){let i=t.target.dataset.cmd;i&&(t.stopPropagation(),n.fire("cmd",[i,e.row.data]))}),r.render()}),n.on("render",function(e){r.fill(e)})}),f.panel("/ModuleTree/Main/ModuleInfo/Siblings/GridView",function(e,t,n){const i=e("GridView");let r=null,o=null;n.on("init",function(){o=n.template(),(r=new i({container:n.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"模块ID",name:"id",width:400,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"所在文件",name:"file",width:400,class:"file",dragable:!0,delegate:"[data-cmd]"}]})).on("process","row",function(e){}),r.on("process","cell",{id:function(e){let t=e.row.data;return o.fill("href",{cmd:"id",text:t.id})},file:function(e){let t=e.row.data;return o.fill("href",{cmd:"file",text:t.file})}}),r.on("click","cell",function(e,t){let i=t.target.dataset.cmd;i&&(t.stopPropagation(),n.fire("cmd",[i,e.row.data]))}),r.render()}),n.on("render",function(e){r.fill(e)})}),f.panel("/ModuleTree/Main/ModuleInfo/Base",function(e,t,n){let i=t.data.none,r={item:null};n.on("init",function(){n.$on("click",{'[data-cmd="item"]':function(e){let t=r.item.parent;n.fire("item",[t])}})}),n.on("render",function({item:e,stat:t}){let{module:o,parent:l,dependents:c=[]}=e.data;"string"==typeof c&&(c=[c]),""===l&&(l=i),r.item=e,n.fill({id:o.id,name:o.name,parent:l||"",method:o.method,"factory-type":o.factory.type,dependents:c.length,level:o.level})})}),f.panel("/ModuleTree/Main/ModuleInfo/Children",function(e,t,n){const i=t.require("GridView");n.set("show",!1),n.on("init",function(){i.on({cmd:function(e,t){let i=t[e];n.fire(e,[i])}})}),n.on("render",function({item:e,stat:t}){let{id$file:r}=t.moduleStat,{children:o=[]}=e.data,l=o.map(e=>{return{id:e,file:r[e]}});i.render(l),n.show()})}),f.panel("/ModuleTree/Main/ModuleInfo/Childs",function(e,t,n){const i=t.require("GridView");n.set("show",!1),n.on("init",function(){i.on({cmd:function(e,t){let i=t[e];n.fire(e,[i])}})}),n.on("render",function({item:e,stat:t}){let{id$file:r}=t.moduleStat,{childs:o=[]}=e.data,l=o.map(e=>{return{id:e,file:r[e]}});i.render(l),n.show()})}),f.panel("/ModuleTree/Main/ModuleInfo/Dependents",function(e,t,n){const i=t.require("GridView");n.set("show",!1),n.on("init",function(){i.on({cmd:function(e,t){let i=t[e];n.fire(e,[i])}})}),n.on("render",function({item:e,stat:t}){let{id$file:r}=t.moduleStat,{dependents:o=[]}=e.data;m.isArray(o)||(o=[o]);let l=o.map(e=>{return{id:e,file:r[e]}});i.render(l),n.show()})}),f.panel("/ModuleTree/Main/ModuleInfo/Privates",function(e,t,n){const i=t.require("GridView");n.set("show",!1),n.on("init",function(){i.on({cmd:function(e,t){let i=t[e];n.fire(e,[i])}})}),n.on("render",function({item:e,stat:t}){let{id$file:r}=t.moduleStat,{id:o,privates:l=[]}=e.data,c=l.map(e=>{let t=`${o}/${e}`;return{id:t,file:r[t]}});i.render(c),n.show()})}),f.panel("/ModuleTree/Main/ModuleInfo/Publics",function(e,t,n){const i=t.require("GridView");n.set("show",!1),n.on("init",function(){i.on({cmd:function(e,t){let i=t[e];n.fire(e,[i])}})}),n.on("render",function({item:e,stat:t}){let{id$file:r}=t.moduleStat,{publics:o=[]}=e.data,l=o.map(e=>{return{id:e,file:r[e]}});i.render(l),n.show()})}),f.panel("/ModuleTree/Main/ModuleInfo/Siblings",function(e,t,n){const i=t.require("GridView");n.set("show",!1),n.on("init",function(){i.on({cmd:function(e,t){let i=t[e];n.fire(e,[i])}})}),n.on("render",function({item:e,stat:t}){let{id$file:r}=t.moduleStat,{siblings:o=[]}=e.data,l=o.map(e=>{return{id:e,file:r[e]}});i.render(l),n.show()})}),f.panel("/ModuleTree/Main/ModuleInfo",function(e,t,n){const i=t.require("Base"),r=t.require("Childs"),o=t.require("Children"),l=t.require("Siblings"),c=t.require("Publics"),a=t.require("Privates"),s=t.require("Dependents");n.on("init",function(){[i,r,o,l,c,a,s].forEach(e=>{e.on({item:function(e){n.fire("item",[e])},id:function(e){n.fire("id",[e])},file:function(e){n.fire("file",[e])}})})}),n.on("render",function(e){i.render(e),r.render(e),o.render(e),l.render(e),c.render(e),a.render(e),s.render(e)})}),f("/ModuleTree/Main/Nav/Data",function(e,t,n){return{make(e){let t=[e,...e.parents].reverse(),n=t.map(e=>e.name),i={type:e.list.length>0?"dir":"file",ext:".js"};return{list:t,names:n,path:e.data.id||"/",icon:i}}}}),f.panel("/ModuleTree/Main/Nav",function(e,t,n){const i=e("MenuNav"),r=t.require("Data");let o=null,l={list:[],item:null,stat:null};n.on("init",function(){(o=new i({container:n.$})).on({item:function(e,t){let i=l.list[t];n.fire("item",[i])},text:function(e){if("/"==e)return void n.fire("item",[{id:e}]);let t=l.stat.moduleStat.id$module[e];if(!t)return!1;n.fire("item",[t])}})}),n.on("render",function({item:e,stat:t}){let{list:n,names:i,path:c,icon:a}=r.make(e);l.item=e,l.stat=t,l.list=n,o.render({names:i,path:c,icon:a})})}),f.panel("/ModuleTree/Main/Tree/Header",function(e,t,n){const i=e("CheckBox");let r=[{id:"secondary",text:"文件",chk:null},{id:"icon",text:"图标",chk:null},{id:"tab",text:"缩进",chk:null},{id:"color",text:"彩色",chk:null},{id:"hover",text:"悬停",chk:null}];n.on("init",function(){r.forEach(e=>{let t=new i({fireNow:!0,container:n.$.find(`[data-id="chk-${e.id}"]`),text:e.text});t.on("checked",function(t){n.fire("check",[{[e.id]:t}])}),e.chk=t}),n.$on("click","[data-cmd]",function(e){let{cmd:t}=e.target.dataset;n.fire("cmd",t,[])})}),n.on("render",function(e){r.forEach(t=>{let n=e[t.id];t.chk.render({checked:n})})})}),f.panel("/ModuleTree/Main/Tree/Main",function(e,t,n){const i=e("TextTree"),r=e("Clipboard");let o=null;return n.on("init",function(){(o=new i({container:n.$,secondaryKey:"file"})).on("cmd",function(e,t){n.fire("cmd",[e,t])})}),n.on("render",function(e){let{id:t,ids:i,id$file:r}=e,l=i.map(e=>{return{id:e,file:r[e]}});o.render(l),"string"==typeof t&&o.highlight(t),n.fire("render")}),{check(e){o.toggle(e)},copy(){let e=o.toString();r.copy(e)}}}),f.panel("/ModuleTree/Main/Tree",function(e,t,n){const i=t.require("Header"),r=t.require("Main");n.on("init",function(){i.on("check",function(e){r.check(e)}),i.on("cmd",{copy:function(){r.copy()}}),r.on({cmd:function(e,t){let i=t[e];n.fire(e,[i])},render:function(){i.render({secondary:!1,icon:!1,tab:!0,color:!0,hover:!1})}})}),n.on("render",function({item:e,stat:t}){let{id:n,parents:i,children:o}=e.data,{ids:l,id$file:c}=t.moduleStat;e.parent&&(l=[...i=i.slice(0).reverse(),n,...o]),r.render({id:n,ids:l,id$file:c})})}),f.panel("/ModuleTree/Main/MarkDoc",function(e,t,n){const i=e("MarkDoc");let r=null;return n.on("init",function(){r=new i({container:n.$})}),n.on("render",function({item:e,stat:t}){let{info:n}=e.data,{content:i,ext:o}=n,l=o.slice(1);r.render({content:i,language:l,baseUrl:"",code:{format:!1}})}),{}}),f.panel("/ModuleTree/Main/Tabs",function(e,t,n){const i=e("@definejs/tabs"),r=e("@definejs/local-storage");let o=[{name:"依赖关系",cmd:"dependent",root:!0},{name:"模块列表",cmd:"list",root:!0},{name:"组织架构",cmd:"tree",root:!0},{name:"模块信息",cmd:"module"},{name:"文件信息",cmd:"file"},{name:"文件内容",cmd:"content"}],l=[],c=null,a=null,s={index:0,cmd$module:null};return n.on("init",function(){a=new r(t.id),s.index=a.get("index")||0,(c=new i({container:n.$.get(0),activedClass:"on",eventName:"click",selector:">li",repeated:!0})).on("change",function(e,t){s.index=t,e=l[t],a.set("index",t);let{cmd:i}=e,{cmd$module:r}=s;r&&v.keys(r).forEach(e=>{let t=r[e];e==i?n.fire("change",[t]):t.hide()}),n.fire("cmd",i,[])})}),n.on("render",function(e){l=o,e&&(l=l.filter(e=>e.root)),c.render(l,function(e,t){return{index:t,name:e.name}}),s.index>l.length-1&&(s.index=0),c.active(s.index)}),{map(e){s.cmd$module=e}}}),f.panel("/ModuleTree/Main",function(e,t,n){const i=t.require("Nav"),r=t.require("Tabs"),o=t.require("MarkDoc"),l=t.require("FileInfo"),c=t.require("ModuleInfo"),a=t.require("Tree"),s=t.require("List"),d=t.require("Dependent");let u={item:null,stat:null};return n.on("init",function(){i.on({item:function(e){n.fire("item",[e])}}),r.map({module:c,file:l,content:o,tree:a,list:s,dependent:d}),r.on({change:function(e){e.render(u)}}),[c,l,a,s,d].forEach(e=>{e.on({item:function(e){n.fire("item",[e])},id:function(e){n.fire("id",[e])},file:function(e){n.fire("file",[e])}})})}),n.on("render",function(e){let t=!(u.item=e.item).parent;u.stat=e.stat,i.render(e),r.render(t)}),{resize(...e){let t="calc(100% - "+e.reduce(function(e,t){return e+t},0)+"px)";n.$.css({width:t})}}}),f("/ModuleTree/Tree/Data",function(e,t,n){const i=t.data.none;function r(e){let t=[],n=[];return e.forEach(e=>{(e.list.length>0?t:n).push(e)}),t.sort((e,t)=>e.id>t.id?1:-1),n.sort((e,t)=>e.id.toUpperCase()>t.id.toUpperCase()?1:-1),[...t,...n]}return{make:function(e){let t=e.moduleStat,{level$ids:n}=t,o=n[1].map(e=>{return function e(t,n){let o=n.id$childs[t]||[],l=n.id$module[t],c=o.map(t=>e(t,n));return c=r(c),{id:t,name:l.name||i,open:!1,list:c,data:{id:t,children:n.id$children[t],childs:n.id$childs[t],dependents:n.id$dependents[t],file:n.id$file[t],info:n.id$info[t],module:n.id$module[t],parent:n.id$parent[t],parents:n.id$parents[t],privates:n.id$privates[t],publics:n.id$publics[t],siblings:n.id$siblings[t]}}}(e,t)});return o=r(o),c.log(o),[{id:"/",name:"模块树",open:!0,dirIcon:{close:"fas fa-folder",open:"fas fa-folder-open"},data:{},list:o}]}}}),f.panel("/ModuleTree/Tree",function(e,t,n){const i=e("SidebarTree"),r=t.require("Data");t.data.none;let o=null;return n.on("init",function(){(o=new i({container:n.$,width:n.$.width(),dirIcon:{close:"fas fa-file-alt",open:"far fa-file-alt"},fileIcon:"fas fa-file"})).on({item:function(e){n.fire("item",[e])},dir:function(e){n.fire("dir",[e])},resize:function(){let e=o.$.outerWidth();n.$.width(e),n.fire("resize")}})}),n.on("render",function(e){let t=r.make(e);o.render(t)}),{open:function(e){o.open(e)}}}),f("/ModuleTree/API",function(e,t,n){const i=e("@definejs/emitter"),r=e("@definejs/loading"),o=e("API"),l=t.require("Data");let c=new i,a=new r({mask:0});return{on:c.on.bind(c),get:function(){let e=new o("Stat.get",{});e.on({request:function(){a.show("加载中...")},response:function(){a.hide()},success:function(e,t,n){let i=l.make(e);c.fire("success","get",[e,i])},fail:function(e,t,n,i){u.alert("获取模块列表失败: {0}",t)},error:function(e,t,n,i){u.alert("获取模块列表错误: 网络繁忙，请稍候再试")}}),e.get()}}}),f.view("/ModuleTree",function(e,t,n){const i=e("@definejs/session-storage"),r=t.require("API"),o=t.require("Tree"),l=t.require("Main");let c=new i(t.id),a={item:null,stat:null};n.on("init",function(){r.on("success",{get:function(e,t){a.stat=e,o.render(e),o.open(a.item.id)}}),o.on({item:function(e){a.item=e,c.set("id",e.id),l.render(a)},resize:function(){let e=o.$.outerWidth();l.resize(e,6)}}),l.on({item:function(e){o.open(e.id)},id:function(e){if(e.startsWith("@definejs/")){let t=`/f/definejs/src/${e}`;n.fire("file",[t])}else o.open(e)},file:function(e){n.fire("file",[e])}})}),n.on("render",function(e){e=e||c.get("id")||1,a.item={id:e},r.get()})}),f.panel("/Setting/Header/List",function(e,t,n){let i=[{name:"显示",value:"show",icon:"fas fa-window-maximize"},{name:"隐藏",value:"hide",icon:"far fa-window-maximize"}];return n.on("init",function(){n.template(function(e,t){return{index:t,name:e.name,icon:e.icon,value:e.value}}),n.$on("click",{'[type="radio"]':function(e){let{checked:t,value:r}=e.target;n.fire("check",[r,i])}})}),n.on("render",function(e){n.fill(i),n.$.find(`[type="radio"][value="${e}"]`).click()}),{}}),f.panel("/Setting/Header",function(e,t,n){const i=e("Settings.Header"),r=t.require("List");return n.on("init",function(){r.on({check:function(e,t){i.set(e)}})}),n.on("render",function(){let e=i.get();r.render(e)}),{}}),f.panel("/Setting/Local/List",function(e,t,n){let i=[{name:"简体中文",value:"chinese",icon:"fas fa-flag red"},{name:"English",value:"english",icon:"fas fa-flag-usa blue"}];return n.on("init",function(){n.template(function(e,t){return{index:t,name:e.name,icon:e.icon,value:e.value}}),n.$on("click",{'[type="radio"]':function(e){let{checked:t,value:r}=e.target;n.fire("check",[r,i])}})}),n.on("render",function(e){n.fill(i),n.$.find(`[type="radio"][value="${e}"]`).click()}),{}}),f.panel("/Setting/Local",function(e,t,n){const i=e("Settings.Language"),r=t.require("List");return n.on("init",function(){r.on({check:function(e,t){i.set(e)}})}),n.on("render",function(){let e=i.get();r.render(e)}),{}}),f.panel("/Setting/Theme/List",function(e,t,n){let i=[{name:"Blue",value:"blue"},{name:"Light",value:"light"}];return n.on("init",function(){n.template(function(e,t){return{index:t,name:e.name,value:e.value}}),n.$on("click",{'[type="radio"]':function(e){let{checked:t,value:r}=e.target;n.fire("check",[r,i])}})}),n.on("render",function(e){n.fill(i),n.$.find(`[type="radio"][value="${e}"]`).click()}),{}}),f.panel("/Setting/Theme",function(e,t,n){const i=e("Settings.Theme"),r=t.require("List");return n.on("init",function(){r.on({check:function(e,t){i.set(e)}})}),n.on("render",function(){let e=i.get();r.render(e)}),{}}),f.view("/Setting",function(e,t,n){const i=t.require("Header"),r=t.require("Theme"),o=t.require("Local");return n.on("init",function(){}),n.on("render",function(){i.render(),r.render(),o.render()}),{}}),f("/Terminal/Command/FileList",function(e,t,n){const i=e("@definejs/loading"),r=e("@definejs/emitter"),o=e("API");let l=new r,c=new i({mask:0});return{on:l.on.bind(l),get:function(){let e=new o("FileList.read",{});e.on({request:function(){c.show("加载中...")},response:function(){c.hide()},success:function(e,t,n){l.fire("success",[e])},fail:function(e,t,n,i){u.alert("获取文件列表失败: {0}",t)},error:function(e,t,n,i){u.alert("获取文件列表错误: 网络繁忙，请稍候再试")}}),e.get({id:"/"})}}}),f("/Terminal/Command/Source",function(e,t,n){const i=e("@definejs/query");let r=new(e("@definejs/emitter")),o=u.config("API"),l=null;return n={on:r.on.bind(r),open:function(e){let t=e.split(" ");e=t[0],t=t.slice(1);let a=i.add(`${o.url}sse/Terminal.exec`,{cmd:e,args:JSON.stringify(t)});n.close(),(l=new EventSource(a)).addEventListener("open",function(e){}),l.addEventListener("stdout",function(e){let t=JSON.parse(e.data);r.fire("stdout",[t])}),l.addEventListener("error",function(e){let{data:t}=e;if(t===M)return u.alert("服务器可能已经关闭了。"),void n.close();(t=JSON.parse(t)).msg=JSON.stringify(JSON.parse(t.msg),null,4),r.fire("error",[t])}),l.addEventListener("stderr",function(e){let t=JSON.parse(e.data);r.fire("stderr",[t])}),l.onmessage=function(e){c.log("onmessage",e)}},close(){if(l)return l.close(),l=null,!0}}}),f("/Terminal/Footer/History",function(e,t,n){let i=new(e("@definejs/local-storage"))(t.id),r=i.get("list")||[],o={index:r.length};return{get(e){let t=o.index+e;if(!(t<0||t>=r.length))return o.index=t,r[t]},push(e){r.push(e),i.set("list",r),o.index=r.length}}}),f.panel("/Terminal/Footer/Input",function(e,t,n){let i=null;return n.on("init",function(){i=n.$.get(0),n.$.on("keyup",function(e){let t=e.keyCode,i=e.target.value;if(13==t&&i)return n.fire("enter",[i]),void(e.target.value="")}),n.$.on("keydown",function(e){let t=e.keyCode;if(38!=t&&40!=t);else{e.preventDefault();let i=t-39;n.fire("move",[i])}}),n.$.on("focusin",function(){n.fire("focus",[!0])}),n.$.on("focusout",function(){n.fire("focus",[!1])})}),n.on("render",function(e){i.value=e||"",s(()=>{i.focus()},200)}),{}}),f("/Terminal/Logs/List/Colors",function(e,t,n){let i={reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29],black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],gray:[90,39],brightRed:[91,39],brightGreen:[92,39],brightYellow:[93,39],brightBlue:[94,39],brightMagenta:[95,39],brightCyan:[96,39],brightWhite:[97,39],bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgGray:[100,49],bgBrightRed:[101,49],bgBrightGreen:[102,49],bgBrightYellow:[103,49],bgBrightBlue:[104,49],bgBrightMagenta:[105,49],bgBrightCyan:[106,49],bgBrightWhite:[107,49]};return{render(e){let t=e;return v.keys(i).forEach(function(e){let n=i[e],r=`[${n[0]}m`,o=`[${n[1]}m`;t=(t=t.split(r).join(`<span class="colors ${e}">`)).split(o).join("</span>")}),t}}}),f("/Terminal/Logs/List/File",function(e,t,n){const i=e("@definejs/string");let r={fs:null,files:[]};return{render(e,t){if(!t)return e;let{files:n}=function(e){if(e===r.fs)return r;let{list:t,root:n}=e;n.endsWith("/")&&(n=n.slice(0,-1));let i=t.map(e=>`${n}${e.name}`);return i=i.sort(function(e,t){return e.length>t.length?-1:1}),r.fs=e,r.files=i,r}(t);return n.forEach((t,n)=>{let r=`<a data-cmd="file" data-value="{${n}}">{${n}}</a>`;e=i.replaceAll(e,t,r)}),e=i.format(e,n)}}}),f("/Terminal/Logs/List/HTML",function(e,t,n){return{render(e){if("string"!=typeof e)return"";return e=(e=(e=(e=(e=e.replace(/[<>]/g,function(e){return"&#"+e.charCodeAt(0)+";"})).split(" ").join('<b class="empty"></b>')).split("│").join('<b class="linkY">│</b>')).split("\r\n").join("<br />")).split("\n").join("<br />")}}}),f.panel("/Terminal/Logs/Header",function(e,t,n){const i=e("CheckBox");let r=[{id:"time",cmd:"time",checked:!0,fireNow:!0,text:"时间"},{id:"color",cmd:"color",checked:!0,fireNow:!0,text:"彩色"},{id:"highlight",cmd:"highlight",checked:!1,fireNow:!0,text:"高亮当前行"},{id:"border",cmd:"border",checked:!1,fireNow:!0,text:"边线"}];return n.on("init",function(){n.$on("click",{"[data-cmd]":function(e){let{cmd:t}=e.currentTarget.dataset;n.fire("cmd",t,[])}}),r=r.map(e=>{let t=new i({checked:e.checked,fireNow:e.fireNow,text:e.text,container:n.$.find(`[data-id="chk-${e.id}"]`)});return t.on("checked",function(t){n.fire("check",e.cmd,[t])}),t})}),n.on("render",function(){r.forEach(e=>{e.render()})}),{close(e){}}}),f.panel("/Terminal/Logs/List",function(e,t,n){const i=e("@definejs/date"),r=t.require("Colors"),o=t.require("File"),l=t.require("HTML");let c=null,a=[],s={input:'<i class="fas fa-terminal"></i>',info:'<i class="fas fa-info-circle"></i>',stdout:""};return n.on("init",function(){c=n.template(),n.$on("click",{"[data-cmd]":function(e){let{cmd:t,value:i}=e.target.dataset;n.fire("cmd",[t,i])}})}),n.on("render",function(e,t){let{msg:d,time:u,type:f}=e;a.push(e),u=i.format(u,"HH:mm:ss"),d=l.render(d),d=r.render(d),d=o.render(d,t);let m=s[f=f||"stdout"]||"",h=a.length-1,p=a[h-1],g=!1;if(p){g=u==i.format(p.time,"HH:mm:ss")}let w=c.fill({time:u,"same-time":g?"same":"",index:h,msg:d,type:f,icon:m});n.$.append(w),n.$.find(`[data-index="${h}"]`).get(0).scrollIntoViewIfNeeded()}),{add(e,t){n.render({type:e,time:p.now(),msg:t})},clear(){a=[],n.$.html("")},showTime(e){n.$.toggleClass("hide-time",!e)},showColor(e){n.$.toggleClass("show-color",e)},showHighlight(e){n.$.toggleClass("show-highlight",e)},showBorder(e){n.$.toggleClass("show-border",e)}}}),f("/Terminal/Command",function(e,t,n){const i=e("@definejs/emitter"),r=t.require("Source"),o=t.require("FileList");let l=new i,c={cmd:"",fs:null,init:!1};return{on:l.on.bind(l),run(e){c.cmd=e,c.init||(c.init=!0,o.on("success",function(e){c.fs=e,r.open(c.cmd)}),r.on("stdout",function(e){e.type="stdout",l.fire("data",[e,c.fs])}),r.on("stderr",function(e){e.type="stderr",l.fire("data",[e,c.fs])}),r.on("error",function(e){e.type="error",l.fire("data",[e,c.fs])})),c.fs?r.open(e):o.get()},close:()=>r.close()}}),f.panel("/Terminal/Footer",function(e,t,n){const i=t.require("History"),r=t.require("Input");return n.on("init",function(){r.on({enter:function(e){i.push(e),n.fire("submit",[e])},focus:function(e){n.$.toggleClass("focus",e)},move:function(e){let t=i.get(e);r.render(t)}})}),n.on("render",function(){r.render("")}),{}}),f.panel("/Terminal/Logs",function(e,t,n){const i=t.require("Header"),r=t.require("List");return n.on("init",function(){i.on({cmd:{clear:function(){r.clear()},close:function(){n.fire("close")}},check:{time:function(e){r.showTime(e)},color:function(e){r.showColor(e)},highlight:function(e){r.showHighlight(e)},border:function(e){r.showBorder(e)}}}),r.on({cmd:function(e,t){n.fire("cmd",[e,t])}})}),n.on("render",function(e,t){i.render(),r.render(e,t)}),{add(e){"clear"!=e?(r.add("input",e),n.fire("add",[e])):r.clear()},close(e){e&&r.add("info","已断开连接")}}}),f.view("/Terminal",function(e,t,n){const i=t.require("Command"),r=t.require("Logs"),o=t.require("Footer");n.on("init",function(){i.on("data",function(e,t){r.render(e,t)}),r.on({cmd:function(e,t){n.fire("cmd",e,[t])},close:function(){let e=i.close();r.close(e)},add:function(e){i.run(e)}}),o.on({submit:function(e){r.add(e)}})}),n.on("render",function(){o.render()})}),f("/Tool/Main/MD5/API",function(e,t,n){const i=e("@definejs/emitter"),r=e("@definejs/loading"),o=e("API");let l=new i,c=new r({mask:0});return{on:l.on.bind(l),get:function(e){let t=new o("Crypto.md5",{});t.on({request:function(){c.show("加载中...")},response:function(){c.hide()},success:function(e,t,n){l.fire("success",[e])},fail:function(e,t,n,i){u.alert("获取 MD5 信息失败: {0}",t)},error:function(e,t,n,i){u.alert("获取 MD5 信息错误: 网络繁忙，请稍候再试")}}),t.post({content:e})}}}),f.panel("/Tool/Main/MD5/Input",function(e,t,n){return n.on("init",function(){n.$on("click",{button:function(){let e=n.$.find("textarea").val();e=e.split("\n").join("\r\n"),n.fire("submit",[e])}})}),n.on("render",function(){}),{}}),f.panel("/Tool/Main/MD5/Output",function(e,t,n){return n.on("init",function(){}),n.on("render",function(e){n.fill({md5:e.md5})}),{}}),f.panel("/Tool/Main/MD5",function(e,t,n){const i=t.require("API"),r=t.require("Input"),o=t.require("Output");return n.on("init",function(){r.on({submit:function(e){i.get(e)}}),i.on({success:function(e){o.render(e)}})}),n.on("render",function(){r.render()}),{}}),f.panel("/Tool/Main/QRCode/Main/Input",function(e,t,n){return n.on("init",function(){n.$on("click",{button:function(){let e=n.$.find("textarea").val();n.fire("submit",[e])}})}),n.on("render",function(){}),{}}),f.panel("/Tool/Main/QRCode/Main/Output",function(e,t,n){return n.on("init",function(){}),n.on("render",function(e,t){let i=`${`http://${e.host}:${e.port}`}${e.qrcode.path}?url=${encodeURIComponent(t)}`,r=`${i}&size=10`,o=`${i}&size=10&margin=4`;n.fill({url:t,src:r,href:o})}),{}}),f.panel("/Tool/Main/QRCode/Statics/List",function(e,t,n){return n.on("init",function(){n.template(function(e,t){let{qrcode:n,url:i}=e,r=`${n}?url=${encodeURIComponent(i)}`;return{index:t,url:i,href:`${r}&size=10&margin=4`,src:`${r}&size=10`}})}),n.on("render",function(e){n.fill(e)}),{}}),f("/Tool/Main/QRCode/API",function(e,t,n){const i=e("@definejs/emitter"),r=e("@definejs/loading"),o=e("API");let l=new i,c=new r({mask:0});return{on:l.on.bind(l),get:function(){let e=new o("Server.get",{});e.on({request:function(){c.show("加载中...")},response:function(){c.hide()},success:function(e,t,n){l.fire("success","get",[e])},fail:function(e,t,n,i){u.alert("获取服务器信息失败: {0}",t)},error:function(e,t,n,i){u.alert("获取服务器信息错误: 网络繁忙，请稍候再试")}}),e.get()}}}),f.panel("/Tool/Main/QRCode/Main",function(e,t,n){const i=t.require("Input"),r=t.require("Output");let o={server:null};return n.on("init",function(){i.on({submit:function(e){r.render(o.server,e)}})}),n.on("render",function(e){o.server=e,i.render()}),{}}),f.panel("/Tool/Main/QRCode/Statics",function(e,t,n){const i=t.require("List");return n.on("init",function(){}),n.on("render",function(e){let t=`http://${e.host}:${e.port}`,n=e.statics.map(n=>({url:`${t}${n}`,qrcode:`${t}${e.qrcode.path}`}));i.render(n)}),{}}),f.panel("/Tool/Main/QRCode",function(e,t,n){const i=t.require("API"),r=t.require("Main"),o=t.require("Statics");n.on("init",function(){i.on("success",{get:function(e){r.render(e),o.render(e)}})}),n.on("render",function(){i.get()})}),f.panel("/Tool/Main",function(e,t,n){const i=t.require("QRCode"),r=t.require("MD5");let o={cmd$module:{}};return n.on("init",function(){}),n.on("render",function(e){let{cmd:n}=e.data,l=o.cmd$module[n];l?l.show():(l=o.cmd$module[n]=t.require(n)).render(),[i,r].forEach(e=>{e!=l&&e.hide()})}),{resize(...e){let t="calc(100% - "+e.reduce(function(e,t){return e+t},0)+"px)";n.$.css({width:t})}}}),f("/Tool/Tree/Data",function(e,t,n){return{make:function(e){let t=1;return[{name:"内容指纹",id:`${t++}`,open:!1,fileIcon:"fas fa-fingerprint",data:{cmd:"MD5"}},{name:"二维码",id:`${t++}`,open:!1,fileIcon:"fas fa-qrcode",data:{cmd:"QRCode"}}]}}}),f.panel("/Tool/Tree",function(e,t,n){const i=e("SidebarTree"),r=t.require("Data");let o=null;return n.on("init",function(){(o=new i({container:n.$,width:n.$.width(),header:!1,resizer:!1})).on({item:function(...e){n.fire("item",e)},dir:function(...e){n.fire("dir",e)},resize:function(...e){let t=o.$.outerWidth();n.$.width(t),n.fire("resize",e)}})}),n.on("render",function(){let e=r.make();o.render(e)}),{open:function(e){o.open(e)}}}),f.view("/Tool",function(e,t,n){const i=e("@definejs/session-storage"),r=t.require("Tree"),o=t.require("Main");let l=null,a={item:null};return n.on("init",function(){l=new i(t.id),r.on({item:function(e){c.log(e),l.set("id",e.id),a.item=e,o.render(e)},resize:function(){let e=r.$.outerWidth();o.resize(e,6)}}),o.on({})}),n.on("render",function(e){e=e||l.get("id")||"1",a.item={id:e},r.render(),r.open(e)}),{}}),f.route("DocAdd",function(e,t){return{demo:function(e){let t=`#!${e}`;n.open(t)}}}),f.route("FileList",function(e,t){const i=t.require("Master");return{demo:function(e){let t=`#!${e}`;n.open(t)},open:function(e){n.open(e)},edit:function(e){i.open("DocAdd",[{name:e}])}}}),f.route("HtmlTree",function(e,t){const n=t.require("Master");return{file:function(e){n.open("FileList",[e])}}}),f.route("MD5",function(e,t){const n=t.require("Master");return{cmd:{file:function(e){n.open("FileList",[e])}}}}),f.route("ModuleTree",function(e,t){const n=t.require("Master");return{file:function(e){n.open("FileList",[e])}}}),f.route("SideMenus",function(e,t){const n=t.require("Master");return{file:function(e){n.open("FileList",[e])}}}),f.route("Terminal",function(e,t){const n=t.require("Master");return{cmd:{file:function(e){n.open("FileList",[e])}}}}),u.launch(function(e,t,n){const i=e("Settings.Theme"),r=t.require("Router"),o=t.require("Markdoc"),l=t.require("Master"),c=t.require("Loading");c.show(),o.on({loading:function(e){c.toggle(e)}}),l.on({require:function(e){return t.require(e)},ready:function(){},render:function(){c.hide(),i.set()}}),r.on({master:function(e){o.hide(),l.render(e)},markdoc:function(e){l.hide(),o.render(e)}}),r.render()})}(top,parent,window,document,location,localStorage,sessionStorage,window.console||{log:function(){},dir:function(){},clear:function(){},error:function(){},info:function(){},debug:function(){},warn:function(){}},history,setTimeout,setInterval,definejs,definejs.require("AppModule").define,Array,Boolean,Date,Error,Function,Math,Number,Object,RegExp,String);