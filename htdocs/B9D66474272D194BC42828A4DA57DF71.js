!function(e,t,n,i,r,o,l,s,c,a,d,u,f,m,h,g,p,w,b,y,v,k,x,M){f("data.Sidebar",function(e,t,n){return[{name:"终端",icon:"fas fa-terminal",view:"Terminal"},{name:"文件资源",icon:"fa fa-folder-open",view:"FileList"},{name:"模块系统",icon:"fa fa-sitemap",view:"ModuleTree"},{name:"文件指纹",icon:"fas fa-fingerprint",view:"MD5"},{name:"日志",icon:"fas fa-comment-dots",view:"Log"},{name:"帮助手册",icon:"fa fa-question-circle",view:"DocHelp"}]}),f("CheckBox.defaults",{checked:!1,fireNow:!0,checkedClass:"far fa-check-square checked",uncheckedClass:"far fa-square"}),f("CheckBox",function(e,t,n){const i=e("$"),r=e("@definejs/object"),o=e("@definejs/template"),l=e("@definejs/emitter"),s=e("Defaults");let c=new Map,a=new o("#tpl-CheckBox");return class{constructor(e){e=s.clone(t,e);let n=new l(this),r={checked:e.checked,text:e.text,fireNow:e.fireNow,checkedClass:e.checkedClass,uncheckedClass:e.uncheckedClass,$:i(e.container),emitter:n,bind:!1};c.set(this,r)}render(e={}){let t=c.get(this),n=r.filter(e,["checked","text"]);v.assign(t,n);let i=a.fill({class:t.checked?t.checkedClass:t.uncheckedClass,text:t.text});t.$.html(i),t.$.addClass("CheckBox"),t.fireNow&&t.emitter.fire("checked",[t.checked]),t.bind||(t.$.on("click",function(e){let n=t.checked=!t.checked,i=t.$.find("i");n?(i.removeClass(t.uncheckedClass),i.addClass(t.checkedClass)):(i.removeClass(t.checkedClass),i.addClass(t.uncheckedClass)),t.emitter.fire("checked",[n])}),t.bind=!0)}on(...e){c.get(this).emitter.on(...e)}destroy(){let e=c.get(this);e.emitter.destroy(),e.$=null,c.delete(this)}}}),f("DateTimePicker",function(e,t,n){const i=e("$"),r=e("@definejs/object"),o=e("@definejs/emitter"),l=e("@definejs/string"),c=e("Defaults");let a=new Map;function d(e,t,n){let i=m.from(n),r=a.get(e).$;return i=[t].concat(i),r.datetimepicker.apply(r,i)}function u(e,n){r.isPlain(e)&&(e=(n=e).selector,delete n.selector),n=c.clone(t,n);let i=v.assign({},n),s=new o(this),d={id:l.random(),$:null,txt:null,emitter:s,selector:e,options:i,disabled:!1,this:this};a.set(this,d)}return u.prototype={constructor:u,id:"",$:null,render:function(e){let t=a.get(this),n=t.emitter;if(t.$=this.$=i(t.selector),t.txt=t.$.get(0),t.$.datetimepicker(t.options),t.$.on({focus:function(){this.select()},change:function(){let e=this.value;t.value=e,s.log(e),n.fire("change",[e])},click:function(){t.this.show()}}),e){let n=e.value;n&&t.$.val(n)}},on:function(e,t){a.get(this).emitter.on(...arguments)},remove:function(){d(this,"remove",arguments)},show:function(){d(this,"show",arguments)},hide:function(){d(this,"hide",arguments)},update:function(){d(this,"update",arguments)},setStartDate:function(){d(this,"setStartDate",arguments)},setEndDate:function(){d(this,"setEndDate",arguments)},setDaysOfWeekDisabled:function(){d(this,"setDaysOfWeekDisabled",arguments)},destroy:function(){let e=a.get(this);e&&(e.emitter.destroy(),e.$.off(),a.delete(this))},set:function(e,t){let n=a.get(this),i=n.txt;switch(e){case"disabled":t=!!t,n.disabled=t,i.disabled=t;break;case"value":n.$.val(t)}},get:function(e){let t=a.get(this);switch(e){case"disabled":return t[e]}}},u}),f("Dialog/Drager",function(e,t,r){const o=e("$"),l=e("@definejs/masker");let s=0,c=0,a=0,d=0,u="",f=i.body,m=null,h={},g=null;function p(e){f.style.cursor=u,g&&g.$.removeClass("draging"),m&&m.hide(),e&&e.preventDefault(),g=null}return o(f).on({mousedown:function(e){(g=h[e.target.id])&&(s=e.pageX,c=e.pageY,u=f.style.cursor,f.style.cursor="move",a=g.$.css("margin-left"),d=g.$.css("margin-top"),a=parseInt(a),d=parseInt(d),g.$.addClass("draging"),(m=m||new l({opacity:0,background:"red","z-index":1025})).show(),n.getSelection().removeAllRanges())},mousemove:function(e){if(!g)return;if(1!=e.which)return void p();let t=e.pageX-s,n=e.pageY-c,i=a+t,r=d+n;g.$.css({"margin-left":i,"margin-top":r})},mouseup:function(e){p(e)}}),{set:function(e,t){h[e]=t},remove:function(e){delete h[e]}}}),f("Dialog/Events",function(e,t,n){const r=e("$");return{bind:function(e){let t={keyup:function(t){13==t.keyCode&&e.visible&&(t.stopPropagation(),e.emitter.fire("enter",[t]))}};r(i.body).on(t),r("#"+e.id).on(t),r("#"+e.headerId).on("click","i",function(){e.this.close()}),r("#"+e.footerId).on("click","button[data-index]",function(){let t=+this.getAttribute("data-index"),n=e.footer.buttons[t],i=n.name||x(t);e.emitter.fire("button",i,[n,t]),e.emitter.fire("button",[n,t]),("autoClose"in n?n.autoClose:e.autoClose)&&e.this.close(!0)})}}}),f("Dialog/Meta",function(e,t,n){const i=e("@definejs/string");return{create:function(e,t){let n="Dialog-"+i.random(4),r=e.footer;r=m.isArray(r)?{content:"",buttons:r}:"string"==typeof r?{content:r,buttons:[]}:r||{};let o={dragable:e.dragable,resizable:e.resizable,cssClass:e.cssClass,autoClose:e.autoClose,mask:e.mask,"z-index":e["z-index"],width:e.width,height:e.height,container:e.container,title:e.title,content:e.content,footer:r,maxWidth:e.maxWidth,minWidth:e.minWidth,maxHeight:e.maxHeight,minHeight:e.minHeight,attributes:e.attributes,masker:null,id:n,headerId:n+"-header",contentId:n+"-content",footerId:n+"-footer",sizerId:n+"-sizer",rendered:!1,visible:!1,$:null,this:this};return v.assign(o,t),o}}}),f("Dialog/Resizer",function(e,t,n){const r=e("$");let o=0,l=0,s=0,c=0,a="",d=i.body,u={},f=null,m=null,h=null;function g(e){d.style.cursor=a,e&&e.preventDefault(),m&&m.removeClass("resizing"),f=null,m=null,h=null}function p(e,t){let n=e+" x "+t;h.html(n)}return r(d).on({mousedown:function(e){let t=e.target,n=t.getAttribute("data-id");if(f=u[n])return o=e.pageX,l=e.pageY,a=d.style.cursor,d.style.cursor=r(t).css("cursor"),s=f.$.css("width"),c=f.$.css("height"),s=parseInt(s),c=parseInt(c),(m=r("#"+f.headerId)).addClass("resizing"),h=r("#"+f.sizerId),p(s,c),!1},mousemove:function(e){if(!f)return;if(1!=e.which)return void g();let t=e.pageX-o,n=e.pageY-l,i=s+t,r=c+n,a=f.maxWidth;a&&i>a&&(i=a);let d=f.minWidth;d&&i<d&&(i=d);let u=f.maxHeight;u&&r>u&&(r=u);let m=f.minHeight;m&&r<m&&(r=m),f.$.css({width:i,height:r}),p(i,r)},mouseup:function(e){g(e)}}),{set:function(e,t){u[e]=t},remove:function(e){delete u[e]}}}),f("Dialog/Style",function(e,t,n){const i=e("@definejs/object");function r(e){return(e=0-(e=parseInt(e))/2)+"px"}return{get:function(e){var t=i.filter(e,["height","width","z-index"]),n=t.width;n?(t.width=parseInt(n)+"px",t["margin-left"]=r(n)):delete t.width;var o=t.height;o?(t.height=parseInt(o)+"px",t["margin-top"]=r(o)):delete t.height;var l=[];for(var s in t){var c=s+": "+t[s];l.push(c)}return t=l.join("; ")+";"}}}),f("Dialog/Template",function(e,t){let n=new(e("@definejs/template"))("#tpl-Dialog");return n.process({"":function(e){let t=this.fill("header",e),n=this.fill("content",e),i=this.fill("footer",e),r=v.entries(e.attributes).map(function(e){return e[0]+'="'+e[1]+'"'});return this.fix("attributes"),{id:e.id,headerId:e.headerId,contentId:e.contentId,footerId:e.footerId,attributes:r.join(" "),cssClass:e.cssClass,style:e.style,header:t,content:n,footer:i}},header:function(e){return{title:e.title,sizerId:e.sizerId}},content:function(e){return e.content},footer:{"":function(e){let t=e.footer;return{content:this.fill("content",t),buttons:this.fill("buttons",t),resizer:this.fill("resizer",e)}},content:function(e){return e.content},buttons:{"":function(e){let t=e.buttons;return t&&0!=t.length?{buttons:t=this.fill("button",t)}:""},button:function(e,t){return{index:t,text:e.text,cssClass:e.cssClass||""}}},resizer:function(e){return e.resizable?{id:e.id}:""}}}),n}),f("Dialog.defaults",{cssClass:"",mask:!0,title:"",content:"",width:0,height:0,"z-index":1024,maxWidth:0,maxHeight:0,minWidth:200,minHeight:160,dragable:!0,resizable:!0,autoClose:!0,attributes:{},footer:{content:"",buttons:[]}}),f("Dialog",function(e,t,n){const r=e("$"),o=e("Defaults"),l=e("@definejs/emitter"),s=e("@definejs/masker"),c=e("@definejs/panel"),a=t.require("Meta"),d=t.require("Template"),u=t.require("Drager"),f=t.require("Resizer"),h=t.require("Style"),g=t.require("Events");let p=new Map;function w(e){e=o.clone(t,e);let n=new l(this),i=a.create(e,{this:this,emitter:n});p.set(this,i),this.id=i.id,this.$=i.$}return w.prototype={constructor:w,id:"",$:null,render:function(e){e=e||{};let t=p.get(this),n=t.emitter;if(t.rendered)return this.set(e),this.show(),void n.fire("render",[e]);let o=t.title=e.title||t.title,l=t.content=e.content||t.content,c=t.footer=e.footer||t.footer,a=h.get(t),m=t.headerId,w=d.fill({id:t.id,headerId:m,contentId:t.contentId,footerId:t.footerId,sizerId:t.sizerId,cssClass:t.cssClass,resizable:t.resizable,attributes:t.attributes,style:a,title:o,content:l,footer:c});r(i.body).prepend(w),t.rendered=!0,this.$=t.$=r("#"+t.id),t.$.toggleClass("auto-size",!t.width||!t.height),t.mask&&(t.masker=new s({"z-index":t["z-index"]-1})),t.dragable&&u.set(m,t),t.resizable&&f.set(t.id,t),g.bind(t),this.show(),n.fire("first-render",[e]),n.fire("render",[e])},show:function(){let e=p.get(this);if(!e.rendered||e.visible)return;let t=e.masker;if(t){let n=s.normalize(e.mask);t.show(n)}e.$.show(),e.visible=!0,e.emitter.fire("show")},close:function(e){let t=p.get(this);if(!t.rendered||!t.visible)return;let n=t.emitter;if(!e){if(!1===(e=n.fire("before-close").slice(-1)[0]))return}let i=t.masker;i&&i.hide(),t.$.hide(),t.visible=!1,n.fire("close")},set:function(e,t){let n="object"==typeof e?e:{[e]:t},i=p.get(this),o={title:"header",content:"content",footer:"footer"};for(e in n){let l=o[e];if(l){let e=d.fill(l,n),t=i[l+"Id"];r("#"+t).html(e)}else switch(t=n[e],e){case"width":case"height":i.$.css(e,t)}}},on:function(e,t){let n=p.get(this).emitter,i=m.from(arguments);n.on(i)},destroy:function(){let e=p.get(this);if(!e)return;e.emitter.destroy(),e.masker.destroy(),e.$.off();let t=e.$.get(0);t.parentNode.removeChild(t),u.remove(e.headerId),f.remove(e.id)}},v.assign(w,{panel:function(e){let t=e.content,n=e.container,i=e.footer,r=t.$.get(0),o=n.$.get(0),l=i&&!m.isArray(i)?i.$.get(0):null,s={};m.from(o.attributes).map(function(e){let t=e.name;"class"!=t&&(s[t]=e.value)});let a=v.assign({},e,{content:r.outerHTML,cssClass:o.className,attributes:s});a.footer=l?l.outerHTML:i;let d=new w(a);return d.on({"first-render":function(){o.parentNode.removeChild(o),r.parentNode.removeChild(r),l&&l.parentNode.removeChild(l),n.set("$");let e=`[data-panel^="${o.getAttribute("data-panel")}"]`,t=n.$.find(e).toArray();t=t.map(function(e){return e.getAttribute("data-panel")}),c.update(t),o=null,r=null,l=null}}),d}}),w}),f("DropList/Current",function(e,t,n){let i={item:null,row:null,event:null,hover:null,keyword:"",html:""};return{create:function(){return v.assign({},i)},reset:function(e,t){t=t||{},v.assign(e.current,i,t),e.this.hover(0)}}}),f("DropList/Field",function(e,t,n){function i(e,t){return"function"==typeof t?t(e):e[t]}return{map:function(e,t){return t=t||[],e?t=t.map(function(t){return{id:e.id?i(t,e.id):"",title:e.title?i(t,e.title):"",item:t,disabled:!1}}):t}}}),f("DropList/Filter",function(e,t,n){return{bind:function(e){let t=e.filters;e.this.on("change",function(n){this.fill(e.list,n,function(e,i){return!t||function(e,t,n){let i=t.length;for(let r=0;r<i;r++){let i=t[r],o=!1;if("object"==typeof i){let e=i;i=e.name,o=e.ignoreCase}let l=e[i];if("number"==typeof l&&(l=x(l)),"string"==typeof l&&(o&&(l=l.toLowerCase(),n=n.toLowerCase()),l.includes(n)))return!0}return!1}(e,t,n)})})}}}),f("DropList/Input",function(e,t,n){const r=e("$");return{create:function(e){let t=i.getElementById(e.txtId),n=!1;return r(t).on({focus:function(){e.disabled||(e.masker.show(),function(e){let t=e.field,n=e.current.item;if(!t||!t.focus||!n)return;let i=e.getValue(n.item,t.focus);e.this.set("text",i),e.this.select()}(e))},blur:function(){e.hovering||(e.masker.hide(),function(e){let t=e.field,n=e.current.item;if(!t||!t.text||!n)return;let i=e.getValue(n.item,t.text);e.this.set("text",i)}(e))},click:function(e){},input:function(){n||e.change()},compositionstart:function(e){n=!0},compositionend:function(t){n=!1,e.change()},keydown:function(n){let i=n.keyCode,r=e.current,o=r.hover;if(13==i)return r.event=n,o&&e.this.select(o.index),void t.blur();let l=o?o.index:-1,s=38==i,c=40==i,a=e.length-1;(s||c)&&((l=s?l-1:l+1)<0?l=a:l>a&&(l=0),e.this.hover(l),n.preventDefault())}}),t}}}),f("DropList/Masker",function(e,t,n){const i=e("@definejs/masker");return{create:function(e){let t=new i({volatile:!0,opacity:e.mask,container:e.dialog,position:"absolute"});return t.on({show:function(){e.$.addClass("on"),e.visible=!0,e.adjust(),e.$table.get(0).scrollIntoViewIfNeeded();let t=e.current.row;t&&t.element.scrollIntoViewIfNeeded(),e.emitter.fire("focus")},hide:function(){let t=e.old.item;""===e.txt.value&&!e.empty&&t&&(e.this.fill(e.list),e.this.select(t));let n=!e.custom&&!e.current.item&&!!e.text;if(s.log("invalid: =========  ",n),n)return e.$txt.addClass("error"),u.alert("输入的数据不存在，请重新输入。",function(){e.txt.focus()}),!1;e.$.removeClass("on"),e.visible=!1,e.emitter.fire("blur")}}),t}}}),f("DropList/Meta",function(e,t,n){const i=e("@definejs/string"),r=e("$");return{create:function(e,t){let n=e.filters,o=e.columns;!0===n&&(n=o||null);let l={id:i.random(),txtId:i.random(),tableId:i.random(),$:null,$table:null,$txt:null,txt:null,this:null,emitter:null,table:null,masker:null,tpl:null,container:e.container,cssClass:e.cssClass,tableClass:e.tableClass,text:e.text,readonly:e.readonly,disabled:e.disabled,custom:e.custom,order:e.order,empty:e.empty,mask:e.mask,dialog:e.dialog,field:e.field,tabIndex:e.tabIndex,maxLength:e.maxLength,columns:o,filters:n,direction:"",visible:!1,hovering:!1,list:[],length:0,current:{},old:{},getValue:function(e,t){return"function"==typeof t?t(e):e[t]},change:function(e){let t=arguments.length>0,n=l.txt,i=r(n);if((e=t?x(e):n.value)===l.text)return;let o=""===e;i.removeClass("error"),l.text=n.title=e,t&&(n.value=e),t||l.emitter.fire("change",[e]),o&&l.emitter.fire("empty",[]),n.placeholder=l.current.item&&o?"(无内容)":""},adjust:function(){if(!l.visible)return;l.$.removeClass("right");let e=l.$table.outerWidth(),t=r(l.dialog).width(),n=l.$table.offset().left-r(l.dialog).offset().left,i=l.direction=n+e>t?"right":"left";l.$.toggleClass("right","right"==i)}};return v.assign(l,t),l}}}),f("DropList/Table",function(e,t,n){const i=e("@definejs/escape"),r=e("Table");return{create:function(e){let t=e.columns.map(function(e){return{name:e}}),n=new r({container:"#"+e.tableId,fields:t,order:e.order,class:e.tableClass,columnName:"name"});return n.on("process",{row:function(t){let n=e.field.title;n&&(t.title=e.getValue(t.data.item,n))},cell:function(t){let n=e.emitter.fire("process",[t]).slice(-1)[0];n===M&&(n=null==(n=t.row.data.item[t.name])?"":n,n=i.html(n));let r=e.current,o=r.keyword;return n.includes(o)&&r.index<0&&(r.index=t.row.index),o&&(n=x(n).split(o).join(r.html)),n}}),n.on("fill",function(t){let n=e.length=t.length,i=b.max(e.current.index,0);e.$table.removeClass("loading").toggleClass("nodata",!n),e.$txt.removeClass("error"),e.this.hover(i),e.adjust()}),n.on("render",function(){this.$.on("mouseover",function(){e.hovering=!0}),this.$.on("mouseout",function(){e.hovering=!1})}),n.on("click",{row:function(t,n){e.current.event=n,e.this.select(t.index)}}),n},getRow:function(e,t){let n=e.get("rows"),i=typeof t;if("number"==i)return n[t];if("function"==i)return n.find(function(e,n){return t(e.data,n)});if(!t)return null;let r=t;return"object"==i&&(r=x(t.id)),n.find(function(e,t){return e.data.id==r})}}}),f("DropList/Template",function(e,t){const n=e("@definejs/template");return{create:function(e){let t=new n("#tpl-DropList");return t.process({"":function(){this.fix(["maxlength","readonly","disabled","tabIndex"]);let t=e.tabIndex,n=e.maxLength;return t=t?'tabindex="'+t+'"':"",n=n?'maxlength="'+e.maxLength+'"':"",{txtId:e.txtId,tableId:e.tableId,text:e.text,readonly:e.readonly?"readonly":"",disabled:e.disabled?"disabled":"",tabindex:t,maxlength:n}}}),t}}}),f("DropList.defaults",{cssClass:"DropList",tableClass:"",text:"",readonly:!1,disabled:!1,custom:!1,order:!1,empty:!1,mask:0,dialog:i.body,columns:[],field:null,filters:!0,container:null,tabIndex:"",maxLength:0}),f("DropList",function(e,t){const n=e("$"),i=e("Defaults"),r=e("@definejs/emitter"),o=e("@definejs/array"),l=e("@definejs/object"),c=t.require("Current"),d=t.require("Field"),u=t.require("Filter"),f=t.require("Input"),m=t.require("Masker"),h=t.require("Meta"),g=t.require("Table"),p=t.require("Template");let w=new Map;function b(e){e=i.clone(t,e);let n=new r(this),o=c.create(),l=h.create(e,{emitter:n,current:o,this:this});w.set(this,l),v.assign(this,{id:l.id,$:l.$,meta:l}),u.bind(l)}return b.prototype={constructor:b,id:"",$:null,render:function(e){let t=w.get(this),i=(t.tpl=p.create(t)).fill(t);t.$=this.$=n(t.container),t.$.html(i),t.$.addClass(t.cssClass),(t.table=g.create(t)).render(),t.txt=f.create(t),t.masker=m.create(t),t.$table=n("#"+t.tableId),t.$txt=n(t.txt),e&&this.fill(e)},fill:function(e,t,n){"function"==typeof t&&(n=t,t="");let i=w.get(this);e=o.map(e,function(e,t){if(!n)return e;let r=n.call(i.this,e,t);return!1===r?null:"object"==typeof r?r:e}),t||(i.list=e);let r=d.map(i.field,e),l=t?i.tpl.fill("keyword",{keyword:t}):"",s=i.current;s.item&&v.assign(i.old,s),c.reset(i,{keyword:t,html:l,index:-1}),i.table.fill(r),i.emitter.fire("fill",[e])},select:function(e){let t=w.get(this),i=t.txt;if(0==arguments.length)return i.select(),i.value;let r=g.getRow(t.table,e);if(!r)return void s.warn("要选择的项无法找到:",e);let o=r.data;if(o.disabled)return void s.warn("要选择的项已给禁用:",o);let l=t.current;if(l.item===o)return t.masker&&t.masker.hide(),void s.warn("要选择的项已给选中:",o);let c=l.row,d=l.item,u=l.event;l.row=r,l.item=o,l.event=null,c&&n(c.element).removeClass("on"),n(r.element).addClass("on"),t.$txt.removeClass("error"),r.element.scrollIntoViewIfNeeded(),this.hover(r.index),u&&a(function(){t.visible&&t.masker&&t.masker.hide()},50);let f=t.field;if(f&&f.text){let e=t.getValue(o.item,f.text);this.set("text",e)}t.emitter.fire("select",[o,{index:r.index,row:r,item:o,event:u,keyword:l.keyword,oldRow:c,oldItem:d}])},hover:function(e){let t=w.get(this),i=t.table.get(e),r=t.current.hover;if(!i)return r&&n(r.element).removeClass("hover"),void(t.current.hover=null);i!==r&&(t.current.hover=i,r&&n(r.element).removeClass("hover"),n(i.element).addClass("hover"),i.element.scrollIntoViewIfNeeded())},set:function(e,t){let n=l.isPlain(e)?e:{[e]:t},i=w.get(this);l.each(n,function(e,t){switch(e){case"text":i.change(t);break;case"disabled":t=!!t,i.txt.disabled=i.disabled=t;break;case"list":i.list=t||[]}})},get:function(e){let t=w.get(this),n=t.current;if(!e)return n.item;switch(e){case"text":case"disabled":case"length":return t[e]}},reset:function(){let e=w.get(this),t=e.current.row;t&&n(t.element).removeClass("on hover"),e.old={},c.reset(e),this.set({text:"",disabled:!1}),e.emitter.fire("reset")},on:function(){w.get(this).emitter.on(...arguments)},destroy:function(){let e=w.get(this);e&&(e.emitter.destroy(),e.table.destroy(),e.masker.destroy(),e.tpl.destroy(),e.current=null,e.$=null,e.txt=null,e.this=null,e.$txt=null,e.$table=null,e.masker=null,w.delete(this))}},b}),f("GridView/Check",function(e,t,n){const i=e("$");return{item:function(e,t,n){let r=t[e.primaryKey],o=e.current,l=o.id$item,s=new Set(o.list);return n===M&&(n=!l[r]),n?(l[r]=t,s.add(r)):(delete l[r],s.delete(r)),o.list=[...s],i("#"+e.countId).html(s.size),s=e.this.get(),e.emitter.fire("check",[{item:t,checked:n,list:s,id$item:l}]),n},all:function(e){let t=e.list,n=e.current.id$item,r=e.primaryKey,o=t.length,l=o>0;for(let e=0;e<o;e++){if(!n[t[e][r]]){l=!1;break}}i("#"+e.checkAllId).toggleClass("on",l)}}}),f("GridView/Fields",function(e,t,n){let i=e("Defaults").get(t.parent.id);return{get:function(e){let t=e.fields,n=e.check,r=e.order,o=[];return n=!0===n?i.check:n,r=!0===r?i.order:r,n&&o.push({name:n.name,width:n.width,caption:"",class:n.class,dragable:n.dragable}),r&&o.push({name:r.name,width:r.width,caption:r.caption,class:r.class,dragable:r.dragable}),t.forEach(function(e){o.push({name:e.name,width:e.width,caption:e.caption,class:e.class,dragable:e.dragable,delegate:e.delegate})}),o},sumWidth:function(e){let t=0;return e.map(function(e){t+=e.width}),t}}}),f("GridView/Meta",function(e,t,n){const i=e("@definejs/string");return{create:function(e,t){let n=e.all,r=n?n.length:e.total,o={id:i.random(),pagerId:i.random(),tableId:i.random(),headerId:i.random(),counterId:i.random(),countId:i.random(),checkAllId:i.random(),$:null,table:null,pager:null,tpl:null,resizer:null,checkItem:null,checkAll:null,all:n,total:r,container:e.container,class:e.class,no:e.no,size:e.size,sizes:e.sizes,check:e.check,order:e.order,primaryKey:e.primaryKey,footer:!!e.footer,list:[],oldList:null,selectedMode:!1,current:{list:[],id$item:{}}};return v.assign(o,t),o}}}),f("GridView/Pager",function(e,t,n){const i=e("Pager");return{create:function(e){let t=new i({container:"#"+e.pagerId,total:e.total,size:e.size,sizes:e.sizes});return t.on({change:function(t,n){e.no=t,e.size=n,e.selectedMode=!1,e.emitter.fire("page","change",[t,n])},error:function(t){e.emitter.fire("page","error",[t])}}),t},list:function(e,t,n){let i=(t-1)*n,r=i+n;return e.slice(i,r)}}}),f("GridView/Resizer",function(e,t,n){const i=e("$"),r=e("TableResizer");return{create:function(e){let t=null,n=new r({table:"#"+e.headerId,fields:e.fields});return n.on("render",function(){let t="#"+e.checkAllId;this.$.on("click",t,function(){let t=i(this),n=!t.hasClass("on");t.toggleClass("on",n),e.table.column("check",function(t){t.ctrl.toggleClass("on",n),e.checkItem(t.row.data,n)})})}),n.on({render:function(n,i){(t=new r({table:e.table.get("element"),dragable:!1,fields:i})).render()},change:function(e){t.set(e)}}),n}}}),f("GridView/Table",function(e,t,n){const i=e("$"),r=e("Table");return{create:function(e){let t=new r({container:"#"+e.tableId,fields:e.fields,order:!1,columnName:"name"});return t.on("process",{row:function(t){t.value=t.data[e.primaryKey],e.emitter.fire("process","row",[t])},cell:{"":function(t){let n=e.emitter.fire("process","cell",t.name,[t]),i=n.slice(-1)[0];return i===M&&(i=(n=e.emitter.fire("process","cell",[t])).slice(-1)[0]),i===M&&(i=t.row.data[t.name]),t.value=i,i},check:function(t){let n=t.row,i=e.current.id$item[n.value];return e.tpl.fill("check-item",{index:n.index,checked:i?"on":""})},order:function(t){let n=t.row.index+1;return!e.order.global||e.selectedMode?n:(e.no-1)*e.size+n}}}),t.on("render",function(){t.$.on("click",'[data-cmd="check-item"]',function(){let n=this.parentNode.id,r=t.get(n),o=e.checkItem(r.row.data);i(this).toggleClass("on",o),e.checkAll()})}),t.on("fill",function(n){e.list=n,e.check&&(e.checkAll(),t.column("check",function(e){e.ctrl=i(e.element).find('[data-cmd="check-item"]')}))}),t.on("click",{"":function(n){e.emitter.fire("click","table",[t,n])},row:function(t,n){e.emitter.fire("click","row",[t,n])},cell:function(t,n){e.emitter.fire("click","cell",t.name,[t,n]),e.emitter.fire("click","cell",[t,n])}}),e.fields.forEach(function(n){let i=n.delegate;i&&t.on("click","cell",n.name,i,function(t,n,r){e.emitter.fire("click","cell",t.name,i,[t,n,r])})}),t}}}),f("GridView/Template",function(e,t,n){const i=e("@definejs/template");return{create:function(e){let t=new i("#tpl-GridView"),n=e.fields;return e.check&&(n[0].caption=t.fill("check-all",{})),t.process({"":function(){return{header:this.fill("header",{fields:n}),id:e.id,class:e.class,"no-footer":e.footer?"":"no-footer",headerId:e.headerId,tableId:e.tableId,pagerId:e.pagerId,counterId:e.counterId,countId:e.countId,checkAllId:e.checkAllId}},header:{"":function(e){let t=e.fields;return{cells:this.fill("cell",t)}},cell:function(e,t){return{caption:e.caption}}}}),t}}}),f("GridView.defaults",{size:20,all:null,class:"",primaryKey:"id",footer:!0,sizes:[10,20,30,40,50],check:{name:"check",width:43,class:"check",dragable:!1},order:{name:"order",width:50,caption:"序号",global:!0,dragable:!0,class:"order"}}),f("GridView",function(e,t,n){const i=e("$"),r=e("@definejs/emitter"),o=e("@definejs/array"),l=e("@definejs/object"),s=e("Defaults"),c=t.require("Template"),a=t.require("Table"),d=t.require("Pager"),u=t.require("Resizer"),f=t.require("Fields"),m=t.require("Check"),h=t.require("Meta");let g=new Map,p=0;function w(e){e=s.clone(t,e);let n=new r(this),i=f.get(e),o=e.width;"auto"==o&&(o=f.sumWidth(i)+264),n.id=`GridView-Emitter-${p++}`;let l=h.create(e,{emitter:n,fields:i,width:o,this:this,checkItem:function(e,t){return m.item(l,e,t)},checkAll:function(){return m.all(l)}});g.set(this,l),v.assign(this,{id:l.id}),l.all&&this.on("pager","change",function(e,t){if(!l.all)return;let n=d.list(l.all,e,t);this.fill(n)})}return w.prototype={constructor:w,id:"",$:null,render:function(){let e=g.get(this),t=(e.tpl=c.create(e)).fill(e);e.$=this.$=i(e.container),e.$.html(t),(e.table=a.create(e)).render(),(e.resizer=u.create(e)).render(),(e.pager=d.create(e)).render(),e.$.on("click","#"+e.counterId,function(){let t=e.selectedMode=!e.selectedMode,n=t?e.this.get():e.oldList;i(this).toggleClass("selected-mode",t),e.table.fill(n)})},fill:function(e,t){let n=g.get(this);t&&(e=o.map(e,t)),n.oldList=e,n.table.fill(e),n.emitter.fire("fill",[e])},check:function(e){let t=g.get(this);e&&e.forEach(function(e){t.checkItem(e,!0)}),t.list&&this.fill(t.list)},clear:function(){let e=g.get(this),t=e.current;t.list.length&&(t.id$item={},t.list=[],e.table.column("check",function(e){e.ctrl.removeClass("on")}),i("#"+e.checkAllId).removeClass("on"),i("#"+e.countId).html(0),e.emitter.fire("clear"))},set:function(e){let t=g.get(this),n=e.all,i=l.filter(e,["total","size","no"]);l.isEmpty(i)||(v.assign(t,i),t.pager.render(i)),n&&(t.all=n)},get:function(){let e=g.get(this),t=e.current.list||[],n=e.current.id$item;return t=t.map(function(e){return n[e]})},to:function(e){g.get(this).pager.to(e)},destroy:function(){let e=g.get(this);e&&(e.emitter.destroy(),e.resizer.destroy(),e.table.destroy(),e.pager.destroy(),e.tpl.destroy(),g.delete(this))},on:function(){g.get(this).emitter.on(...arguments)}},v.assign(w,{}),w}),f("MarkDoc/Href/Url",function(e,t,n){const i=e("@definejs/query"),r=e("@definejs/hash"),o=e("resolveUrl");function l(e,t){if(0!=t.indexOf("."))return t;let n=e.split("/").slice(0,-1).join("/")+"/",i=o(n,t),r=o("./");return i=i.slice(r.length)}return{getHref:function(e,t){let n=i.get(e)||{},r=n.file,o=n.dir;if(!r)return e;o&&(o=l(t,o));let s=r.split(",");return s=s.map(function(e){return e=l(t,e)}),r=s.join(","),o&&(e=i.add(e,"dir",o)),e=i.add(e,"file",r)},getHash:function(e){let t=i.get(e);return r.set("",t)}}}),f("MarkDoc/Code",function(e,t,i){const r=e("$"),o=e("@definejs/string"),l=e("@definejs/json");return{each:function(e,t){r(e).find("code[data-language]").each(function(e){let n=this.innerText,i=this.getAttribute("data-language");t({element:this,content:n,language:i},e)})},format:function(e){if("json"==e.getAttribute("data-language")){let t=e.innerText,i=l.parse(t);i&&(i=n.JSON.stringify(i,null,4),e.innerHTML=i)}},language:function(e,t){return o.format(e.samples.language,{language:t,foldable:e.code.foldable?"foldable":""})},wrap:function(e,t){let n=r(t.element.parentNode),i=t.language+t.numbers;n.wrap(e.samples.source),n.before(i),n.height(t.height);let o=n.parent().find(">ul"),l=10*o.find(">li").length.toString().length+15;o.css("width",l),n.css("margin-left",l)}}}),f("MarkDoc/Content",function(e,t,i){const r=e("@definejs/string"),o=n.marked;return{get:function(e,t){let n=t.language,i=t.content,l=t.process;return"html"!=n&&"htm"!=n||(n="",i=["``` html",i,"```"].join("\r\n")),n?i=r.format(e.samples.pre,{language:n,content:i}):(i=o(i),l&&(i=l(i))),i}}}),f("MarkDoc/Events",function(e,t,n){const i=e("$");return{bind:function(e,t){e.bind=!0,e.code.foldable&&e.$.on("click",'[data-cmd="language"]',function(e){i(this.parentNode).toggleClass("on"),e.stopPropagation()}),e.code.foldable&&e.$.on("click",'[data-cmd="source-code"]',function(){let e=i(this);e.hasClass("on")&&e.removeClass("on")}),e.$.on("click",'a[href^="#"]',function(t){let n=this.getAttribute("href");t.preventDefault(),e.emitter.fire("hash",[n])}),e.titles.foldable&&e.$.on("click",e.titles.selector,function(t){"span"==t.target.tagName.toLowerCase()&&i(this).nextUntil(e.titles.selector).animate({height:"toggle",opacity:"toggle"})})}}}),f("MarkDoc/Highlight",function(e,t,i){const r=e("@definejs/string"),o=n.hljs;return{highlight:function(e,t){if(!t)return"";t=r.replaceAll(t,"&lt;","<"),t=r.replaceAll(t,"&gt;",">");try{return o.highlight(e,t).value}catch(e){return t}}}}),f("MarkDoc/Href",function(e,t,n){const i=t.require("Url");return{format:function(e,t){t&&e.$.find("a").each(function(){let e=this,n=e.getAttribute("href");(n.startsWith("#")||n.startsWith("?"))&&e.setAttribute("target","_self"),n.startsWith("?")&&(n=i.getHref(n,t),n=i.getHash(n),e.setAttribute("href",n))})}}}),f("MarkDoc/Image",function(e,t,n){const i=e("$");return{format:function(e,t){t&&i(e).find("img").each(function(){let e=this.getAttribute("src");!e||e.startsWith("http://")||e.startsWith("https://")||(this.src=t+e)})}}}),f("MarkDoc/Lines",function(e,t,n){const i=e("@definejs/string");return n={getNumbers:function(e,t){let r=e.samples.numbers,o=e.samples["numbers.item"],l=t.split(/\r\n|\n|\r/),s=n.getHeight(l);l[l.length-1]||(l=l.slice(0,-1));let c=l.map(function(e,t){return i.format(o,{no:t+1})});return i.format(r,{height:s,items:c.join(""),total:c.length})},getHeight:function(e){return m.isArray(e)||(e=e.split(/\r\n|\n|\r/)),20*e.length}}}),f("MarkDoc/Meta",function(e,t,n){const i=e("$"),r=e("@definejs/string"),o=e("@definejs/template");let l={format:!0,language:!0,numbers:!0,foldable:!0},s={selector:"h1,h2,h3,h4,h5,h6",foldable:!0};return{create:function(e,t){let n=new o("#tpl-MarkDoc"),c=v.assign({},l,e.code),a=v.assign({},s,e.titles),d=e.container,u={id:r.random(),container:d,code:{format:c.format,language:c.language,numbers:c.numbers,foldable:c.foldable},this:null,emitter:null,$:i(d),tpl:n,bind:!1,outline:{visible:!0},current:{},titles:{selector:a.selector,foldable:a.foldable},samples:{source:n.sample("source"),language:n.sample("language"),pre:n.sample("pre"),numbers:n.sample("numbers"),"numbers.item":n.sample("numbers","item"),title:n.sample("title")}};return v.assign(u,t),u}}}),f("MarkDoc/Titles",function(e,t,n){const i=e("$");return{render:function(e){let t=e.samples.title,n=e.titles.selector,r="";return e.$.find(n).each(function(){let e=i(this),o=e.nextUntil(n);r=r||e.text(),e.wrapInner(t),e.toggleClass("title",o.length>0)}),r}}}),f("MarkDoc",function(e,t,n){const i=e("$"),r=e("@definejs/array"),o=e("@definejs/emitter"),l=t.require("Meta"),s=t.require("Content"),c=t.require("Events"),d=t.require("Titles"),u=t.require("Href"),f=t.require("Code"),m=t.require("Highlight"),h=t.require("Lines"),g=t.require("Image");let p=new Map;function w(e){let t=new o(this),n=l.create(e,{this:this,emitter:t});p.set(this,n),v.assign(this,{id:n.id,$:n.$,data:{}}),this.on("process",function(e){return e=(e=(e=e.split("<li>[ ] ").join('<li class="todo-list-item"> <i class="far fa-square"></i>')).split("<li>[#] ").join('<li class="todo-list-item"> <i class="fas fa-check-square"></i>')).split("<li>[x] ").join('<li class="todo-list-item"> <i class="fas fa-check-square"></i>')})}return w.prototype={constructor:w,$:null,data:{},render:function(e){let t=p.get(this),n=t.current,r=!!e.language,o=s.get(t,{language:e.language,content:e.content,process:function(e){let n=t.emitter.fire("process",[e]);return n.length>0?n[0]:e}});e.code&&v.assign(t.code,e.code),e.titles&&v.assign(t.titles,e.titles),t.$.html(o),t.$.addClass("MarkDoc"),t.$.toggleClass("SourceMode",r),t.outline.visible=!0,t.bind||c.bind(t),g.format(t.$,e.imgUrl),f.each(t.$,function(e,n){let r=e.element,o=e.language,l=t.code;l.format&&f.format(r);let s=r.innerText,c=h.getHeight(s);f.wrap(t,{element:r,height:c,language:l.language?f.language(t,o):"",numbers:l.numbers?h.getNumbers(t,s):""}),s=m.highlight(o,s),i(r).addClass("hljs").html(s)});let l=d.render(t);r||u.format(t,e.baseUrl),n.code=t.$.find("pre>code"),n.html=n.code.html(),n.ul=t.$.find("ul"),t.emitter.fire("render",[{title:l}])},show:function(){let e=p.get(this);e.$.show(...arguments),e.emitter.fire("show")},hide:function(){let e=p.get(this);e.$.hide(...arguments),e.emitter.fire("hide")},outline:function(){let e=p.get(this),t=e.$.find(">*:not("+e.titles.selector+")"),n=e.outline.visible?"hide":"show";t.animate({height:n,opacity:n},"fast"),e.outline.visible=!e.outline.visible},empty:function(e){let t=p.get(this).current,n=t.code,i=t.ul,o=t.html;if(e){let e=h.getHeight(o);return n.parent().height(e),i.find("li").show(),void n.html(o)}let l=(o=n.html()).split(/\r\n|\n|\r/);o=(l=r.map(l,function(e){return e.length>0?e:null})).join("\r\n"),n.html(o);let s=h.getHeight(o);n.parent().height(s);let c=l.length-1;i.find("li").show(),i.find("li:gt("+c+")").hide()},on:function(){p.get(this).emitter.on(...arguments)},toOutline:function(e){let t=p.get(this),n=t.$.find(t.titles.selector).get(e);if(!n)return;let r=i(n);n.scrollIntoViewIfNeeded?n.scrollIntoViewIfNeeded():n.scrollIntoView();r.addClass("on"),a(function(){r.removeClass("on"),a(function(){r.addClass("on"),a(function(){r.removeClass("on")},200)},200)},200)},getOutlines:function(){let e=p.get(this),t=e.$.find(e.titles.selector).toArray();return t=t.map(function(e){return{level:+e.nodeName.slice(1),text:e.innerText}})}},w}),f("MenuTree/Events",function(e,t,n){const i=e("$");return{bind:function(e){e.$.on("click",'[data-type="item"]',function(t){var n=this.id,r=e.eid$item[n];if(r){var o="item",l=r.list,s=e.current;if(s&&i("#"+s.eid).removeClass("on"),l&&l.length&&!1!==r.foldable)if(r!=s&&r.open)o="item";else{var c=r.open=!r.open,a=i(this.parentNode);o=c?"open":"close",a.toggleClass("down",c);var d=a.children("ul");c?d.slideDown(200):d.slideUp(200)}i(this).addClass("on"),this.scrollIntoViewIfNeeded(),e.current=r,e.emitter.fire(o,[r])}}),e.$.on("click",'[data-type="icon"]',function(t){t.stopPropagation();var n=t.target,i=n.getAttribute("data-index"),r=e.eid$item[n.parentNode.id],o=(r.icons||[])[i];o&&r&&e.emitter.fire("icon",[o,r])})}}}),f("MenuTree/Meta",function(e,t,n){const i=e("@definejs/string");return{create:function(e,t){let n={id:i.random(),container:e.container,$:null,this:null,emitter:null,tpl:null,list:null,current:null,id$item:{},eid$item:{},init:function(e){let t=e.id,r="",o=e.list=e.list||[],l=e.parent,s=l?l.level+1:0;t?r=e.eid=i.random():t=r=e.id=e.eid=i.random(),e.level=s,n.id$item[t]=e,n.eid$item[r]=e,o.map(function(t){t.parent=e})},open:function(e,t){if("string"==typeof e){let t=e;if(!(e=n.id$item[t]))throw new p("不存在 id 为 "+t+" 的节点。")}return"boolean"==typeof t&&(e.open=t),function e(t,n){let i=t.parent;i&&n&&(n(i),e(i,n))}(e,function(t){e.open&&(t.open=e.open)}),e},fill:function(e){e=e||n.list;let t=n.tpl.fill({list:e});n.$.html(t),n.list=e}};return v.assign(n,t),n}}}),f("MenuTree/Template",function(e,t,n){const i=e("@definejs/template"),r=e("@definejs/escape");function o(e,t){let n=e.list,i=m.isArray(n)&&n.length>0?"dir":"file";return this.fill(i,e)}function l(e,t){let n=e.icon;return{index:t,name:e.name||n,class:e.class||n}}return{create:function(e){let t=new i("#tpl-MenuTree");return t.process({"":function(e){return{items:e.list.map(o,t)}},dir:{"":function(n){!1===n.foldable&&(n.open=!0);let i=n.list,l=i.find(function(e){return e.list&&e.list.length>0}),s=i.map(o,t),c=this.fill("icon",n.icons||[]),a=r.html(n.name),d=e.current;return{eid:n.eid,name:a||"",items:s,open:n.open?"down":"",on:d&&n.id==d.id?"on":"",icons:c,display:n.open?"display: block;":"display: none;",hasDir:l?"has-dir":"all-files"}},icon:l},file:{"":function(t,n){let i=this.fill("icon",t.icons||[]),o=r.html(t.name),l=e.current;return{eid:t.eid,name:o,on:l&&t.id==l.id?"on":"",icons:i}},icon:l}}),t}}}),f("MenuTree.defaults",{}),f("MenuTree",function(e,t,n){const i=e("@definejs/emitter"),r=e("$"),o=e("Defaults"),l=t.require("Events"),c=t.require("Meta"),a=t.require("Template");let d=new Map;function u(e){e=o.clone(t,e);let n=new i(this),r=c.create(e,{this:this,emitter:n});d.set(this,r),v.assign(this,{id:r.id,$:r.$})}return u.prototype={constructor:u,id:"",$:null,render:function(e){let t=d.get(this);t.$=r(t.container),t.tpl=a.create(t),e&&this.fill(e),t.$.show(),t.$.addClass("MenuTree"),l.bind(t)},fill:function(e){let t=d.get(this),n=t.current;e=JSON.stringify(e),e=JSON.parse(e),t.list=e,t.id$item={},t.eid$item={},this.each(t.init),this.each(t.open),t.fill(e),n&&(t.current=this.get(n.id)),t.emitter.fire("fill",[e])},insert:function(e,t,n){let i=d.get(this);switch(typeof t){case"string":let e=t;if(!(t=i.id$item[e]))throw new p("不存在 id 为 "+e+" 的父节点。");break;case"number":n=t,t=null}t=t||null,e.parent=t,i.init(e),i.open(e),u.each(e.list,i.init),u.each(e.list,i.open);let r=t?t.list:i.list,o=r.length;n===M||n>=o?r.push(e):r.splice(n,0,e),i.fill(),i.emitter.fire("insert",[e])},add:function(e){let t=d.get(this),n=t.current||null;this.insert(e,n),t.emitter.fire("add",[e])},delete:function(e){let t=d.get(this),n=this.get(e);if(!n)return void s.error("不存在该节点:",e);let i=n.parent,r=i?i.list:t.list,o=r.findIndex(function(e){return e.id==n.id});if(o<0)throw new p("在该节点的同级节点列表中找不到自己。");r.splice(o,1),delete t.id$item[n.id],delete t.eid$item[n.eid],u.each(e.list,function(e){delete t.id$item[e.id],delete t.eid$item[e.eid]}),t.current===n&&(t.current=null),t.fill(),t.emitter.fire("delete",[n])},move:function(e,t){let n=d.get(this),i=this.get(e);if(!i)return void s.error("不存在该节点:",e);let r=i.parent,o=r?r.list:n.list,l=o.findIndex(function(e){return e.id==i.id});if(l<0)throw new p("在该节点的同级节点列表中找不到自己。");let c=l+t,a=o.length-1;c=b.max(c,0);let u=o[c=b.min(c,a)],f=o[l];o[l]=u,o[c]=f,n.fill(),n.emitter.fire("move",[i,t])},open:function(e){let t=d.get(this),n=this.get(e);if(!n)throw new p("不存在该节点");t.open(n,!0),t.fill(),n.list&&(n.open=!1),r("#"+n.eid).trigger("click")},close:function(e){d.get(this);let t=this.get(e);if(!t)throw new p("不存在该节点");t.open&&r("#"+t.eid).trigger("click")},each:function(e){let t=d.get(this);u.each(t.list,e)},get:function(e){let t=d.get(this);if(!e)return t.list;switch(typeof e){case"string":return t.id$item[e];case"object":let n=e;return"string"==typeof(e=n.id)?t.id$item[e]:t.list.includes(n)?n:null;default:return null}},update:function(e){d.get(this);let t=this.get(e);t||s.error("不存在该节点:",e),t.data=e.data,t.name=e.name,r("#"+t.eid).html(e.name)},destroy:function(){let e=d.get(this);e&&(e.emitter.destroy(),e.tpl.destroy(),e.$.off(),d.delete(this))},on:function(e,t){d.get(this).emitter.on(...arguments)}},v.assign(u,{each:function(e,t){e&&t&&e.map(function(e,n){t(e,n),u.each(e.list,t)})},tree:function(e,t){let n=t.field,i=[],r={};return e.map(function(e){let t=e[n.id],i=n.name,o="function"==typeof i?i(e):e[i];r[t]={name:o,item:e}}),e.map(function(e){let o=e[n.id],l=r[o],s=e[n.parentId];if(t.isRoot(e))return void i.push(l);let c=r[s];(c.list=c.list||[]).push(l)}),i}}),u}),f("{MenuTreeSidebar.id}/Main/Data",function(e,t,n){const i=t.data.none;function r(e){let t=`/${i}`;return e.startsWith(t)?e=e.slice(t.length):e.startsWith("/")&&(e=e.slice("/".length)),e}return{toTree:function(e){let t=function e(t,n){let i=t.dir$files;return t.dir$dirs[n].map(function(o){let l=n+"/"+o;l=l.replace(/\/+/g,"/");let s=e(t,l),c=i[l];c=c.map(function(e){let t=l+"/"+e;return{name:e,id:t,mid:r(t),data:{type:"file",name:t,parent:l}}}),(s=[...s,...c]).length||s.push({name:"(空目录)",id:l+"/",data:{type:"file",name:"",parent:l}});let a=r(l);return{name:o,id:l,mid:a,data:{type:"dir",name:l,parent:n},list:s}})}(e,"/"),n=e.dir$files["/"];return n=n.map(function(e){let t="/"+e;return{name:e,id:t,mid:r(t),data:{type:"file",name:t,parent:"/"}}}),t=[...t,...n],[{name:e.root.split("/").slice(-1)[0],id:"/",open:!0,foldable:!1,data:{type:"dir",name:"/"},list:t}]}}}),f("{MenuTreeSidebar.id}/Resizer/Masker",function(e,t,n){const i=e("@definejs/masker");let r=null;return{show(){(r=r||new i({opacity:0})).show()},hide(){r&&r.hide()}}}),f.panel("{MenuTreeSidebar.id}/Header",function(e,t,n){n.on("init",function(){let e=!1;n.$.on("click","[data-cmd]",function(){let t=this.getAttribute("data-cmd");"dir-only"==t?(e=!e,n.$.find("i").toggleClass("checked",e),n.fire("dir-only",[e])):n.fire(t)})}),n.on("render",function(e){e=e||{},n.$.toggleClass("back",!!e.back),n.$.toggleClass("forward",!!e.forward),n.$.toggleClass("up",!!e.up),n.$.toggleClass("root",!!e.root),n.$.toggleClass("dir-only",!!e.dirOnly)})}),f.panel("{MenuTreeSidebar.id}/Main",function(e,t,n){const i=e("MenuTree"),r=t.require("Data");let o=null,l={item:null,index:-1,list:[]};return n.on("init",function(){function e(e){e!==l.item&&(l.index++,l.list[l.index]=e,l.item=e,n.fire("item",[e,{back:l.index>0,forward:l.index<l.list.length-1,up:!(!e||!e.parent),root:!!e.parent,dirOnly:"dir"==e.data.type}]),n.fire(e.data.type,[e]))}(o=new i({container:n.$})).on({fill:function(e){},item:function(t){let n=t.id;"/"!=n&&n.endsWith("/")?o.open(t.parent.id):e(t)},open:function(t){e(t)},close:function(t){e(t)},icon:function(e,t){},delete:function(e){this.open(e.parent)}}),o.render()}),n.on("render",function(e){let t=r.toTree(e);s.log(t),l.item=null,l.list=[],l.index=-1,l.push=!0,o.fill(t)}),{open:function(e){o.get(e)?o.open(e):u.alert("不存在节点: "+e,function(){})},back:function(){let e=l.index-1,t=l.list[e];t&&(l.index=e-1,this.open(t))},forward:function(){let e=l.index+1,t=l.list[e];t&&this.open(t)},up:function(){let e=l.item,t=e?e.parent:null;t&&this.open(t)},root:function(){this.open("/")},dirOnly:function(e){n.$.toggleClass("dir-only",!!e)}}}),f.panel("{MenuTreeSidebar.id}/Resizer",function(e,t,n){const r=t.require("Masker");n.on("init",function(){let e=!1,t=0,o="",l=i.body,s=n.$.get(0);$(l).on({mousedown:function(i){i.target===s&&(e=!0,t=i.pageX,o=l.style.cursor,l.style.cursor="w-resize",r.show(),n.fire("start"))},mousemove:function(i){if(!e)return;let r=i.pageX-t;n.fire("change",[r])},mouseup:function(t){e&&(e=!1,l.style.cursor=o,r.hide(),n.fire("stop"))}})}),n.on("render",function(e){})}),f("MenuTreeSidebar/Events",function(e,t,n){e("$");return{bind:function(e){}}}),f("MenuTreeSidebar/Meta",function(e,t,n){const i=e("@definejs/string");let r=0;return{create(e,t){let n={id:`MenuTreeSidebar-${r++}-${i.random(4)}`,container:e.container,$:null,this:null,emitter:null,tpl:null};return v.assign(n,t),n}}}),f("MenuTreeSidebar/Template",function(e,t,n){const i=e("@definejs/template");return{create:function(e){let t=new i("#tpl-MenuTreeSidebar");return t.process({"":function(t){return{id:e.id}}}),t}}}),f.panel("{MenuTreeSidebar.id}",function(e,t,n){const i=t.require("Header"),r=t.require("Main"),o=t.require("Resizer"),l=t.data.none;return n.on("init",function(){r.on({item:function(e,t){n.fire("item",[e]),i.render(t)},dir:function(e){n.fire("dir",[e])},file:function(e){n.fire("dir",[e])}}),i.on({back:function(){r.back()},forward:function(){r.forward()},up:function(){r.up()},root:function(){r.root()},"dir-only":function(e){r.dirOnly(e)}})}),n.on("init",function(){function e(){return n.$.outerWidth()}function t(e){n.$.outerWidth(e)}let i=e();o.on({change:function(e){let r=i+e;r<220?t(220):(t(r),n.fire("resize","change",[e,r]))},stop:function(){i=e(),n.fire("resize","stop")}})}),n.on("render",function(e){i.render(),r.render(e),o.render()}),{open:function(e,t){if(t)if(e.startsWith("/")){let t=`/${l}`;e.startsWith(t)||(e=`${t}${e}`)}else e=`/${e}`;r.open(e)}}}),f("MenuTreeSidebar.defaults",{}),f("MenuTreeSidebar",function(e,t,n){const i=e("@definejs/app-module"),r=e("@definejs/emitter"),o=e("$"),l=e("Defaults"),s=t.require("Events"),c=t.require("Meta"),a=t.require("Template");let d=new Map;return class{constructor(e){e=l.clone(t,e);let n=new r(this),i=c.create(e,{this:this,emitter:n});i.tpl=a.create(i),d.set(this,i),v.assign(this,{id:i.id,$:i.$}),s.bind(i)}render(t){let n=d.get(this),r=n.tpl.fill({});n.container&&(o(n.container).html(r),n.$=n.this.$=o(`#${n.id}`)),i.fill("{MenuTreeSidebar.id}",{"MenuTreeSidebar.id":n.id}),e(`${n.id}`).render(t)}}}),f("Outline/Events",function(e,t,n){const i=e("$");return{bind:function(e){e.$.on("click","li[data-index]",function(t){let n=+this.getAttribute("data-index"),i=e.list[n];e.emitter.fire("item",[i,n])}),e.$.on("click","i[data-index]",function(t){let n=e.list,r=+this.getAttribute("data-index"),o=n[r];if(0==(o.children||[]).length)return;let l=i(this),c=l.hasClass("closed"),a=r+1,d=n.slice(a).findIndex(function(e,t){return e.level<=o.level});d=d<0?n.length:d+a,s.log(a,d),l.toggleClass("opened",c),l.toggleClass("closed",!c),l.attr({title:c?"点击收起子级":"点击展开子级"}),t.stopPropagation(),n.slice(a,d).forEach(function(t,n){n+=a;let i=e.$.find(`li[data-index="${n}"]`),r="closed-count",o=i.data(r)||0;c?--o<=0&&(o=0,i.slideDown("fast")):(o++,i.slideUp("fast")),i.data(r,o)})})}}}),f("Outline/Meta",function(e,t,n){const i=e("@definejs/string");return{create:function(e,t){let n={id:i.random(),container:e.container,this:null,emitter:null,$:null,tpl:null,list:null};return v.assign(n,t),n}}}),f("Outline/Template",function(e,t,n){const i=e("@definejs/template"),r=e("@definejs/string");return{create:function(){let e=new i("#tpl-Outline");return e.process({"":function(e){let t=e.list;return{items:this.fill("item",t)}},item:{"":function(e,t){let n=e.level,i=n-1,o=e.children||[];return i=(i=r.random(i).split("")).map(function(){return{}}),{index:t,level:n,tabs:i=this.fill("tab",i),text:e.text,opened:o.length>0?"opened":"","folder-title":o.length>0?"点击收起子级":""}},tab:function(e,t){return{}}}}),e}}}),f("Outline",function(e,t,n){const i=e("$"),r=e("@definejs/emitter"),o=t.require("Meta"),l=t.require("Events"),s=t.require("Template");let c=new Map;function a(e){let t=new r(this),n=s.create(),i=o.create(e,{this:this,emitter:t,tpl:n});c.set(this,i),v.assign(this,{id:i.id,$:i.$,data:{}})}return a.prototype={constructor:a,$:null,data:{},render:function(e){let t=c.get(this);t.$=i(t.container),(e=e||t.list)&&this.fill(e),t.$.show(),l.bind(t)},fill:function(e){e.forEach(function(t,n){t.parent=null;let i=t.level;if(1!=i)for(let r=n-1;r>=0;r--){let n=e[r];if(i>n.level)return t.parent=n,n.children=n.children||[],void n.children.push(t)}});let t=c.get(this),n=t.tpl.fill({list:e});return t.list=e,t.$&&t.$.html(n),n},show:function(){let e=c.get(this);e.$.show(...arguments),e.emitter.fire("show")},hide:function(){let e=c.get(this);e.$.hide(...arguments),e.emitter.fire("hide")},on:function(){c.get(this).emitter.on(...arguments)}},a}),f("Pager/Events",function(e,t){return{bind:function(e){let t=e.txtId,n=e.sizerId,r=e.this;function o(){let e=+i.getElementById(t).value;r.to(e)}e.$.on("click","[data-no]",function(){if($(this).hasClass("active"))return;let e=+this.getAttribute("data-no");r.to(e)}),e.$.on("click",'[data-button="to"]',function(){o()}),e.$.on("click",'[data-button="previous"]',function(){r.previous()}),e.$.on("click",'[data-button="next"]',function(){r.next()}),e.$.on("change","#"+n,function(){let t=this.selectedIndex,n=e.sizes[t];r.render({size:n,no:1}),r.to(1)}),e.$.on("keydown","#"+t,function(e){let t=e.keyCode;s.log(t),13!=t?48<=t&&t<=57||96<=t&&t<=105||(8==t||37==t||39==t||46==t)||112<=t&&t<=123||e.preventDefault():o()})}}}),f("Pager/JumpNo",function(e,t){return{get:function(e,t,n){return e<=1?e:t==e?e-1:(t>n?i=t+1:(i=t-1)<1&&(i=2),i);var i}}}),f("Pager/Regions",function(e,t){return{get:function(e,t){return e<=10?[{from:1,to:e,more:!1}]:t<=3?[{from:1,to:5,more:!0}]:t<=5?[{from:1,to:t+2,more:!0}]:t>=e-1?[{from:1,to:2,more:!0},{from:e-5,to:e,more:!1}]:[{from:1,to:2,more:!0},{from:t-2,to:t+2,more:t+2!=e}]}}}),f("Pager/Sizes",function(e,t){return{get:function(e,t){return e=[t=t||e[0],...e],(e=[...new Set(e)]).sort(function(e,t){return e>t?1:-1}),e}}}),f("Pager/Template",function(e,t){const n=e("@definejs/template"),i=e("@definejs/array");let r=new n("#tpl-Pager");return r.process({"":function(e){let t=e.no,n=e.count;return{regions:this.fill("region",e.regions,t),sizes:this.fill("size",e.sizes,e.size),count:e.count,total:e.total,ulId:e.ulId,txtId:e.txtId,sizerId:e.sizerId,toNo:e.toNo,"first-disabled-class":t==b.min(1,n)?"disabled":"","final-disabled-class":t==n?"disabled":"","jump-disabled-class":0==n?"disabled":""}},region:{"":function(e,t,n){let r=e.from,o=e.to,l=i.pad(r,o+1);l=this.fill("item",l,n);let s=e.more||"";return s&&(s=this.fill("more",{})),l+s},item:function(e,t,n){return{no:e,active:e==n?"active":""}},more:function(e){return e}},size:function(e,t,n){return this.fix("selected"),{value:e,selected:e==n?'selected="selected"':""}}}),r}),f("Pager.defaults",{container:"",total:0,current:1,size:20,min:0,sizes:[10,20,30,40,50]}),f("Pager",function(e,t){const n=e("$"),i=e("@definejs/emitter"),r=e("@definejs/string"),o=e("Defaults"),l=t.require("Events"),s=t.require("JumpNo"),c=t.require("Regions"),a=t.require("Sizes");let d=new Map;function u(e){e=o.clone(t,e);let n=r.random(),l=new i(this),s=e.size,c=a.get(e.sizes,s),u={id:n,txtId:r.random(),ulId:r.random(),sizerId:r.random(),$:null,ctn:e.container,no:e.no||1,size:s,total:e.total||0,min:e.min||0,count:0,last:0,sizes:c,emitter:l,this:this};d.set(this,u),v.assign(this,{id:n,meta:u,$:u.$})}return u.prototype={constructor:u,id:"",$:null,render:function(e){e=e||{};let i=d.get(this),r="number"==typeof e.total?e.total:i.total,o="number"==typeof e.size?e.size:i.size,a="number"==typeof e.min?e.min:i.min,u="number"==typeof e.no?e.no:i.no,f=b.ceil(r/o),m=!!i.$;if(0==f)return void(i.$&&i.$.hide());if(u<1||u>f)return i.emitter.fire("error",["输入的页码值只能从 1 到 "+f]),!1;if(i.$=this.$=n(i.ctn),i.count=f,i.no=u,i.total=r,i.size=o,i.min=a,m||l.bind(i),f<a)return void i.$.hide();let h=t.require("Template"),g=c.get(f,u),p=s.get(f,u,i.last),w=h.fill({regions:g,no:u,count:f,total:r,toNo:p,txtId:i.txtId,sizerId:i.sizerId,sizes:i.sizes,size:i.size});i.$.html(w).show()},to:function(e){let t=d.get(this),n=t.emitter,i=/^\d+$/.test(e);i?(e=parseInt(e),!1!==(i=this.render({no:e}))&&(t.last=t.no,t.no=e,n.fire("change",[e,t.size]))):n.fire("error",["输入的页码必须是数字"])},previous:function(){let e=d.get(this).no-1;e<1||this.to(e)},next:function(){let e=d.get(this),t=e.no+1;t>e.count||this.to(t)},first:function(){this.to(1)},final:function(){let e=d.get(this).count;this.to(e)},refresh:function(){let e=d.get(this).no;this.to(e)},on:function(){let e=d.get(this).emitter,t=m.from(arguments);e.on(t)},destroy:function(){let e=d.get(this);e.emitter.off(),e.$&&e.$.html("").undelegate(),d.delete(this)}},u}),f("Table/Meta/Column",function(e,t,n){const i=e("@definejs/string");return{create:function(e){let t=i.random(),n={name:e.name,caption:e.caption,index:e.index,field:e.field,table:e.table,id:t,cells:[],data:{},deps:[],infers:[],type:"Table.Column",change:null,sum:function(t){let i=0;return n.cells.map(function(n,r){let o=t?t.call(e.table,n,r):n.value;null!==o&&(i+=o=o||0)}),i}};return n}}}),f("Table/Meta",function(e,t,n){const i=e("@definejs/string"),r=t.require("Column");return{create:function(e,t){let n=e.count||e.details.length,o={},l={},s=e.fields.map(function(n,i){let s=n[e.columnName],c=n[e.captionName],a=r.create({name:s,caption:c,index:i,field:n,table:t.this});return o[s]=a,l[a.id]=a,a}),c={id:i.random(),fields:e.fields,columnName:e.columnName,captionName:e.captionName,details:e.details,ctn:e.container,width:e.width,class:e.class,order:e.order,attributes:e.attributes,count:n,columns:s,id$column:l,name$column:o,rows:[],id$row:{},id$cell:{},emitter:null,tpl:null,element:null,$:null,$tbody:null,$ctn:null,this:null};return v.assign(c,t),c}}}),f("Table/Order",function(e,t,n){let i={sample:"{order}",add:!0,index:0};return{normalize:function(e){let t=e.order;if(!t)return e;!0===t&&(t={}),t=v.assign({},i,t);let n=e.fields.slice(0),r={[e.columnName]:"order",caption:"序号"},o=t.index;return t.add?n.splice(o,0,r):n[o]=r,e=v.assign({},e,{order:t,fields:n})}}}),f("Table/Reaction",function(e,t,n){const i=e("@definejs/object");function r(e,t,n,i){let r=e[t];r?(i&&(r.change=i),n&&(r.deps.splice(0),r.deps.push(...n),n.map(function(n){let i=e[n];if(!i)return void s.warn("不存在名为 "+t+" 的列。");let r=i.infers;(r=new Set(r)).add(t),i.infers.splice(0),i.infers.push(...r)}))):s.warn("不存在名为 "+t+" 的列。")}return{set:function(e,t,n){let o=this;if(i.isPlain(e))i.each(e,function(e,t){m.isArray(t)?r(o,e,t,null):"function"!=typeof t?r(o,e,t.deps,t.change):r(o,e,null,t)});else if(i.isPlain(t)){let n=t;r(o,e,n.deps,n.change)}else"function"==typeof t&&(n=t,t=null),r(o,e,t,n)}}}),f("Table/Row",function(e,t,n){const r=e("@definejs/string");return n={create:function(e,t){let n=e.rows,i=r.random(),o=n.length,l=v.assign({},t),c={},a=e.id$row[i]={id:i,index:o,type:"Table.Row",cells:null,table:e.this,element:null,data:l,name$cell:c,value:null,title:"",class:"",attributes:{index:o}};return a.valueOf=function(e){return c[e].value},a.cells=e.fields.map(function(t,n){let i=r.random(),o=e.columns[n],l=e.order.index==n,d=t[e.columnName],u=t[e.captionName],f=e.id$cell[i]={id:i,name:d,caption:u,type:"Table.Cell",row:a,field:t,index:n,isOrder:l,column:o,table:e.this,ctrl:null,element:null,value:null,data:{},deps:o.deps,infers:o.infers,title:"",html:"",class:t.class||"",attributes:{index:n,name:d}};return f.change=function(t,n){(n=n||[]).push(f),f.value=t,s.log(n),f.infers.map(function(t){let i=e.name$column[t],r=c[t],o=i.change;if(n.includes(r)||!o)return;let l=o.apply(r,[f,n]);l!==M&&(r.value=l)}),e.emitter.fire("change",f.name,[f]),e.emitter.fire("change",[f])},o.cells.push(f),c[d]=f,f}),n.push(a),a},add:function(e,t){let r=e.rows.length,o=n.create(e,t),l=e.tpl.fill("tr",o,r);return e.$tbody.append(l),o.element=i.getElementById(o.id),o.cells.map(function(e){e.element=i.getElementById(e.id)}),o},remove:function(e,t){let n=e.rows,i=n[t];n.splice(t,1),delete e.id$row[i.id],i.cells.map(function(t){let n=t.ctrl;n&&n.destroy(),delete e.id$cell[t.id],t.ctrl=null,t.element=null}),e.columns.map(function(e,n){e.cells.splice(t,1)});let r=i.element;return r&&r.parentNode.removeChild(r),i.element=null,n.slice(t).map(function(n,i){if(i=n.index=i+t,"index"in n.attributes&&(n.element.setAttribute("data-index",i),n.attributes.index=i),e.order){let t=e.tpl;n.cells.map(function(e){if(!e.isOrder)return;let n=t.fill("tr","td",e,0,i);e.element.innerHTML=n})}}),i},move:function(e,t,n){let i=e.rows,r=t+n;if(0==n||r<0||r>i.length-1)return;let o=i[t],l=i[r],s=o.element.parentNode;i.splice(t,1),i.splice(r,0,o),n>0?s.insertBefore(l.element,o.element):s.insertBefore(o.element,l.element),i.map(function(t,n){t.index!=n&&(t.index=n,"index"in t.attributes&&(t.element.setAttribute("data-index",n),t.attributes.index=n),e.order&&t.cells.map(function(t){if(!t.isOrder)return;let i=e.tpl.fill("tr","td",t,0,n);t.element.innerHTML=i}))}),e.emitter.fire("move",[o,n])}}}),f("Table/Static",function(e,t,n){const i=e("@definejs/object");return n={eachCell:function(e,t){m.isArray(e)||(e=[e]);let n=[];e.map(function(e){switch(e.type){case"Table.Cell":n.push(e);break;case"Table.Column":case"Table.Row":n=n.concat(e.cells);break;default:throw new p("无法识别的 type 值: "+type)}}),n.map(t)},column:function(e,t,i){let r=[];if(m.isArray(e)){e.map(function(e){if(!n.isRow(e))return;let i=e.name$cell[t];i&&r.push(i)})}else if(n.isRow(e)){let n=e.name$cell[t];n&&r.push(n)}else{let n=e.get("name$column")[t];n&&(r=n.cells||[])}r.map(function(e,t){i(e,t)})},isCell:function(e){return i.isPlain(e)&&"Table.Cell"==e.type},isRow:function(e){return i.isPlain(e)&&"Table.Row"==e.type},isColumn:function(e){return i.isPlain(e)&&"Table.Column"==e.type}}}),f("Table/Template",function(e,t){const n=e("@definejs/template"),i=e("@definejs/string");function r(e){return e?(e=v.entries(e).map(function(e){return"data-"+e[0]+'="'+e[1]+'"'})).join(" "):""}function o(e){let t=e.title;return t===M||""===t?"":'title="'+t+'"'}function l(e){let t=e.class;return m.isArray(t)&&(t=t.join(" ")),t?'class="'+t+'"':""}return{create:function(e){let t=new n("#tpl-Table"),s=e.emitter;return t.process({"":function(){this.fix("attributes");let t=e.width||"";t&&(t="width: "+t+"px;");let n=this.fill("tr",e.rows),i=r(e.attributes),o=e.class||"";return{id:e.id,class:o+" Table",width:t,rows:n,attributes:i}},tr:{"":function(e,t){this.fix(["class","attributes","title"]),s.fire("process","row",[e,t]);let n=r(e.attributes),i=this.fill("td",e.cells,t),c=o(e),a=l(e);return{id:e.id,class:a,attributes:n,title:c,cells:i}},td:{"":function(t,n,c){this.fix(["class","attributes","title"]);let a="";if(t.isOrder)a=i.format(e.order.sample,{index:n,no:c,order:c+1});else{let e=s.fire("process","cell",t.name,[t,n]);(a=e.slice(-1)[0])===M&&(a=(e=s.fire("process","cell",[t,n])).slice(-1)[0]);let i=typeof a;"number"!=i&&"boolean"!=i||(a=x(a))}let d=!1===t.field.visible?"display: none;":"",u=r(t.attributes),f=o(t),m=l(t);return{id:t.id,cid:t.column.id,html:a||"",class:m,attributes:u,display:d,title:f}}}}}),t}}}),f("Table.defaults",{$:null,fields:[],width:0,widths:[],class:"",process:{},order:!1,details:[],columnName:"fieldName",captionName:"caption"}),f("Table",function(e,t,n){const r=e("$"),o=e("@definejs/emitter"),l=e("@definejs/object"),c=e("Defaults"),a=t.require("Reaction"),d=t.require("Static"),u=t.require("Template"),f=t.require("Row"),h=t.require("Order"),g=t.require("Meta");let w=new Map;function b(e){e=c.clone(t,e),e=h.normalize(e);let n=new o(this),i=g.create(e,{emitter:n,this:this});i.tpl=u.create(i),w.set(this,i),v.assign(this,{id:i.id,meta:i});for(let e=0;e<i.count;e++)this.new(i.details[e]);let r=e.reaction;r&&this.reaction(r),this.on("process","cell",function(e){return(e.row.data||{})[e.name]})}return b.prototype={constructor:b,id:"",$:null,render:function(){let e=w.get(this),t=e.rows,n=e.tpl.fill({});if(e.$ctn=r(e.ctn),!e.$ctn.length)throw new p("不存在容器节点: "+e.ctn);return e.$ctn.html(n),e.rows.map(function(e){e.element=i.getElementById(e.id),e.cells.map(function(e){e.element=i.getElementById(e.id)})}),e.element=i.getElementById(e.id),e.$=this.$=r(e.element),e.$tbody=e.$.find(">tbody"),e.fields.forEach(function(t,n){let i=t.delegate;i&&(m.isArray(i)?i:[i]).forEach(function(n){let i='>tr>td[data-name="'+t[e.columnName]+'"] '+n;e.$tbody.on("click",i,function(t){let i=r(this).parents().toArray(),o=i.length;for(let r=0;r<o;r++){let o=i[r].id,l=e.id$cell[o];if(l){e.emitter.fire("click","cell",l.name,n,[l,t,this]);break}}})})}),e.$tbody.on("click",">tr>td",function(t){let n=e.id$cell[this.id];e.emitter.fire("click","cell",n.name,[n,t]),e.emitter.fire("click","cell",[n,t])}),e.$tbody.on("click",">tr",function(t){let n=e.id$row[this.id];e.emitter.fire("click","row",[n,t])}),e.$tbody.on("click",function(t){e.emitter.fire("click",[t])}),e.emitter.fire("render",[t]),n},new:function(e){let t=w.get(this),n=f.create(t,e);return t.emitter.fire("new",[n,e]),n},add:function(e){let t=w.get(this);if(m.isArray(e)){let n=e.map(function(e){return f.add(t,e)});return t.emitter.fire("add",[n]),n}let n=f.add(t,e);return t.emitter.fire("add",[n]),n},remove:function(e){let t=w.get(this);"number"!=typeof e&&(e=t.rows.length-1);let n=f.remove(t,e);t.emitter.fire("remove",[n,e])},move:function(e,t){let n=w.get(this),i=typeof e,r="number"==i?n.rows[e]:"string"==i?n.id$row[e]:"object"==i?n.id$row[e.id]:null;if(!r)throw new p("传入的参数 item 不属性当前 table 的表格行。");f.move(n,r.index,t)},fill:function(e){this.clear();let t=w.get(this),n=e.map(function(e){return this.new(e)},this),r=t.tpl.fill("tr",n);t.$tbody.html(r),n.map(function(e){e.element=i.getElementById(e.id),e.cells.map(function(e){e.element=i.getElementById(e.id)})}),t.emitter.fire("fill",[e])},clear:function(){let e=w.get(this);e.rows.map(function(e){e.cells.map(function(e){let t=e.ctrl;t&&t.destroy&&t.destroy()})}),e.columns.map(function(e){e.cells.splice(0)}),e.id$row={},e.id$cell={},e.rows.splice(0),e.$tbody.html(""),e.emitter.fire("clear")},get:function(e){let t=w.get(this),n=t.rows;if(0==arguments.length)return n;if("number"==typeof e)return n[e];switch(e){case"id$row":case"id$cell":case"id$column":case"name$column":case"rows":case"columns":case"element":case"details":return t[e];case"length":return n.length}return"string"==typeof e?t.id$cell[e]||t.id$row[e]||t.id$column[e]:void 0},set:function(e,t){let n=w.get(this);switch(e){case"width":n[e]=t}},column:function(e,t){let n=w.get(this).name$column[e];if(n)return n.cells.map(function(e,n){t&&t(e,n)}),n;s.warn("不存在名为 "+e+" 的列。")},reaction:function(e,t,n){let i=w.get(this);a.set.call(i.name$column,...arguments)},destroy:function(){let e=w.get(this);if(!e)return;let t=e.element;e.tpl.destroy(),e.emitter.destroy(),t.parentNode.removeChild(t),e.$tbody.off(),e.$.off(),l.each(e.id$cell,function(e,t){let n=t.ctrl;n&&n.destroy&&n.destroy()}),w.delete(this)},on:function(){w.get(this).emitter.on(...arguments)}},v.assign(b,d),b}),f("TableResizer/Mouse/Masker",function(e){const t=e("@definejs/masker");let n=null;return{show(){(n=n||new t({opacity:0})).show()},hide(){n&&n.hide()}}}),f("TableResizer/Cols",function(e,t){let n=new(e("@definejs/template"))("#tpl-TableResizer");return n.process({colgroup:{"":function(e){return{cols:this.fill("col",e.fields)}},col:function(e,t){return{index:t,width:e.width,display:e.visible?"":"display: none;"}}}}),{fill:function(e,t){let i=n.fill("colgroup",{fields:t});return e.prepend(i),e.find("colgroup>col").toArray()}}}),f("TableResizer/Fields",function(e,t){return{normalize:function(e){return e=e.map(function(e,t){let n=!("visible"in(e=v.assign({},e)))||e.visible;n&&e.width;return e.visible=!!n,e.dragable=!1!==e.dragable,e.width=e.width||0,e})},sum:function(e){let t=0;return e=e.map(function(e,n){e.visible&&(t+=e.width)}),t}}}),f("TableResizer/Meta",function(e,t,n){const i=e("@definejs/string");return{create:function(e,t){let n={id:i.random(),emitter:null,table:null,$:null,this:null,selector:e.table,dragable:e.dragable,rowspan:e.rowspan,minWidth:e.minWidth,indexKey:e.indexKey,cssClass:e.cssClass,fields:null,width:0,cols:[],id$index:{},cell$ids:new Map};return v.assign(n,t),n}}}),f("TableResizer/Mouse",function(e,t,n){const r=e("$"),o=t.require("Masker");let l={},s=!1,c=0,a=0,d=0,u="",f="",m=null,h=i.body;return r(h).on({mousedown:function(e){f=e.target.id;let t=l[f];if(!t)return;let n=t.id$index[f],i=t.fields[n],a=n==t.fields.length-1;s=!0,d=e.pageX,u=h.style.cursor,h.style.cursor="ew-resize",c=i.width,(m=r("#"+f+">b")).addClass("on"),m.toggleClass("last",a),m.html(c+"px"),o.show()},mousemove:function(e){if(!s)return;let t=l[f],n=e.pageX-d,i=c+n;if(i<t.minWidth)return;let r=t.fields,o=t.id$index[f],u=t.cols[o],h=a=t.width+n;u.width=r[o].width=i,t.$.width(h),m.html(i+"px"),t.emitter.fire("change",[{index:o,dx:n,tdWidth:i,width:h,fields:r}])},mouseup:function(){let e=l[f];e&&(e.width=a,f="",s=!1,h.style.cursor=u,o.hide(),m&&m.removeClass("on"))}}),{set:function(e,t){l[e]=t},remove:function(e){delete l[e]}}}),f("TableResizer/Rows",function(e,t){const n=e("@definejs/array");return{get:function(e,t){let i=m.from(e.rows).slice(0,t),r=n.pad(0,t).map(function(){return[]});return i.map(function(e,t){let i=0,o=r[t],l=o.length;l>0&&(i=o.findIndex(function(e){return!e}))<0&&(i=l),m.from(e.cells).map(function(e,l){let s=e.getAttribute("rowspan"),c=e.getAttribute("colspan");s=y(s)||1,c=y(c)||1,n.pad(0,s).map(function(o){let l=r[o+t];n.pad(0,c).map(function(t){l[i+t]=e})}),o[i+=c]&&(i=o.findIndex(function(e){return!e}))<0&&(i=o.length)})}),r}}}),f("TableResizer.defaults",{dragable:!0,rowspan:1,minWidth:20,indexKey:"data-target-index",cssClass:"TableResizer",fields:[]}),f("TableResizer",function(e,t){const n=e("$"),r=e("Defaults"),o=e("@definejs/string"),l=e("@definejs/emitter"),s=e("@definejs/template"),c=t.require("Cols"),a=t.require("Mouse"),d=t.require("Rows"),u=t.require("Fields"),f=t.require("Meta");let m=new Map,h=new s("#tpl-TableResizer");function g(e){e=r.clone(t,e);let n=new l(this),i=u.normalize(e.fields),o=e.width||u.sum(i),s=f.create(e,{emitter:n,this:this,fields:i,width:o});m.set(this,s),v.assign(this,{id:s.id,meta:s})}return g.prototype={constructor:g,id:"",$:null,render:function(){this.destroy(!0);let e=m.get(this);e.$=this.$=n(e.selector),e.$.addClass(e.cssClass);let t=e.table=e.$.get(0),i=d.get(t,e.rowspan);e.dragable&&i.map(function(t){t.map(function(t,i){let r=o.random(),l=t.getAttribute(e.indexKey);if(null!==l){let n=e.cell$ids.get(t)||[],i=n.length;if(n.push(r),e.cell$ids.set(t,n),i!=l)return}let s=e.fields[i],c=h.fill("resizer",{id:r,display:!1===s.dragable?"display: none;":""});n(t).append(c),e.id$index[r]=i,a.set(r,e)})}),e.cols=c.fill(e.$,e.fields),t.style.width=e.width+"px",e.emitter.fire("render",[e.width,e.fields])},set:function(e){let t=e.index,n=e.width,i=e.tdWidth,r=m.get(this);r.fields[t].width=i,r.cols[t].width=i,r.width=n,r.table.style.width=n+"px"},on:function(){m.get(this).emitter.on(...arguments)},destroy:function(e){let t=m.get(this);if(v.keys(t.id$index).map(function(e){a.remove(e);let t=i.getElementById(e);t&&t.parentNode.removeChild(t)}),!e){let e=t.$.find(">colgroup").get(0);e&&e.parentNode.removeChild(e),t.emitter.destroy(),t.$.removeClass(t.cssClass),m.delete(this)}}},g}),f("TextTree/Events",function(e,t,n){const r=e("$");let o={};return{bind:function(e){let t=`#${e.id} [data-cmd]`;r(i.body).on("click",t,function(t){let{cmd:n,index:i}=t.currentTarget.dataset;if("icon-dir"==n)return;i=y(i);let r=e.items[i];e.emitter.fire("cmd",n,[r]),e.emitter.fire("cmd",[n,r])}),r(i.body).on("click",t,function(t){let{cmd:n,index:i}=t.currentTarget.dataset;if("icon-dir"!=n)return;let l=r(this),c=e.items[i],{id:a}=c,d=l.hasClass("closed"),u=`#${e.id} li[data-id^="${a}${e.seperator}"]`;l.toggleClass("closed",!d),o[a]=!d,s.log(o),r(u).each(function(){let t=r(this);if(!d)return void t.slideUp("fast");let{id:n}=this.dataset;(function(e,t){let n,i;do{n=t[e],i=o[n],e=n}while("string"==typeof n&&!i);return i})(n,e.id$parent)?t.slideUp("fast"):t.slideDown("fast")})})}}}),f("TextTree/Meta",function(e,t,n){const i=e("@definejs/string"),r=e("@definejs/tree");let o=0;return{create:function(e,t){let n={id:`TextTree-${o++}-${i.random(4)}`,seperator:e.seperator,secondaryKey:e.secondaryKey,container:e.container,emptyText:e.emptyText,showSecondary:e.showSecondary,showIcon:e.showIcon,showTab:e.showTab,showColor:e.showColor,showHover:e.showHover,highlightIndex:-1,items:[],id$item:{},id$index:{},id$children:{},id$childs:{},id$parent:{},id$parents:{},id$siblings:{},tree:null,$:null,this:null,emitter:null,tpl:null,makeData:function(e,t){let i=function(e,t){let n={},i={},r={},o={},l={},c={},a={},d=e.map((e,l)=>{let{id:s}=e,c=s.split(t),a=(c.slice(-1)[0],null),d=[];if(n[s]=e,c.length>1){let e=a=c.slice(0,-1).join(t),n=o[e]||[];n.push(s),o[e]=n,d=(d=(d=c.map((e,t)=>c.slice(0,t+1).join("/"))).reverse()).slice(1)}return i[s]=a,r[s]=d,s});d.forEach((e,n)=>{let r=d.filter(n=>n.startsWith(`${e}${t}`));l[e]=r,a[e]=n;let s=i[e];if("string"==typeof s){let t=(o[s]||[]).filter(t=>t!=e);c[e]=[...new Set(t)]}});let u={ids:d,id$item:n,id$children:l,id$childs:o,id$parent:i,id$parents:r,id$siblings:c,id$index:a};return s.log(u),u}(e=e||[],t=t||n.seperator);return v.assign(n,{id$item:i.id$item,id$index:i.id$index,id$children:i.id$children,id$childs:i.id$childs,id$parent:i.id$parent,id$parents:i.id$parents,id$siblings:i.id$siblings}),i},toggleHideClass:function(e,t){n.$&&("boolean"==typeof t?n.$.toggleClass(e,!t):n.$.toggleClass(e))}},{ids:l}=n.makeData(e.list);return n.tree=new r(l,n.seperator),v.assign(n,t),n}}}),f("TextTree/Template",function(e,t,n){const i=e("@definejs/template");return{create:function(e){let t=new i("#tpl-TextTree");function n(e,n){let i=t.fill(e,n);return i=(i=i.trim()).split("\n").join("")}return t.process({"":function(t){let n=this.fill("item",t.list);return{id:t.id,items:n,"hide-tab":e.showTab?"":"hide-tab","hide-icon":e.showIcon?"":"hide-icon","hide-secondary":e.showSecondary?"":"hide-secondary","hide-color":e.showColor?"":"hide-color","hide-hover":e.showHover?"":"hide-hover"}},item:function(t,i){let{tabs:r,key:o,linker:l,id:s}=t,c=e.id$children[s].length>0;return o=o||e.emptyText,r=n("tabs",t),o=n("key",{key:o,index:i,id:s,isDir:c}),{id:s,tabs:r,linker:l=n("linker",t),key:o,index:i,type:c?"dir":"file"}},tabs:function(e){let{tabs:t}=e,i=0;return{tabs:t=t.split("").map(function(e,t){e=e.trim(),i++,e.length>0&&(i=0);let r="";return(!e&&0==t||4==i)&&(r="grouper",i=0),n("b",{class:r,text:e})})}},key:{"":function(e){let t=this.fill("secondary",e),n=this.fill("icon",e);return{...e,icon:n,secondary:t}},icon:function({isDir:e}){return{type:e?"dir":"file",icon:e?"fas fa-angle-down":"far fa-circle"}},secondary:function(t){let{secondaryKey:n}=e;if(!n)return"";let i=t.index;return{secondary:e.id$item[t.id][n],secondaryKey:n,index:i}}}}),t}}}),f("TextTree.defaults",{seperator:"/",emptyText:"(app)",secondaryKey:"",showSecondary:!1,showIcon:!1,showTab:!1,showColor:!1,showHover:!1}),f("TextTree",function(e,t,n){const i=e("@definejs/emitter"),r=e("@definejs/object"),o=e("$"),l=e("Defaults"),c=t.require("Events"),a=t.require("Meta"),d=t.require("Template");let u=new Map;return class{constructor(e){e=l.clone(t,e);let n=new i(this),r=a.create(e,{this:this,emitter:n});r.tpl=d.create(r),u.set(this,r),v.assign(this,{id:r.id,$:r.$}),c.bind(r)}render(e){let t=u.get(this);if(e){let{ids:n}=t.makeData(e);t.tree.clear(),n.forEach(e=>{let n=e.split(t.seperator);t.tree.set(n)})}let n=t.tree.render(function(e,n){let{key:i,nodes:r,keys:o,value:l}=e,{tabs:s,linker:c,content:a}=n;return{id:o.join(t.seperator),tabs:s,key:i,linker:c}});t.items=n;let i=t.tpl.fill({id:t.id,list:n});return t.container&&(o(t.container).html(i),t.$=t.this.$=o(`#${t.id}`)),i}toString(e){let t=u.get(this);return e===M&&t.$&&(e=!t.$.hasClass("hide-secondary")),t.tree.render(function(n,i){let{key:r,nodes:o,keys:l,value:s}=n,{tabs:c,linker:a,content:d}=i,u="";if(e){let e=l.join(t.seperator);u=t.id$item[e][t.secondaryKey]}let f=`${c}${a} ${r||t.emptyText}`;return u&&(f=f+" "+u),f}).join("\n")}on(...e){u.get(this).emitter.on(...e)}toggle(e){let t=u.get(this);r.isPlain(e)?r.each(e,function(e,n){t.toggleHideClass(`hide-${e}`,n)}):t.$.toggle(e)}highlight(e){let t=u.get(this),n=t.id$index[e];n<0?s.warn(`不存在 id 为 ${e} 的项。`):(t.highlightIndex&&t.$.find(`[data-cmd="id"][data-index="${t.highlightIndex}"]`).removeClass("on"),t.$.find(`[data-cmd="id"][data-index="${n}"]`).addClass("on"),t.highlightIndex=n)}}}),f("$",function(e,t,i){return n.definejs.require("jquery")}),f("API",function(e,t,n){const i=e("@definejs/api");return function(e,t){var n=new i(e,t),r=(n.get.bind(n),n.post.bind(n));return n.post=function(e,t){return r({data:e},t)},n}}),f("Clipboard",function(e,t,n){let r=new(e("@definejs/toast"))({duration:1200});return{copy(e){let t=i.createElement("textarea");t.setAttribute("readonly","readonly"),t.style.height=0,i.body.appendChild(t),t.value=e,t.select(),i.execCommand("copy")&&r.show("已复制"),i.body.removeChild(t)}}}),f("Defaults",function(e,t,n){const i=e("@definejs/object");return n={get:function(t){if("string"==typeof t)return e(n=t+".defaults");var n=t.name+".defaults",i=t.parent;return i?i.require(n):e(n)},clone:function(e,t,r,o){var l=n.get(e),s=m.from(arguments).slice(1);return s=[{},l].concat(s),l=i.deepAssign.apply(null,s)}}}),f("File",function(e,t,n){return{getSizeDesc:function(e){return e?e<1024?{value:e,desc:"B"}:(e/=1024)<1024?{value:e=b.ceil(e),desc:"KB"}:(e/=1024)<1024?((e=e.toFixed(2)).endsWith("0")&&(e=e.slice(0,-1)),e.endsWith("0")&&(e=e.slice(0,-2)),{value:e,desc:"MB"}):((e=(e/=1024).toFixed(2)).endsWith("0")&&(e=e.slice(0,-1)),e.endsWith("0")&&(e=e.slice(0,-2)),{value:e,desc:"GB"}):{value:0,desc:""}}}}),f("List",function(e,t,n){const i=e("@definejs/emitter");let r=new Map;function o(e){let t={emitter:new i(this),list:(e=e||[]).slice(0),reserves:e.slice(0)};r.set(this,t)}return o.prototype={constructor:o,add:function(e){let t=this.index(e);if(t>=0)return t;let n=r.get(this),i=n.list,o=n.emitter;return i.push(e),t=i.length-1,o.fire("change",[i.slice(0)]),o.fire("add",[e,t]),t},insert:function(e,t){let n=r.get(this),i=n.list,o=n.emitter;return e+=1,i.splice(e,0,t),o.fire("change",[i.slice(0)]),o.fire("insert",[t,e]),e},remove:function(e){"object"==typeof e&&(e=this.index(e));let t=r.get(this),n=t.emitter,i=t.list,o=i[e];if(o)return i.splice(e,1),n.fire("change",[i.slice(0)]),n.fire("remove",[o,e]),o},clear:function(e){let t=r.get(this),n=(t.list,t.emitter),i=t.reserves;t.list=e?[]:i.slice(0),n.fire("change",[t.list.slice(0)]),n.fire("clear")},get:function(e){let t=r.get(this).list;return 0==arguments.length?t.slice(0):t[e]},index:function(e){let t=r.get(this).list,n=e.id;return t.findIndex(function(e,t){return e.id==n})},on:function(e,t){r.get(this).emitter.on(...arguments)}},o}),f.panel("/Loading",function(e,t,n){return{hide:function(){n.hide()}}}),f.panel("/Master/PageList/List",function(e,t,n){const i=e("@definejs/tabs");let r=[],o=null;return n.on("init",function(){o=new i({container:n.$,selector:">li",activedClass:"on"}),n.$.on("click","[data-cmd]",function(e){e.stopPropagation();let t=+this.getAttribute("data-index"),i=this.getAttribute("data-cmd"),l=r[t];o.active(t),n.fire(i,[l,t])})}),n.on("render",function(e){r=e,n.fill(r,function(e,t){return{index:t,name:e.name}})}),{active:function(e){o.active(e)}}}),f("/Master/PageList/Mask",function(e,t,n){const i=e("@definejs/panel"),r=e("@definejs/masker");let o=null,l=!1,s=new i;return s.on("init",function(){(o=new r({volatile:!0,opacity:0})).on({hide:function(){l=!1,s.fire("hide")},show:function(){l=!0,s.fire("show")}})}),s.on("render",function(){}),s.wrap({toggle:function(){l?o.hide():o.show()}})}),f.panel("/Master/PageList",function(e,t,n){const i=t.require("List"),r=t.require("Mask");return n.on("init",function(){let e=n.$.find(">div");n.$.on("click",">i",function(){r.toggle()}),n.$.on("click",'[data-cmd="clear"]',function(){n.fire("clear")}),n.$.on("click",'[data-cmd="refresh"]',function(){n.fire("refresh")}),r.on({hide:function(){e.slideUp("fast"),n.$.removeClass("show")},show:function(){e.slideDown("fast"),n.$.addClass("show")}}),n.propagate(i,["active","close"])}),n.on("render",function(e){i.render(e),r.render(),n.fire("render",[e])}),{active:i.active}}),f("/Master/PageTabs/List",function(e,t,n){return new(e("List"))([{view:"Home",id:"Home",name:"首页",isHome:!0}])}),f.panel("/Master/PageTabs/Tabs",function(e,t,n){const i=e("$"),r=e("@definejs/tabs");let o=null,l=[];n.on("init",function(){(o=new r({container:n.$.get(0),selector:">li",eventName:"click",indexKey:"data-index",activedClass:"on"})).on("change",function(e,t){n.fire("active",[e,t])})}),n.on("init",function(){n.$.on("click",'[data-cmd="close"]',function(e){e.stopPropagation();let t=+this.parentNode.getAttribute("data-index"),i=l[t];if(i&&!i.isHome)return!n.fire("close",[i,t]).includes(!1)&&void c.close(t)})}),n.on("render",function(e){l=e,o.render(l,{"":function(e,t){let n=e.isHome?"home":"item";return{item:this.fill(n,e,t)}},home:function(e,t){return{index:t}},item:function(e,t){return{index:t,name:e.name,"actived-class":e.actived?"hover":"",title:e.name,icon:e.icon}}}),n.fire("render",[l])});let s=null,c={active:function(e,t){o.active(e,!t);let i=n.$.find(">li").get(e);(i.scrollIntoViewIfNeeded||i.scrollIntoView).call(i)},index:function(){return o.getActivedIndex()},close:function(e){e===M&&(e=c.index());let t='>li[data-index="'+e+'"]';n.$.find(t).animate({width:0,padding:0},function(){i(this).hide(),o.remove(e),s&&s(),n.fire("after-close",[e])})},clear:function(){!function e(t){if(t<0)return void(s=null);s=function(){e(t-1)};let i=l[t];if(!i||i.isHome)return void s();let r=n.fire("close",[i,t]);if(r.includes(!1))return;c.close(t)}(l.length-1)}};return c}),f.panel("/Master/PageTabs",function(e,t,n){const i=t.require("List"),r=t.require("Tabs");return n.on("init",function(){i.on({change:function(e){r.render(e)},remove:function(e,t){r.active(t-1,!0)},clear:function(){r.active(0,!0)}}),r.on({render:function(e){n.fire("render",[e])},active:function(e,t){n.fire("active",[e,t])},close:function(e,t){if(n.fire("close",[e,t]).includes(!1))return!1},"after-close":function(e){i.remove(e)}})}),n.on("render",function(){var e=i.get();r.render(e),r.active(0,!0),n.fire("ready")}),{open:function(e){var t=i.index(e);return t>=0?(r.active(t),t):(t=r.index(),t=i.insert(t,e),r.active(t),t)},close:function(e){r.close(e)},active:function(e){r.active(e)},clear:function(){r.clear()},set:function(e,t){var n=i.index({id:e});if(!(n<0)){var o=i.get();i.get(n).name=t,n=r.index(),r.render(o),r.active(n)}}}}),f.panel("/Master/Sidebar/Header",function(e,t,n){const i=e("@definejs/local-storage");let r=null,o=!0;n.on("init",function(){r=new i(t.id),(o=r.get("visible"))===M&&(o=!0),n.fire("toggle",[o]),n.$.on("click",function(){o=!o,r.set("visible",o),n.fire("toggle",[o])})}),n.on("render",function(){})}),f.panel("/Master/Sidebar/List",function(e,t,n){const i=e("@definejs/tabs");let r=[],o=null;return n.on("init",function(){o=new i({container:n.$,selector:">li",activedClass:"on"}),n.$.on("click","[data-index]",function(){let e=+this.getAttribute("data-index"),t=r[e];o.active(e),n.fire("item",[t])})}),n.on("render",function(e){r=e,n.fill(r,function(e,t){return e.id=e.view,e.index=t,{index:t,name:e.name,icon:e.icon,class:e.border?"group":""}})}),{active:function(e){let t=e.index;"number"!=typeof t&&(t=-1),o.active(t)},get:function(e){return r.find(function(t,n){return t.view===e})}}}),f.panel("/Master/Sidebar",function(e,t,n){const i=e("@definejs/package"),r=t.require("Header"),o=t.require("List");return n.on("init",function(){r.on({toggle:function(e){n.fire("toggle",[e])}}),o.on({item:function(e){n.fire("item",[e])}})}),n.on("render",function(){i.load("data.Sidebar",function(){let t=e("data.Sidebar");r.render(),o.render(t),n.fire("render",[])})}),{active:o.active,get:o.get}}),f.panel("/Master/Views",function(e,t,n){const i=e("@definejs/package");let r=null,o={},l={},c=new Map,a=new Map;function d(e,t){let i=o[e];if(i)return i;let r=n.fire("require",[e]);return(i=r[0])?(o[e]=i,a.set(i,t),l[e]||(l[e]=!0,i.on("close",function(){delete o[e],c.delete(i);let t=[...arguments];n.fire("close",t)}),i.on("title",function(e){let t=a.get(i);t.title=e,n.fire("title",[t.id,e])}),i.on("refresh",function(){let e=c.get(i)||[];i.render(...e)}),i.on("fullscreen",function(){n.fire("fullscreen")})),i):void 0}function u(e,t){let i=t.args||[],o=t.render;r&&r.hide(),r=e,o?(c.set(e,i),e.render(...i)):e.show(),n.fire("active",[t])}return{open:function(e,t){let r=t||{},l=r.args||[];r={name:e,args:l,render:!o[e]||r.render,title:r.title,id:r.id||""};let c=d(e,r);c?u(c,r):i.load(e,function(t){if(!t)return s.warn("不存在视图 "+e+" 对应的 package 文件。"),void n.fire("404",[r]);let i=t.html;i&&n.$.append(i.content);let o=d(e,r);if(!o)return s.warn("无法获取到视图: "+e),void n.fire("404",[r]);u(o,r)})},close:function(e,t){let n=o[e];if(n)return!n.close(...t).includes(!1)&&(c.delete(n),void delete o[e])},refresh:function(e){if("string"==typeof(e=e||r)){e=n.fire("require",[e])[0]}if(!e)return;let t=c.get(e)||[];if(e.refresh(...t).includes(!1))return!1;e.render(...t)}}}),f.panel("/Master",function(e,t,n){const r=t.require("Sidebar"),o=t.require("PageTabs"),l=t.require("PageList"),s=t.require("Views");return n.on("init",function(){r.on({render:function(e){o.render()},item:function(e){let t=o.open(e);l.active(t)},toggle:function(e){n.$.toggleClass("hide",!e)}}),o.on({render:function(e){l.render(e)},active:function(e,t){r.active(e),l.active(t),s.open(e.view,{title:e.name,id:e.id})},ready:function(){a(function(){n.fire("ready")},100)},close:function(e,t){return s.close(e.view,[t])}}),l.on({render:function(e){},active:function(e,t){r.active(e),o.active(t),s.open(e.view,{title:e.name,id:e.id})},clear:function(){o.clear()},refresh:function(){s.refresh()},close:function(e,t){o.close(t)}}),s.on({require:function(e){return n.fire("require",[e])[0]},close:function(){o.close(...arguments)},404:function(e){s.open("404",{args:[e.title],render:!0,title:"404-"+e.title})},error:function(e,t){s.open("Error",{args:[e,t],render:!0,title:"error-"+e.title})},active:function(e){i.title=e.title},title:function(e,t){o.set(e,t)},fullscreen:function(){n.$.toggleClass("fullscreen")}})}),n.on("render",function(){r.render()}),n.on("after-render",function(){n.fire("render")}),{open:function(e,t,n){m.isArray(t)&&(n=t,t="");let i={view:e},c=r.get(e);c&&(i=v.assign({},c),r.active(c)),i.name=t||i.name||e,i.id=i.id||e;let a=o.open(i);l.active(a),s.open(e,{args:n,render:!0,title:i.name,id:i.id})},close:function(){},refresh:function(e){s.refresh(...arguments)}}}),f.view("/404",function(e,t,n){n.on("init",function(){}),n.on("render",function(e){})}),f.view("/Error",function(e,t,n){n.on("init",function(){}),n.on("render",function(e,t){n.fill({name:e.name,ex:t.stack}),s.log(t)})}),f.panel("/FileList/Dialog/Content/File",function(e,t,n){return n.on("init",function(){n.$.on("change",'[type="file"]',function(){var e=this.files[0];s.log("change",this.value),s.log(e),n.fire("change",[e])})}),n.on("render",function(e){}),{render:function(e){s.log(e),n.set("$"),n.set("rendered",!1),n.render(e),n.hide()},check:function(e){return!(e=e.replace(/\\/g,"/"))||"."==e||e.includes("..")||e.includes(":")||e.includes("*")||e.includes("?")||e.includes('"')||e.includes("<")||e.includes(">")||e.includes("|")||e.includes("//")||e.includes(" ")||e.includes("./")?"":e}}}),f("/FileList/Dialog/API",function(e,t,n){const i=e("@definejs/emitter"),r=e("@definejs/loading"),o=e("@definejs/toast");var l=e("API"),s=new i,c=new r({mask:0}),d=new o({duration:1500,mask:0});return{on:s.on.bind(s),rename:function(e){var t=new l("FileList.rename"),n=e.item,i=n.parent,r=!i.parent?e.name:i.id+"/"+e.name;t.on({request:function(){c.show("提交中...")},response:function(){c.hide()},success:function(e,t,n){d.show("重命名成功"),a(function(){s.fire("success",[{dest:r}])},1500)},fail:function(e,t,n,i){u.alert("重命名失败: {0}",t)},error:function(e,t,n,i){u.alert("重命名错误: 网络繁忙，请稍候再试")}}),t.post({id:n.id,dest:r})},add:function(t){var n=t.type,i=t.item,r=t.file;"file"==n&&r?function(t){var n=e("File"),i=t.item,r=i.parent?i.id+"/":"";n.upload({file:t.file,dir:r,name:t.name,done:function(e){e?(d.show("上传成功"),a(function(){s.fire("success",[{dest:e.dest}])},1500)):u.alert("上传失败")}})}({file:r,item:i,name:t.name}):function(e){var t=new l("FileList.add"),n=e.item,i=n.id;n.parent&&(i+="/");var r=i+e.name;t.on({request:function(){c.show("提交中...")},response:function(){c.hide()},success:function(e,t,n){d.show("添加成功"),a(function(){s.fire("success",[{dest:r}])},1500)},fail:function(e,t,n,i){u.alert("添加失败: {0}",t)},error:function(e,t,n,i){u.alert("添加错误: 网络繁忙，请稍候再试")}}),t.post({id:r,type:e.type})}({item:i,name:t.name,type:n})}}}),f.panel("/FileList/Dialog/Content",function(e,t,n){var i=t.require("File"),r=null;return n.on("init",function(){n.template({"":function(e){return{names:this.fill("names",e),types:"add"==e.cmd?this.fill("types",{}):""}},names:function(e){var t=e.item,n=t.parent;return"add"==e.cmd?{parent:t.parent?t.id+"/":"",name:""}:{parent:n.parent?n.id:"",name:t.name}},types:function(){return{}}}),i.on({change:function(e){n.fire("select",[e]),r.val(e.name)}}),n.$.on("click",'[type="radio"]',function(){var e=this.value,t="file"==e;i.toggle(t),n.fire("type",[e])})}),n.on("render",function(e){n.fill(e),i.render(),(r=n.$.find('[data-id="name"]')).focus()}),{get:function(){var e=r.val().replace(/\\/g,"/"),t=n.$.find('[type="radio"]:checked').val();return(e=i.check(e))?{name:e,type:t}:(r.focus(),r.addClass("warn"),r.get(0).select(),void a(function(){r.removeClass("warn")},100))}}}),f.panel("/FileList/Dialog",function(e,t,n){var i=e("Dialog"),r=t.require("Content"),o=t.require("API"),l=null,c=null;n.on("init",function(){function e(){var e=r.get();if(c&&e)switch(c.cmd){case"rename":if(e.name==c.item.name)return void l.close();o.rename({item:c.item,name:e.name});break;case"add":o.add({item:c.item,name:e.name,type:e.type,file:c.file})}}(l=i.panel({container:n,content:r,title:"",resizable:!0,autoClose:!1,width:400,height:200,"z-index":1023,footer:[{text:"确定",name:"ok"}]})).on({render:function(e){r.render(c)},enter:function(t){e()}}),l.on("button",{ok:function(){e()}}),r.on({select:function(e){c.file=e,s.log(c)},type:function(e){s.log(e)}}),o.on("success",function(e){l.close(),n.fire("success",[e])})}),n.on("render",function(e){var t=e.item,n="file"==t.data.type,i="add"==e.cmd;n&&i&&(e.item=t.parent),function(e){c=v.assign({},e);var t=e.item,n="add"==e.cmd,i="file"==t.data.type,r=n?"添加":"重命名"+(i?"文件":"目录"),o=n?232:150;l.render({title:r}),l.set({height:o})}(e)})}),f.panel("/FileList/Main/List/Filter/Dir",function(e,t,n){const i=e("CheckBox");let r=null;n.on("init",function(){(r=new i({fireNow:!0,container:n.$,text:"仅当前目录"})).on("checked",function(e){n.fire("change",[e])})}),n.on("render",function(e){r.render({checked:e})})}),f.panel("/FileList/Main/List/Filter/Name",function(e,t,n){n.on("init",function(){n.$.on("input","input",function(){s.log(this.value),n.fire("change",[this.value])})}),n.on("render",function(){})}),f.panel("/FileList/Main/List/Filter/Type",function(e,t,n){const i=e("DropList");let r=null,o=[{id:"0",name:"全部"}],l={};n.on("init",function(){(r=new i({container:n.$.find(">div"),columns:["name"],empty:!1,field:{id:"id",text:"name",focus:"name",title:"name"}})).on({error:function(e,t){u.alert(t)},process:function(e){},select:function(e,t){let i=t.index,r=JSON.stringify(o);l[r]=i,n.fire("change",[e.item.value])}})}),n.on("render",function(e){o=e;let t=JSON.stringify(e),n=l[t]||0;r.render(),r.fill(o),r.select(n)})}),f.panel("/FileList/Main/List/Filter",function(e,t,n){const i=t.require("Type"),r=t.require("Name"),o=t.require("Dir");let l={type:"",beginDate:"",endDate:"",name:"",dir:!1};n.on("init",function(){let e=null;function t(t){v.assign(l,t),clearTimeout(e),e=a(function(){let e=v.assign({},l);n.fire("change",[e])},100)}i.on({change:function(e){t({type:e})}}),r.on({change:function(e){t({name:e})}}),o.on({change:function(e){t({dir:e})}})}),n.on("render",function(e){i.render(e),r.render(),o.render(!0)})}),f.panel("/FileList/Main/List/GridView",function(e,t,n){const i=e("@definejs/date"),r=e("GridView"),o=e("File");let l=null,s=null,c={keyword:"",keywordHtml:""};n.on("init",function(){s=n.template(),(l=new r({container:n.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"路径",name:"name",width:500,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"类型",name:"typeDesc",width:80,class:"type",dragable:!0},{caption:"大小",name:"size",width:70,class:"size",dragable:!0}]})).on("process","cell",{name:function(e){let t=e.row.data.name.split("/"),n=t.slice(-1)[0],i=t.slice(0,-1).join("/"),r=(i+="/")+n,o=c.keyword;return o&&(i=i.split(o).join(c.keywordHtml),n=n.split(o).join(c.keywordHtml)),s.fill("name",{dir:i,filename:n,fullname:r})}}),l.on("process","row",function(e){e.class=e.data.item.type}),l.on("click","cell",{name:{"":function(e,t){t.stopPropagation(),e.column.cells.forEach(function(t){$(t.element).toggleClass("text",t===e)}),$(e.element).find("input").get(0).select()},"[data-cmd]":function(e,t){t.stopPropagation();let i=e.row.data.item;n.fire("item",[i])}}}),l.on("click","table",function(e,t){e.column("name",function(e){$(e.element).removeClass("text")})}),l.render()}),n.on("render",function(e,t={}){let n=c.keyword=t.keyword||"",r=t.root||"";n&&(c.keywordHtml='<span class="keyword">'+n+"</span>"),e=e.map(function(e,t){let n=e.stat,l=i.format(n.birthtime,"yyyy-MM-dd HH:mm:ss"),s=i.format(n.mtime,"yyyy-MM-dd HH:mm:ss"),c="file"==e.type,a=o.getSizeDesc(n.size),d=e.name;return c||(d+="/"),{name:r+d,typeDesc:c?e.ext.slice(1)+" 文件":"目录",size:a.value+" "+a.desc,birthtime:l,mtime:s,item:e}}),l.fill(e)})}),f("/FileList/Main/List/List",function(e,t,n){const i=e("@definejs/date");var r=[".png",".jpg",".jpeg",".gif",".bmp"];return{getTypes:function(e){var t=!1,n=!1,i=!1,o=new Set;e.forEach(function(e,l){var s=e.type;if("dir"!=s){if("file"==s){i=!0;var c=e.ext.toLowerCase();o.add(c),r.includes(c)&&(n=!0)}}else t=!0});var l=[{id:"0",name:"全部",value:""}];return t&&l.push({id:"1",name:"目录",value:"dir"}),i&&l.push({id:"3",name:"文件",value:"file"}),n&&l.push({id:"2",name:"图片",value:r}),[...o].forEach(function(e,t){var n=t+4+"",i=e.slice(1)+" 文件";l.push({id:n,name:i,value:[e]})}),l},filter:function(e,t){if(!t)return e;var n=t.type,r=t.beginDate,o=t.endDate,l=t.name||"",s=t.dir;return n&&n.length>0&&("string"==typeof n?e=e.filter(function(e){return e.type==n}):m.isArray(n)&&(e=e.filter(function(e){if("file"!=e.type)return!1;var t=e.ext.toLowerCase();return n.includes(t)}))),l&&(e=e.filter(function(e){return e.name.includes(l)})),r&&(r=i.parse(r),e=e.filter(function(e){return r<=e.stat.birthtimeMs})),o&&(o=i.parse(o),e=e.filter(function(e){return o>=e.stat.birthtimeMs})),s&&(e=e.filter(function(e){var t=e.name.slice(1);return"/"==s?!t.includes("/"):!t.slice(s.length+1).includes("/")})),e}}}),f.panel("/FileList/Main/List",function(e,t,n){const i=t.require("Filter"),r=t.require("GridView"),o=t.require("List");let l={root:"",list:[],item:null};return n.on("init",function(){i.on({change:function(e){let t=!!e.dir&&l.item.id;e=v.assign({},e,{dir:t}),items=o.filter(l.list,e),r.render(items,{keyword:e.name,root:l.root})}}),r.on({item:function(e){n.fire("item",[e])}})}),n.on("render",function(e){let t=l.list=e.list,n=o.getTypes(t);l.item=e.item,l.root=e.root,i.render(n)}),{}}),f.panel("/FileList/Main/Tree/Header",function(e,t,n){const i=e("CheckBox");let r=[{id:"icon",text:"图标",chk:null},{id:"tab",text:"缩进",chk:null},{id:"color",text:"彩色",chk:null},{id:"hover",text:"悬停",chk:null}];n.on("init",function(){r.forEach(e=>{let t=new i({fireNow:!0,container:n.$.find(`[data-id="chk-${e.id}"]`),text:e.text});t.on("checked",function(t){n.fire("check",[{[e.id]:t}])}),e.chk=t}),n.$on("click","[data-cmd]",function(e){let{cmd:t}=e.target.dataset;n.fire("cmd",t,[])})}),n.on("render",function(e){r.forEach(t=>{let n=e[t.id];t.chk.render({checked:n})})})}),f.panel("/FileList/Main/Tree/Main",function(e,t,i){const r=e("TextTree"),o=e("Clipboard");let l=null,s={$view:null};function c(e){if(e&&(s.$view=e),!s.$view)return;let t=s.$view.height();i.$.height(t-139)}return i.on("init",function(){(l=new r({container:i.$})).on("cmd",function(e,t){i.fire("cmd",[e,t])}),$(n).on("resize",function(e){c()})}),i.on("render",function(e){let{id:t,list:n,$view:r}=e;l.render(n),"string"==typeof t&&l.highlight(t),c(r),i.fire("render")}),{check(e){l.toggle(e)},copy(){let e=l.toString();o.copy(e)}}}),f.panel("/FileList/Main/Tree",function(e,t,n){const i=t.require("Header"),r=t.require("Main");n.on("init",function(){i.on("check",function(e){r.check(e)}),i.on("cmd",{copy:function(){r.copy()}}),r.on({cmd:function(e,t){n.fire("cmd",e,[t])},render:function(){i.render({icon:!1,tab:!0,color:!0,hover:!1})}})}),n.on("render",function(e,t){let{item:n,list:i,root:o}=e;i=i.map(e=>{return{id:o+e.name}});let l="/"==n.id?o:o+n.id,s=l.split("/");i=[...s.map((e,t)=>{return{id:s.slice(0,t+1).join("/")}}),...i],r.render({id:l,list:i,$view:t})})}),f.panel("/FileList/Main/Tabs",function(e,t,n){const i=e("@definejs/tabs");let r=[{name:"组织架构",cmd:"tree",root:!0},{name:"文件列表",cmd:"list",root:!0}],o=null,l={index:0};n.on("init",function(){(o=new i({container:n.$.get(0),activedClass:"on",eventName:"click",selector:">li",repeated:!0})).on("change",function(e,t){l.index=t,e=r[t],n.fire(e.cmd)})}),n.on("render",function(){o.render(r,function(e,t){return{index:t,name:e.name}}),o.active(l.index)})}),f.panel("/FileList/Main",function(e,t,n){const i=t.require("Tabs"),r=t.require("Tree"),o=t.require("List");let l={root:"",list:[],item:null};n.on("init",function(){i.on({tree:function(){r.render(l,n.$),o.hide()},list:function(){r.hide(),o.render(l)}}),o.on({item:function(e){n.fire("item",[e])}}),r.on("cmd",{id:function(e){let t=e.id.slice(l.root.length);n.fire("item",[{name:t}])}})}),n.on("render",function(e){let t=e.root;t.endsWith("/")&&(t=t.slice(0,-1)),l.root=t,l.list=e.list,l.item=e.item,i.render()});let s=638;return{resize:function(e){if(!0===e)return s=(s=n.$.get(0).style.width).slice(12,-3),void(s=y(s));let t="calc(100% - "+(s+e)+"px)";n.$.css({width:t})}}}),f.panel("/FileList/Preview/MarkDoc",function(e,t,n){const i=e("@definejs/escape"),r=e("MarkDoc");let o=null,l=[".json",".js",".css",".html",".less"];return n.on("init",function(){(o=new r({container:n.$})).on("render",function(){let e=o.getOutlines();n.fire("render",[e])})}),n.on("render",function(e){let t=e.content,r=e.ext.toLowerCase(),s="",c=!0;"source"==e.type?(t=i.html(t),s=r.slice(1),c=!1):l.includes(r)&&(s=r.slice(1)),o.render({content:t,language:s,baseUrl:"",code:{format:c}}),n.$.toggleClass("image",e.isImage)}),{outline:function(e){o.toOutline(e)}}}),f.panel("/FileList/Preview/Tabs",function(e,t,n){const i=e("@definejs/tabs");var r=[{name:"预览",type:"preview"},{name:"源码",type:"source"}],o=0,l=null;n.on("init",function(){(l=new i({container:n.$,activedClass:"on",eventName:"click",selector:">li",repeated:!0})).on("change",function(e,t){o=t,e=r[t],n.fire("change",[e.type])})}),n.on("render",function(e){l.render(r,function(e,t){return{index:t,name:e.name}}),"number"==typeof e?o=e:e=o,l.active(e)})}),f.panel("/FileList/Preview",function(e,t,n){var i=t.require("Tabs"),r=t.require("MarkDoc"),o={},l=638;return n.on("init",function(){i.on({change:function(e){o.type=e,r.render(o)}}),r.on({render:function(e){n.fire("render",[e])}})}),n.on("render",function(e){var t=e.isImage,n=t?".md":e.ext;o={content:e.content,ext:n,isImage:t,type:""},i.render()}),{get:function(){return o},outline:function(e){r.outline(e)},resize:function(e){if(!0===e)return l=(l=n.$.get(0).style.width).slice(12,-3),void(l=y(l));var t="calc(100% - "+(l+e)+"px)";n.$.css({width:t})}}}),f.panel("/FileList/Sidebar/Operation",function(e,t,n){const i=e("@definejs/json");n.on("init",function(){n.$.on("click","button",function(){var e=this.getAttribute("data-cmd");n.fire("cmd",[e])})}),n.on("render",function(e){var t=e.item,r=e.detail,o=t.parent?t.data.type:"root",l=!1,s=!1;if("file"==r.type&&".json"==r.ext.toLowerCase()){var c=i.parse(r.content);l=c&&m.isArray(c.groups),s=c&&c.header&&m.isArray(c.header.menus)}n.$.removeClass("root dir file").addClass(o),n.$.toggleClass("image",!!r.isImage),n.$.toggleClass("side-menu",!!l),n.$.toggleClass("top-menu",!!s)})}),f.panel("/FileList/Sidebar/Outline",function(e,t,n){var i=e("Outline"),r=null;n.set("show",!1),n.on("init",function(){(r=new i({container:n.$})).on({item:function(e,t){n.fire("item",[e,t])}}),r.render()}),n.on("render",function(e){r.fill(e)})}),f("/FileList/Sidebar/Stat/Types",function(e,t,n){const i=e("@definejs/object"),r=e("File");let o=[".png",".jpg",".jpeg",".gif",".bmp"];return{get:function(e){if(!e)return[];let t={dir:0,file:0,image:0,size:0},n={};e.forEach(function(e,i){let r=e.type;if(t[r]++,"dir"==r)return;let l=e.ext.toLowerCase();n[l]=(n[l]||0)+1,o.includes(l)&&t.image++,t.size+=e.stat.size});let l=[{name:"全部",value:e.length,desc:"个",class:"spliter"}],s=t.size;return s&&(s=r.getSizeDesc(s),l.push({name:"大小",value:s.value,desc:s.desc,class:"dir-size"})),t.dir&&l.push({name:"目录",value:t.dir,desc:"个"}),t.file&&l.push({name:"文件",value:t.file,desc:"个"}),t.image&&l.push({name:"图片",value:t.image,desc:"个"}),v.keys(i.sort(n)).forEach(function(e,t){let i=n[e],r=e.slice(1)+" 文件",o=0==t?"spliter":"";l.push({name:r,value:i,desc:"个",class:o})}),l}}}),f.panel("/FileList/Sidebar/Stat",function(e,t,n){const i=e("File"),r=e("@definejs/date"),o=t.require("Types");n.on("init",function(){n.template({"":function(e){return this.fill("table",e)},table:{"":function(e){let{stat:t,type:n,name:l}=e,s="dir"==n?"目录":e.ext.slice(1)+" 文件",c=r.format(t.birthtime,"yyyy-MM-dd HH:mm:ss"),a=r.format(t.mtime,"yyyy-MM-dd HH:mm:ss"),d=i.getSizeDesc(t.size),u=o.get(e.list),f=l.split("/").slice(-1)[0],m=e.root.slice(0,-1);return u=this.fill("type",u),{sname:f,name:m+l,ext:e.ext,md5:e.md5,size:d.value,sizeDesc:d.desc,birthtime:c,mtime:a,type:s,types:u}},type:function(e,t){return{name:e.name,value:e.value,desc:e.desc||"",class:e.class||""}}}})}),n.on("render",function(e){s.log(e),n.fill(e),n.$.toggleClass("dir","dir"==e.type)})}),f.panel("/FileList/Sidebar/Tabs",function(e,t,n){const i=e("@definejs/tabs");var r=[{name:"常规",type:"general"},{name:"提纲",type:"outline"}],o=0,l=null;n.on("init",function(){(l=new i({container:n.$.get(0),activedClass:"on",eventName:"click",selector:">li",repeated:!0})).on("change",function(e,t){o=t,e=r[t],n.fire(e.type)})}),n.on("render",function(e){var t=e.index,n=e.outline,i=n?r:r.slice(0,-1);l.render(i,function(e,t){return{index:t,name:e.name}}),"number"==typeof t?o=t:t=o,n||(t=0),l.active(t)})}),f.panel("/FileList/Sidebar",function(e,t,n){var i=t.require("Stat"),r=t.require("Operation"),o=t.require("Outline"),l=t.require("Tabs");return n.on("init",function(){l.on({general:function(){i.show(),r.show(),o.hide()},outline:function(){i.hide(),r.hide(),o.show()}}),r.on({cmd:function(e){n.fire("operation",e)}}),o.on({item:function(e,t){n.fire("outline",[e,t])}})}),n.on("render",function(e){s.log(e);var t=e.detail,n="file"==e.item.data.type&&!t.isImage;i.render(t),r.render(e),l.render({outline:n})}),{outline:function(e){o.render(e)}}}),f("/FileList/Tree/Main/Data",function(e,t,n){return{toTree:function(e){var t=function e(t,n){var i=t.dir$files;return t.dir$dirs[n].map(function(r){var o=n+"/"+r;o=o.replace(/\/+/g,"/");var l=e(t,o),s=i[o];return s=s.map(function(e){var t=o+"/"+e;return{name:e,id:t,data:{type:"file",name:t,parent:o}}}),(l=[...l,...s]).length||l.push({name:"(空目录)",id:o+"/",data:{type:"file",name:"",parent:o}}),{name:r,id:o,data:{type:"dir",name:o,parent:n},list:l}})}(e,"/"),n=e.dir$files["/"];return n=n.map(function(e){var t="/"+e;return{name:e,id:t,data:{type:"file",name:t,parent:"/"}}}),t=[...t,...n],[{name:e.root.split("/").slice(-1)[0],id:"/",open:!0,foldable:!1,data:{type:"dir",name:"/"},list:t}]}}}),f("/FileList/Tree/Resizer/Masker",function(e,t,n){const i=e("@definejs/masker");let r=null;return{show(){(r=r||new i({opacity:0})).show()},hide(){r&&r.hide()}}}),f.panel("/FileList/Tree/Header",function(e,t,n){const i=e("CheckBox");let r=null,o={dirOnly:!1};n.on("init",function(){(r=new i({fireNow:!0,container:n.$.find('[data-id="chk-dir-only"]'),text:"仅目录"})).on("checked",function(e){o.dirOnly=e,n.fire("dir-only",[e])}),n.$on("click",{"[data-cmd]":function(e){let{cmd:t}=this.dataset;n.fire(t)}})}),n.on("render",function(e){e=e||{},n.$.toggleClass("back",!!e.back),n.$.toggleClass("forward",!!e.forward),n.$.toggleClass("up",!!e.up),n.$.toggleClass("root",!!e.root),n.$.toggleClass("dir-only",!!e.dirOnly),r.render({checked:o.dirOnly})})}),f.panel("/FileList/Tree/Main",function(e,t,n){var i=e("MenuTree"),r=t.require("Data"),o=null,l={item:null,index:-1,list:[]};return n.on("init",function(){function e(e){e!==l.item&&(l.index++,l.list[l.index]=e,l.item=e,n.fire("item",[e,{back:l.index>0,forward:l.index<l.list.length-1,up:!(!e||!e.parent),root:!!e.parent,dirOnly:"dir"==e.data.type}]),n.fire(e.data.type,[e]))}(o=new i({container:n.$})).on({fill:function(e){},item:function(t){var n=t.id;"/"!=n&&n.endsWith("/")?o.open(t.parent.id):e(t)},open:function(t){e(t)},close:function(t){e(t)},icon:function(e,t){},delete:function(e){this.open(e.parent)}}),o.render()}),n.on("render",function(e){var t=r.toTree(e);s.log(t),l.item=null,l.list=[],l.index=-1,l.push=!0,o.fill(t)}),{open:function(e){o.get(e)?o.open(e):u.alert("不存在节点: "+e,function(){o.open("/")})},back:function(){var e=l.index-1,t=l.list[e];t&&(l.index=e-1,this.open(t))},forward:function(){var e=l.index+1,t=l.list[e];t&&this.open(t)},up:function(){var e=l.item,t=e?e.parent:null;t&&this.open(t)},root:function(){this.open("/")},dirOnly:function(e){n.$.toggleClass("dir-only",!!e)}}}),f.panel("/FileList/Tree/Resizer",function(e,t,n){const r=t.require("Masker");n.on("init",function(){let e=!1,t=0,o="",l=i.body,s=n.$.get(0);$(l).on({mousedown:function(i){i.target===s&&(e=!0,t=i.pageX,o=l.style.cursor,l.style.cursor="w-resize",r.show(),n.fire("start"))},mousemove:function(i){if(!e)return;let r=i.pageX-t;n.fire("change",[r])},mouseup:function(t){e&&(e=!1,l.style.cursor=o,r.hide(),n.fire("stop"))}})}),n.on("render",function(e){})}),f.panel("/FileList/Tree",function(e,t,n){const i=t.require("Header"),r=t.require("Main"),o=t.require("Resizer");return n.on("init",function(){r.on({item:function(e,t){n.fire("item",[e]),i.render(t)},dir:function(e){n.fire("dir",[e])},file:function(e){n.fire("dir",[e])}}),i.on({back:function(){r.back()},forward:function(){r.forward()},up:function(){r.up()},root:function(){r.root()},"dir-only":function(e){r.dirOnly(e)}})}),n.on("init",function(){function e(){return n.$.outerWidth()}function t(e){n.$.outerWidth(e)}let i=e();o.on({change:function(e){let r=i+e;r<220?t(220):(t(r),n.fire("resize","change",[e,r]))},stop:function(){i=e(),n.fire("resize","stop")}})}),n.on("render",function(e){i.render(),r.render(e),o.render()}),{open:function(e){r.open(e)}}}),f("/FileList/API",function(e,t,n){const i=e("@definejs/emitter"),r=e("@definejs/string"),o=e("@definejs/loading"),l=e("API");let s=new i,c=new o({mask:0});return{on:s.on.bind(s),get:function(){let e=new l("FileList.get",{});e.on({request:function(){c.show("加载中...")},response:function(){c.hide()},success:function(e,t,n){s.fire("success","get",[e])},fail:function(e,t,n,i){u.alert("获取文件列表失败: {0}",t)},error:function(e,t,n,i){u.alert("获取文件列表错误: 网络繁忙，请稍候再试")}}),e.get()},read:function(e){let t=new l("FileList.read",{});t.on({request:function(){c.show("加载中...")},response:function(){c.hide()},success:function(t,n,i){t.content;if(t.isImage){let e="![ ]({url})";t.content=r.format(e,{url:t.url})}let o=e.data.type,l={detail:t,item:e};s.fire("success","read",o,[l])},fail:function(e,t,n,i){u.alert("获取文件内容失败: {0}",t)},error:function(e,t,n,i){u.alert("获取文件内容错误: 网络繁忙，请稍候再试")}}),t.get({id:e.id})}}}),f.view("/FileList",function(e,t,i){const r=e("@definejs/session-storage"),o=t.require("API"),l=t.require("Tree"),s=t.require("Preview"),c=t.require("Sidebar"),a=t.require("Dialog"),d=t.require("Main");let u=new r(t.id),f={item:{id:"/"},detail:null};i.on("init",function(){o.on("success",{get:function(e){let{root:t}=e,n=f.item.id;n.startsWith(`${t}/`)&&(f.item.id=n=n.slice(t.length)),l.render(e),l.open(n)},read:{dir:function(e){s.hide(),d.render({list:e.detail.list,item:e.item,root:e.detail.root}),c.render(e)},file:function(e){f.detail=e.detail,s.render(e.detail),d.hide(),c.render(e)}},delete:function(e){f.item.id=e.parent,o.get()}}),l.on({item:function(e){u.set("id",e.id),f.item=e,o.read(e)},resize:{change:function(e){d.resize(e),s.resize(e)},stop:function(){d.resize(!0),s.resize(!0)}}}),d.on({item:function(e){l.open(e.name)}}),s.on({render:function(e){c.outline(e)}}),c.on("outline",function(e,t){s.outline(t)}),c.on("operation",{refresh:function(){o.get()},open:function(){n.open(f.detail.url)},demo:function(){i.fire("demo",[f.item.id])},sidebar:function(){i.fire("sidebar",[f.item.id])}}),a.on({success:function(e){f.item={id:e.dest},o.get()}})}),i.on("render",function(e){let t=e||u.get("id")||"/";f.item={id:t},o.get()})}),f.view("/Home",function(e,t,n){n.on("init",function(){}),n.on("render",function(){})}),f("/Log/List/Colors",function(e,t,n){let i={reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29],black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],gray:[90,39],brightRed:[91,39],brightGreen:[92,39],brightYellow:[93,39],brightBlue:[94,39],brightMagenta:[95,39],brightCyan:[96,39],brightWhite:[97,39],bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgGray:[100,49],bgBrightRed:[101,49],bgBrightGreen:[102,49],bgBrightYellow:[103,49],bgBrightBlue:[104,49],bgBrightMagenta:[105,49],bgBrightCyan:[106,49],bgBrightWhite:[107,49]};return{render(e){let t=e;return v.keys(i).forEach(function(e){let n=i[e],r=`[${n[0]}m`,o=`[${n[1]}m`;t=(t=t.split(r).join(`<span class="colors ${e}">`)).split(o).join("</span>")}),t}}}),f("/Log/List/File",function(e,t,n){const i=e("@definejs/string");let r={fs:null,files:[]};return{render(e,t){if(!t)return e;let{files:n}=function(e){if(e===r.fs)return r;let{list:t,root:n}=e;n.endsWith("/")&&(n=n.slice(0,-1));let i=t.map(e=>`${n}${e.name}`);return i=i.sort(function(e,t){return e.length>t.length?-1:1}),r.fs=e,r.files=i,r}(t);return n.forEach((t,n)=>{let r=`<a data-cmd="file" data-value="{${n}}">{${n}}</a>`;e=i.replaceAll(e,t,r)}),e=i.format(e,n)}}}),f("/Log/List/HTML",function(e,t,n){return{render(e){if("string"!=typeof e)return"";return e=(e=(e=(e=(e=e.replace(/[<>]/g,function(e){return"&#"+e.charCodeAt(0)+";"})).split(" ").join('<b class="empty"></b>')).split("│").join('<b class="linkY">│</b>')).split("\r\n").join("<br />")).split("\n").join("<br />")}}}),f("/Log/API",function(e,t,n){const i=e("@definejs/emitter"),r=(e("@definejs/string"),e("@definejs/loading")),o=e("API");let l=new i,s=new r({mask:0});return{on:l.on.bind(l),get:function(){let e=new o("Log.get",{});e.on({request:function(){s.show("加载中...")},response:function(){s.hide()},success:function(e,t,n){e=e.filter(e=>!!e),l.fire("success","get",[e])},fail:function(e,t,n,i){u.alert("获取日志列表失败: {0}",t)},error:function(e,t,n,i){u.alert("获取日志列表错误: 网络繁忙，请稍候再试")}}),e.get()},clear(){let e=new o("Log.clear",{});e.on({request:function(){s.show("处理中...")},response:function(){s.hide()},success:function(e,t,n){l.fire("success","clear",[])},fail:function(e,t,n,i){u.alert(`清空日志失败: ${t}`)},error:function(e,t,n,i){u.alert("清空日志错误: 网络繁忙，请稍候再试")}}),e.get()}}}),f.panel("/Log/Header",function(e,t,n){const i=e("CheckBox");let r=[{id:"time",cmd:"time",checked:!0,fireNow:!0,text:"时间"},{id:"color",cmd:"color",checked:!0,fireNow:!0,text:"彩色"},{id:"highlight",cmd:"highlight",checked:!1,fireNow:!0,text:"高亮当前行"},{id:"border",cmd:"border",checked:!1,fireNow:!0,text:"边线"}];return n.on("init",function(){n.$on("click",{"[data-cmd]":function(e){let{cmd:t}=e.currentTarget.dataset;n.fire("cmd",t,[])}}),r=r.map(e=>{let t=new i({checked:e.checked,fireNow:e.fireNow,text:e.text,container:n.$.find(`[data-id="chk-${e.id}"]`)});return t.on("checked",function(t){n.fire("check",e.cmd,[t])}),t})}),n.on("render",function(){r.forEach(e=>{e.render()})}),{close(e){}}}),f.panel("/Log/List",function(e,t,n){const i=e("@definejs/date"),r=t.require("Colors"),o=t.require("File"),l=t.render("HTML");let s={input:'<i class="fas fa-terminal"></i>',info:'<i class="fas fa-info-circle"></i>',stdout:""},c={list:[],fs:null};return n.on("init",function(){n.$on("click",{"[data-cmd]":function(e){let{cmd:t,value:i}=e.target.dataset;n.fire("cmd",[t,i])}}),n.template(function(e,t){if(!e)return"";let{msg:n,time:a,type:d}=e;a=i.format(a,"HH:mm:ss"),n=l.render(n),n=r.render(n),n=o.render(n,c.fs);let u=s[d=d||"stdout"]||"",f=c.list[t-1],m=!1;if(f){m=a==i.format(f.time,"HH:mm:ss")}return{time:a,"same-time":m?"same":"",index:t,msg:n,type:d,icon:u}})}),n.on("render",function(e,t){c.list=e,c.fs=t,n.fill(e);let i=e.length-1;i>=0&&n.$.find(`li[data-index="${i}"]`).get(0).scrollIntoViewIfNeeded()}),{add(e,t){n.render({type:e,time:g.now(),msg:t})},clear(){list=[],n.$.html("")},showTime(e){n.$.toggleClass("hide-time",!e)},showColor(e){n.$.toggleClass("show-color",e)},showHighlight(e){n.$.toggleClass("show-highlight",e)},showBorder(e){n.$.toggleClass("show-border",e)}}}),f.view("/Log",function(e,t,n){const i=t.require("API"),r=t.require("Header"),o=t.require("List");n.on("init",function(){r.on({cmd:{clear:function(){u.confirm("确认要清空服务器端的日志列表？",function(){i.clear()})},close:function(){panel.fire("close")}},check:{time:function(e){o.showTime(e)},color:function(e){o.showColor(e)},highlight:function(e){o.showHighlight(e)},border:function(e){o.showBorder(e)}}}),o.on({cmd:function(e,t){panel.fire("cmd",[e,t])}}),i.on("success",{get:function(e,t){r.render(),o.render(e,t)},clear:function(){o.clear()}})}),n.on("render",function(){i.get()})}),f("/MD5/List/GridView/Data",function(e,t,n){return{parse(e,t){let n={},i={},r={};return e.forEach(e=>{let{file:t,md5:r}=e,o=n[r];o||(o=n[r]=[]),o.push(t),i[t]=r}),e=[],v.keys(i).sort().forEach(o=>{let l=i[o];if(r[l])return;r[l]=!0;let s=n[l];t&&s.length<2||(s=s.sort(),e.push({md5:l,files:s}))}),e}}}),f.panel("/MD5/List/GridView",function(e,t,n){const i=e("GridView"),r=t.require("Data");let o=null,l=null;return n.on("init",function(){n.template({file:function(e){return{index:0,file:e.file}},files:{"":function(e){return{items:this.fill("item",e.list)}},item:function(e,t){return{index:t,file:e.file}}}}),o=n.template(),(l=new i({container:n.$,primaryKey:"md5",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"MD5",name:"md5",width:300,class:"name",dragable:!0},{caption:"文件",name:"file",width:700,class:"file",dragable:!0,delegate:"[data-cmd]"}]})).on("process","row",function(e){let t=e.data;e.class=t.files.length>1?"multi":""}),l.on("process","cell",{file:function(e){let t=e.row.data.files.map(e=>({file:e}));return t.length>1?html=o.fill("files",{list:t}):html=o.fill("file",t[0]),html}}),l.on("click","cell",function(e,t){let{cmd:i,index:r}=t.target.dataset;if(i){t.stopPropagation();let o=e.row.data.files[+r];n.fire("cmd",[i,o])}}),l.render()}),n.on("render",function(e,t){e=r.parse(e,t),l.fill(e)}),{setHeight(e){n.$.height(e)}}}),f.panel("/MD5/List/Header",function(e,t,n){const i=e("CheckBox");let r=null;n.on("init",function(){(r=new i({fireNow:!0,container:n.$.find('[data-id="chk-repeat"]'),text:"仅显示重复文件"})).on("checked",function(e){n.fire("multi",[e])})}),n.on("render",function(e){r.render({checked:e})})}),f.panel("/MD5/List",function(e,t,n){const i=t.require("Header"),r=t.require("GridView");let o={list:[]};return n.on("init",function(){i.on({multi:function(e){s.log(e),r.render(o.list,e)}}),r.on({cmd:function(e,t){n.fire("cmd",[e,t])}})}),n.on("render",function(e){o.list=e,i.render(!1)}),{setHeight(e){r.setHeight(e)}}}),f("/MD5/API",function(e,t,n){const i=e("@definejs/emitter"),r=e("@definejs/loading"),o=e("API");let l=new i,s=new r({mask:0});return{on:l.on.bind(l),get:function(){let e=new o("MD5.get",{});e.on({request:function(){s.show("加载中...")},response:function(){s.hide()},success:function(e,t,n){l.fire("success","get",[e])},fail:function(e,t,n,i){u.alert("获取 md5 列表失败: {0}",t)},error:function(e,t,n,i){u.alert("获取 md5 列表错误: 网络繁忙，请稍候再试")}}),e.get()}}}),f.view("/MD5",function(e,t,i){const r=e("$"),o=t.require("API"),l=t.require("List");i.on("init",function(){function e(){let e=i.$.height();l.setHeight(e-100)}r(n).on("resize",function(t){e()}),o.on("success",{get:function(t){l.render(t),e()}}),l.on({cmd:function(e,t){i.fire("cmd",e,[t])}})}),i.on("render",function(){o.get()})}),f("/Terminal/Command/FS",function(e,t,n){const i=e("@definejs/loading"),r=e("@definejs/emitter"),o=e("API");let l=new r,s=new i({mask:0});return{on:l.on.bind(l),get:function(){let e=new o("FileList.read",{});e.on({request:function(){s.show("加载中...")},response:function(){s.hide()},success:function(e,t,n){l.fire("success",[e])},fail:function(e,t,n,i){u.alert("获取文件列表失败: {0}",t)},error:function(e,t,n,i){u.alert("获取文件列表错误: 网络繁忙，请稍候再试")}}),e.get({id:"/"})}}}),f("/Terminal/Command/Source",function(e,t,n){const i=e("@definejs/query");let r=new(e("@definejs/emitter")),o=u.config("API"),l=null;return n={on:r.on.bind(r),open:function(e){let t=e.split(" ");e=t[0],t=t.slice(1);let c=i.add(`${o.url}sse/Terminal.exec`,{cmd:e,args:JSON.stringify(t)});n.close(),(l=new EventSource(c)).addEventListener("open",function(e){}),l.addEventListener("stdout",function(e){let t=JSON.parse(e.data);r.fire("stdout",[t])}),l.addEventListener("error",function(e){let{data:t}=e;if(t===M)return u.alert("服务器可能已经关闭了。"),void n.close();(t=JSON.parse(t)).msg=JSON.stringify(JSON.parse(t.msg),null,4),r.fire("error",[t])}),l.addEventListener("stderr",function(e){let t=JSON.parse(e.data);r.fire("stderr",[t])}),l.onmessage=function(e){s.log("onmessage",e)}},close(){if(l)return l.close(),l=null,!0}}}),f("/Terminal/Footer/History",function(e,t,n){let i=new(e("@definejs/local-storage"))(t.id),r=i.get("list")||[],o={index:r.length};return{get(e){let t=o.index+e;if(!(t<0||t>=r.length))return o.index=t,r[t]},push(e){r.push(e),i.set("list",r),o.index=r.length}}}),f.panel("/Terminal/Footer/Input",function(e,t,n){let i=null;return n.on("init",function(){i=n.$.get(0),n.$.on("keyup",function(e){let t=e.keyCode,i=e.target.value;if(13==t&&i)return n.fire("enter",[i]),void(e.target.value="")}),n.$.on("keydown",function(e){let t=e.keyCode;if(38!=t&&40!=t);else{e.preventDefault();let i=t-39;n.fire("move",[i])}}),n.$.on("focusin",function(){n.fire("focus",[!0])}),n.$.on("focusout",function(){n.fire("focus",[!1])})}),n.on("render",function(e){i.value=e||"",i.focus()}),{focus(){i.focus()}}}),f.panel("a",function(e,t,n){const i=e("DropList");let r=null,o=[{id:"0",name:"全部"}],l={};n.on("init",function(){(r=new i({container:n.$.find(">div"),columns:["name"],empty:!1,field:{id:"id",text:"name",focus:"name",title:"name"}})).on({error:function(e,t){u.alert(t)},process:function(e){},select:function(e,t){let i=t.index,r=JSON.stringify(o);l[r]=i,n.fire("change",[e.item.value])}})}),n.on("render",function(e){o=e;let t=JSON.stringify(e),n=l[t]||0;r.render(),r.fill(o),r.select(n)})}),f("/Terminal/Logs/List/Colors",function(e,t,n){let i={reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29],black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],gray:[90,39],brightRed:[91,39],brightGreen:[92,39],brightYellow:[93,39],brightBlue:[94,39],brightMagenta:[95,39],brightCyan:[96,39],brightWhite:[97,39],bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgGray:[100,49],bgBrightRed:[101,49],bgBrightGreen:[102,49],bgBrightYellow:[103,49],bgBrightBlue:[104,49],bgBrightMagenta:[105,49],bgBrightCyan:[106,49],bgBrightWhite:[107,49]};return{render(e){let t=e;return v.keys(i).forEach(function(e){let n=i[e],r=`[${n[0]}m`,o=`[${n[1]}m`;t=(t=t.split(r).join(`<span class="colors ${e}">`)).split(o).join("</span>")}),t}}}),f("/Terminal/Logs/List/File",function(e,t,n){const i=e("@definejs/string");let r={fs:null,files:[]};return{render(e,t){if(!t)return e;let{files:n}=function(e){if(e===r.fs)return r;let{list:t,root:n}=e;n.endsWith("/")&&(n=n.slice(0,-1));let i=t.map(e=>`${n}${e.name}`);return i=i.sort(function(e,t){return e.length>t.length?-1:1}),r.fs=e,r.files=i,r}(t);return n.forEach((t,n)=>{let r=`<a data-cmd="file" data-value="{${n}}">{${n}}</a>`;e=i.replaceAll(e,t,r)}),e=i.format(e,n)}}}),f("/Terminal/Logs/List/HTML",function(e,t,n){return{render(e){if("string"!=typeof e)return"";return e=(e=(e=(e=(e=e.replace(/[<>]/g,function(e){return"&#"+e.charCodeAt(0)+";"})).split(" ").join('<b class="empty"></b>')).split("│").join('<b class="linkY">│</b>')).split("\r\n").join("<br />")).split("\n").join("<br />")}}}),f.panel("/Terminal/Logs/Header",function(e,t,n){const i=e("CheckBox");let r=[{id:"time",cmd:"time",checked:!0,fireNow:!0,text:"时间"},{id:"color",cmd:"color",checked:!0,fireNow:!0,text:"彩色"},{id:"highlight",cmd:"highlight",checked:!1,fireNow:!0,text:"高亮当前行"},{id:"border",cmd:"border",checked:!1,fireNow:!0,text:"边线"}];return n.on("init",function(){n.$on("click",{"[data-cmd]":function(e){let{cmd:t}=e.currentTarget.dataset;n.fire("cmd",t,[])}}),r=r.map(e=>{let t=new i({checked:e.checked,fireNow:e.fireNow,text:e.text,container:n.$.find(`[data-id="chk-${e.id}"]`)});return t.on("checked",function(t){n.fire("check",e.cmd,[t])}),t})}),n.on("render",function(){r.forEach(e=>{e.render()})}),{close(e){}}}),f.panel("/Terminal/Logs/List",function(e,t,n){const i=e("@definejs/date"),r=t.require("Colors"),o=t.require("File"),l=t.render("HTML");let s=null,c=[],a={input:'<i class="fas fa-terminal"></i>',info:'<i class="fas fa-info-circle"></i>',stdout:""};return n.on("init",function(){s=n.template(),n.$on("click",{"[data-cmd]":function(e){let{cmd:t,value:i}=e.target.dataset;n.fire("cmd",[t,i])}})}),n.on("render",function(e,t){let{msg:d,time:u,type:f}=e;c.push(e),u=i.format(u,"HH:mm:ss"),d=l.render(d),d=r.render(d),d=o.render(d,t);let m=a[f=f||"stdout"]||"",h=c.length-1,g=c[h-1],p=!1;if(g){p=u==i.format(g.time,"HH:mm:ss")}let w=s.fill({time:u,"same-time":p?"same":"",index:h,msg:d,type:f,icon:m});n.$.append(w),n.$.find(`[data-index="${h}"]`).get(0).scrollIntoViewIfNeeded()}),{add(e,t){n.render({type:e,time:g.now(),msg:t})},clear(){c=[],n.$.html("")},showTime(e){n.$.toggleClass("hide-time",!e)},showColor(e){n.$.toggleClass("show-color",e)},showHighlight(e){n.$.toggleClass("show-highlight",e)},showBorder(e){n.$.toggleClass("show-border",e)}}}),f("/Terminal/Command",function(e,t,n){const i=e("@definejs/emitter"),r=t.require("Source"),o=t.require("FS");let l=new i,s={cmd:"",fs:null,init:!1};return{on:l.on.bind(l),run(e){s.cmd=e,s.init||(s.init=!0,o.on("success",function(e){s.fs=e,r.open(s.cmd)}),r.on("stdout",function(e){e.type="stdout",l.fire("data",[e,s.fs])}),r.on("stderr",function(e){e.type="stderr",l.fire("data",[e,s.fs])}),r.on("error",function(e){e.type="error",l.fire("data",[e,s.fs])})),s.fs?r.open(e):o.get()},close:()=>r.close()}}),f.panel("/Terminal/Footer",function(e,t,n){const i=t.require("History"),r=t.require("Input");return n.on("init",function(){r.on({enter:function(e){i.push(e),n.fire("submit",[e])},focus:function(e){n.$.toggleClass("focus",e)},move:function(e){let t=i.get(e);r.render(t)}})}),n.on("render",function(){r.render("")}),{}}),f.panel("/Terminal/Logs",function(e,t,n){const i=t.require("Header"),r=t.require("List");return n.on("init",function(){i.on({cmd:{clear:function(){r.clear()},close:function(){n.fire("close")}},check:{time:function(e){r.showTime(e)},color:function(e){r.showColor(e)},highlight:function(e){r.showHighlight(e)},border:function(e){r.showBorder(e)}}}),r.on({cmd:function(e,t){n.fire("cmd",[e,t])}})}),n.on("render",function(e,t){i.render(),r.render(e,t)}),{add(e){"clear"!=e?(r.add("input",e),n.fire("add",[e])):r.clear()},close(e){e&&r.add("info","已断开连接")}}}),f.view("/Terminal",function(e,t,n){const i=t.require("Command"),r=t.require("Logs"),o=t.require("Footer");n.on("init",function(){i.on("data",function(e,t){r.render(e,t)}),r.on({cmd:function(e,t){n.fire("cmd",e,[t])},close:function(){let e=i.close();r.close(e)},add:function(e){i.run(e)}}),o.on({submit:function(e){r.add(e)}})}),n.on("render",function(){o.render()})}),f("/ModuleTree/API/Data",function(e,t,n){const i=e("@definejs/object"),r=t.data.none;function o(e){let t={};return i.each(e,function(e,n){e=function(e){return""===e?`/${r}`:e.startsWith("/")&&e.length>1?`/${r}${e}`:"/"!=e?`/${e}`:e}(e),n=n.map(function(e){return""===e&&(e=r),e}),t[e]=n}),t}function l(e,t){return!!e[t]}return{make(e){let{moduleStat:t}=e,{id$childs:n,id$parent:r,id$module:s}=t,c={"/":[]},a={"/":[]};return i.each(r,function(e,t){if(t||""===t)return;l(n,e)?c["/"].push(e):a["/"].push(e)}),i.each(n,function(e,t){let i=[],r=[];t.forEach(function(e){let t=l(n,e)?i:r,{name:o}=s[e];t.push(o)}),c[e]=i,a[e]=r}),c=o(c),a=o(a),{dir$dirs:c,dir$files:a,root:"模块树"}}}}),f.panel("/ModuleTree/Main/FileInfo",function(e,t,n){const i=e("File"),r=e("@definejs/date");let o={info:null};n.on("init",function(){n.$on("click",{'[data-cmd="file"]':function(e){let t={file:o.info.file};n.fire("cmd",["file",t])},'[data-cmd="dir"]':function(e){let t=o.info.dir;t.endsWith("/")&&(t=t.slice(0,-1));let i={file:t};n.fire("cmd",["file",i])}})}),n.on("render",function(e){let{item:t,stat:l}=e,{id$info:s,id$module:c}=l.moduleStat,a=s[t.mid],d=i.getSizeDesc(a.size),u=a.ext.slice(1)+" 文件",f=r.format(a.stat.birthtime,"yyyy-MM-dd HH:mm:ss"),m=r.format(a.stat.mtime,"yyyy-MM-dd HH:mm:ss");o.info=a,n.fill({name:a.name,file:a.file,ext:a.ext,md5:a.md5,dir:a.dir,lines:a.lines,type:u,size:d.value,sizeDesc:d.desc,birthtime:f,mtime:m,isUTF8:a.isUTF8?"是":"否"})})}),f.panel("/ModuleTree/Main/List/GridView",function(e,t,n){const i=e("GridView");let r=null,o=null;n.on("init",function(){r=n.template(),(o=new i({container:n.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"模块ID",name:"id",width:400,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"所在文件",name:"file",width:400,class:"file",dragable:!0,delegate:"[data-cmd]"},{caption:"被父模块依赖",name:"used",width:100,class:"used",dragable:!1}]})).on("process","row",function(e){let t=e.data;e.class=t.used?"":"not-used"}),o.on("process","cell",{id:function(e){let t=e.row.data;return r.fill("href",{cmd:"id",text:t.id})},file:function(e){let t=e.row.data;return r.fill("href",{cmd:"file",text:t.file})},used:function(e){let t=e.row.data;return r.fill(e.name,{text:t.used?"是":"否",class:t.used?"":"not-used"})}}),o.on("click","cell",function(e,t){let i=t.target.dataset.cmd;i&&(t.stopPropagation(),n.fire("cmd",[i,e.row.data]))}),o.render()}),n.on("render",function(e){o.fill(e)})}),f.panel("/ModuleTree/Main/List",function(e,t,n){const i=t.require("GridView");n.set("show",!1),n.on("init",function(){i.on({cmd:function(e,t){n.fire("cmd",[e,t])}})}),n.on("render",function({item:e,stat:t}){let{mid:r}=e,{ids:o,id$file:l,id$dependents:s,id$children:c}=t.moduleStat;if("string"==typeof r){o=[r,...c[r]]}let a=o.map(e=>{return{id:e,file:l[e],used:"string"==typeof s[e]}});i.render(a),n.show()})}),f.panel("/ModuleTree/Main/ModuleInfo/Children/GridView",function(e,t,n){const i=e("GridView");let r=null,o=null;n.on("init",function(){o=n.template(),(r=new i({container:n.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"模块ID",name:"id",width:400,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"所在文件",name:"file",width:400,class:"file",dragable:!0,delegate:"[data-cmd]"},{caption:"被父模块依赖",name:"used",width:100,class:"used",dragable:!1}]})).on("process","row",function(e){let t=e.data;e.class=t.used?"":"not-used"}),r.on("process","cell",{id:function(e){let t=e.row.data;return o.fill("href",{cmd:"id",text:t.id})},file:function(e){let t=e.row.data;return o.fill("href",{cmd:"file",text:t.file})},used:function(e){let t=e.row.data;return o.fill(e.name,{text:t.used?"是":"否",class:t.used?"":"not-used"})}}),r.on("click","cell",function(e,t){let i=t.target.dataset.cmd;i&&(t.stopPropagation(),n.fire("cmd",[i,e.row.data]))}),r.render()}),n.on("render",function(e){r.fill(e)})}),f.panel("/ModuleTree/Main/ModuleInfo/Childs/GridView",function(e,t,n){const i=e("GridView");let r=null,o=null;n.on("init",function(){o=n.template(),(r=new i({container:n.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"模块ID",name:"id",width:400,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"所在文件",name:"file",width:400,class:"file",dragable:!0,delegate:"[data-cmd]"},{caption:"被父模块依赖",name:"used",width:100,class:"used",dragable:!1}]})).on("process","row",function(e){let t=e.data;e.class=t.used?"":"not-used"}),r.on("process","cell",{id:function(e){let t=e.row.data;return o.fill("href",{cmd:"id",text:t.id})},file:function(e){let t=e.row.data;return o.fill("href",{cmd:"file",text:t.file})},used:function(e){let t=e.row.data;return o.fill(e.name,{text:t.used?"是":"否",class:t.used?"":"not-used"})}}),r.on("click","cell",function(e,t){let i=t.target.dataset.cmd;i&&(t.stopPropagation(),n.fire("cmd",[i,e.row.data]))}),r.render()}),n.on("render",function(e){r.fill(e)})}),f.panel("/ModuleTree/Main/ModuleInfo/Dependents/GridView",function(e,t,n){const i=e("GridView");let r=null,o=null;n.on("init",function(){o=n.template(),(r=new i({container:n.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"模块ID",name:"id",width:400,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"所在文件",name:"file",width:400,class:"file",dragable:!0,delegate:"[data-cmd]"}]})).on("process","cell",{id:function(e){let t=e.row.data;return o.fill("href",{cmd:"id",text:t.id})},file:function(e){let t=e.row.data;return o.fill("href",{cmd:"file",text:t.file})}}),r.on("click","cell",function(e,t){let i=t.target.dataset.cmd;i&&(t.stopPropagation(),n.fire("cmd",[i,e.row.data]))}),r.render()}),n.on("render",function(e){r.fill(e)})}),f.panel("/ModuleTree/Main/ModuleInfo/Privates/GridView",function(e,t,n){const i=e("GridView");let r=null,o=null;n.on("init",function(){o=n.template(),(r=new i({container:n.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"模块ID",name:"id",width:400,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"所在文件",name:"file",width:400,class:"file",dragable:!0,delegate:"[data-cmd]"}]})).on("process","cell",{id:function(e){let t=e.row.data;return o.fill("href",{cmd:"id",text:t.id})},file:function(e){let t=e.row.data;return o.fill("href",{cmd:"file",text:t.file})}}),r.on("click","cell",function(e,t){let i=t.target.dataset.cmd;i&&(t.stopPropagation(),n.fire("cmd",[i,e.row.data]))}),r.render()}),n.on("render",function(e){r.fill(e)})}),f.panel("/ModuleTree/Main/ModuleInfo/Publics/GridView",function(e,t,n){const i=e("GridView");let r=null,o=null;n.on("init",function(){o=n.template(),(r=new i({container:n.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"模块ID",name:"id",width:400,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"所在文件",name:"file",width:400,class:"file",dragable:!0,delegate:"[data-cmd]"}]})).on("process","cell",{id:function(e){let t=e.row.data.id;if(!t.startsWith("@"))return o.fill("href",{cmd:"id",text:t})},file:function(e){let t=e.row.data;return o.fill("href",{cmd:"file",text:t.file||""})}}),r.on("click","cell",function(e,t){let i=t.target.dataset.cmd;i&&(t.stopPropagation(),n.fire("cmd",[i,e.row.data]))}),r.render()}),n.on("render",function(e){r.fill(e)})}),f.panel("/ModuleTree/Main/ModuleInfo/Siblings/GridView",function(e,t,n){const i=e("GridView");let r=null,o=null;n.on("init",function(){o=n.template(),(r=new i({container:n.$,primaryKey:"id",check:!1,order:!0,class:"",footer:!1,fields:[{caption:"模块ID",name:"id",width:400,class:"name",dragable:!0,delegate:"[data-cmd]"},{caption:"所在文件",name:"file",width:400,class:"file",dragable:!0,delegate:"[data-cmd]"},{caption:"被父模块依赖",name:"used",width:100,class:"used",dragable:!1}]})).on("process","row",function(e){let t=e.data;e.class=t.used?"":"not-used"}),r.on("process","cell",{id:function(e){let t=e.row.data;return o.fill("href",{cmd:"id",text:t.id})},file:function(e){let t=e.row.data;return o.fill("href",{cmd:"file",text:t.file})},used:function(e){let t=e.row.data;return o.fill(e.name,{text:t.used?"是":"否",class:t.used?"":"not-used"})}}),r.on("click","cell",function(e,t){let i=t.target.dataset.cmd;i&&(t.stopPropagation(),n.fire("cmd",[i,e.row.data]))}),r.render()}),n.on("render",function(e){r.fill(e)})}),f.panel("/ModuleTree/Main/ModuleInfo/Base",function(e,t,n){let i=t.data.none,r={parent:""};n.on("init",function(){n.$on("click",{"[data-cmd]":function(e){let t=e.target.dataset.cmd,i={id:r.parent};n.fire("cmd",[t,i])}})}),n.on("render",function(e){let{item:t,stat:o}=e,{id$module:l,id$parent:s}=o.moduleStat,c=t.mid,a=l[c],d=s[c];""===d&&(d=i),r.parent=d,n.fill({id:a.id,name:a.name,parent:d||"",method:a.method,"factory-type":a.factory.type})})}),f.panel("/ModuleTree/Main/ModuleInfo/Children",function(e,t,n){const i=t.require("GridView");n.set("show",!1),n.on("init",function(){i.on({cmd:function(e,t){n.fire("cmd",[e,t])}})}),n.on("render",function(e){let{item:t,stat:r}=e,{id$children:o,id$file:l,id$dependents:s}=r.moduleStat,c=o[t.mid]||[];if(!c.length)return void n.hide();let a=c.map(e=>{return{id:e,file:l[e],used:"string"==typeof s[e]}});i.render(a),n.show()})}),f.panel("/ModuleTree/Main/ModuleInfo/Childs",function(e,t,n){const i=t.require("GridView");n.set("show",!1),n.on("init",function(){i.on({cmd:function(e,t){n.fire("cmd",[e,t])}})}),n.on("render",function(e){let{item:t,stat:r}=e,{id$childs:o,id$file:l,id$dependents:s}=r.moduleStat,c=o[t.mid]||[];if(!c.length)return void n.hide();let a=c.map(e=>{return{id:e,file:l[e],used:"string"==typeof s[e]}});i.render(a),n.show()})}),f.panel("/ModuleTree/Main/ModuleInfo/Dependents",function(e,t,n){const i=t.require("GridView");n.set("show",!1),n.on("init",function(){i.on({cmd:function(e,t){n.fire("cmd",[e,t])}})}),n.on("render",function(e){let{item:t,stat:r}=e,{id$dependents:o,id$file:l}=r.moduleStat,s=o[t.mid];if(!s)return void n.hide();m.isArray(s)||(s=[s]);let c=s.map(e=>{return{id:e,file:l[e]}});i.render(c),n.show()})}),f.panel("/ModuleTree/Main/ModuleInfo/Privates",function(e,t,n){const i=t.require("GridView");n.set("show",!1),n.on("init",function(){i.on({cmd:function(e,t){n.fire("cmd",[e,t])}})}),n.on("render",function(e){let{item:t,stat:r}=e,{id$privates:o,id$file:l}=r.moduleStat,s=t.mid,c=o[s]||[];if(!c.length)return void n.hide();let a=s,d=c.map(e=>{let t=`${a}/${e}`;return{id:t,file:l[t]}});i.render(d),n.show()})}),f.panel("/ModuleTree/Main/ModuleInfo/Publics",function(e,t,n){const i=t.require("GridView");n.set("show",!1),n.on("init",function(){i.on({cmd:function(e,t){n.fire("cmd",[e,t])}})}),n.on("render",function(e){let{item:t,stat:r}=e,{id$publics:o,id$file:l}=r.moduleStat,s=o[t.mid]||[];if(!s.length)return void n.hide();let c=s.map(e=>{return{id:e,file:l[e]}});i.render(c),n.show()})}),f.panel("/ModuleTree/Main/ModuleInfo/Siblings",function(e,t,n){const i=t.require("GridView");n.set("show",!1),n.on("init",function(){i.on({cmd:function(e,t){n.fire("cmd",[e,t])}})}),n.on("render",function(e){let{item:t,stat:r}=e,{id$siblings:o,id$file:l,id$dependents:s}=r.moduleStat,c=o[t.mid]||[];if(!c.length)return void n.hide();let a=c.map(e=>{return{id:e,file:l[e],used:"string"==typeof s[e]}});i.render(a),n.show()})}),f.panel("/ModuleTree/Main/ModuleInfo",function(e,t,n){const i=t.require("Base"),r=t.require("Childs"),o=t.require("Children"),l=t.require("Siblings"),s=t.require("Publics"),c=t.require("Privates"),a=t.require("Dependents");n.on("init",function(){[i,r,o,l,s,c,a].forEach(e=>{e.on({cmd:function(e,t){n.fire("cmd",[e,t])}})})}),n.on("render",function(e){i.render(e),l.render(e),s.render(e),c.render(e),a.render(e)})}),f.panel("/ModuleTree/Main/Tree/Header",function(e,t,n){const i=e("CheckBox");let r=[{id:"secondary",text:"文件",chk:null},{id:"icon",text:"图标",chk:null},{id:"tab",text:"缩进",chk:null},{id:"color",text:"彩色",chk:null},{id:"hover",text:"悬停",chk:null}];n.on("init",function(){r.forEach(e=>{let t=new i({fireNow:!0,container:n.$.find(`[data-id="chk-${e.id}"]`),text:e.text});t.on("checked",function(t){n.fire("check",[{[e.id]:t}])}),e.chk=t}),n.$on("click","[data-cmd]",function(e){let{cmd:t}=e.target.dataset;n.fire("cmd",t,[])})}),n.on("render",function(e){r.forEach(t=>{let n=e[t.id];t.chk.render({checked:n})})})}),f.panel("/ModuleTree/Main/Tree/Main",function(e,t,i){const r=e("TextTree"),o=e("Clipboard");let l=null,s={$view:null};function c(e){if(e&&(s.$view=e),!s.$view)return;let t=s.$view.height();i.$.height(t-139)}return i.on("init",function(){(l=new r({container:i.$,secondaryKey:"file"})).on("cmd",function(e,t){i.fire("cmd",[e,t])}),$(n).on("resize",function(e){c()})}),i.on("render",function(e){let{id:t,ids:n,id$file:r,$view:o}=e,s=n.map(e=>{return{id:e,file:r[e]}});l.render(s),"string"==typeof t&&l.highlight(t),c(o),i.fire("render")}),{check(e){l.toggle(e)},copy(){let e=l.toString();o.copy(e)}}}),f.panel("/ModuleTree/Main/Tree",function(e,t,n){const i=t.require("Header"),r=t.require("Main");n.on("init",function(){i.on("check",function(e){r.check(e)}),i.on("cmd",{copy:function(){r.copy()}}),r.on({cmd:function(e,t){n.fire("cmd",[e,t])},render:function(){i.render({secondary:!1,icon:!1,tab:!0,color:!0,hover:!1})}})}),n.on("render",function({item:e,stat:t},n){let{mid:i}=e,{ids:o,id$children:l,id$file:s,id$parents:c}=t.moduleStat;if("string"==typeof i){let e=l[i],t=c[i];o=[...t=t.slice(0).reverse(),i,...e]}r.render({id:i,ids:o,id$file:s,$view:n})})}),f.panel("/ModuleTree/Main/MarkDoc",function(e,t,n){const i=e("@definejs/escape"),r=e("MarkDoc");let o=null,l=[".json",".js",".css",".html"];return n.on("init",function(){(o=new r({container:n.$})).on("render",function(){let e=o.getOutlines();n.fire("render",[e])})}),n.on("render",function(e){let{item:t,stat:r}=e,{moduleStat:s,htmlStat:c}=r,{id$info:a}=s,d=a[t.mid],{content:u,ext:f}=d,m="",h=!0;"source"==e.type?(u=i.html(u),m=f.slice(1),h=!1):l.includes(f)&&(m=f.slice(1)),o.render({content:u,language:m,baseUrl:"",code:{format:h}}),n.$.toggleClass("image",!1)}),{outline:function(e){o.toOutline(e)}}}),f.panel("/ModuleTree/Main/Tabs",function(e,t,n){const i=e("@definejs/tabs");let r=[{name:"模块信息",cmd:"module"},{name:"文件信息",cmd:"file"},{name:"文件内容",cmd:"content"},{name:"组织架构",cmd:"tree",root:!0},{name:"模块列表",cmd:"list",root:!0}],o=[],l=null,s={index:0};n.on("init",function(){(l=new i({container:n.$.get(0),activedClass:"on",eventName:"click",selector:">li",repeated:!0})).on("change",function(e,t){s.index=t,e=o[t],n.fire(e.cmd)})}),n.on("render",function(e){o=r,e&&(o=o.filter(e=>e.root)),l.render(o,function(e,t){return{index:t,name:e.name}}),s.index>o.length-1&&(s.index=0),l.active(s.index)})}),f.panel("/ModuleTree/Main",function(e,t,n){const i=t.require("Tabs"),r=t.require("MarkDoc"),o=t.require("FileInfo"),l=t.require("ModuleInfo"),s=t.require("Tree"),c=t.require("List");let a={item:null,stat:null};return n.on("init",function(){i.on({module:function(){l.render(a),o.hide(),r.hide(),s.hide(),c.hide()},file:function(){l.hide(),o.render(a),r.hide(),s.hide(),c.hide()},content:function(){l.hide(),o.hide(),r.render(a),s.hide(),c.hide()},tree:function(){l.hide(),o.hide(),r.hide(),s.render(a,n.$),c.hide()},list:function(){l.hide(),o.hide(),r.hide(),s.hide(),c.render(a)}}),o.on("cmd",function(e,t){n.fire("cmd",[e,t])}),l.on("cmd",function(e,t){n.fire("cmd",[e,t])}),s.on("cmd",function(e,t){n.fire("cmd",[e,t])}),c.on("cmd",function(e,t){n.fire("cmd",[e,t])})}),n.on("render",function(e){a.item=e.item,a.stat=e.stat;let t=a.item.mid===M;i.render(t)}),{resize:function(e,t){let i=`calc(100% - ${t}px)`;n.$.css({width:i})}}}),f("/ModuleTree/Tree/Main/Data",function(e,t,n){const i=t.data.none;function r(e){let t=`/${i}`;return e.startsWith(t)?e=e.slice(t.length):e.startsWith("/")&&(e=e.slice("/".length)),e}return{toTree:function(e){let t=function e(t,n){let i=t.dir$files;return t.dir$dirs[n].map(function(o){let l=n+"/"+o;l=l.replace(/\/+/g,"/");let s=e(t,l),c=i[l];c=c.map(function(e){let t=l+"/"+e;return{name:e,id:t,mid:r(t),data:{type:"file",name:t,parent:l}}}),(s=[...s,...c]).length||s.push({name:"(空目录)",id:l+"/",data:{type:"file",name:"",parent:l}});let a=r(l);return{name:o,id:l,mid:a,data:{type:"dir",name:l,parent:n},list:s}})}(e,"/"),n=e.dir$files["/"];return n=n.map(function(e){let t="/"+e;return{name:e,id:t,mid:r(t),data:{type:"file",name:t,parent:"/"}}}),t=[...t,...n],[{name:e.root.split("/").slice(-1)[0],id:"/",open:!0,foldable:!1,data:{type:"dir",name:"/"},list:t}]}}}),f("/ModuleTree/Tree/Resizer/Masker",function(e,t,n){const i=e("@definejs/masker");let r=null;return{show(){(r=r||new i({opacity:0})).show()},hide(){r&&r.hide()}}}),f.panel("/ModuleTree/Tree/Header",function(e,t,n){const i=e("CheckBox");let r=null,o={dirOnly:!1};n.on("init",function(){(r=new i({fireNow:!0,container:n.$.find('[data-id="chk-dir-only"]'),text:"仅目录"})).on("checked",function(e){o.dirOnly=e,n.fire("dir-only",[e])}),n.$on("click",{"[data-cmd]":function(e){let{cmd:t}=this.dataset;n.fire(t)}})}),n.on("render",function(e){e=e||{},n.$.toggleClass("back",!!e.back),n.$.toggleClass("forward",!!e.forward),n.$.toggleClass("up",!!e.up),n.$.toggleClass("root",!!e.root),n.$.toggleClass("dir-only",!!e.dirOnly),r.render({checked:o.dirOnly})})}),f.panel("/ModuleTree/Tree/Main",function(e,t,n){const i=e("MenuTree"),r=t.require("Data");let o=null,l={item:null,index:-1,list:[]};return n.on("init",function(){function e(e){e!==l.item&&(l.index++,l.list[l.index]=e,l.item=e,n.fire("item",[e,{back:l.index>0,forward:l.index<l.list.length-1,up:!(!e||!e.parent),root:!!e.parent,dirOnly:"dir"==e.data.type}]),n.fire(e.data.type,[e]))}(o=new i({container:n.$})).on({fill:function(e){},item:function(t){let n=t.id;"/"!=n&&n.endsWith("/")?o.open(t.parent.id):e(t)},open:function(t){e(t)},close:function(t){e(t)},icon:function(e,t){},delete:function(e){this.open(e.parent)}}),o.render()}),n.on("render",function(e){let t=r.toTree(e);s.log(t),l.item=null,l.list=[],l.index=-1,l.push=!0,o.fill(t)}),{open:function(e){o.get(e)?o.open(e):u.alert("不存在节点: "+e,function(){})},back:function(){let e=l.index-1,t=l.list[e];t&&(l.index=e-1,this.open(t))},forward:function(){let e=l.index+1,t=l.list[e];t&&this.open(t)},up:function(){let e=l.item,t=e?e.parent:null;t&&this.open(t)},root:function(){this.open("/")},dirOnly:function(e){n.$.toggleClass("dir-only",!!e)}}}),f.panel("/ModuleTree/Tree/Resizer",function(e,t,n){const r=t.require("Masker");n.on("init",function(){let e=!1,t=0,o="",l=i.body,s=n.$.get(0);$(l).on({mousedown:function(i){i.target===s&&(e=!0,t=i.pageX,o=l.style.cursor,l.style.cursor="w-resize",r.show(),n.fire("start"))},mousemove:function(i){if(!e)return;let r=i.pageX-t;n.fire("change",[r])},mouseup:function(t){e&&(e=!1,l.style.cursor=o,r.hide(),n.fire("stop"))}})}),n.on("render",function(e){})}),f.panel("/ModuleTree/Tree",function(e,t,n){const i=t.require("Header"),r=t.require("Main"),o=t.require("Resizer"),l=t.data.none;return n.on("init",function(){r.on({item:function(e,t){n.fire("item",[e]),i.render(t)},dir:function(e){n.fire("dir",[e])},file:function(e){n.fire("dir",[e])}}),i.on({back:function(){r.back()},forward:function(){r.forward()},up:function(){r.up()},root:function(){r.root()},"dir-only":function(e){r.dirOnly(e)}})}),n.on("init",function(){function e(){return n.$.outerWidth()}function t(e){n.$.outerWidth(e)}let i=e();o.on({change:function(e){let r=i+e;r<220?t(220):(t(r),n.fire("resize","change",[e,r]))},stop:function(){i=e(),n.fire("resize","stop")}})}),n.on("render",function(e){i.render(),r.render(e),o.render()}),{open:function(e,t){if(t)if(e.startsWith("/")){let t=`/${l}`;e.startsWith(t)||(e=`${t}${e}`)}else e=`/${e}`;r.open(e)}}}),f("/ModuleTree/API",function(e,t,n){const i=e("@definejs/emitter"),r=e("@definejs/loading"),o=e("API"),l=t.require("Data");let s=new i,c=new r({mask:0});return{on:s.on.bind(s),get:function(){let e=new o("Stat.get",{});e.on({request:function(){c.show("加载中...")},response:function(){c.hide()},success:function(e,t,n){let i=l.make(e);s.fire("success","get",[e,i])},fail:function(e,t,n,i){u.alert("获取模块列表失败: {0}",t)},error:function(e,t,n,i){u.alert("获取模块列表错误: 网络繁忙，请稍候再试")}}),e.get()}}}),f.view("/ModuleTree",function(e,t,n){const i=e("@definejs/session-storage"),r=t.require("API"),o=t.require("Tree"),l=t.require("Main");let s=new i(t.id),c={item:{id:"/"},stat:null};n.on("init",function(){r.on("success",{get:function(e,t){c.stat=e,o.render(t),o.open(c.item.id)}}),o.on({item:function(e){s.set("id",e.id),c.item=e,l.render(c)},resize:{change:function(e,t){l.resize(e,t)},stop:function(){l.resize(!0)}}}),l.on({cmd:function(e,t){"id"==e?o.open(t.id,!0):n.fire("cmd",e,[t])}})}),n.on("render",function(e){let t=e||s.get("id")||"/";c.item={id:t},r.get()})}),f.route("FileList",function(e,t){const n=t.require("Master");return{edit:function(e){n.open("DocAdd","写文档",[{id:e}])},use:function(e){n.open("DocAdd","写文档",[{content:e.content,ext:e.ext}])},sidebar:function(e){n.open("SideMenus",[e])},topmenu:function(e){n.open("TopMenus",[e])}}}),f.route("MD5",function(e,t){const n=t.require("Master");return{cmd:{file:function(e){n.open("FileList",[e])}}}}),f.route("ModuleTree",function(e,t){const n=t.require("Master");return{cmd:{file:function(e){n.open("FileList",[e.file])}}}}),f.route("SideMenus",function(e,t){const n=t.require("Master");return{file:function(e){n.open("FileList",[e])}}}),f.route("Terminal",function(e,t){const n=t.require("Master");return{cmd:{file:function(e){s.log(e),n.open("FileList",[e])}}}}),u.launch(function(e,t,n){const i=t.require("Master");t.require("Loading").hide(),i.on({require:function(e){return t.require(e)},ready:function(){i.open("FileList",[])},render:function(){}}),i.render()})}(top,parent,window,document,location,localStorage,sessionStorage,window.console||{log:function(){},dir:function(){},clear:function(){},error:function(){},info:function(){},debug:function(){},warn:function(){}},history,setTimeout,setInterval,definejs,definejs.require("AppModule").define,Array,Boolean,Date,Error,Function,Math,Number,Object,RegExp,String);